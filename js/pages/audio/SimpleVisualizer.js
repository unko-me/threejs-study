var Stats=function(){var t=Date.now(),e=t,n=0,o=1/0,i=0,r=0,s=1/0,a=0,u=0,p=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",function(t){t.preventDefault(),w(++p%2)},!1),c.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(d);var l=document.createElement("div");l.id="fpsText",l.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",l.innerHTML="FPS",d.appendChild(l);var h=document.createElement("div");for(h.id="fpsGraph",h.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(h);74>h.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",h.appendChild(f)}var y=document.createElement("div");y.id="ms",y.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(y);var m=document.createElement("div");m.id="msText",m.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="MS",y.appendChild(m);var v=document.createElement("div");for(v.id="msGraph",v.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",y.appendChild(v);74>v.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(f);var w=function(t){switch(p=t){case 0:d.style.display="block",y.style.display="none";break;case 1:d.style.display="none",y.style.display="block"}};return{REVISION:11,domElement:c,setMode:w,begin:function(){t=Date.now()},end:function(){var p=Date.now();n=p-t,o=Math.min(o,n),i=Math.max(i,n),m.textContent=n+" MS ("+o+"-"+i+")";var c=Math.min(30,30-30*(n/200));return v.appendChild(v.firstChild).style.height=c+"px",u++,p>e+1e3&&(r=Math.round(1e3*u/(p-e)),s=Math.min(s,r),a=Math.max(a,r),l.textContent=r+" FPS ("+s+"-"+a+")",c=Math.min(30,30-30*(r/100)),h.appendChild(h.firstChild).style.height=c+"px",e=p,u=0),p},update:function(){t=this.end()}}};(function(){!function(){var t;return t=new Stats,t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",document.body.appendChild(t.domElement),setInterval(function(){t.begin(),t.end()},1e3/60)}()}).call(this),function(){var t;t=function(){function t(){}return t.canWebGL=function(){var t;try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return t=e,!1}},t}(),"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?exports.CanvasDetector=t:window.CanvasDetector=t}.call(this),function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}())}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t){this.option=t,this.update=e(this.update,this),this.render=e(this.render,this),this.onWindowResize=e(this.onWindowResize,this),this.setup=e(this.setup,this),this.scene=new THREE.Scene,this.setup()}return t.prototype.scene=null,t.prototype.camera=null,t.prototype.setup=function(){return this.setupCamera(),this.setupRenderer(),this.setupLights(),this.setupControl(),this.initNotify(),this._setup()},t.prototype._setup=function(){},t.prototype.initNotify=function(){return $(".notify").delay(2e3).fadeOut(1e3)},t.prototype.setupCamera=function(){return this.camera=new THREE.PerspectiveCamera(75,1.5,.1,5e3),this._setupCameraPos(),this._setupCameraLookAt()},t.prototype._setupCameraLookAt=function(){return this.camera.lookAt(new THREE.Vector3)},t.prototype._setupCameraPos=function(){return this.camera.position.set(400,1200,700)},t.prototype.setupRenderer=function(){var t;return this.renderer=Modernizr.webgl?new THREE.WebGLRenderer(null!=(t=this.option)?t.rendererParams:void 0):new THREE.CanvasRenderer,window.addEventListener("resize",this.onWindowResize),this.onWindowResize(),this._setupClearColor(),document.getElementById("renderer").appendChild(this.renderer.domElement)},t.prototype._setupClearColor=function(){var t,e,n,o,i,r;return e=(null!=(n=this.option)&&null!=(o=n.clear)?o.color:void 0)||0,t=(null!=(i=this.option)&&null!=(r=i.clear)?r.alpha:void 0)||1,this.renderer.setClearColor(e,t),this.renderer.autoClearColor=!1},t.prototype.setupLights=function(){return this._setupDirectionalLight(),this._setupAmbientLight()},t.prototype._setupAmbientLight=function(){var t,e;return(null!=(t=this.option)?t.amibientLight:void 0)?this.scene.add(new THREE.AmbientLight(null!=(e=this.option)?e.amibientLight.color:void 0)):void 0},t.prototype._setupDirectionalLight=function(){return this._directionalLight=new THREE.DirectionalLight(16777215,2),this._directionalLight.position.set(0,300,100),this.scene.add(this._directionalLight)},t.prototype.setupControl=function(){return this.control=new THREE.TrackballControls(this.camera,this.renderer.domElement)},t.prototype.onWindowResize=function(){return this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},t.prototype.render=function(){return this.renderer.render(this.scene,this.camera)},t.prototype.update=function(){var t;return null!=(t=this.control)&&t.update(),this._update(),this.render(),requestAnimationFrame(this.update)},t.prototype._update=function(){},t.prototype.startLoop=function(){return this.update()},t}(),"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?exports.BaseWorld=t:window.BaseWorld=t}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t,n,o){this._onLoad=e(this._onLoad,this);var i;this._success=n,this._error=o,window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,this._context=new AudioContext,i=new XMLHttpRequest,i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=this._onLoad,i.send()}return t.prototype._onLoad=function(t){return this.arrayBuffer=t.target.response,this.convert()},t.prototype.convert=function(){return this._context.decodeAudioData(this.arrayBuffer,function(t){return function(e){return t.audioBuffer=e,console.log("buffer end"),"function"==typeof t._success&&t._success(e),t._success=null,t._error=null}}(this))},t}(),"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?exports.AudioLoader=t:window.AudioLoader=t}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,o=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=function(t){function n(){this.stop=e(this.stop,this),this.play=e(this.play,this),this.togglePlay=e(this.togglePlay,this),this._setupAnalyser=e(this._setupAnalyser,this),this.setup=e(this.setup,this)}var i;return o(n,t),i=0,n.prototype._isPlay=!1,n.prototype.context=null,n.prototype.analyser=null,Object.defineProperties(n.prototype,{isPlay:{get:function(){return this._isPlay}}}),n.prototype.setup=function(t,e){return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,this.context=new AudioContext,this._setupAnalyser(e),this._load(t)},n.prototype._load=function(t){return this.loader=new AudioLoader(t,function(t){return function(e){return console.log("end",e),t.emit("load")}}(this))},n.prototype._setupAnalyser=function(t){return this.analyser=this.context.createAnalyser(),this.analyser.fftSize=t},n.prototype._setupOSC=function(){var t,e;return e=this.context.createOscillator(),t=this.context.createGain(),t.gain.value=.5,e.connect(t),t.connect(this.context.destination)},n.prototype.togglePlay=function(){return this._isPlay?this.stop():this.play(),this._isPlay=!this._isPlay},n.prototype.play=function(){var t;return t=this.context.createBufferSource(),t.buffer=this.loader.audioBuffer,t.playbackRate.value=1,t.loop=!0,this.analyser&&t.connect(this.analyser),t.connect(this.context.destination),t.start(0),this.source=t},n.prototype.stop=function(){return this.source&&this.source.stop(0),this.source=null},n}(EventEmitter2),"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?exports.SimpleAudioPlayer=t:window.SimpleAudioPlayer=t}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,o=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=function(t){function n(){this.togglePlay=e(this.togglePlay,this),this._onMove=e(this._onMove,this),this._onTouchMove=e(this._onTouchMove,this),this._onMoveStart=e(this._onMoveStart,this),this._onMoveEnd=e(this._onMoveEnd,this),this._setupMouseMove=e(this._setupMouseMove,this),n.__super__.constructor.call(this)}var i;return o(n,t),i=1024,n.prototype._isPlay=!1,n.prototype._mouseXFactor=.5,n.prototype._setup=function(){var t;return t=300,this.control.update(),this.camera.position.set(0,t,800),this.camera.lookAt(new THREE.Vector3(0,300,0)),this._setupAudio(),this._setupLine(),this._setupMouseMove()},n.prototype._setupMouseMove=function(){return HandEvent.supportTouch?(document.addEventListener(HandEvent.TOUCH_START,this._onMoveStart),document.addEventListener(HandEvent.TOUCH_MOVE,this._onTouchMove,!0)):document.addEventListener(HandEvent.TOUCH_MOVE,this._onMove)},n.prototype._onMoveEnd=function(){return document.removeEventListener(HandEvent.TOUCH_END,this._onMoveEnd),document.addEventListener(HandEvent.TOUCH_START,this._onMoveStart)},n.prototype._onMoveStart=function(){return document.addEventListener(HandEvent.TOUCH_END,this._onMoveEnd)},n.prototype._onTouchMove=function(t){return this._mouseXFactor=t.touches[0].pageX/window.innerWidth},n.prototype._onMove=function(t){return this._mouseXFactor=t.clientX/window.innerWidth},n.prototype._setupAudio=function(){return this.player=new SimpleAudioPlayer,this.player.on("load",function(t){return function(){return HandEvent.supportTouch?void 0:t.togglePlay()}}(this)),this.player.setup("../../sound/hakatanosio.mp3",i),this.context=this.player.context,$(document).on(HandEvent.TOUCH_START,function(t){return function(){return t.player.loader.audioBuffer?t.togglePlay():void 0}}(this)),$(document).on(HandEvent.TOUCH_END,function(){return function(){}}(this))},n.prototype.togglePlay=function(){return this.player.togglePlay()},n.prototype._setupLine=function(){var t,e,n,o,r,s,a,u;for(this.lineGeometry=new THREE.Geometry,e=[],r=i/4,a=window.innerWidth/r,n=u=0;r>=0?r>u:u>r;n=r>=0?++u:--u)s=new THREE.Vector3(n*a-.5*r*a,0,0),this.lineGeometry.vertices.push(s),t=new THREE.Color(16777215),e[n]=t,e[n].setHSL(n/r,.6,.6);return this.lineGeometry.colors=e,o=new THREE.LineBasicMaterial({color:16777215,opacity:1,linewidth:1,vertexColors:THREE.VertexColors}),this.line=new THREE.Line(this.lineGeometry,o),this.scene.add(this.line),this._addPoint()},n.prototype._addPoint=function(){return this.particleMaterial=new THREE.PointCloudMaterial({map:THREE.ImageUtils.loadTexture("../../img/katapad/yes_02.png"),transparent:!0,blending:THREE.AdditiveBlending,size:30}),this.particleGeo=this.lineGeometry.clone(),this.particle=new THREE.PointCloud(this.particleGeo,this.particleMaterial),this.particle.sortParticles=!1,this.scene.add(this.particle)},n.prototype._update=function(){var t,e;return this.player.isPlay&&(t=this._getData(),this._renderLine(t),null!=this.player.source&&(this.player.source.playbackRate.value=1*this._mouseXFactor+.5)),this.camera.lookAt(new THREE.Vector3(0,300,0)),e=-.003,this.line.rotation.y+=e,this.particle.rotation.y+=e},n.prototype._getData=function(){var t,e;return(t=this.player.analyser)?(e=new Uint8Array(t.frequencyBinCount/2),t.getByteFrequencyData(e),e):void 0},n.prototype._renderLine=function(t){var e,n,o,i,r,s;for(e=5,o=0,n=r=0,s=t.length;s>r;n=++r)i=t[n],this.lineGeometry.vertices[n].y=i*e,this.particleGeo.vertices[n].y=i*e,o+=i;return this.lineGeometry.verticesNeedUpdate=!0,this.particleGeo.verticesNeedUpdate=!0,this.particleMaterial.size=o/t.length*.3},n}(BaseWorld),"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?exports.SimpleVisualizer=t:window.SimpleVisualizer=t}.call(this);