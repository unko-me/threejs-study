var Stats=function(){var e=Date.now(),t=e,i=0,r=1/0,s=0,a=0,n=1/0,o=0,h=0,c=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(e){e.preventDefault(),y(++c%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(d);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",p.innerHTML="FPS",d.appendChild(p);var u=document.createElement("div");for(u.id="fpsGraph",u.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(u);74>u.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",u.appendChild(f)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(m);var g=document.createElement("div");g.id="msText",g.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",g.innerHTML="MS",m.appendChild(g);var v=document.createElement("div");for(v.id="msGraph",v.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(v);74>v.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(f);var y=function(e){switch(c=e){case 0:d.style.display="block",m.style.display="none";break;case 1:d.style.display="none",m.style.display="block"}};return{REVISION:11,domElement:l,setMode:y,begin:function(){e=Date.now()},end:function(){var c=Date.now();i=c-e,r=Math.min(r,i),s=Math.max(s,i),g.textContent=i+" MS ("+r+"-"+s+")";var l=Math.min(30,30-30*(i/200));return v.appendChild(v.firstChild).style.height=l+"px",h++,c>t+1e3&&(a=Math.round(1e3*h/(c-t)),n=Math.min(n,a),o=Math.max(o,a),p.textContent=a+" FPS ("+n+"-"+o+")",l=Math.min(30,30-30*(a/100)),u.appendChild(u.firstChild).style.height=l+"px",t=c,h=0),c},update:function(){e=this.end()}}};(function(){!function(){var e;return e=new Stats,e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.top="0px",document.body.appendChild(e.domElement),setInterval(function(){e.begin(),e.end()},1e3/60)}()}).call(this),function(){var e;e=function(){function e(){}return e.canWebGL=function(){var e;try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return e=t,!1}},e}(),"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof exports?exports.CanvasDetector=e:window.CanvasDetector=e}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e){this.option=e,this.update=t(this.update,this),this.render=t(this.render,this),this.onWindowResize=t(this.onWindowResize,this),this.setup=t(this.setup,this),this.scene=new THREE.Scene,this.setup()}return e.prototype.scene=null,e.prototype.camera=null,e.prototype.setup=function(){return this.setupCamera(),this.setupRenderer(),this.setupLights(),this.setupControl(),this.initNotify(),this._setup()},e.prototype._setup=function(){},e.prototype.initNotify=function(){return $(".notify").delay(2e3).fadeOut(1e3)},e.prototype.setupCamera=function(){return this.camera=new THREE.PerspectiveCamera(75,1.5,1,5e3),this._setupCameraPos(),this._setupCameraLookAt()},e.prototype._setupCameraLookAt=function(){return this.camera.lookAt(new THREE.Vector3)},e.prototype._setupCameraPos=function(){return this.camera.position.set(400,1200,700)},e.prototype.setupRenderer=function(){return this.renderer=Modernizr.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer,window.addEventListener("resize",this.onWindowResize),this.onWindowResize(),this._setupClearColor(),document.getElementById("renderer").appendChild(this.renderer.domElement)},e.prototype._setupClearColor=function(){var e,t,i,r,s,a;return t=(null!=(i=this.option)&&null!=(r=i.clear)?r.color:void 0)||0,e=(null!=(s=this.option)&&null!=(a=s.clear)?a.alpha:void 0)||1,this.renderer.setClearColor(t,e)},e.prototype.setupLights=function(){return this._setupDirectionalLight(),this._setupAmbientLight()},e.prototype._setupAmbientLight=function(){var e,t;return(null!=(e=this.option)?e.amibientLight:void 0)?this.scene.add(new THREE.AmbientLight(null!=(t=this.option)?t.amibientLight.color:void 0)):void 0},e.prototype._setupDirectionalLight=function(){return this._directionalLight=new THREE.DirectionalLight(16777215,2),this._directionalLight.position.set(0,300,100),this.scene.add(this._directionalLight)},e.prototype.setupControl=function(){return this.control=new THREE.TrackballControls(this.camera,this.renderer.domElement)},e.prototype.onWindowResize=function(){return this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},e.prototype.render=function(){return this.renderer.render(this.scene,this.camera)},e.prototype.update=function(){var e;return null!=(e=this.control)&&e.update(),this._update(),this.render(),requestAnimationFrame(this.update)},e.prototype._update=function(){},e.prototype.startLoop=function(){return this.update()},e}(),"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof exports?exports.BaseWorld=e:window.BaseWorld=e}.call(this),THREE.ColladaLoader=function(){function e(e,i,r){var s=0;if(document.implementation&&document.implementation.createDocument){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState){if(0==a.status||200==a.status)if(a.responseXML)jt=i,t(a.responseXML,void 0,e);else if(a.responseText){jt=i;var n=new DOMParser,o=n.parseFromString(a.responseText,"application/xml");t(o,void 0,e)}else console.error("ColladaLoader: Empty or non-existing file ("+e+")")}else 3==a.readyState&&r&&(0==s&&(s=a.getResponseHeader("Content-Length")),r({total:s,loaded:a.responseText.length}))},a.open("GET",e,!0),a.send(null)}else alert("Don't know how to parse XML!")}function t(e,t,i){if(Ht=e,t=t||jt,void 0!==i){var s=i.split("/");s.pop(),Rt=(s.length<1?".":s.join("/"))+"/"}r(),vt(),It=a("library_images image",C,"image"),Pt=a("library_materials material",U,"material"),Xt=a("library_effects effect",K,"effect"),zt=a("library_geometries geometry",X,"geometry"),Dt=a("library_cameras camera",at,"camera"),qt=a("library_lights light",ot,"light"),Lt=a("library_controllers controller",M,"controller"),St=a("library_animations animation",tt,"animation"),_t=a("library_visual_scenes visual_scene",O,"visual_scene"),Ct=[],Mt=[],Nt=n(),At=new THREE.Object3D;for(var o=0;o<Nt.nodes.length;o++)At.add(y(Nt.nodes[o]));At.scale.multiplyScalar(Vt),h();var c={scene:At,morphs:Ct,skins:Mt,animations:kt,dae:{images:It,materials:Pt,cameras:Dt,lights:qt,effects:Xt,geometries:zt,controllers:Lt,animations:St,visualScenes:_t,scene:Nt}};return t&&t(c),c}function i(e){Gt=e}function r(){var e=Ht.querySelectorAll("asset"),t=e[0];if(t&&t.childNodes)for(var i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];switch(r.nodeName){case"unit":var s=r.getAttribute("meter");s&&(Vt=parseFloat(s));break;case"up_axis":Zt=r.textContent.charAt(0)}}}function a(e,t,i){for(var r=Ht.querySelectorAll(e),s={},a=0,n=r.length,o=0;n>o;o++){var h=r[o],c=(new t).parse(h);c.id&&0!=c.id.length||(c.id=i+a++),s[c.id]=c}return s}function n(){var e=Ht.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return _t[t.length>0?t:"visual_scene0"]}return null}function h(){kt=[],c(At)}function c(e){var t=Nt.getChildById(e.id,!0),i=null;if(t&&t.keys){i={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},kt.push(i);for(var r=0,s=t.keys.length;s>r;r++)i.length=Math.max(i.length,t.keys[r].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(var r=0,s=e.children.length;s>r;r++)for(var a=c(e.children[r]),n=0,o=a.hierarchy.length;o>n;n++)i.hierarchy.push({keys:[],sids:[]});return i}function l(){var e,t=1e6,i=-t,r=0;for(var s in St){var a=St[s];e=e||a.id;for(var n=0;n<a.sampler.length;n++){var o=a.sampler[n];o.create(),t=Math.min(t,o.startTime),i=Math.max(i,o.endTime),r=Math.max(r,o.input.length)}}return{start:t,end:i,frames:r,ID:e}}function d(e,t){var i=t instanceof L?Lt[t.url]:t;if(!i||!i.morph)return void console.log("could not find morph controller!");for(var r=i.morph,s=0;s<r.targets.length;s++){var a=r.targets[s],n=zt[a];if(n.mesh&&n.mesh.primitives&&n.mesh.primitives.length){var o=n.mesh.primitives[0].geometry;o.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:o.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}function p(e,t,i,r){if(e.world=e.world||new THREE.Matrix4,e.localworld=e.localworld||new THREE.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var s=e.channels[0],a=s.sampler.output[i];a instanceof THREE.Matrix4&&(e.world.copy(a),e.localworld.copy(a),0==i&&e.matrix.copy(a))}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var n=0;n<e.nodes.length;n++)p(e.nodes[n],t,i,e.world)}function u(e,t){for(var i=0;i<e.length;i++){var r=e[i],s=-1;if("JOINT"==r.type){for(var a=0;a<t.joints.length;a++)if(r.sid==t.joints[a]){s=a;break}if(s>=0){var n=t.invBindMatrices[s];r.invBindMatrix=n,r.skinningMatrix=new THREE.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,n),r.animatrix=new THREE.Matrix4,r.animatrix.copy(r.localworld),r.weights=[];for(var a=0;a<t.weights.length;a++)for(var o=0;o<t.weights[a].length;o++){var h=t.weights[a][o];h.joint==s&&r.weights.push(h)}}else console.warn("ColladaLoader: Could not find joint '"+r.sid+"'."),r.skinningMatrix=new THREE.Matrix4,r.weights=[]}}}function f(e){var t=[],i=function(e,t,r){var s={};s.name=t.sid,s.parent=e,s.matrix=t.matrix;var a=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];s.matrix.decompose(a[0],a[1],a[2]),s.pos=[a[0].x,a[0].y,a[0].z],s.scl=[a[2].x,a[2].y,a[2].z],s.rotq=[a[1].x,a[1].y,a[1].z,a[1].w],r.push(s);for(var n in t.nodes)i(t.sid,t.nodes[n],r)};return i(-1,e,t),t}function m(e,t,i){var r=[];p(t,r,-1),u(r,i.skin),v=new THREE.Vector3;for(var a=[],n=0;n<e.vertices.length;n++)a.push(new THREE.Vector3);for(n=0;n<r.length;n++)if("JOINT"==r[n].type)for(j=0;j<r[n].weights.length;j++)w=r[n].weights[j],vidx=w.index,weight=w.weight,o=e.vertices[vidx],s=a[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(r[n].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(var n=0;n<e.vertices.length;n++)e.vertices[n]=a[n]}function g(e,t,i){var r=Lt[t.url];if(i=void 0!==i?i:40,!r||!r.skin)return void console.log("ColladaLoader: Could not find skin controller.");if(!t.skeleton||!t.skeleton.length)return void console.log("ColladaLoader: Could not find the skeleton for the skin. ");for(var s=l(),a=Nt.getChildById(t.skeleton[0],!0)||Nt.getChildBySid(t.skeleton[0],!0),n=f(a),o=r.skin.joints,h=[],c=0;c<o.length;c++)for(var d=0;d<n.length;d++)n[d].name==o[c]&&(h[c]=n[d]);for(var c=0;c<h.length;c++)for(var d=0;d<h.length;d++)h[c].parent==h[d].name&&(h[c].parent=d);{var c,d,g;new THREE.Vector3}for(c=0;c<e.vertices.length;c++)e.vertices[c].applyMatrix4(r.skin.bindShapeMatrix);for(var v=[],y=[],b=r.skin.weights,c=0;c<b.length;c++){var w=new THREE.Vector4(b[c][0]?b[c][0].joint:0,b[c][1]?b[c][1].joint:0,b[c][2]?b[c][2].joint:0,b[c][3]?b[c][3].joint:0),g=new THREE.Vector4(b[c][0]?b[c][0].weight:0,b[c][1]?b[c][1].weight:0,b[c][2]?b[c][2].weight:0,b[c][3]?b[c][3].weight:0);v.push(w),y.push(g)}e.skinIndices=v,e.skinWeights=y,e.bones=h;for(var x={name:s.ID,fps:30,length:s.frames/30,hierarchy:[]},d=0;d<h.length;d++)x.hierarchy.push({parent:h[d].parent,name:h[d].name,keys:[]});for(console.log("ColladaLoader:",s.ID+" has "+h.length+" bones."),m(e,a,r),i=0;i<s.frames;i++){var E=[];p(a,E,i),u(E,r.skin);for(var c=0;c<E.length;c++)for(var d=0;d<x.hierarchy.length;d++)if(x.hierarchy[d].name==E[c].sid){var T={};T.time=i/30,T.matrix=E[c].animatrix,0==i&&(E[c].matrix=T.matrix);var N=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];T.matrix.decompose(N[0],N[1],N[2]),T.pos=[N[0].x,N[0].y,N[0].z],T.scl=[N[2].x,N[2].y,N[2].z],T.rot=N[1],x.hierarchy[d].keys.push(T)}e.animation=x}}function y(e){var t,i,r,s,a=new THREE.Object3D,n=!1;for(r=0;r<e.controllers.length;r++){var o=Lt[e.controllers[r].url];switch(o.type){case"skin":if(zt[o.skin.source]){var h=new P;h.url=o.skin.source,h.instance_material=e.controllers[r].instance_material,e.geometries.push(h),n=!0,t=e.controllers[r]}else if(Lt[o.skin.source]){var c=Lt[o.skin.source];if(i=c,c.morph&&zt[c.morph.source]){var h=new P;h.url=c.morph.source,h.instance_material=e.controllers[r].instance_material,e.geometries.push(h)}}break;case"morph":if(zt[o.morph.source]){var h=new P;h.url=o.morph.source,h.instance_material=e.controllers[r].instance_material,e.geometries.push(h),i=e.controllers[r]}console.log("ColladaLoader: Morph-controller partially supported.")}}var l={};for(r=0;r<e.geometries.length;r++){var p,u=e.geometries[r],f=u.instance_material,m=zt[u.url],v={},b=[],w=0;if(m){if(!m.mesh||!m.mesh.primitives)continue;if(0==a.name.length&&(a.name=m.id),f)for(s=0;s<f.length;s++){var x=f[s],E=Pt[x.target],T=E.instance_effect.url,N=Xt[T].shader,k=N.material;if(m.doubleSided){if(!(x.symbol in l)){var _=k.clone();_.side=THREE.DoubleSide,l[x.symbol]=_}k=l[x.symbol]}k.opacity=k.opacity?k.opacity:1,v[x.symbol]=w,b.push(k),p=k,p.name=null==E.name||""===E.name?E.id:E.name,w++}var R,C=p||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:m.doubleSided?THREE.DoubleSide:THREE.FrontSide}),M=m.mesh.geometry3js;if(w>1)for(C=new THREE.MeshFaceMaterial(b),s=0;s<M.faces.length;s++){var H=M.faces[s];H.materialIndex=v[H.daeMaterial]}void 0!==t?(g(M,t),M.morphTargets.length>0?(C.morphTargets=!0,C.skinning=!1):(C.morphTargets=!1,C.skinning=!0),R=new THREE.SkinnedMesh(M,C,!1),R.name="skin_"+Mt.length,Mt.push(R)):void 0!==i?(d(M,i),C.morphTargets=!0,R=new THREE.Mesh(M,C),R.name="morph_"+Ct.length,Ct.push(R)):R=new THREE.Mesh(M,C),a.add(R)}}for(r=0;r<e.cameras.length;r++){var A=e.cameras[r],j=Dt[A.url],O=new THREE.PerspectiveCamera(j.yfov,parseFloat(j.aspect_ratio),parseFloat(j.znear),parseFloat(j.zfar));a.add(O)}for(r=0;r<e.lights.length;r++){var I=null,S=e.lights[r],L=qt[S.url];if(L&&L.technique){var z,X=L.color.getHex(),D=L.intensity,q=L.distance,G=L.falloff_angle;switch(L.technique){case"directional":I=new THREE.DirectionalLight(X,D,q),I.position.set(0,0,1);break;case"point":I=new THREE.PointLight(X,D,q);break;case"spot":I=new THREE.SpotLight(X,D,q,G,z),I.position.set(0,0,1);break;case"ambient":I=new THREE.AmbientLight(X)}}I&&a.add(I)}if(a.name=e.name||e.id||"",a.id=e.id||"",a.layer=e.layer||"",a.matrix=e.matrix,a.matrix.decompose(a.position,a.quaternion,a.scale),Yt.centerGeometry&&a.geometry){var Y=a.geometry.center();Y.multiply(a.scale),Y.applyQuaternion(a.quaternion),a.position.sub(Y)}for(r=0;r<e.nodes.length;r++)a.add(y(e.nodes[r],e));return a}function b(e){for(var t=Ht.querySelectorAll("library_nodes node"),i=0;i<t.length;i++){var r=t[i].attributes.getNamedItem("id");if(r&&r.value===e)return t[i]}return void 0}function x(e){var t=[],i=1e6,r=-1e6;for(var s in St)for(var a=St[s],n=0;n<a.channel.length;n++){var o=a.channel[n],h=a.sampler[n],s=o.target.split("/")[0];s==e.id&&(h.create(),o.sampler=h,i=Math.min(i,h.startTime),r=Math.max(r,h.endTime),t.push(o))}return t.length&&(e.startTime=i,e.endTime=r),t}function E(e){if(e.channels&&e.channels.length){for(var t=[],i=[],r=0,s=e.channels.length;s>r;r++){var a,n=e.channels[r],o=n.fullSid,h=n.sampler,c=h.input,l=e.getTransformBySid(n.sid);if(n.arrIndices){a=[];for(var d=0,p=n.arrIndices.length;p>d;d++)a[d]=Et(n.arrIndices[d])}else a=Tt(n.member);if(l){-1===i.indexOf(o)&&i.push(o);for(var d=0,p=c.length;p>d;d++){var u=c[d],f=h.getData(l.type,d,a),m=T(t,u);if(!m){m=new st(u);var g=N(t,u);t.splice(-1==g?t.length:g,0,m)}m.addTarget(o,l,a,f)}}else console.log('Could not find transform "'+n.sid+'" in node '+e.id)}for(var r=0;r<i.length;r++)for(var v=i[r],d=0;d<t.length;d++){var m=t[d];m.hasTarget(v)||k(t,m,d,v)}e.keys=t,e.sids=i}}function T(e,t){for(var i=null,r=0,s=e.length;s>r&&null==i;r++){var a=e[r];if(a.time===t)i=a;else if(a.time>t)break}return i}function N(e,t){for(var i=-1,r=0,s=e.length;s>r&&-1==i;r++){var a=e[r];a.time>=t&&(i=r)}return i}function k(e,t,i,r){var s=R(e,r,i?i-1:0),a=_(e,r,i+1);if(s&&a){var n,o=(t.time-s.time)/(a.time-s.time),h=s.getTarget(r),c=a.getTarget(r).data,l=h.data;if("matrix"===h.type)n=l;else if(l.length){n=[];for(var d=0;d<l.length;++d)n[d]=l[d]+(c[d]-l[d])*o}else n=l+(c-l)*o;t.addTarget(r,h.transform,h.member,n)}}function _(e,t,i){for(;i<e.length;i++){var r=e[i];if(r.hasTarget(t))return r}return null}function R(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var r=e[i];if(r.hasTarget(t))return r}return null}function C(){this.id="",this.init_from=""}function M(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function H(){this.method=null,this.source=null,this.targets=null,this.weights=null}function A(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function O(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Object3D}function I(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function S(){this.sid="",this.type="",this.data=[],this.obj=null}function L(){this.url="",this.skeleton=[],this.instance_material=[]}function z(){this.symbol="",this.target=""}function P(){this.url="",this.instance_material=[]}function X(){this.id="",this.mesh=null}function D(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function q(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function G(){q.call(this),this.vcount=[]}function Y(){q.call(this),this.vcount=3}function V(){this.source="",this.count=0,this.stride=0,this.params=[]}function Z(){this.input={}}function B(){this.semantic="",this.offset=0,this.source="",this.set=0}function F(e){this.id=e,this.type=null}function U(){this.id="",this.name="",this.instance_effect=null}function W(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function J(e,t){this.type=e,this.effect=t,this.material=null}function Q(e){this.effect=e,this.init_from=null,this.format=null}function $(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function K(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function et(){this.url=""}function tt(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function it(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function rt(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function st(e){this.targets=[],this.time=e}function at(){this.id="",this.name="",this.technique=""}function nt(){this.url=""}function ot(){this.id="",this.name="",this.technique=""}function ht(){this.url=""}function ct(e){var t=e.getAttribute("id");return void 0!=Ot[t]?Ot[t]:(Ot[t]=new F(t).parse(e),Ot[t])}function lt(e){for(var t=ut(e),i=[],r=0,s=t.length;s>r;r++)i.push("true"==t[r]||"1"==t[r]?!0:!1);return i}function dt(e){for(var t=ut(e),i=[],r=0,s=t.length;s>r;r++)i.push(parseFloat(t[r]));return i}function pt(e){for(var t=ut(e),i=[],r=0,s=t.length;s>r;r++)i.push(parseInt(t[r],10));return i}function ut(e){return e.length>0?ft(e).split(/\s+/):[]}function ft(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function mt(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function gt(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function vt(){if(Yt.convertUpAxis!==!0||Zt===Yt.upAxis)Bt=null;else switch(Zt){case"X":Bt="Y"===Yt.upAxis?"XtoY":"XtoZ";break;case"Y":Bt="X"===Yt.upAxis?"YtoX":"YtoZ";break;case"Z":Bt="X"===Yt.upAxis?"ZtoX":"ZtoY"}}function yt(e,t){if(Yt.convertUpAxis===!0&&Zt!==Yt.upAxis)switch(Bt){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":var i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":var i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":var i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":var i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function bt(e,t){if(Yt.convertUpAxis!==!0||Zt===Yt.upAxis)return t;switch(e){case"X":t="XtoY"==Bt?-1*t:t;break;case"Y":t="YtoZ"==Bt||"YtoX"==Bt?-1*t:t;break;case"Z":t="ZtoY"==Bt?-1*t:t}return t}function wt(e,t){var i=[e[t],e[t+1],e[t+2]];return yt(i,-1),new THREE.Vector3(i[0],i[1],i[2])}function xt(e){if(Yt.convertUpAxis){var t=[e[0],e[4],e[8]];yt(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],yt(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],yt(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],yt(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],yt(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],yt(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],yt(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new THREE.Matrix4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Et(e){if(e>-1&&3>e){var t=["X","Y","Z"],i={X:0,Y:1,Z:2};e=Tt(t[e]),e=i[e]}return e}function Tt(e){if(Yt.convertUpAxis)switch(e){case"X":switch(Bt){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(Bt){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(Bt){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}var Nt,kt,_t,Rt,Ct,Mt,Ht=null,At=null,jt=null,Ot={},It={},St={},Lt={},zt={},Pt={},Xt={},Dt={},qt={},Gt=THREE.SmoothShading,Yt={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},Vt=1,Zt="Y",Bt=null;return C.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},M.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new A).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new H).parse(i),this.type=i.nodeName}}return this},H.prototype.parse=function(e){var t,i={},r=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var s=e.childNodes[t];if(1==s.nodeType)switch(s.nodeName){case"source":var a=(new F).parse(s);i[a.id]=a;break;case"targets":r=this.parseInputs(s);break;default:console.log(s.nodeName)}}for(t=0;t<r.length;t++){var n=r[t],a=i[n.source];switch(n.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read()}}return this},H.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":t.push((new B).parse(r))}}return t},A.prototype.parse=function(e){var t,i,r={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var s=0;s<e.childNodes.length;s++){var a=e.childNodes[s];if(1==a.nodeType)switch(a.nodeName){case"bind_shape_matrix":var n=dt(a.textContent);this.bindShapeMatrix=xt(n);break;case"source":var o=(new F).parse(a);r[o.id]=o;break;case"joints":t=a;break;case"vertex_weights":i=a;break;default:console.log(a.nodeName)}}return this.parseJoints(t,r),this.parseWeights(i,r),this},A.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":var s=(new B).parse(r),a=t[s.source];"JOINT"==s.semantic?this.joints=a.read():"INV_BIND_MATRIX"==s.semantic&&(this.invBindMatrices=a.read())}}},A.prototype.parseWeights=function(e,t){for(var i,r,s=[],a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(1==n.nodeType)switch(n.nodeName){case"input":s.push((new B).parse(n));break;case"v":i=pt(n.textContent);break;case"vcount":r=pt(n.textContent)}}for(var o=0,a=0;a<r.length;a++){for(var h=r[a],c=[],l=0;h>l;l++){for(var d={},p=0;p<s.length;p++){var u=s[p],f=i[o+u.offset];switch(u.semantic){case"JOINT":d.joint=f;break;case"WEIGHT":d.weight=t[u.source].data[f]}}c.push(d),o+=s.length}for(var l=0;l<c.length;l++)c[l].index=a;this.weights.push(c)}},O.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},O.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},O.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new I).parse(i))}}return this},I.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i,r,s=this.channels[t],a=s.target.split("/"),n=(a.shift(),a.shift()),o=n.indexOf(".")>=0,h=n.indexOf("(")>=0;if(o)a=n.split("."),n=a.shift(),r=a.shift();else if(h){i=n.split("("),n=i.shift();for(var c=0;c<i.length;c++)i[c]=parseInt(i[c].replace(/\)/,""))}if(n==e)return s.info={sid:n,dotSyntax:o,arrSyntax:h,arrIndices:i},s}return null},I.prototype.getChildById=function(e,t){if(this.id==e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},I.prototype.getChildBySid=function(e,t){if(this.sid==e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},I.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid==e)return this.transforms[t];return null},I.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new I).parse(r));break;case"instance_camera":this.cameras.push((new nt).parse(r));break;case"instance_controller":this.controllers.push((new L).parse(r));break;case"instance_geometry":this.geometries.push((new P).parse(r));break;case"instance_light":this.lights.push((new ht).parse(r));break;case"instance_node":t=r.getAttribute("url").replace(/^#/,"");var s=b(t);s&&this.nodes.push((new I).parse(s));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new S).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=x(this),E(this),this.updateMatrix(),this},I.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},S.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=dt(e.textContent),this.convert(),this},S.prototype.convert=function(){switch(this.type){case"matrix":this.obj=xt(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":yt(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":yt(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},S.prototype.apply=function(){var e=new THREE.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),S.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},L.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":for(var r=i.querySelectorAll("instance_material"),s=0;s<r.length;s++){var a=r[s];this.instance_material.push((new z).parse(a))}break;case"extra":}}return this},z.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},P.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"==i.nodeName){for(var r=i.querySelectorAll("instance_material"),s=0;s<r.length;s++){var a=r[s];this.instance_material.push((new z).parse(a))}break}}return this},X.prototype.parse=function(e){this.id=e.getAttribute("id"),gt(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new D(this).parse(i);break;case"extra":}}return this},D.prototype.parse=function(e){this.primitives=[];var t;for(t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":ct(i);break;case"vertices":this.vertices=(new Z).parse(i);break;case"triangles":this.primitives.push((new Y).parse(i));break;case"polygons":this.primitives.push((new q).parse(i));break;case"polylist":this.primitives.push((new G).parse(i))}}this.geometry3js=new THREE.Geometry;var r=Ot[this.vertices.input.POSITION.source].data;for(t=0;t<r.length;t+=3)this.geometry3js.vertices.push(wt(r,t).clone());for(t=0;t<this.primitives.length;t++){var s=this.primitives[t];s.setVertices(this.vertices),this.handlePrimitive(s,this.geometry3js)}return this.geometry3js.computeFaceNormals(),this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},D.prototype.handlePrimitive=function(e,t){var i,r,s,a,n,o,h,c=e.p,l=e.inputs,d=0,p=3,u=0,f=[];for(i=0;i<l.length;i++){s=l[i];var m=s.offset+1;switch(u=m>u?m:u,s.semantic){case"TEXCOORD":f.push(s.set)}}for(var g=0;g<c.length;++g)for(var v=c[g],y=0;y<v.length;){var b=[],w=[],x=null,E=[];for(p=e.vcount?e.vcount.length?e.vcount[d++]:e.vcount:v.length/u,i=0;p>i;i++)for(r=0;r<l.length;r++)switch(s=l[r],o=Ot[s.source],a=v[y+i*u+s.offset],h=o.accessor.params.length,n=a*h,s.semantic){case"VERTEX":b.push(a);break;case"NORMAL":w.push(wt(o.data,n));break;case"TEXCOORD":x=x||{},void 0===x[s.set]&&(x[s.set]=[]),x[s.set].push(new THREE.Vector2(o.data[n],o.data[n+1]));break;case"COLOR":E.push((new THREE.Color).setRGB(o.data[n],o.data[n+1],o.data[n+2]))}if(0==w.length)if(s=this.vertices.input.NORMAL){o=Ot[s.source],h=o.accessor.params.length;for(var T=0,N=b.length;N>T;T++)w.push(wt(o.data,b[T]*h))
}else t.calcNormals=!0;if(!x&&(x={},s=this.vertices.input.TEXCOORD)){f.push(s.set),o=Ot[s.source],h=o.accessor.params.length;for(var T=0,N=b.length;N>T;T++)n=b[T]*h,void 0===x[s.set]&&(x[s.set]=[]),x[s.set].push(new THREE.Vector2(o.data[n],1-o.data[n+1]))}if(0==E.length&&(s=this.vertices.input.COLOR)){o=Ot[s.source],h=o.accessor.params.length;for(var T=0,N=b.length;N>T;T++)n=b[T]*h,E.push((new THREE.Color).setRGB(o.data[n],o.data[n+1],o.data[n+2]))}var k,_,R=null,C=[];if(3===p)C.push(new THREE.Face3(b[0],b[1],b[2],w,E.length?E:new THREE.Color));else if(4===p)C.push(new THREE.Face3(b[0],b[1],b[3],[w[0],w[1],w[3]],E.length?[E[0],E[1],E[3]]:new THREE.Color)),C.push(new THREE.Face3(b[1],b[2],b[3],[w[1],w[2],w[3]],E.length?[E[1],E[2],E[3]]:new THREE.Color));else if(p>4&&Yt.subdivideFaces){var M=E.length?E:new THREE.Color;for(r=1;p-1>r;)C.push(new THREE.Face3(b[0],b[r],b[r+1],[w[0],w[r++],w[r]],M))}if(C.length)for(var T=0,N=C.length;N>T;T++)for(R=C[T],R.daeMaterial=e.material,t.faces.push(R),r=0;r<f.length;r++)k=x[f[r]],_=p>4?[k[0],k[T+1],k[T+2]]:4===p?0===T?[k[0],k[1],k[3]]:[k[1].clone(),k[2],k[3].clone()]:[k[0],k[1],k[2]],void 0===t.faceVertexUvs[r]&&(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(_);else console.log("dropped face with vcount "+p+" for geometry with id: "+t.id);y+=u*p}},q.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},q.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=mt(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new B).parse(e.childNodes[t]));break;case"vcount":this.vcount=pt(i.textContent);break;case"p":this.p.push(pt(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},G.prototype=Object.create(q.prototype),Y.prototype=Object.create(q.prototype),V.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=mt(e,"count",0),this.stride=mt(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("param"==i.nodeName){var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},Z.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"==e.childNodes[t].nodeName){var i=(new B).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},B.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=mt(e,"set",-1),this.offset=mt(e,"offset",0),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0),this},F.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=lt(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=dt(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=pt(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=ut(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var r=0;r<i.childNodes.length;r++)if("accessor"==i.childNodes[r].nodeName){this.accessor=(new V).parse(i.childNodes[r]);break}}}return this},F.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var r=this.data.slice(i,i+16),s=xt(r);e.push(s)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},U.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"==e.childNodes[t].nodeName){this.instance_effect=(new et).parse(e.childNodes[t]);break}return this},W.prototype.isColor=function(){return null==this.texture},W.prototype.isTexture=function(){return null!=this.texture},W.prototype.parse=function(e){"transparent"==e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=dt(i.textContent);this.color=new THREE.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},W.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":this.texOpts[i.nodeName]="TRUE"===i.textContent.toUpperCase()?1:parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},J.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new W).parse(i);break;case"bump":var r=i.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new W).parse(i):"normalmap"===r.toLowerCase()?this.normal=(new W).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new W).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new W).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var s=i.querySelectorAll("float");s.length>0&&(this[i.nodeName]=parseFloat(s[0].textContent))}}return this.create(),this},J.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var i=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);i>0&&(t=!0,e.transparent=!0,e.opacity=1-i)}var r={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var s in this)switch(s){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var a=this[s];if(a instanceof W)if(a.isTexture()){var n=a.texture,o=this.effect.sampler[n];if(void 0!==o&&void 0!==o.source){var h=this.effect.surface[o.source],c=It[h.init_from];if(c){var l,d=Rt+c.init_from,p=THREE.Loader.Handlers.get(d);null!==p?l=p.load(d):(l=new THREE.Texture,p=new THREE.ImageLoader,p.load(d,function(e){l.image=e,l.needsUpdate=!0})),l.wrapS=a.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,l.wrapT=a.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,l.offset.x=a.texOpts.offsetU,l.offset.y=a.texOpts.offsetV,l.repeat.x=a.texOpts.repeatU,l.repeat.y=a.texOpts.repeatV,e[r[s]]=l,"emission"===s&&(e.emissive=16777215)}}}else"diffuse"!==s&&t||("emission"===s?e.emissive=a.color.getHex():e[s]=a.color.getHex());break;case"shininess":e[s]=this[s];break;case"reflectivity":e[s]=this[s],e[s]>0&&(e.envMap=Yt.defaultEnvMap),e.combine=THREE.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[s],1!==this[s]&&(e.envMap=Yt.defaultEnvMap);break;case"transparency":}switch(e.shading=Gt,e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case"phong":case"blinn":void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshPhongMaterial(e);break;case"lambert":default:void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshLambertMaterial(e)}return this.material},Q.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},$.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},K.prototype.create=function(){return null==this.shader?null:void 0},K.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),gt(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},K.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[t]=new Q(this).parse(r);break;case"sampler2D":this.sampler[t]=new $(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},K.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var s=(new C).parse(r);It[s.id]=s;break;case"extra":break;default:console.log(r.nodeName)}}return t},K.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new J(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},K.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},K.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(e)}}},et.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},tt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var r=(new tt).parse(i);for(var s in r.source)this.source[s]=r.source[s];for(var a=0;a<r.channel.length;a++)this.channel.push(r.channel[a]),this.sampler.push(r.sampler[a]);break;case"source":var s=(new F).parse(i);this.source[s.id]=s;break;case"sampler":this.sampler.push(new rt(this).parse(i));break;case"channel":this.channel.push(new it(this).parse(i))}}return this},it.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),i=(t.shift(),t.shift()),r=i.indexOf(".")>=0,s=i.indexOf("(")>=0;if(r)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(s){var a=i.split("(");this.sid=a.shift();for(var n=0;n<a.length;n++)a[n]=parseInt(a[n].replace(/\)/,""));this.arrIndices=a}else this.sid=i;return this.fullSid=i,this.dotSyntax=r,this.arrSyntax=s,this},rt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new B).parse(i))}}return this},rt.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},rt.prototype.getData=function(e,t,i){var r;if("matrix"===e&&16===this.strideOut)r=this.output[t];else if(this.strideOut>1){r=[],t*=this.strideOut;for(var s=0;s<this.strideOut;++s)r[s]=this.output[t+s];if(3===this.strideOut)switch(e){case"rotate":case"translate":yt(r,-1);break;case"scale":yt(r,1)}else 4===this.strideOut&&"matrix"===e&&yt(r,-1)}else r=this.output[t],i&&"translate"==e&&(r=bt(i,r));return r},st.prototype.addTarget=function(e,t,i,r){this.targets.push({sid:e,member:i,transform:t,data:r})},st.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},st.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},st.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},st.prototype.interpolate=function(e,t){for(var i=0,r=this.targets.length;r>i;i++){var s,a=this.targets[i],n=e.getTarget(a.sid);if("matrix"!==a.transform.type&&n){var o=(t-this.time)/(e.time-this.time),h=n.data,c=a.data;if(0>o&&(o=0),o>1&&(o=1),c.length){s=[];for(var l=0;l<c.length;++l)s[l]=c[l]+(h[l]-c[l])*o}else s=c+(h-c)*o}else s=a.data;a.transform.update(s,a.member)}},at.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i)}}return this},at.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"==e.childNodes[t].nodeName)for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++)if(this.technique=i.childNodes[r].nodeName,"perspective"==this.technique)for(var s=i.childNodes[r],a=0;a<s.childNodes.length;a++){var n=s.childNodes[a];switch(n.nodeName){case"yfov":this.yfov=n.textContent;break;case"xfov":this.xfov=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}else if("orthographic"==this.technique)for(var o=i.childNodes[r],a=0;a<o.childNodes.length;a++){var n=o.childNodes[a];switch(n.nodeName){case"xmag":this.xmag=n.textContent;break;case"ymag":this.ymag=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}return this},nt.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ot.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},ot.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];switch(s.nodeName){case"color":var a=dt(s.textContent);this.color=new THREE.Color(0),this.color.setRGB(a[0],a[1],a[2]),this.color.a=a[3];break;case"falloff_angle":this.falloff_angle=parseFloat(s.textContent);break;case"quadratic_attenuation":var n=parseFloat(s.textContent);this.distance=n?Math.sqrt(1/n):0}}}return this},ot.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},ht.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},{load:e,parse:t,setPreferredShading:i,applySkin:g,geometries:zt,options:Yt}},function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},i={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var s in t)i.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=function(e){function i(){this._updateMizunoPos=t(this._updateMizunoPos,this),this._rotateNext=t(this._rotateNext,this),this._start=t(this._start,this),i.__super__.constructor.call(this,{amibientLight:{color:3355443}})}var s,a;return r(i,e),s=300,a=!1,i.prototype._setup=function(){return this._loadModel(),this._addLight(),this._addParticle(),this._addPMizuno(),this._start()},i.prototype._addLight=function(){var e;return this.camera.position.x=-200,this.camera.position.y=430,this.camera.position.z=-200,this.camera.position.y=830,this.camera.position.z=300,e=new THREE.SpotLight(16777215,.5,0,Math.PI/6,10),this.scene.add(e),e.position.set(-600,800,100),e.castShadow=!0,e.shadowMapWidth=150,e.shadowMapHeight=150,this._addLightHelper(e),e=new THREE.SpotLight(16777215,.3,0,Math.PI/6,10),this.scene.add(e),e.position.set(-600,300,-400),this._addLightHelper(e),e=new THREE.SpotLight(16777215,.3,0,Math.PI/6,10),this.scene.add(e),e.position.set(600,300,-400),this._addLightHelper(e),this.scene.add(new THREE.GridHelper(1e3,100))},i.prototype._addLightHelper=function(e){var t;return a?(t=new THREE.SpotLightHelper(e),this.scene.add(t)):void 0},i.prototype._loadModel=function(){var e;return e=new THREE.ColladaLoader,e.load("../../model/dae/wc/models/wc.dae",function(e){return function(t){var i,r,s,a,n;for(i=t.scene,console.log("dae:",i),n=i.children,s=0,a=n.length;a>s;s++)r=n[s],r.position.x-=143,r.position.y-=40;return i.scale.x=i.scale.y=i.scale.z=10,i.updateMatrix(),i.rotation.x=-90*Math.PI/180,i.position.set(0,0,0),e.scene.add(i)}}(this))},i.prototype._addParticle=function(){var e,t,i;for(this.particleMaterial=new THREE.PointCloudMaterial({map:THREE.ImageUtils.loadTexture("../../img/particle/drops-assets/drops.png"),transparent:!0,blending:THREE.AdditiveBlending,size:20}),this.particleGeo=new THREE.Geometry,e=i=0;s>=0?s>i:i>s;e=s>=0?++i:--i)t=new THREE.Vector3(0,100,-10),this.particleGeo.vertices.push(t);return this.particle=new THREE.PointCloud(this.particleGeo,this.particleMaterial),this.scene.add(this.particle)},i.prototype._start=function(){return TweenMax.to(this.camera.position,1,{x:100,y:this.camera.position.y-50,z:this.camera.position.z-5,delay:1.6,ease:"easeInOutQuint",onComplete:function(e){return function(){return e._startParticle(),e._rotateNext()}}(this)})},i.prototype._rotateNext=function(){return TweenMax.to(this.camera.position,1,{x:-200,y:-10,z:-130,delay:3,ease:"easeInOutQuint"})},i.prototype._startParticle=function(){var e,t,i,r,s,a;for(s=this.particleGeo.vertices,a=[],e=i=0,r=s.length;r>i;e=++i)t=s[e],a.push(TweenMax.to(t,1,{y:800,x:100*Math.random()-50,z:100*Math.random()-50+200,ease:"easeInQuint",delay:.01*e,repeat:-1}));return a},i.prototype._addPMizuno=function(){var e,t,i;return this._data={x:106,y:542,z:115,rotationX:-40,rotationY:0,rotationZ:0},e=new THREE.PlaneGeometry(301,218,10,10),t=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("../../img/particle/drops-assets/mizuno.png"),side:THREE.DoubleSide}),this.mizuno=new THREE.Mesh(e,t),i=2,this.mizuno.scale.set(i,i,i),this._updateMizunoPos(),this.scene.add(this.mizuno),this.control.target=this.mizuno.position,a?this._setupGUI():void 0},i.prototype._updateMizunoPos=function(){return this.mizuno.position.set(this._data.x,this._data.y,this._data.z),this.mizuno.rotation.x=this._data.rotationX*Math.PI/180,this.mizuno.rotation.y=this._data.rotationY*Math.PI/180,this.mizuno.rotation.z=this._data.rotationZ*Math.PI/180},i.prototype._setupGUI=function(){var e;return e=new dat.GUI,e.add(this._data,"x",-1e3,1e3),e.add(this._data,"y",1,1e3),e.add(this._data,"z",-100,1e3),e.add(this._data,"rotationX",0,360),e.add(this._data,"rotationY",0,360),e.add(this._data,"rotationZ",0,360)},i.prototype._update=function(){return this.particleGeo.verticesNeedUpdate=!0,this._updateMizunoPos()},i}(BaseWorld),"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof exports?exports.DaeWC=e:window.DaeWC=e}.call(this);