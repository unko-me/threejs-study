var Stats=function(){var e=Date.now(),t=e,n=0,r=1/0,i=0,o=0,a=1/0,s=0,d=0,l=0,p=document.createElement("div");p.id="stats",p.addEventListener("mousedown",function(e){e.preventDefault(),E(++l%2)},!1),p.style.cssText="width:80px;opacity:0.9;cursor:pointer";var u=document.createElement("div");u.id="fps",u.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",p.appendChild(u);var c=document.createElement("div");c.id="fpsText",c.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",c.innerHTML="FPS",u.appendChild(c);var h=document.createElement("div");for(h.id="fpsGraph",h.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",u.appendChild(h);74>h.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",h.appendChild(f)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",p.appendChild(m);var w=document.createElement("div");w.id="msText",w.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",w.innerHTML="MS",m.appendChild(w);var y=document.createElement("div");for(y.id="msGraph",y.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(y);74>y.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",y.appendChild(f);var E=function(e){switch(l=e){case 0:u.style.display="block",m.style.display="none";break;case 1:u.style.display="none",m.style.display="block"}};return{REVISION:11,domElement:p,setMode:E,begin:function(){e=Date.now()},end:function(){var l=Date.now();n=l-e,r=Math.min(r,n),i=Math.max(i,n),w.textContent=n+" MS ("+r+"-"+i+")";var p=Math.min(30,30-30*(n/200));return y.appendChild(y.firstChild).style.height=p+"px",d++,l>t+1e3&&(o=Math.round(1e3*d/(l-t)),a=Math.min(a,o),s=Math.max(s,o),c.textContent=o+" FPS ("+a+"-"+s+")",p=Math.min(30,30-30*(o/100)),h.appendChild(h.firstChild).style.height=p+"px",t=l,d=0),l},update:function(){e=this.end()}}};(function(){!function(){var e;return e=new Stats,e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.top="0px",document.body.appendChild(e.domElement),setInterval(function(){e.begin(),e.end()},1e3/60)}()}).call(this),function(){var e;e=function(){function e(){}return e.canWebGL=function(){var e;try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return e=t,!1}},e}(),"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof exports?exports.CanvasDetector=e:window.CanvasDetector=e}.call(this),function(){window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame)}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.render=t(this.render,this),this.onWindowResize=t(this.onWindowResize,this),this.setup=t(this.setup,this),this.scene=new THREE.Scene,this.setup()}return e.prototype.scene=null,e.prototype.camera=null,e.prototype.setup=function(){return this.setupCamera(),this.setupRenderer(),this.setupLight()},e.prototype.setupCamera=function(){return this.camera=new THREE.PerspectiveCamera(75,1.5,1,2e3),this.camera.position.set(0,0,70)},e.prototype.setupRenderer=function(){return this.renderer=Modernizr.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer,this.onWindowResize(),this.renderer.setClearColor(0),$(window).on("resize",this.onWindowResize),this.onWindowResize(),document.getElementById("renderer").appendChild(this.renderer.domElement)},e.prototype.setupLight=function(){var e;return e=new THREE.DirectionalLight("#ffffff",1),e.position.set(0,1300,10),this.scene.add(e)},e.prototype.onWindowResize=function(){return this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},e.prototype.render=function(){return this.renderer.render(this.scene,this.camera)},e}(),"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof exports?exports.ThreeWorld=e:window.ThreeWorld=e}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}};t=function(){function e(){}return e.prototype.angle=1,e.prototype.depth=0,e.prototype.segments=10,e}(),e=function(){function e(e){this.world=e,this.update=n(this.update,this)}var r;return r=360,e.prototype._angle=0,e.prototype._list=null,e.prototype._planes=null,e.prototype._flock=null,e.prototype.setup=function(){return this._setupShader(),this._setupGUI(),this._setupDennys(),this._setupGround(),this.world.scene.add(new THREE.AmbientLight(3355443)),this.world.camera.position.x=400,this.world.camera.position.y=1200,this.world.camera.position.z=700,this.world.camera.lookAt(new THREE.Vector3)},e.prototype._ang=-.15,e.prototype.update=function(){return this.dennys&&(this._ang+=5e-4,this._ang>.6&&(this._ang=.6),this.dennys.rotation.y+=this._ang),this._updateParticle()},e.prototype._updateParticle=function(){return this.particles.material.uniforms.time.value=(Date.now()-this._startTime)/300},e.prototype._setupGUI=function(){var e;return e=new dat.GUI,this._data=new t,e.add(this._data,"angle",1,100),e.add(this._data,"depth",0,100)},e.prototype._setupDennys=function(){var e;return e=new THREE.JSONLoader,e.load("../../model/dennys/dennys.js",function(e){return function(t,n){var r,i,o,a,s,d;return s=500,i=new THREE.MeshFaceMaterial(n),r=new THREE.Mesh(t,i),r.position.set(0,s+80,0),r.scale.set(50,50,50),a=new THREE.Object3D,a.add(r),o=new THREE.MeshPhongMaterial({color:16777215}),t=new THREE.CylinderGeometry(20,20,s,10),d=new THREE.Mesh(t,o),a.add(d),d.position.y=s/2,e.world.scene.add(a),e.dennys=a}}(this))},e.prototype._setupGround=function(){var e,t,n;return t=new THREE.MeshLambertMaterial({color:3355443}),e=new THREE.PlaneGeometry(6e3,6e3,10,10),n=new THREE.Mesh(e,t),this.world.scene.add(n),n.rotation.x=-90*Math.PI/180},e.prototype._setupShader=function(){var e,t,n,i,o,a,s,d,l,p;for(this._startTime=Date.now(),p=document.getElementById("vertexshader").textContent,t=document.getElementById("fragmentshader").textContent,s=THREE.ImageUtils.loadTexture("../../img/particle/particle.png"),d={time:{type:"f",value:0},size:{type:"f",value:120},startColor:{type:"c",value:new THREE.Color(16711680)},offsetColor:{type:"c",value:new THREE.Color(16776960)},texture:{type:"t",value:s}},e={lifetime:{type:"f",value:[]},shift:{type:"f",value:[]}},i=new THREE.ShaderMaterial({vertexShader:p,fragmentShader:t,uniforms:d,attributes:e,blending:THREE.AdditiveBlending,transparent:!0,depthTest:!1}),n=new THREE.Geometry,e=i.attributes,o=0;r>o;)l=new THREE.Vector3(1200*(Math.random()-.5),500+20*(Math.random()-.5),1200*(Math.random()-.5)),n.vertices.push(l),d.size.value=60+30*Math.random(),d.startColor.value.r=.8+.24*Math.random(),d.startColor.value.g=.24+.12*Math.random(),d.offsetColor.value.r=.8+.24*Math.random()-d.startColor.value.r,d.offsetColor.value.g=.24+.12*Math.random()-d.startColor.value.g,e.lifetime.value.push(2.4),e.shift.value.push(2.4*Math.random()),o++;a=new THREE.PointCloud(n,i),a.sortParticles=!1,this.world.scene.add(a),this.particles=a},e.prototype._setupAxisHelper=function(){var e;return e=new THREE.AxisHelper(1e3),this.world.scene.add(e)},e}(),"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof exports?exports.DennysTest=e:window.DennysTest=e,function(){var t,n,r,i;return i=new ThreeWorld,n=new e(i),n.setup(),t=new THREE.TrackballControls(i.camera),(r=function(){return function(){return requestAnimationFrame(r),t.update(),n.update(),i.render()}}(this))()}()}.call(this);