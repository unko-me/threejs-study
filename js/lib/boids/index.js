function Boids(t,i){if(!(this instanceof Boids))return new Boids(t,i);t=t||{},i=i||function(){},this.speedLimitRoot=t.speedLimit||0,this.accelerationLimitRoot=t.accelerationLimit||1,this.speedLimit=Math.pow(this.speedLimitRoot,2),this.accelerationLimit=Math.pow(this.accelerationLimitRoot,2),this.separationDistance=Math.pow(t.separationDistance||60,2),this.alignmentDistance=Math.pow(t.alignmentDistance||180,2),this.cohesionDistance=Math.pow(t.cohesionDistance||180,2),this.separationForce=t.separationForce||.15,this.cohesionForce=t.cohesionForce||.1,this.alignmentForce=t.alignmentForce||t.alignment||.25,this.attractors=t.attractors||[];for(var o=this.boids=[],a=0,s=void 0===t.boids?50:t.boids;s>a;a+=1)o[a]=[25*Math.random(),25*Math.random(),0,0,0,0]}var sqrt=Math.sqrt,POSITIONX=0,POSITIONY=1,SPEEDX=2,SPEEDY=3,ACCELERATIONX=4,ACCELERATIONY=5;Boids.prototype.tick=function(){for(var t,i,o,a,s,r,e,E,n,c,h,A,C=this.boids,L=this.separationDistance,D=this.separationForce,I=this.cohesionDistance,O=this.cohesionForce,R=this.alignmentDistance,m=this.alignmentForce,d=this.speedLimit,N=this.accelerationLimit,P=this.accelerationLimitRoot,S=this.speedLimitRoot,T=C.length,p=T,X=this.attractors,Y=X.length;p--;){for(t=0,i=0,o=0,a=0,s=0,r=0,c=C[p],A=Y;A--;)attractor=X[A],e=c[0]-attractor[0],E=c[1]-attractor[1],n=e*e+E*E,n<attractor[2]*attractor[2]&&(h=sqrt(e*e+E*E),C[p][SPEEDX]-=attractor[3]*e/h||0,C[p][SPEEDY]-=attractor[3]*E/h||0);for(A=T;A--;)A!==p&&(e=c[0]-C[A][0],E=c[1]-C[A][1],n=e*e+E*E,L>n?(t+=e,i+=E):(I>n&&(o+=e,a+=E),R>n&&(s+=C[A][SPEEDX],r+=C[A][SPEEDY])));h=sqrt(t*t+i*i),C[p][ACCELERATIONX]+=D*t/h||0,C[p][ACCELERATIONY]+=D*i/h||0,h=sqrt(o*o+a*a),C[p][ACCELERATIONX]-=O*o/h||0,C[p][ACCELERATIONY]-=O*a/h||0,h=sqrt(s*s+r*r),C[p][ACCELERATIONX]-=m*s/h||0,C[p][ACCELERATIONY]-=m*r/h||0}for(p=T;p--;)N&&(n=C[p][ACCELERATIONX]*C[p][ACCELERATIONX]+C[p][ACCELERATIONY]*C[p][ACCELERATIONY],n>N&&(ratio=P/sqrt(n),C[p][ACCELERATIONX]*=ratio,C[p][ACCELERATIONY]*=ratio)),C[p][SPEEDX]+=C[p][ACCELERATIONX],C[p][SPEEDY]+=C[p][ACCELERATIONY],d&&(n=C[p][SPEEDX]*C[p][SPEEDX]+C[p][SPEEDY]*C[p][SPEEDY],n>d&&(ratio=S/sqrt(n),C[p][SPEEDX]*=ratio,C[p][SPEEDY]*=ratio)),C[p][POSITIONX]+=C[p][SPEEDX],C[p][POSITIONY]+=C[p][SPEEDY]},window.Boids=Boids;