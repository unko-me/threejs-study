THREE.EditorControls=function(e,t){function o(e){r.enabled!==!1&&(e.preventDefault(),0===e.button?l=E.ROTATE:1===e.button?l=E.ZOOM:2===e.button&&(l=E.PAN),v.set(e.clientX,e.clientY),t.addEventListener("mousemove",n,!1),t.addEventListener("mouseup",a,!1),t.addEventListener("mouseout",a,!1),t.addEventListener("dblclick",a,!1))}function n(e){if(r.enabled!==!1){e.preventDefault(),h.set(e.clientX,e.clientY);var t=h.x-v.x,o=h.y-v.y;l===E.ROTATE?r.rotate(new THREE.Vector3(.005*-t,.005*-o,0)):l===E.ZOOM?r.zoom(new THREE.Vector3(0,0,o)):l===E.PAN&&r.pan(new THREE.Vector3(-t,o,0)),v.set(e.clientX,e.clientY)}}function a(){t.removeEventListener("mousemove",n,!1),t.removeEventListener("mouseup",a,!1),t.removeEventListener("mouseout",a,!1),t.removeEventListener("dblclick",a,!1),l=E.NONE}function c(e){e.preventDefault();var t=0;e.wheelDelta?t=-e.wheelDelta:e.detail&&(t=10*e.detail),r.zoom(new THREE.Vector3(0,0,t))}function i(e){if(r.enabled!==!1){switch(e.touches.length){case 1:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[1].pageX,e.touches[1].pageY,0),y=T[0].distanceTo(T[1])}g[0].copy(T[0]),g[1].copy(T[1])}}function s(e){if(r.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=function(e,t){var o=t[0];for(var n in t)o.distanceTo(e)>t[n].distanceTo(e)&&(o=t[n]);return o};switch(e.touches.length){case 1:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[0].pageX,e.touches[0].pageY,0),r.rotate(T[0].sub(t(T[0],g)).multiplyScalar(-.005));break;case 2:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[1].pageX,e.touches[1].pageY,0),distance=T[0].distanceTo(T[1]),r.zoom(new THREE.Vector3(0,0,y-distance)),y=distance;var o=T[0].clone().sub(t(T[0],g)),n=T[1].clone().sub(t(T[1],g));o.x=-o.x,n.x=-n.x,r.pan(o.add(n).multiplyScalar(.5))}g[0].copy(T[0]),g[1].copy(T[1])}}t=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3;var r=this,u=new THREE.Vector3,E={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},l=E.NONE,d=this.center,p=new THREE.Matrix3,h=new THREE.Vector2,v=new THREE.Vector2,m={type:"change"};this.focus=function(t,o){var n=new THREE.Vector3;if(t.matrixWorld.decompose(d,new THREE.Quaternion,n),o&&t.geometry){n=(n.x+n.y+n.z)/3,d.add(t.geometry.boundingSphere.center.clone().multiplyScalar(n));var a=t.geometry.boundingSphere.radius*n,c=e.position.clone().sub(d).normalize().multiplyScalar(2*a);e.position.copy(d).add(c)}e.lookAt(d),r.dispatchEvent(m)},this.pan=function(t){var o=e.position.distanceTo(d);t.multiplyScalar(.001*o),t.applyMatrix3(p.getNormalMatrix(e.matrix)),e.position.add(t),d.add(t),r.dispatchEvent(m)},this.zoom=function(t){var o=e.position.distanceTo(d);t.multiplyScalar(.001*o),t.length()>o||(t.applyMatrix3(p.getNormalMatrix(e.matrix)),e.position.add(t),r.dispatchEvent(m))},this.rotate=function(t){u.copy(e.position).sub(d);var o=Math.atan2(u.x,u.z),n=Math.atan2(Math.sqrt(u.x*u.x+u.z*u.z),u.y);o+=t.x,n+=t.y;var a=1e-6;n=Math.max(a,Math.min(Math.PI-a,n));var c=u.length();u.x=c*Math.sin(n)*Math.sin(o),u.y=c*Math.cos(n),u.z=c*Math.sin(n)*Math.cos(o),e.position.copy(d).add(u),e.lookAt(d),r.dispatchEvent(m)},t.addEventListener("contextmenu",function(e){e.preventDefault()},!1),t.addEventListener("mousedown",o,!1),t.addEventListener("mousewheel",c,!1),t.addEventListener("DOMMouseScroll",c,!1);var T=(new THREE.Vector3,[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),g=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],y=null;t.addEventListener("touchstart",i,!1),t.addEventListener("touchmove",s,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype);