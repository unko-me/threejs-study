THREE.TGALoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TGALoader.prototype={constructor:THREE.TGALoader,load:function(e,r,a,o){var t=this,i=new THREE.DataTexture,s=new THREE.XHRLoader(t.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){i.image=t.parse(e),i.needsUpdate=!0,r&&r(i)},a,o),i},parse:function(e){function r(e){switch(e.image_type){case p:case g:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case h:case f:case u:case T:e.colormap_type&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case l:console.error("THREE.TGALoader.parse.tgaCheckHeader: No data");default:console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function a(e,r,a,o,t){var i,s,n,c;if(s=a.pixel_size>>3,n=a.width*a.height*s,r&&(c=t.subarray(o,o+=a.colormap_length*(a.colormap_size>>3))),e){i=new Uint8Array(n);for(var d,l,p,h=0,f=new Uint8Array(s);n>h;)if(d=t[o++],l=(127&d)+1,128&d){for(p=0;s>p;++p)f[p]=t[o++];for(p=0;l>p;++p)i.set(f,h+p*s);h+=s*l}else{for(l*=s,p=0;l>p;++p)i[h+p]=t[o++];h+=l}}else i=t.subarray(o,o+=r?a.width*a.height:n);return{pixel_data:i,palettes:c}}function o(e,r,a,o,t,i,s,n,c){var d,l,p,h=c,f=0,g=R.width;for(p=r;p!==o;p+=a)for(l=t;l!==s;l+=i,f++)d=n[f],e[4*(l+g*p)+3]=255,e[4*(l+g*p)+2]=h[3*d+0],e[4*(l+g*p)+1]=h[3*d+1],e[4*(l+g*p)+0]=h[3*d+2];return e}function t(e,r,a,o,t,i,s,n){var c,d,l,p=0,h=R.width;for(l=r;l!==o;l+=a)for(d=t;d!==s;d+=i,p+=2)c=n[p+0]+(n[p+1]<<8),e[4*(d+h*l)+0]=(31744&c)>>7,e[4*(d+h*l)+1]=(992&c)>>2,e[4*(d+h*l)+2]=(31&c)>>3,e[4*(d+h*l)+3]=32768&c?0:255;return e}function i(e,r,a,o,t,i,s,n){var c,d,l=0,p=R.width;for(d=r;d!==o;d+=a)for(c=t;c!==s;c+=i,l+=3)e[4*(c+p*d)+3]=255,e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+1]=n[l+1],e[4*(c+p*d)+0]=n[l+2];return e}function s(e,r,a,o,t,i,s,n){var c,d,l=0,p=R.width;for(d=r;d!==o;d+=a)for(c=t;c!==s;c+=i,l+=4)e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+1]=n[l+1],e[4*(c+p*d)+0]=n[l+2],e[4*(c+p*d)+3]=n[l+3];return e}function n(e,r,a,o,t,i,s,n){var c,d,l,p=0,h=R.width;for(l=r;l!==o;l+=a)for(d=t;d!==s;d+=i,p++)c=n[p],e[4*(d+h*l)+0]=c,e[4*(d+h*l)+1]=c,e[4*(d+h*l)+2]=c,e[4*(d+h*l)+3]=255;return e}function c(e,r,a,o,t,i,s,n){var c,d,l=0,p=R.width;for(d=r;d!==o;d+=a)for(c=t;c!==s;c+=i,l+=2)e[4*(c+p*d)+0]=n[l+0],e[4*(c+p*d)+1]=n[l+0],e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+3]=n[l+1];return e}function d(e,r,a,d){var l,p,h,f,g,u,T=new Uint8Array(e*r*4);switch((R.flags&E)>>_){default:case H:l=0,h=1,g=e,p=0,f=1,u=r;break;case w:l=0,h=1,g=e,p=r-1,f=-1,u=-1;break;case k:l=e-1,h=-1,g=-1,p=0,f=1,u=r;break;case m:l=e-1,h=-1,g=-1,p=r-1,f=-1,u=-1}if(x)switch(R.pixel_size){case 8:n(T,p,f,u,l,h,g,a);break;case 16:c(T,p,f,u,l,h,g,a);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}else switch(R.pixel_size){case 8:o(T,p,f,u,l,h,g,a,d);break;case 16:t(T,p,f,u,l,h,g,a);break;case 24:i(T,p,f,u,l,h,g,a);break;case 32:s(T,p,f,u,l,h,g,a);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}return T}var l=0,p=1,h=2,f=3,g=9,u=10,T=11,E=48,_=4,w=0,m=1,H=2,k=3;e.length<19&&console.error("THREE.TGALoader.parse: Not enough data to contain header.");var y=new Uint8Array(e),v=0,R={id_length:y[v++],colormap_type:y[v++],image_type:y[v++],colormap_index:y[v++]|y[v++]<<8,colormap_length:y[v++]|y[v++]<<8,colormap_size:y[v++],origin:[y[v++]|y[v++]<<8,y[v++]|y[v++]<<8],width:y[v++]|y[v++]<<8,height:y[v++]|y[v++]<<8,pixel_size:y[v++],flags:y[v++]};r(R),R.id_length+v>e.length&&console.error("THREE.TGALoader.parse: No data"),v+=R.id_length;var b=!1,A=!1,x=!1;switch(R.image_type){case g:b=!0,A=!0;break;case p:A=!0;break;case u:b=!0;break;case h:break;case T:b=!0,x=!0;break;case f:x=!0}var G=a(b,A,R,v,y),L=d(R.width,R.height,G.pixel_data,G.palettes);return{width:R.width,height:R.height,data:L}}};