THREE.VRMLLoader=function(){},THREE.VRMLLoader.prototype={constructor:THREE.VRMLLoader,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,load:function(e,r){var o=this,s=new XMLHttpRequest;s.addEventListener("load",function(e){var s=o.parse(e.target.responseText);o.dispatchEvent({type:"load",content:s}),r&&r(s)},!1),s.addEventListener("progress",function(e){o.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),s.addEventListener("error",function(){o.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),s.open("GET",e,!0),s.send(null)},parse:function(e){var r=function(){console.warn("VRML V1.0 not supported yet")},o=function(e,r){var o={},s=/(\b|\-|\+)([\d\.e]+)/,n=/([\d\.\+\-e]+),?\s+([\d\.\+\-e]+),?\s+([\d\.\+\-e]+)/,i=function(e,r,o){var s=e.r-r.r,n=e.g-r.g,i=e.b-r.b,a=new THREE.Color;return a.r=e.r-o*s,a.g=e.g-o*n,a.b=e.b-o*i,a},a=function(e,r,o,s,n){for(var a,t,l,c,d,h,g,p,f=n?1:-1,E=["a","b","c","d"],v=[],y=1,u={},R={},x=!1,m=0;m<o.length;m++){var T={};T.y=f*Math.cos(o[m])*r,T.x=f*Math.sin(o[m])*r,v.push(T)}for(var F=0;F<e.faces.length;F++){a=e.faces[F],t=a instanceof THREE.Face3?3:4;for(var w=0;t>w;w++){c=a[E[w]],l=e.vertices[c];for(var H=0;H<s.length;H++)0===H?(u.x=0,u.y=n?r:-1*r):(u.x=v[H-1].x,u.y=v[H-1].y),R=v[H],void 0!==R?(x=n?l.y<=u.y&&l.y>R.y:l.y>=u.y&&l.y<R.y,x&&(g=s[H+1],h=s[H],y=Math.abs(l.y-u.y)/(u.y-R.y),d=i(h,g,y),a.vertexColors[w]=d)):void 0===a.vertexColors[w]&&(p=n?s.length-1:0,a.vertexColors[w]=s[p])}}},t=function(e,r){for(var o,i,a,t,l=[],c={},d=/[^\s,\[\]]+/g;null!=(o=d.exec(r));)l.push(o[0]);switch(i=l[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=i,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=i,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=i,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":this.recordingFieldname=i,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(l.length>0){t=[];for(var h=0;h<l.length;h++)/(-?\d+)/.test(l[h])&&("-1"===l[h]?(t.length>0&&this.indexes.push(t),t=[]):t.push(parseInt(l[h])))}/]/.exec(r)&&(this.isRecordingFaces=!1,e.coordIndex=this.indexes)}else if(this.isRecordingPoints)l=n.exec(r),null!=l&&(a={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])},this.points.push(a)),/]/.exec(r)&&(this.isRecordingPoints=!1,e.points=this.points);else if(this.isRecordingAngles){if(l.length>0)for(var h=0;h<l.length;h++)s.test(l[h])&&this.angles.push(parseFloat(l[h]));/]/.exec(r)&&(this.isRecordingAngles=!1,e[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(var g=/([\d\.\+\-e]+),?\s+([\d\.\+\-e]+),?\s+([\d\.\+\-e]+)/g;null!==(l=g.exec(r));)color={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])},this.colors.push(color);/]/.exec(r)&&(this.isRecordingColors=!1,e[this.recordingFieldname]=this.colors)}else if("NULL"!==l[l.length-1]&&"children"!==i){switch(i){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!=l.length){console.warn("Invalid color format detected for "+i);break}c={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])};break;case"translation":case"scale":case"size":if(4!=l.length){console.warn("Invalid vector format detected for "+i);break}c={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])};break;case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!=l.length){console.warn("Invalid single float value specification detected for "+i);break}c=parseFloat(l[1]);break;case"rotation":if(5!=l.length){console.warn("Invalid quaternion format detected for "+i);break}c={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3]),w:parseFloat(l[4])};break;case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!=l.length){console.warn("Invalid format detected for "+i);break}c="TRUE"===l[1]?!0:!1}e[i]=c}return c},l=function(e){for(var r,o,s={string:"Scene",children:[]},n=s,i=0;i<e.length;i++){var a="",l=e[i];if(null===(result=/^\s+?$/g.exec(l))&&(l=l.trim(),""!==l)){if(/#/.exec(l)){var c=l.split("#");l=c[0],a=c[1]}if(r=/([^\s]*){1}\s?{/.exec(l)){var d={nodeType:r[1],string:l,parent:n,children:[],comment:a};n.children.push(d),n=d,/}/.exec(l)&&(o=/{(.*)}/.exec(l)[1],d.children.push(o),t(n,o),n=n.parent)}else/}/.exec(l)?n=n.parent:""!==l&&(t(n,l),n.children.push(l))}}return s},c=function(e,s){if("string"!=typeof e){var n=s;if("Transform"===e.nodeType||"Group"===e.nodeType){if(n=new THREE.Object3D,/DEF/.exec(e.string)&&(n.name=/DEF\s+(\w+)/.exec(e.string)[1],o[n.name]=n),void 0!==e.translation){var i=e.translation;n.position.set(i.x,i.y,i.z)}if(void 0!==e.rotation){var t=e.rotation;n.quaternion.setFromAxisAngle(new THREE.Vector3(t.x,t.y,t.z),t.w)}if(void 0!==e.scale){var l=e.scale;n.scale.set(l.x,l.y,l.z)}s.add(n)}else if("Shape"===e.nodeType)n=new THREE.Mesh,/DEF/.exec(e.string)&&(n.name=/DEF (\w+)/.exec(e.string)[1],o[n.name]=n),s.add(n);else if("Background"===e.nodeType){var d=20,h=2e4,g=new THREE.SphereGeometry(h,d,d),p=new THREE.MeshBasicMaterial({color:"white",vertexColors:THREE.VertexColors,shading:THREE.NoShading});p.side=THREE.BackSide,p.fog=!1,p.color=new THREE.Color,a(g,h,e.skyAngle,e.skyColor,!0);var f=new THREE.Mesh(g,p);r.add(f),h=12e3;var E=new THREE.SphereGeometry(h,d,d,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),v=new THREE.MeshBasicMaterial({color:"white",vertexColors:THREE.VertexColors,shading:THREE.NoShading});v.side=THREE.BackSide,v.fog=!1,v.color=new THREE.Color,a(E,h,e.groundAngle,e.groundColor,!1);var y=new THREE.Mesh(E,v);r.add(y)}else{if(/geometry/.exec(e.string)){if("Box"===e.nodeType){var l=e.size;s.geometry=new THREE.BoxGeometry(l.x,l.y,l.z)}else if("Cylinder"===e.nodeType)s.geometry=new THREE.CylinderGeometry(e.radius,e.radius,e.height);else if("Cone"===e.nodeType)s.geometry=new THREE.CylinderGeometry(e.topRadius,e.bottomRadius,e.height);else if("Sphere"===e.nodeType)s.geometry=new THREE.SphereGeometry(e.radius);else if("IndexedFaceSet"===e.nodeType){for(var u,R=new THREE.Geometry,x=0,m=e.children.length;m>x;x++){var T,F=e.children[x];if("Coordinate"===F.nodeType){for(var w=0,H=F.points.length;H>w;w++){var b=F.points[w];T=new THREE.Vector3(b.x,b.y,b.z),R.vertices.push(T)}break}}for(var C=0,x=0,m=e.coordIndex.length;m>x;x++)for(u=e.coordIndex[x],C=0;u.length>=3&&C<u.length-2;){var M=new THREE.Face3(u[0],u[C+1],u[C+2],null);C++,R.faces.push(M)}!1===e.solid&&(s.material.side=THREE.DoubleSide),R.solid=e.solid,R.computeFaceNormals(),R.computeBoundingSphere(),/DEF/.exec(e.string)&&(R.name=/DEF (\w+)/.exec(e.string)[1],o[R.name]=R),s.geometry=R}return}if(/appearance/.exec(e.string)){for(var x=0;x<e.children.length;x++){var F=e.children[x];if("Material"===F.nodeType){var k=new THREE.MeshPhongMaterial;if(void 0!==F.diffuseColor){var S=F.diffuseColor;k.color.setRGB(S.r,S.g,S.b)}if(void 0!==F.emissiveColor){var L=F.emissiveColor;k.emissive.setRGB(L.r,L.g,L.b)}if(void 0!==F.specularColor){var l=F.specularColor;k.specular.setRGB(l.r,l.g,l.b)}if(void 0!==F.transparency){var i=F.transparency;k.opacity=Math.abs(1-i),k.transparent=!0}/DEF/.exec(e.string)&&(k.name=/DEF (\w+)/.exec(e.string)[1],o[k.name]=k),s.material=k;break}}return}}for(var x=0,H=e.children.length;H>x;x++){var F=e.children[x];c(e.children[x],n)}}else if(/USE/.exec(e)){var I=/USE\s+?(\w+)/.exec(e)[1];if(void 0==o[I])console.warn(I+" is not defined.");else if(/appearance/.exec(e)&&I)s.material=o[I].clone();else if(/geometry/.exec(e)&&I)s.geometry=o[I].clone(),void 0!==o[I].solid&&o[I].solid===!1&&(s.geometry.solid=!1,s.material.side=THREE.DoubleSide);else if(I){var n=o[I].clone();s.add(n)}}};c(l(e),r)},s=new THREE.Scene,n=e.split("\n"),i=n.shift();return/V1.0/.exec(i)?r(n,s):/V2.0/.exec(i)&&o(n,s),s}},THREE.EventDispatcher.prototype.apply(THREE.VRMLLoader.prototype);