THREE.CTMLoader=function(e){THREE.Loader.call(this,e)},THREE.CTMLoader.prototype=Object.create(THREE.Loader.prototype),THREE.CTMLoader.prototype.loadParts=function(e,t,r){r=r||{};var o=this,a=new XMLHttpRequest,s=r.basePath?r.basePath:this.extractUrlBase(e);a.onreadystatechange=function(){function e(e){l+=1,i.push(e),l===n.offsets.length&&t(i,d)}if(4===a.readyState&&(200===a.status||0===a.status)){for(var n=JSON.parse(a.responseText),d=[],i=[],l=0,u=0;u<n.materials.length;u++)d[u]=o.createMaterial(n.materials[u],s);var f=s+n.data,p={useWorker:r.useWorker,offsets:n.offsets};o.load(f,e,p)}},a.open("GET",e,!0),a.setRequestHeader("Content-Type","text/plain"),a.send(null)},THREE.CTMLoader.prototype.load=function(e,t,r){r=r||{};var o=this,a=void 0!==r.offsets?r.offsets:[0],s=new XMLHttpRequest,n=null,d=0;s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||0===s.status){var i=new Uint8Array(s.response),l=Date.now();if(r.useWorker){var u=new Worker("js/loaders/ctm/CTMWorker.js");u.onmessage=function(e){for(var r=e.data,a=0;a<r.length;a++){var s=r[a],n=Date.now();o.createModel(s,t);var d=Date.now();console.log("model load time [worker]: "+(d-n)+" ms, total: "+(d-l))}},u.postMessage({data:i,offsets:a})}else for(var f=0;f<a.length;f++){var p=new CTM.Stream(i);p.offset=a[f];var c=new CTM.File(p);o.createModel(c,t)}}else console.error("Couldn't load ["+e+"] ["+s.status+"]");else 3===s.readyState?n&&(0===d&&(d=s.getResponseHeader("Content-Length")),n({total:d,loaded:s.responseText.length})):2===s.readyState&&(d=s.getResponseHeader("Content-Length"))},s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null)},THREE.CTMLoader.prototype.createModel=function(e,t){var r=function(){THREE.BufferGeometry.call(this),this.materials=[];var t,r,o=e.body.indices,a=e.body.vertices,s=e.body.normals,n=e.body.uvMaps;void 0!==n&&n.length>0&&(t=n[0].uv);var d=e.body.attrMaps;void 0!==d&&d.length>0&&"Color"===d[0].name&&(r=d[0].attr),this.addAttribute("index",new THREE.BufferAttribute(o,1)),this.addAttribute("position",new THREE.BufferAttribute(a,3)),void 0!==s&&this.addAttribute("normal",new THREE.BufferAttribute(s,3)),void 0!==t&&this.addAttribute("uv",new THREE.BufferAttribute(t,2)),void 0!==r&&this.addAttribute("color",new THREE.BufferAttribute(r,4))};r.prototype=Object.create(THREE.BufferGeometry.prototype);var o=new r;o.computeOffsets(),void 0===o.attributes.normal&&o.computeVertexNormals(),t(o)};