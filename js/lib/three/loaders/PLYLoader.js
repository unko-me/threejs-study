THREE.PLYLoader=function(){},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t){var r=this,n=new XMLHttpRequest;n.addEventListener("load",function(e){var n=r.parse(e.target.response);r.dispatchEvent({type:"load",content:n}),t&&t(n)},!1),n.addEventListener("progress",function(e){r.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),n.addEventListener("error",function(){r.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null)},bin2str:function(e){for(var t=new Uint8Array(e),r="",n=0;n<e.byteLength;n++)r+=String.fromCharCode(t[n]);return r},isASCII:function(e){var t=this.parseHeader(this.bin2str(e));return"ascii"===t.format},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){function t(e){var t=Object();return t.type=e[0],"list"===t.type?(t.name=e[3],t.countType=e[1],t.itemType=e[2]):t.name=e[1],t}var r=/ply([\s\S]*)end_header\n/,n="";null!=(result=r.exec(e))&&(n=result[1]);var s=new Object;s.comments=[],s.elements=[],s.headerLength=result[0].length;for(var a,o,i=n.split("\n"),c=void 0,u=0;u<i.length;u++){var l=i[u];if(l=l.trim(),""!==l)switch(o=l.split(/\s+/),a=o.shift(),l=o.join(" "),a){case"format":s.format=o[0],s.version=o[1];break;case"comment":s.comments.push(l);break;case"element":void 0!==c&&s.elements.push(c),c=Object(),c.name=o[0],c.count=parseInt(o[1]),c.properties=[];break;case"property":c.properties.push(t(o));break;default:console.log("unhandled",a,o)}}return void 0!==c&&s.elements.push(c),s},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){values=t.split(/\s+/);for(var r=Object(),n=0;n<e.length;n++)if("list"===e[n].type){var s=[],a=this.parseASCIINumber(values.shift(),e[n].countType);for(j=0;a>j;j++)s.push(this.parseASCIINumber(values.shift(),e[n].itemType));r[e[n].name]=s}else r[e[n].name]=this.parseASCIINumber(values.shift(),e[n].type);return r},parseASCII:function(e){var t,r=new THREE.Geometry,n=this.parseHeader(e),s=/end_header\n([\s\S]*)$/,a="";null!=(t=s.exec(e))&&(a=t[1]);var o=a.split("\n"),i=0,c=0;r.useColor=!1;for(var u=0;u<o.length;u++){var l=o[u];if(l=l.trim(),""!==l){c>=n.elements[i].count&&(i++,c=0);var p=this.parseASCIIElement(n.elements[i].properties,l);this.handleElement(r,n.elements[i].name,p),c++}}return this.postProcess(r)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,r){"vertex"===t?(e.vertices.push(new THREE.Vector3(r.x,r.y,r.z)),"red"in r&&"green"in r&&"blue"in r&&(e.useColor=!0,color=new THREE.Color,color.setRGB(r.red/255,r.green/255,r.blue/255),e.colors.push(color))):"face"===t&&e.faces.push(new THREE.Face3(r.vertex_indices[0],r.vertex_indices[1],r.vertex_indices[2]))},binaryRead:function(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}},binaryReadElement:function(e,t,r,n){for(var s,a=Object(),o=0,i=0;i<r.length;i++)if("list"===r[i].type){var c=[];s=this.binaryRead(e,t+o,r[i].countType,n);var u=s[0];for(o+=s[1],j=0;u>j;j++)s=this.binaryRead(e,t+o,r[i].itemType,n),c.push(s[0]),o+=s[1];a[r[i].name]=c}else s=this.binaryRead(e,t+o,r[i].type,n),a[r[i].name]=s[0],o+=s[1];return[a,o]},parseBinary:function(e){for(var t,r=new THREE.Geometry,n=this.parseHeader(this.bin2str(e)),s="binary_little_endian"===n.format,a=new DataView(e,n.headerLength),o=0,i=0;i<n.elements.length;i++)for(var c=0;c<n.elements[i].count;c++){t=this.binaryReadElement(a,o,n.elements[i].properties,s),o+=t[1];var u=t[0];this.handleElement(r,n.elements[i].name,u)}return this.postProcess(r)}},THREE.EventDispatcher.prototype.apply(THREE.PLYLoader.prototype);