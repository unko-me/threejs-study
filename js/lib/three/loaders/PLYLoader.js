THREE.PLYLoader=function(){this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,setPropertyNameMapping:function(e){this.propertyNameMapping=e},load:function(e,t){var r=this,n=new XMLHttpRequest;n.addEventListener("load",function(e){var n=r.parse(e.target.response);r.dispatchEvent({type:"load",content:n}),t&&t(n)},!1),n.addEventListener("progress",function(e){r.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),n.addEventListener("error",function(){r.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null)},bin2str:function(e){for(var t=new Uint8Array(e),r="",n=0;n<e.byteLength;n++)r+=String.fromCharCode(t[n]);return r},isASCII:function(e){var t=this.parseHeader(this.bin2str(e));return"ascii"===t.format},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){function t(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}var r=/ply([\s\S]*)end_header\s/,n="";null!==(result=r.exec(e))&&(n=result[1]);for(var s,a,i={comments:[],elements:[],headerLength:result[0].length},o=n.split("\n"),c=void 0,p=0;p<o.length;p++){var u=o[p];if(u=u.trim(),""!==u)switch(a=u.split(/\s+/),s=a.shift(),u=a.join(" "),s){case"format":i.format=a[0],i.version=a[1];break;case"comment":i.comments.push(u);break;case"element":void 0!==c&&i.elements.push(c),c=Object(),c.name=a[0],c.count=parseInt(a[1]),c.properties=[];break;case"property":c.properties.push(t(a,this.propertyNameMapping));break;default:console.log("unhandled",s,a)}}return void 0!==c&&i.elements.push(c),i},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){values=t.split(/\s+/);for(var r=Object(),n=0;n<e.length;n++)if("list"===e[n].type){var s=[],a=this.parseASCIINumber(values.shift(),e[n].countType);for(j=0;a>j;j++)s.push(this.parseASCIINumber(values.shift(),e[n].itemType));r[e[n].name]=s}else r[e[n].name]=this.parseASCIINumber(values.shift(),e[n].type);return r},parseASCII:function(e){var t,r=new THREE.Geometry,n=this.parseHeader(e),s=/end_header\s([\s\S]*)$/,a="";null!==(t=s.exec(e))&&(a=t[1]);var i=a.split("\n"),o=0,c=0;r.useColor=!1;for(var p=0;p<i.length;p++){var u=i[p];if(u=u.trim(),""!==u){c>=n.elements[o].count&&(o++,c=0);var l=this.parseASCIIElement(n.elements[o].properties,u);this.handleElement(r,n.elements[o].name,l),c++}}return this.postProcess(r)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,r){"vertex"===t?(e.vertices.push(new THREE.Vector3(r.x,r.y,r.z)),"red"in r&&"green"in r&&"blue"in r&&(e.useColor=!0,color=new THREE.Color,color.setRGB(r.red/255,r.green/255,r.blue/255),e.colors.push(color))):"face"===t&&e.faces.push(new THREE.Face3(r.vertex_indices[0],r.vertex_indices[1],r.vertex_indices[2]))},binaryRead:function(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}},binaryReadElement:function(e,t,r,n){for(var s,a=Object(),i=0,o=0;o<r.length;o++)if("list"===r[o].type){var c=[];s=this.binaryRead(e,t+i,r[o].countType,n);var p=s[0];for(i+=s[1],j=0;p>j;j++)s=this.binaryRead(e,t+i,r[o].itemType,n),c.push(s[0]),i+=s[1];a[r[o].name]=c}else s=this.binaryRead(e,t+i,r[o].type,n),a[r[o].name]=s[0],i+=s[1];return[a,i]},parseBinary:function(e){for(var t,r=new THREE.Geometry,n=this.parseHeader(this.bin2str(e)),s="binary_little_endian"===n.format,a=new DataView(e,n.headerLength),i=0,o=0;o<n.elements.length;o++)for(var c=0;c<n.elements[o].count;c++){t=this.binaryReadElement(a,i,n.elements[o].properties,s),i+=t[1];var p=t[0];this.handleElement(r,n.elements[o].name,p)}return this.postProcess(r)}},THREE.EventDispatcher.prototype.apply(THREE.PLYLoader.prototype);