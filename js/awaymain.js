function mountain_js_context_available(t,e){var i=away.stagegl.ContextStage3D.contexts[t];if(i._iCallback){i._iDriverInfo=e;var n=window.setTimeout(function(){window.clearTimeout(n);try{i._iCallback(i)}catch(t){console.log("Callback failed during flash initialization with '"+t.toString()+"'")}},1)}}(function(){var t;t=function(){function t(){}return t.canWebGL=function(){var t;try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return t=e,!1}},t}(),"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?exports.CanvasDetector=t:window.CanvasDetector=t}).call(this);var Stats=function(){var t=Date.now(),e=t,i=0,n=1/0,r=0,s=0,a=1/0,o=0,h=0,p=0,u=document.createElement("div");u.id="stats",u.addEventListener("mousedown",function(t){t.preventDefault(),y(++p%2)},!1),u.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",u.appendChild(l);var c=document.createElement("div");c.id="fpsText",c.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",c.innerHTML="FPS",l.appendChild(c);var d=document.createElement("div");for(d.id="fpsGraph",d.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(d);74>d.children.length;){var _=document.createElement("span");_.style.cssText="width:1px;height:30px;float:left;background-color:#113",d.appendChild(_)}var f=document.createElement("div");f.id="ms",f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",u.appendChild(f);var g=document.createElement("div");g.id="msText",g.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",g.innerHTML="MS",f.appendChild(g);var m=document.createElement("div");for(m.id="msGraph",m.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",f.appendChild(m);74>m.children.length;)_=document.createElement("span"),_.style.cssText="width:1px;height:30px;float:left;background-color:#131",m.appendChild(_);var y=function(t){switch(p=t){case 0:l.style.display="block",f.style.display="none";break;case 1:l.style.display="none",f.style.display="block"}};return{REVISION:11,domElement:u,setMode:y,begin:function(){t=Date.now()},end:function(){var p=Date.now();i=p-t,n=Math.min(n,i),r=Math.max(r,i),g.textContent=i+" MS ("+n+"-"+r+")";var u=Math.min(30,30-30*(i/200));return m.appendChild(m.firstChild).style.height=u+"px",h++,p>e+1e3&&(s=Math.round(1e3*h/(p-e)),a=Math.min(a,s),o=Math.max(o,s),c.textContent=s+" FPS ("+a+"-"+o+")",u=Math.min(30,30-30*(s/100)),d.appendChild(d.firstChild).style.height=u+"px",e=p,h=0),p},update:function(){t=this.end()}}},away;!function(t){!function(t){var e=function(){function t(t,e,i){"undefined"==typeof t&&(t=""),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=""),this._errorID=0,this._messsage="",this._name="",this._messsage=t,this._name=name,this._errorID=e}return Object.defineProperty(t.prototype,"message",{get:function(){return this._messsage},set:function(t){this._messsage=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorID",{get:function(){return this._errorID},enumerable:!0,configurable:!0}),t}();t.Error=e}(t.errors||(t.errors={})),t.errors}(away||(away={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},away;!function(t){!function(e){var i=function(t){function e(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),t.call(this,e||"ArgumentError",i)}return __extends(e,t),e}(t.errors.Error);e.ArgumentError=i}(t.errors||(t.errors={})),t.errors}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e}(t.Error);t.CastError=e}(t.errors||(t.errors={})),t.errors}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=""),"undefined"==typeof i&&(i=0),t.call(this,"PartialImplementationError - this function is in development. Required Dependency: "+e,i)}return __extends(e,t),e}(t.Error);t.PartialImplementationError=e}(t.errors||(t.errors={})),t.errors}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),t.call(this,e||"An abstract method was called! Either an instance of an abstract class was created, or an abstract method was not overridden by the subclass.",i)}return __extends(e,t),e}(t.errors.Error);e.AbstractMethodError=i}(t.errors||(t.errors={})),t.errors}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e="DocumentError"),"undefined"==typeof i&&(i=0),t.call(this,e,i)}return __extends(e,t),e.DOCUMENT_DOES_NOT_EXIST="documentDoesNotExist",e}(t.Error);t.DocumentError=e}(t.errors||(t.errors={})),t.errors}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),t.call(this,e||"RangeError",i)}return __extends(e,t),e}(t.errors.Error);e.RangeError=i}(t.errors||(t.errors={})),t.errors}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){this.type=void 0,this.target=void 0,this.type=t}return t.prototype.clone=function(){return new t(this.type)},t.COMPLETE="complete",t.OPEN="open",t.ENTER_FRAME="enterFrame",t.EXIT_FRAME="exitFrame",t.RESIZE="resize",t.ERROR="error",t.CHANGE="change",t}();t.Event=e}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i,n){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),e.call(this,t),this._asset=i,this._prevName=n||(this._asset?this._asset.name:null)}return __extends(i,e),Object.defineProperty(i.prototype,"asset",{get:function(){return this._asset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"assetPrevName",{get:function(){return this._prevName},enumerable:!0,configurable:!0}),i.prototype.clone=function(){return new t.events.AssetEvent(this.type,this.asset,this.assetPrevName)},i.ASSET_COMPLETE="assetComplete",i.ASSET_RENAME="assetRename",i.ASSET_CONFLICT_RESOLVED="assetConflictResolved",i.TEXTURE_SIZE_ERROR="textureSizeError",i}(t.events.Event);e.AssetEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){t.call(this,e),this._camera=i}return __extends(e,t),Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),e.PROJECTION_CHANGED="projectionChanged",e}(t.events.Event);e.CameraEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){t.call(this,e),this.object=i}return __extends(e,t),e.VISIBLITY_UPDATED="visiblityUpdated",e.SCENETRANSFORM_CHANGED="scenetransformChanged",e.SCENE_CHANGED="sceneChanged",e.POSITION_CHANGED="positionChanged",e.ROTATION_CHANGED="rotationChanged",e.SCALE_CHANGED="scaleChanged",e}(t.Event);t.DisplayObjectEvent=e}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){"undefined"==typeof t&&(t=null),this.listeners=new Array,this.target=t||this}return t.prototype.addEventListener=function(t,e){void 0===this.listeners[t]&&(this.listeners[t]=new Array),-1===this.getEventListenerIndex(t,e)&&this.listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){var i=this.getEventListenerIndex(t,e);-1!==i&&this.listeners[t].splice(i,1)},t.prototype.dispatchEvent=function(t){var e=this.listeners[t.type];if(void 0!==e){var i=e.length;t.target=this.target;for(var n=0;i>n;n++)e[n](t)}},t.prototype.getEventListenerIndex=function(t,e){if(void 0!==this.listeners[t])for(var i=this.listeners[t],n=i.length,r=0;n>r;r++)if(e==i[r])return r;return-1},t.prototype.hasEventListener=function(t,e){return null!=e?-1!==this.getEventListenerIndex(t,e):void 0!==this.listeners[t]?this.listeners[t].length>0:!1},t}();t.EventDispatcher=e}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){"undefined"==typeof i&&(i=null),t.call(this,e),this._subGeometry=i}return __extends(e,t),Object.defineProperty(e.prototype,"subGeometry",{get:function(){return this._subGeometry},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._subGeometry)},e.SUB_GEOMETRY_ADDED="SubGeometryAdded",e.SUB_GEOMETRY_REMOVED="SubGeometryRemoved",e.BOUNDS_INVALID="BoundsInvalid",e}(t.events.Event);e.GeometryEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){"undefined"==typeof i&&(i=null),t.call(this,e),this.status=i}return __extends(e,t),e.HTTP_STATUS="HTTPStatusEvent_HTTP_STATUS",e}(t.events.Event);e.HTTPStatusEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.IO_ERROR="ioError",e}(t.events.Event);e.IOErrorEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.clone=function(){return new t.events.LightEvent(this.type)},i.CASTS_SHADOW_CHANGE="castsShadowChange",i}(t.events.Event);e.LightEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i,n,r){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),t.call(this,e),this._url=i,this._content=n,this._assets=r}return __extends(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._url,this._content,this._assets)},e.RESOURCE_COMPLETE="resourceComplete",e}(t.events.Event);e.LoaderEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i){"undefined"==typeof i&&(i=""),e.call(this,t),this._message=i}return __extends(i,e),Object.defineProperty(i.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),i.prototype.clone=function(){return new t.events.ParserEvent(this.type,this.message)},i.PARSE_COMPLETE="parseComplete",i.PARSE_ERROR="parseError",i.READY_FOR_DEPENDENCIES="readyForDependencies",i}(t.events.Event);e.ParserEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){t.call(this,e),this._iAllowedToPropagate=!0}return __extends(e,t),Object.defineProperty(e.prototype,"bubbles",{get:function(){var t=this._iAllowedToPropagate;return this._iAllowedToPropagate=!0,t},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){this._iAllowedToPropagate=!1,this._iParentEvent&&this._iParentEvent.stopPropagation()},e.prototype.stopImmediatePropagation=function(){this._iAllowedToPropagate=!1,this._iParentEvent&&this._iParentEvent.stopImmediatePropagation()},e.prototype.clone=function(){var t=new e(this.type);return t.screenX=this.screenX,t.screenY=this.screenY,t.view=this.view,t.object=this.object,t.materialOwner=this.materialOwner,t.material=this.material,t.uv=this.uv,t.localPosition=this.localPosition,t.localNormal=this.localNormal,t.index=this.index,t.subGeometryIndex=this.subGeometryIndex,t.delta=this.delta,t.ctrlKey=this.ctrlKey,t.shiftKey=this.shiftKey,t._iParentEvent=this,t._iAllowedToPropagate=this._iAllowedToPropagate,t},Object.defineProperty(e.prototype,"scenePosition",{get:function(){return this.object.sceneTransform.transformVector(this.localPosition)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneNormal",{get:function(){var t=this.object.sceneTransform.deltaTransformVector(this.localNormal);return t.normalize(),t},enumerable:!0,configurable:!0}),e.MOUSE_OVER="mouseOver3d",e.MOUSE_OUT="mouseOut3d",e.MOUSE_UP="mouseUp3d",e.MOUSE_DOWN="mouseDown3d",e.MOUSE_MOVE="mouseMove3d",e.CLICK="click3d",e.DOUBLE_CLICK="doubleClick3d",e.MOUSE_WHEEL="mouseWheel3d",e}(t.events.Event);e.MouseEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.SIZE_CHANGED="sizeChanged",e}(t.Event);t.MaterialEvent=e}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.PROGRESS="progress",e}(t.events.Event);e.ProgressEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){t.call(this,e),this._projection=i}return __extends(e,t),Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},enumerable:!0,configurable:!0}),e.MATRIX_CHANGED="matrixChanged",e}(t.events.Event);e.ProjectionEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.VIEWPORT_UPDATED="viewportUpdated",e.SCISSOR_UPDATED="scissorUpdated",e}(t.Event);t.RendererEvent=e}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){this.displayObject=i,t.call(this,e)}return __extends(e,t),e.ADDED_TO_SCENE="addedToScene",e.REMOVED_FROM_SCENE="removedFromScene",e.PARTITION_CHANGED="partitionChanged",e}(t.events.Event);e.SceneEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.CONTEXT_CREATED="contextCreated",e.CONTEXT_DISPOSED="contextDisposed",e.CONTEXT_RECREATED="contextRecreated",e.VIEWPORT_UPDATED="viewportUpdated",e}(t.events.Event);e.StageEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e,i){"undefined"==typeof i&&(i=""),t.call(this,e),this._dataType=i}return __extends(e,t),Object.defineProperty(e.prototype,"dataType",{get:function(){return this._dataType},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._dataType)},e.INDICES_UPDATED="indicesUpdated",e.VERTICES_UPDATED="verticesUpdated",e}(t.events.Event);e.SubGeometryEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.TIMER="timer",e.TIMER_COMPLETE="timerComplete",e}(t.events.Event);e.TimerEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(){this.position=0,this.length=0,this._mode=""}return e.prototype.writeByte=function(){throw"Virtual method"},e.prototype.readByte=function(){throw"Virtual method"},e.prototype.writeUnsignedByte=function(){throw"Virtual method"},e.prototype.readUnsignedByte=function(){throw"Virtual method"},e.prototype.writeUnsignedShort=function(){throw"Virtual method"},e.prototype.readUnsignedShort=function(){throw"Virtual method"},e.prototype.writeUnsignedInt=function(){throw"Virtual method"},e.prototype.readUnsignedInt=function(){throw"Virtual method"},e.prototype.writeFloat=function(){throw"Virtual method"},e.prototype.toFloatBits=function(){throw"Virtual method"},e.prototype.readFloat=function(){throw"Virtual method"},e.prototype.fromFloatBits=function(){throw"Virtual method"},e.prototype.getBytesAvailable=function(){throw new t.errors.AbstractMethodError("ByteArrayBase, getBytesAvailable() not implemented ")},e.prototype.toString=function(){return"[ByteArray] ( "+this._mode+" ) position="+this.position+" length="+this.length},e.prototype.compareEqual=function(t,e){(void 0==e||e>this.length-this.position)&&(e=this.length-this.position),e>t.length-t.position&&(e=t.length-t.position);for(var i=!0;i&&e>=4;)e-=4,this.readUnsignedInt()!=t.readUnsignedInt()&&(i=!1);for(;i&&e>=1;)e--,this.readUnsignedByte()!=t.readUnsignedByte()&&(i=!1);var n;return this.position-=n-e,t.position-=n-e,i},e.prototype.writeBase64String=function(t){for(var e=0;e<t.length;e++)t.charAt(e)},e.prototype.dumpToConsole=function(){function t(t,e){for(var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n="",r=0;e>r;r++)n=i[t>>(r<<2)&15]+n;return n}var e=this.position;this.position=0;for(var i=8,n=0;n<this.length;n+=i){for(var r=t(n,4)+":",s=0;i>s&&n+s<this.length;s++)r+=" "+t(this.readUnsignedByte(),2);console.log(r)}this.position=e},e.prototype.readBase64String=function(t){return(void 0==t||t>this.length-this.position)&&(t=this.length-this.position),t>0?e.internalGetBase64String(t,this.readUnsignedByte,this):""},e.internalGetBase64String=function(t,i,n){for(var r,s,a,o,h,p,u,l="",c=e.Base64Key;t>=3;)r=i.apply(n),s=i.apply(n),a=i.apply(n),o=r>>2,h=(3&r)<<4|s>>4,p=(15&s)<<2|a>>6,u=63&a,l+=c.charAt(o)+c.charAt(h)+c.charAt(p)+c.charAt(u),t-=3;return 2==t?(r=i.apply(n),s=i.apply(n),o=r>>2,h=(3&r)<<4|s>>4,p=(15&s)<<2,l+=c.charAt(o)+c.charAt(h)+c.charAt(p)+"="):1==t&&(r=i.apply(n),o=r>>2,h=(3&r)<<4,l+=c.charAt(o)+c.charAt(h)+"=="),l},e.Base64Key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e}();e.ByteArrayBase=i}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this),this.maxlength=0,this._mode="Typed array",this.maxlength=4,this.arraybytes=new ArrayBuffer(this.maxlength),this.unalignedarraybytestemp=new ArrayBuffer(16)}return __extends(e,t),e.prototype.ensureWriteableSpace=function(t){this.ensureSpace(t+this.position)},e.prototype.setArrayBuffer=function(t){this.ensureSpace(t.byteLength),this.length=t.byteLength;var e=new Int8Array(t),i=new Int8Array(this.arraybytes,0,this.length);i.set(e),this.position=0},e.prototype.getBytesAvailable=function(){return this.length-this.position},e.prototype.ensureSpace=function(t){if(t>this.maxlength){var e=t+255&-256,i=new ArrayBuffer(e),n=new Uint8Array(this.arraybytes,0,this.length),r=new Uint8Array(i,0,this.length);r.set(n),this.arraybytes=i,this.maxlength=e}},e.prototype.writeByte=function(t){this.ensureWriteableSpace(1);var e=new Int8Array(this.arraybytes);e[this.position++]=~~t,this.position>this.length&&(this.length=this.position)},e.prototype.readByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;var t=new Int8Array(this.arraybytes);return t[this.position++]},e.prototype.readBytes=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),null==i&&(i=t.length),t.ensureWriteableSpace(e+i);var n=new Int8Array(t.arraybytes),r=new Int8Array(this.arraybytes);n.set(r.subarray(this.position,this.position+i),e),this.position+=i,i+e>t.length&&(t.length+=i+e-t.length)},e.prototype.writeUnsignedByte=function(t){this.ensureWriteableSpace(1);var e=new Uint8Array(this.arraybytes);e[this.position++]=255&~~t,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;var t=new Uint8Array(this.arraybytes);return t[this.position++]},e.prototype.writeUnsignedShort=function(t){if(this.ensureWriteableSpace(2),0==(1&this.position)){var e=new Uint16Array(this.arraybytes);e[this.position>>1]=65535&~~t}else{var e=new Uint16Array(this.unalignedarraybytestemp,0,1);e[0]=65535&~~t;var i=new Uint8Array(this.arraybytes,this.position,2),n=new Uint8Array(this.unalignedarraybytestemp,0,2);i.set(n)}this.position+=2,this.position>this.length&&(this.length=this.position)},e.prototype.readUTFBytes=function(t){for(var e="",i=this.position+t,n=new DataView(this.arraybytes);this.position<i;){var r=n.getUint8(this.position++);if(128>r){if(0==r)break;e+=String.fromCharCode(r)}else if(224>r)e+=String.fromCharCode((63&r)<<6|127&n.getUint8(this.position++));else if(240>r){var s=n.getUint8(this.position++);e+=String.fromCharCode((31&r)<<12|(127&s)<<6|127&n.getUint8(this.position++))}else{var s=n.getUint8(this.position++),a=n.getUint8(this.position++);e+=String.fromCharCode((15&r)<<18|(127&s)<<12|a<<6&127|127&n.getUint8(this.position++))}}return e},e.prototype.readInt=function(){var t=new DataView(this.arraybytes),e=t.getInt32(this.position,!0);return this.position+=4,e},e.prototype.readShort=function(){var t=new DataView(this.arraybytes),e=t.getInt16(this.position,!0);return this.position+=2,e},e.prototype.readDouble=function(){var t=new DataView(this.arraybytes),e=t.getFloat64(this.position,!0);return this.position+=8,e},e.prototype.readUnsignedShort=function(){if(this.position>this.length+2)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if(0==(1&this.position)){var t=new Uint16Array(this.arraybytes),e=this.position>>1;return this.position+=2,t[e]}var t=new Uint16Array(this.unalignedarraybytestemp,0,1),i=new Uint8Array(this.arraybytes,this.position,2),n=new Uint8Array(this.unalignedarraybytestemp,0,2);return n.set(i),this.position+=2,t[0]},e.prototype.writeUnsignedInt=function(t){if(this.ensureWriteableSpace(4),0==(3&this.position)){var e=new Uint32Array(this.arraybytes);e[this.position>>2]=4294967295&~~t}else{var e=new Uint32Array(this.unalignedarraybytestemp,0,1);e[0]=4294967295&~~t;var i=new Uint8Array(this.arraybytes,this.position,4),n=new Uint8Array(this.unalignedarraybytestemp,0,4);i.set(n)}this.position+=4,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedInt=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if(0==(3&this.position)){var t=new Uint32Array(this.arraybytes),e=this.position>>2;return this.position+=4,t[e]}var t=new Uint32Array(this.unalignedarraybytestemp,0,1),i=new Uint8Array(this.arraybytes,this.position,4),n=new Uint8Array(this.unalignedarraybytestemp,0,4);return n.set(i),this.position+=4,t[0]},e.prototype.writeFloat=function(t){if(this.ensureWriteableSpace(4),0==(3&this.position)){var e=new Float32Array(this.arraybytes);e[this.position>>2]=t}else{var e=new Float32Array(this.unalignedarraybytestemp,0,1);e[0]=t;var i=new Uint8Array(this.arraybytes,this.position,4),n=new Uint8Array(this.unalignedarraybytestemp,0,4);i.set(n)}this.position+=4,this.position>this.length&&(this.length=this.position)},e.prototype.readFloat=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;if(0==(3&this.position)){var t=new Float32Array(this.arraybytes),e=this.position>>2;return this.position+=4,t[e]}var t=new Float32Array(this.unalignedarraybytestemp,0,1),i=new Uint8Array(this.arraybytes,this.position,4),n=new Uint8Array(this.unalignedarraybytestemp,0,4);return n.set(i),this.position+=4,t[0]},e}(t.ByteArrayBase);t.ByteArray=e}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this),this._bytes=[],this._mode="Array"}return __extends(e,t),e.prototype.writeByte=function(t){var e=~~t;this._bytes[this.position++]=e,this.position>this.length&&(this.length=this.position)},e.prototype.readByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;return this._bytes[this.position++]},e.prototype.writeUnsignedByte=function(t){var e=~~t;this._bytes[this.position++]=255&e,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;return this._bytes[this.position++]},e.prototype.writeUnsignedShort=function(t){var e=~~t;this._bytes[this.position++]=255&e,this._bytes[this.position++]=e>>8&255,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedShort=function(){if(this.position+2>this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;var t=this._bytes[this.position]|this._bytes[this.position+1]<<8;return this.position+=2,t},e.prototype.writeUnsignedInt=function(t){var e=~~t;this._bytes[this.position++]=255&e,this._bytes[this.position++]=e>>>8&255,this._bytes[this.position++]=e>>>16&255,this._bytes[this.position++]=e>>>24&255,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedInt=function(){if(this.position+4>this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;var t=this._bytes[this.position]|this._bytes[this.position+1]<<8|this._bytes[this.position+2]<<16|this._bytes[this.position+3]<<24;return this.position+=4,t>>>0},e.prototype.writeFloat=function(t){this.writeUnsignedInt(this.toFloatBits(Number(t)))},e.prototype.toFloatBits=function(t){if(0==t)return 0;var e=0;0>t?(t=-t,e=1):e=0;var i=Math.log(t)/Math.log(2);i=Math.floor(i),t*=Math.pow(2,23-i);var n=Math.floor(t)-8388608;return i+=127,e<<31>>>0|i<<23|n},e.prototype.readFloat=function(){return this.fromFloatBits(this.readUnsignedInt())},e.prototype.fromFloatBits=function(t){if(0==t)return 0;var e=t>>>23&255,i=8388607&t|8388608,n=Math.pow(2,e-127-23)*i;return t>>>31!=0&&(n=-n),n},e}(t.ByteArrayBase);t.ByteArrayBuffer=e}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.float32ColorToARGB=function(t){var e=(4278190080&t)>>>24,i=(16711680&t)>>>16,n=(65280&t)>>>8,r=255&t,s=[e,i,n,r];return s},t.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.RGBToHexString=function(e){return"#"+t.componentToHex(e[1])+t.componentToHex(e[2])+t.componentToHex(e[3])},t.ARGBToHexString=function(e){return"#"+t.componentToHex(e[0])+t.componentToHex(e[1])+t.componentToHex(e[2])+t.componentToHex(e[3])},t}();t.ColorUtils=e}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(e){var i=function(){function i(){}return i.string=function(t){return"function"==typeof t&&(t=new t),"string"==typeof t?t:t},i.byteArray=function(t){return"function"==typeof t&&(t=new t),t instanceof e.ByteArray?t:t},i.isHex=function(t){for(var e=t.length,i=0;e>i;++i)if(-1==this._hexChars.indexOf(t.charAt(i)))return!1;return!0},i.tryColor=function(t){if("number"==typeof t)return Math.floor(t);if("string"==typeof t){if("random"==t)return Math.floor(16777216*Math.random());if(null==this._colorNames&&(this._colorNames=new Object,this._colorNames.steelblue=4620980,this._colorNames.royalblue=267920,this._colorNames.cornflowerblue=6591981,this._colorNames.lightsteelblue=11584734,this._colorNames.mediumslateblue=8087790,this._colorNames.slateblue=6970061,this._colorNames.darkslateblue=4734347,this._colorNames.midnightblue=1644912,this._colorNames.navy=128,this._colorNames.darkblue=139,this._colorNames.mediumblue=205,this._colorNames.blue=255,this._colorNames.dodgerblue=2003199,this._colorNames.deepskyblue=49151,this._colorNames.lightskyblue=8900346,this._colorNames.skyblue=8900331,this._colorNames.lightblue=11393254,this._colorNames.powderblue=11591910,this._colorNames.azure=15794175,this._colorNames.lightcyan=14745599,this._colorNames.paleturquoise=11529966,this._colorNames.mediumturquoise=4772300,this._colorNames.lightseagreen=2142890,this._colorNames.darkcyan=35723,this._colorNames.teal=32896,this._colorNames.cadetblue=6266528,this._colorNames.darkturquoise=52945,this._colorNames.aqua=65535,this._colorNames.cyan=65535,this._colorNames.turquoise=4251856,this._colorNames.aquamarine=8388564,this._colorNames.mediumaquamarine=6737322,this._colorNames.darkseagreen=9419919,this._colorNames.mediumseagreen=3978097,this._colorNames.seagreen=3050327,this._colorNames.darkgreen=25600,this._colorNames.green=32768,this._colorNames.forestgreen=2263842,this._colorNames.limegreen=3329330,this._colorNames.lime=65280,this._colorNames.chartreuse=8388352,this._colorNames.lawngreen=8190976,this._colorNames.greenyellow=11403055,this._colorNames.yellowgreen=10145074,this._colorNames.palegreen=10025880,this._colorNames.lightgreen=9498256,this._colorNames.springgreen=65407,this._colorNames.mediumspringgreen=64154,this._colorNames.darkolivegreen=5597999,this._colorNames.olivedrab=7048739,this._colorNames.olive=8421376,this._colorNames.darkkhaki=12433259,this._colorNames.darkgoldenrod=12092939,this._colorNames.goldenrod=14329120,this._colorNames.gold=16766720,this._colorNames.yellow=16776960,this._colorNames.khaki=15787660,this._colorNames.palegoldenrod=15657130,this._colorNames.blanchedalmond=16772045,this._colorNames.moccasin=16770229,this._colorNames.wheat=16113331,this._colorNames.navajowhite=16768685,this._colorNames.burlywood=14596231,this._colorNames.tan=13808780,this._colorNames.rosybrown=12357519,this._colorNames.sienna=10506797,this._colorNames.saddlebrown=9127187,this._colorNames.chocolate=13789470,this._colorNames.peru=13468991,this._colorNames.sandybrown=16032864,this._colorNames.darkred=9109504,this._colorNames.maroon=8388608,this._colorNames.brown=10824234,this._colorNames.firebrick=11674146,this._colorNames.indianred=13458524,this._colorNames.lightcoral=15761536,this._colorNames.salmon=16416882,this._colorNames.darksalmon=15308410,this._colorNames.lightsalmon=16752762,this._colorNames.coral=16744272,this._colorNames.tomato=16737095,this._colorNames.darkorange=16747520,this._colorNames.orange=16753920,this._colorNames.orangered=16729344,this._colorNames.crimson=14423100,this._colorNames.red=16711680,this._colorNames.deeppink=16716947,this._colorNames.fuchsia=16711935,this._colorNames.magenta=16711935,this._colorNames.hotpink=16738740,this._colorNames.lightpink=16758465,this._colorNames.pink=16761035,this._colorNames.palevioletred=14381203,this._colorNames.mediumvioletred=13047173,this._colorNames.purple=8388736,this._colorNames.darkmagenta=9109643,this._colorNames.mediumpurple=9662683,this._colorNames.blueviolet=9055202,this._colorNames.indigo=4915330,this._colorNames.darkviolet=9699539,this._colorNames.darkorchid=10040012,this._colorNames.mediumorchid=12211667,this._colorNames.orchid=14315734,this._colorNames.violet=15631086,this._colorNames.plum=14524637,this._colorNames.thistle=14204888,this._colorNames.lavender=15132410,this._colorNames.ghostwhite=16316671,this._colorNames.aliceblue=15792383,this._colorNames.mintcream=16121850,this._colorNames.honeydew=15794160,this._colorNames.lightgoldenrodyellow=16448210,this._colorNames.lemonchiffon=16775885,this._colorNames.cornsilk=16775388,this._colorNames.lightyellow=16777184,this._colorNames.ivory=16777200,this._colorNames.floralwhite=16775920,this._colorNames.linen=16445670,this._colorNames.oldlace=16643558,this._colorNames.antiquewhite=16444375,this._colorNames.bisque=16770244,this._colorNames.peachpuff=16767673,this._colorNames.papayawhip=16773077,this._colorNames.beige=16119260,this._colorNames.seashell=16774638,this._colorNames.lavenderblush=16773365,this._colorNames.mistyrose=16770273,this._colorNames.snow=16775930,this._colorNames.white=16777215,this._colorNames.whitesmoke=16119285,this._colorNames.gainsboro=14474460,this._colorNames.lightgrey=13882323,this._colorNames.silver=12632256,this._colorNames.darkgrey=11119017,this._colorNames.grey=8421504,this._colorNames.lightslategrey=7833753,this._colorNames.slategrey=7372944,this._colorNames.dimgrey=6908265,this._colorNames.darkslategrey=3100495,this._colorNames.black=0,this._colorNames.transparent=4278190080),null!=this._colorNames[t])return this._colorNames[t];if(6==t.length&&this.isHex(t))return parseInt("0x"+t)}return null},i.color=function(e){var i=this.tryColor(e);if(null==i)throw new t.errors.CastError("Can't cast to color: "+e);return i},i.tryClass=function(t){if(this._notClasses[t])return t;var e=this._classes[t];if(null!=e)return e;try{return e=window[t],this._classes[t]=e,e}catch(i){}return this._notClasses[t]=!0,t},i.bitmapData=function(e){if(null==e)return null;if("string"==typeof e&&(e=this.tryClass(e)),"function"==typeof e)try{e=new e
}catch(i){e=new e(0,0)}if(e instanceof t.base.BitmapData)return e;if(e instanceof t.textures.ImageTexture&&(e=e.htmlImageElement),e instanceof HTMLImageElement){var n=e,r=new t.base.BitmapData(n.width,n.height,!0,0);return r.draw(n),r}throw new t.errors.CastError("Can't cast to BitmapData: "+e)},i.bitmapTexture=function(e){if(null==e)return null;if("string"==typeof e&&(e=this.tryClass(e)),"function"==typeof e)try{e=new e}catch(n){e=new e(0,0)}if(e instanceof t.textures.BitmapTexture)return e;try{var r=i.bitmapData(e);return new t.textures.BitmapTexture(r)}catch(n){}throw new t.errors.CastError("Can't cast to BitmapTexture: "+e)},i._hexChars="0123456789abcdefABCDEF",i._notClasses=new Object,i._classes=new Object,i}();e.Cast=i}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.setElementSize=function(t,e,i){t.style.width=e+"px",t.style.height=i+"px",t.width=e,t.height=i},t.setElementWidth=function(t,e){t.style.width=e+"px",t.width=e},t.setElementHeight=function(t,e){t.style.height=e+"px",t.height=e},t.setElementX=function(t,e){t.style.position="absolute",t.style.left=e+"px"},t.setElementY=function(t,e){t.style.position="absolute",t.style.top=e+"px"},t.getElementVisibility=function(t){return"visible"==t.style.visibility},t.setElementVisibility=function(t,e){t.style.visibility=e?"visible":"hidden"},t.setElementAlpha=function(t,e){if(t instanceof HTMLCanvasElement){var i=t.getContext("2d");i.globalAlpha=e}},t.setElementPosition=function(t,e,i,n){"undefined"==typeof n&&(n=!1),t.style.position=n?"absolute":"relative",t.style.left=e+"px",t.style.top=i+"px"},t}();t.CSS=e}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){var e=function(){function e(){}return e.breakpoint=function(){t.Debug["break"]()},e.throwPIROnKeyWordOnly=function(e,i){"undefined"==typeof i&&(i=!0),t.Debug.keyword=i?e:null},e.throwPIR=function(i,n,r){if(e.logPIR("PartialImplementationError "+i,n,r),e.THROW_ERRORS){if(t.Debug.keyword){var s=i+n+r;if(-1==s.indexOf(t.Debug.keyword))return}throw new t.errors.PartialImplementationError(i+"."+n+": "+r)}},e.logPIR=function(t,i,n){"undefined"==typeof n&&(n=""),e.LOG_PI_ERRORS&&console.log(t+"."+i+": "+n)},e.log=function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];e.ENABLE_LOG&&console.log(t)},e.THROW_ERRORS=!0,e.ENABLE_LOG=!0,e.LOG_PI_ERRORS=!0,e.keyword=null,e}();t.Debug=e}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){"undefined"==typeof t&&(t=null),this._func=t}return t.create=function(t,e){var i=function(){return e.apply(t,arguments)};return i},t.prototype.createDelegate=function(e){return t.create(e,this._func)},t}();t.Delegate=e}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(t){function e(){return Date.now()}t.getTimer=e}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(e,i){var n=this;this._active=!1,this._argsArray=new Array,this._getTimer=t.utils.getTimer,this.setCallback(e,i),this._rafUpdateFunction=function(){n._active&&n._tick()},this._argsArray.push(this._dt)}return e.prototype.setCallback=function(t,e){this._callback=t,this._callbackContext=e},e.prototype.start=function(){this._prevTime=this._getTimer(),this._active=!0,window.requestAnimationFrame?window.requestAnimationFrame(this._rafUpdateFunction):window.mozRequestAnimationFrame?window.requestAnimationFrame=window.mozRequestAnimationFrame:window.webkitRequestAnimationFrame?window.requestAnimationFrame=window.webkitRequestAnimationFrame:window.oRequestAnimationFrame&&(window.requestAnimationFrame=window.oRequestAnimationFrame)},e.prototype.stop=function(){this._active=!1},Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),e.prototype._tick=function(){this._currentTime=this._getTimer(),this._dt=this._currentTime-this._prevTime,this._argsArray[0]=this._dt,this._callback.apply(this._callbackContext,this._argsArray),window.requestAnimationFrame(this._rafUpdateFunction),this._prevTime=this._currentTime},e}();e.RequestAnimationFrame=i}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.isBitmapDataValid=function(e){return null==e?!0:t.isDimensionValid(e.width)&&t.isDimensionValid(e.height)},t.isHTMLImageElementValid=function(e){return null==e?!0:t.isDimensionValid(e.width)&&t.isDimensionValid(e.height)},t.isDimensionValid=function(e){return e>=1&&e<=t.MAX_SIZE&&t.isPowerOfTwo(e)},t.isPowerOfTwo=function(t){return t?(t&-t)==t:!1},t.getBestPowerOf2=function(e){for(var i=1;e>i;)i<<=1;return i>t.MAX_SIZE&&(i=t.MAX_SIZE),i},t.MAX_SIZE=2048,t}();t.TextureUtils=e}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(i,n){if("undefined"==typeof n&&(n=0),e.call(this),this._repeatCount=0,this._currentCount=0,this._running=!1,this._delay=i,this._repeatCount=n,isNaN(i)||0>i)throw new t.errors.Error("Delay is negative or not a number")}return __extends(i,e),Object.defineProperty(i.prototype,"currentCount",{get:function(){return this._currentCount},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"delay",{get:function(){return this._delay},set:function(t){this._delay=t,this._running&&(this.stop(),this.start())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(t){this._repeatCount=t},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this._running&&this.stop(),this._currentCount=0},Object.defineProperty(i.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),i.prototype.start=function(){var t=this;this._running=!0,clearInterval(this._iid),this._iid=setInterval(function(){return t.tick()},this._delay)},i.prototype.stop=function(){this._running=!1,clearInterval(this._iid)},i.prototype.tick=function(){this._currentCount++,this._repeatCount>0&&this._currentCount>=this._repeatCount?(this.stop(),this.dispatchEvent(new t.events.TimerEvent(t.events.TimerEvent.TIMER)),this.dispatchEvent(new t.events.TimerEvent(t.events.TimerEvent.TIMER_COMPLETE))):this.dispatchEvent(new t.events.TimerEvent(t.events.TimerEvent.TIMER))},i}(t.events.EventDispatcher);e.Timer=i}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(e){var i=function(){function i(t,e,i,n,r,s){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),this.x=t,this.y=e,this.z=i,this.width=n,this.height=r,this.depth=s}return Object.defineProperty(i.prototype,"back",{get:function(){return this.z+this.depth},set:function(t){this.depth=t-this.z},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottomRightBack",{get:function(){return null==this._bottomRightBack&&(this._bottomRightBack=new e.Vector3D),this._bottomRightBack.x=this.x+this.width,this._bottomRightBack.y=this.y+this.height,this._bottomRightBack.z=this.z+this.depth,this._bottomRightBack},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"front",{get:function(){return this.z},set:function(t){this.depth+=this.z-t,this.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return null==this._size&&(this._size=new e.Vector3D),this._size.x=this.width,this._size.y=this.height,this._size.z=this.depth,this._size},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topLeftFront",{get:function(){return null==this._topLeftFront&&(this._topLeftFront=new t.geom.Vector3D),this._topLeftFront.x=this.x,this._topLeftFront.y=this.y,this._topLeftFront.z=this.z,this._topLeftFront},enumerable:!0,configurable:!0}),i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.width,this.height,this.depth)},i.prototype.contains=function(t,e,i){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e&&this.z<=i&&this.z+this.depth>=i},i.prototype.containsPoint=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y&&this.z<=t.z&&this.z+this.depth>=t.z},i.prototype.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height&&this.z<=t.z&&this.z+this.depth>=t.z+t.depth},i.prototype.copyFrom=function(){},i.prototype.equals=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.width==t.width&&this.height==t.height&&this.depth==t.depth},i.prototype.inflate=function(t,e,i){this.x-=t/2,this.y-=e/2,this.z-=i/2,this.width+=t/2,this.height+=e/2,this.depth+=i/2},i.prototype.inflatePoint=function(t){this.x-=t.x/2,this.y-=t.y/2,this.z-=t.z/2,this.width+=t.x/2,this.height+=t.y/2,this.depth+=t.z/2},i.prototype.intersection=function(t){if(this.intersects(t)){var e=new i;return this.x>t.x?(e.x=this.x,e.width=t.x-this.x+t.width,e.width>this.width&&(e.width=this.width)):(e.x=t.x,e.width=this.x-t.x+this.width,e.width>t.width&&(e.width=t.width)),this.y>t.y?(e.y=this.y,e.height=t.y-this.y+t.height,e.height>this.height&&(e.height=this.height)):(e.y=t.y,e.height=this.y-t.y+this.height,e.height>t.height&&(e.height=t.height)),this.z>t.z?(e.z=this.z,e.depth=t.z-this.z+t.depth,e.depth>this.depth&&(e.depth=this.depth)):(e.z=t.z,e.depth=this.z-t.z+this.depth,e.depth>t.depth&&(e.depth=t.depth)),e}return new i},i.prototype.intersects=function(t){return this.x+this.width>t.x&&this.x<t.x+t.width&&this.y+this.height>t.y&&this.y<t.y+t.height&&this.z+this.depth>t.z&&this.z<t.z+t.depth},i.prototype.isEmpty=function(){return 0==this.x&&0==this.y&&0==this.z&&0==this.width&&0==this.height&&0==this.depth},i.prototype.offset=function(t,e,i){this.x+=t,this.y+=e,this.z+=i},i.prototype.offsetPosition=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},i.prototype.setEmpty=function(){this.x=0,this.y=0,this.z=0,this.width=0,this.height=0,this.depth=0},i.prototype.setTo=function(t,e,i,n,r,s){this.x=t,this.y=e,this.z=i,this.width=n,this.height=r,this.depth=s},i.prototype.toString=function(){return"[Box] (x="+this.x+", y="+this.y+", z="+this.z+", width="+this.width+", height="+this.height+", depth="+this.depth+")"},i.prototype.union=function(t){var e=new i;return this.x<t.x?(e.x=this.x,e.width=t.x-this.x+t.width,e.width<this.width&&(e.width=this.width)):(e.x=t.x,e.width=this.x-t.x+this.width,e.width<t.width&&(e.width=t.width)),this.y<t.y?(e.y=this.y,e.height=t.y-this.y+t.height,e.height<this.height&&(e.height=this.height)):(e.y=t.y,e.height=this.y-t.y+this.height,e.height<t.height&&(e.height=t.height)),this.z<t.z?(e.z=this.z,e.depth=t.z-this.z+t.depth,e.depth<this.depth&&(e.depth=this.depth)):(e.z=t.z,e.depth=this.z-t.z+this.depth,e.depth<t.depth&&(e.depth=t.depth)),e},i}();e.Box=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(t,e,i,n,r,s,a,o){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=0),"undefined"==typeof o&&(o=0),this.redMultiplier=t,this.greenMultiplier=e,this.blueMultiplier=i,this.alphaMultiplier=n,this.redOffset=r,this.greenOffset=s,this.blueOffset=a,this.alphaOffset=o}return Object.defineProperty(e.prototype,"color",{get:function(){return this.redOffset<<16|this.greenOffset<<8|this.blueOffset},set:function(e){var i=t.utils.ColorUtils.float32ColorToARGB(e);this.redOffset=i[1],this.greenOffset=i[2],this.blueOffset=i[3],this.redMultiplier=0,this.greenMultiplier=0,this.blueMultiplier=0},enumerable:!0,configurable:!0}),e.prototype.concat=function(t){this.redMultiplier+=t.redMultiplier,this.greenMultiplier+=t.greenMultiplier,this.blueMultiplier+=t.blueMultiplier,this.alphaMultiplier+=t.alphaMultiplier},e}();e.ColorTransform=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.RADIANS_TO_DEGREES=180/Math.PI,t.DEGREES_TO_RADIANS=Math.PI/180,t}();t.MathConsts=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(t,e,i,n,r,s){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}return e.prototype.clone=function(){return new e(this.a,this.b,this.c,this.d,this.tx,this.ty)},e.prototype.concat=function(t){var e=this.a*t.a+this.b*t.c;this.b=this.a*t.b+this.b*t.d,this.a=e;var i=this.c*t.a+this.d*t.c;this.d=this.c*t.b+this.d*t.d,this.c=i;var n=this.tx*t.a+this.ty*t.c+t.tx;this.ty=this.tx*t.b+this.ty*t.d+t.ty,this.tx=n},e.prototype.copyColumnFrom=function(t,e){if(t>2)throw"Column "+t+" out of bounds (2)";0==t?(this.a=e.x,this.c=e.y):1==t?(this.b=e.x,this.d=e.y):(this.tx=e.x,this.ty=e.y)},e.prototype.copyColumnTo=function(e,i){if(e>2)throw new t.errors.ArgumentError("ArgumentError, Column "+e+" out of bounds [0, ..., 2]");0==e?(i.x=this.a,i.y=this.c,i.z=0):1==e?(i.x=this.b,i.y=this.d,i.z=0):(i.x=this.tx,i.y=this.ty,i.z=1)},e.prototype.copyFrom=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty},e.prototype.copyRowFrom=function(e,i){if(e>2)throw new t.errors.ArgumentError("ArgumentError, Row "+e+" out of bounds [0, ..., 2]");0==e?(this.a=i.x,this.c=i.y):1==e?(this.b=i.x,this.d=i.y):(this.tx=i.x,this.ty=i.y)},e.prototype.copyRowTo=function(e,i){if(e>2)throw new t.errors.ArgumentError("ArgumentError, Row "+e+" out of bounds [0, ..., 2]");0==e?(i.x=this.a,i.y=this.b,i.z=this.tx):1==e?(i.x=this.c,i.y=this.d,i.z=this.ty):i.setTo(0,0,1)},e.prototype.createBox=function(t,e,i,n,r){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),this.a=t,this.d=e,this.b=i,this.tx=n,this.ty=r},e.prototype.createGradientBox=function(t,e,i,n,r){if("undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),this.a=t/1638.4,this.d=e/1638.4,0!=i){var s=Math.cos(i),a=Math.sin(i);this.b=a*this.d,this.c=-a*this.a,this.a*=s,this.d*=s}else this.b=this.c=0;this.tx=n+t/2,this.ty=r+e/2},e.prototype.deltaTransformPoint=function(e){return new t.geom.Point(e.x*this.a+e.y*this.c,e.x*this.b+e.y*this.d)},e.prototype.identity=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},e.prototype.invert=function(){var t=this.a*this.d-this.b*this.c;if(0==t)this.a=this.b=this.c=this.d=0,this.tx=-this.tx,this.ty=-this.ty;else{t=1/t;var e=this.d*t;this.d=this.a*t,this.a=e,this.b*=-t,this.c*=-t;var i=-this.a*this.tx-this.c*this.ty;this.ty=-this.b*this.tx-this.d*this.ty,this.tx=i}},e.prototype.multiply=function(t){var i=new e;return i.a=this.a*t.a+this.b*t.c,i.b=this.a*t.b+this.b*t.d,i.c=this.c*t.a+this.d*t.c,i.d=this.c*t.b+this.d*t.d,i.tx=this.tx*t.a+this.ty*t.c+t.tx,i.ty=this.tx*t.b+this.ty*t.d+t.ty,i},e.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a*e-this.b*i;this.b=this.a*i+this.b*e,this.a=n;var r=this.c*e-this.d*i;this.d=this.c*i+this.d*e,this.c=r;var s=this.tx*e-this.ty*i;this.ty=this.tx*i+this.ty*e,this.tx=s},e.prototype.scale=function(t,e){this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.tx*=t,this.ty*=e},e.prototype.setTo=function(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s},e.prototype.toString=function(){return"[Matrix] (a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},e.prototype.transformPoint=function(e){return new t.geom.Point(e.x*this.a+e.y*this.c+this.tx,e.x*this.b+e.y*this.d+this.ty)},e.prototype.translate=function(t,e){this.tx+=t,this.ty+=e},e}();e.Matrix=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=function(){function i(t){"undefined"==typeof t&&(t=null),this.rawData=null!=t&&16==t.length?t.concat():[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return i.prototype.append=function(t){var e=this.rawData[0],i=this.rawData[4],n=this.rawData[8],r=this.rawData[12],s=this.rawData[1],a=this.rawData[5],o=this.rawData[9],h=this.rawData[13],p=this.rawData[2],u=this.rawData[6],l=this.rawData[10],c=this.rawData[14],d=this.rawData[3],_=this.rawData[7],f=this.rawData[11],g=this.rawData[15],m=t.rawData[0],y=t.rawData[4],b=t.rawData[8],x=t.rawData[12],v=t.rawData[1],w=t.rawData[5],D=t.rawData[9],C=t.rawData[13],S=t.rawData[2],P=t.rawData[6],A=t.rawData[10],T=t.rawData[14],M=t.rawData[3],E=t.rawData[7],O=t.rawData[11],R=t.rawData[15];this.rawData[0]=e*m+s*y+p*b+d*x,this.rawData[1]=e*v+s*w+p*D+d*C,this.rawData[2]=e*S+s*P+p*A+d*T,this.rawData[3]=e*M+s*E+p*O+d*R,this.rawData[4]=i*m+a*y+u*b+_*x,this.rawData[5]=i*v+a*w+u*D+_*C,this.rawData[6]=i*S+a*P+u*A+_*T,this.rawData[7]=i*M+a*E+u*O+_*R,this.rawData[8]=n*m+o*y+l*b+f*x,this.rawData[9]=n*v+o*w+l*D+f*C,this.rawData[10]=n*S+o*P+l*A+f*T,this.rawData[11]=n*M+o*E+l*O+f*R,this.rawData[12]=r*m+h*y+c*b+g*x,this.rawData[13]=r*v+h*w+c*D+g*C,this.rawData[14]=r*S+h*P+c*A+g*T,this.rawData[15]=r*M+h*E+c*O+g*R},i.prototype.appendRotation=function(t,e){var n=i.getAxisRotation(e.x,e.y,e.z,t);this.append(n)},i.prototype.appendScale=function(t,e,n){this.append(new i([t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1]))},i.prototype.appendTranslation=function(t,e,i){this.rawData[12]+=t,this.rawData[13]+=e,this.rawData[14]+=i},i.prototype.clone=function(){return new i(this.rawData.slice(0))},i.prototype.copyColumnFrom=function(e,i){switch(e){case 0:this.rawData[0]=i.x,this.rawData[1]=i.y,this.rawData[2]=i.z,this.rawData[3]=i.w;break;case 1:this.rawData[4]=i.x,this.rawData[5]=i.y,this.rawData[6]=i.z,this.rawData[7]=i.w;break;case 2:this.rawData[8]=i.x,this.rawData[9]=i.y,this.rawData[10]=i.z,this.rawData[11]=i.w;break;case 3:this.rawData[12]=i.x,this.rawData[13]=i.y,this.rawData[14]=i.z,this.rawData[15]=i.w;break;default:throw new t.errors.ArgumentError("ArgumentError, Column "+e+" out of bounds [0, ..., 3]")}},i.prototype.copyColumnTo=function(e,i){switch(e){case 0:i.x=this.rawData[0],i.y=this.rawData[1],i.z=this.rawData[2],i.w=this.rawData[3];break;case 1:i.x=this.rawData[4],i.y=this.rawData[5],i.z=this.rawData[6],i.w=this.rawData[7];break;case 2:i.x=this.rawData[8],i.y=this.rawData[9],i.z=this.rawData[10],i.w=this.rawData[11];break;case 3:i.x=this.rawData[12],i.y=this.rawData[13],i.z=this.rawData[14],i.w=this.rawData[15];break;default:throw new t.errors.ArgumentError("ArgumentError, Column "+e+" out of bounds [0, ..., 3]")}},i.prototype.copyFrom=function(t){for(var e=t.rawData.length,i=0;e>i;i++)this.rawData[i]=t.rawData[i]},i.prototype.copyRawDataFrom=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=!1),i&&this.transpose();for(var n=t.length-e,r=0;n>r;r++)this.rawData[r]=t[r+e];i&&this.transpose()},i.prototype.copyRawDataTo=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=!1),i&&this.transpose();for(var n=this.rawData.length,r=0;n>r;r++)t[r+e]=this.rawData[r];i&&this.transpose()},i.prototype.copyRowFrom=function(e,i){switch(e){case 0:this.rawData[0]=i.x,this.rawData[4]=i.y,this.rawData[8]=i.z,this.rawData[12]=i.w;break;case 1:this.rawData[1]=i.x,this.rawData[5]=i.y,this.rawData[9]=i.z,this.rawData[13]=i.w;break;case 2:this.rawData[2]=i.x,this.rawData[6]=i.y,this.rawData[10]=i.z,this.rawData[14]=i.w;break;case 3:this.rawData[3]=i.x,this.rawData[7]=i.y,this.rawData[11]=i.z,this.rawData[15]=i.w;break;default:throw new t.errors.ArgumentError("ArgumentError, Row "+e+" out of bounds [0, ..., 3]")}},i.prototype.copyRowTo=function(e,i){switch(e){case 0:i.x=this.rawData[0],i.y=this.rawData[4],i.z=this.rawData[8],i.w=this.rawData[12];break;case 1:i.x=this.rawData[1],i.y=this.rawData[5],i.z=this.rawData[9],i.w=this.rawData[13];break;case 2:i.x=this.rawData[2],i.y=this.rawData[6],i.z=this.rawData[10],i.w=this.rawData[14];break;case 3:i.x=this.rawData[3],i.y=this.rawData[7],i.z=this.rawData[11],i.w=this.rawData[15];break;default:throw new t.errors.ArgumentError("ArgumentError, Row "+e+" out of bounds [0, ..., 3]")}},i.prototype.copyToMatrix3D=function(t){t.rawData=this.rawData.slice(0)},i.prototype.decompose=function(t){"undefined"==typeof t&&(t="eulerAngles");var i=[],n=this.clone(),r=n.rawData,s=new e.Vector3D(r[12],r[13],r[14]);r[12]=0,r[13]=0,r[14]=0;var a=new e.Vector3D;a.x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),a.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),a.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),r[0]*(r[5]*r[10]-r[6]*r[9])-r[1]*(r[4]*r[10]-r[6]*r[8])+r[2]*(r[4]*r[9]-r[5]*r[8])<0&&(a.z=-a.z),r[0]/=a.x,r[1]/=a.x,r[2]/=a.x,r[4]/=a.y,r[5]/=a.y,r[6]/=a.y,r[8]/=a.z,r[9]/=a.z,r[10]/=a.z;var o=new e.Vector3D;switch(t){case e.Orientation3D.AXIS_ANGLE:o.w=Math.acos((r[0]+r[5]+r[10]-1)/2);var h=Math.sqrt((r[6]-r[9])*(r[6]-r[9])+(r[8]-r[2])*(r[8]-r[2])+(r[1]-r[4])*(r[1]-r[4]));o.x=(r[6]-r[9])/h,o.y=(r[8]-r[2])/h,o.z=(r[1]-r[4])/h;break;case e.Orientation3D.QUATERNION:var p=r[0]+r[5]+r[10];p>0?(o.w=Math.sqrt(1+p)/2,o.x=(r[6]-r[9])/(4*o.w),o.y=(r[8]-r[2])/(4*o.w),o.z=(r[1]-r[4])/(4*o.w)):r[0]>r[5]&&r[0]>r[10]?(o.x=Math.sqrt(1+r[0]-r[5]-r[10])/2,o.w=(r[6]-r[9])/(4*o.x),o.y=(r[1]+r[4])/(4*o.x),o.z=(r[8]+r[2])/(4*o.x)):r[5]>r[10]?(o.y=Math.sqrt(1+r[5]-r[0]-r[10])/2,o.x=(r[1]+r[4])/(4*o.y),o.w=(r[8]-r[2])/(4*o.y),o.z=(r[6]+r[9])/(4*o.y)):(o.z=Math.sqrt(1+r[10]-r[0]-r[5])/2,o.x=(r[8]+r[2])/(4*o.z),o.y=(r[6]+r[9])/(4*o.z),o.w=(r[1]-r[4])/(4*o.z));break;case e.Orientation3D.EULER_ANGLES:o.y=Math.asin(-r[2]),1!=r[2]&&-1!=r[2]?(o.x=Math.atan2(r[6],r[10]),o.z=Math.atan2(r[1],r[0])):(o.z=0,o.x=Math.atan2(r[4],r[5]))}return i.push(s),i.push(o),i.push(a),i},i.prototype.deltaTransformVector=function(e){var i=e.x,n=e.y,r=e.z;return new t.geom.Vector3D(i*this.rawData[0]+n*this.rawData[4]+r*this.rawData[8],i*this.rawData[1]+n*this.rawData[5]+r*this.rawData[9],i*this.rawData[2]+n*this.rawData[6]+r*this.rawData[10],i*this.rawData[3]+n*this.rawData[7]+r*this.rawData[11])},i.prototype.identity=function(){this.rawData=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},i.interpolate=function(t,e,n){for(var r=new i,s=0;16>s;++s)r.rawData[s]=t.rawData[s]+(e.rawData[s]-t.rawData[s])*n;return r},i.prototype.interpolateTo=function(t,e){for(var i=0;16>i;++i)this.rawData[i]=this.rawData[i]+(t.rawData[i]-this.rawData[i])*e},i.prototype.invert=function(){var t=this.determinant,e=Math.abs(t)>1e-11;if(e){t=1/t;var i=this.rawData[0],n=this.rawData[4],r=this.rawData[8],s=this.rawData[12],a=this.rawData[1],o=this.rawData[5],h=this.rawData[9],p=this.rawData[13],u=this.rawData[2],l=this.rawData[6],c=this.rawData[10],d=this.rawData[14],_=this.rawData[3],f=this.rawData[7],g=this.rawData[11],m=this.rawData[15];this.rawData[0]=t*(o*(c*m-d*g)-h*(l*m-d*f)+p*(l*g-c*f)),this.rawData[1]=-t*(a*(c*m-d*g)-h*(u*m-d*_)+p*(u*g-c*_)),this.rawData[2]=t*(a*(l*m-d*f)-o*(u*m-d*_)+p*(u*f-l*_)),this.rawData[3]=-t*(a*(l*g-c*f)-o*(u*g-c*_)+h*(u*f-l*_)),this.rawData[4]=-t*(n*(c*m-d*g)-r*(l*m-d*f)+s*(l*g-c*f)),this.rawData[5]=t*(i*(c*m-d*g)-r*(u*m-d*_)+s*(u*g-c*_)),this.rawData[6]=-t*(i*(l*m-d*f)-n*(u*m-d*_)+s*(u*f-l*_)),this.rawData[7]=t*(i*(l*g-c*f)-n*(u*g-c*_)+r*(u*f-l*_)),this.rawData[8]=t*(n*(h*m-p*g)-r*(o*m-p*f)+s*(o*g-h*f)),this.rawData[9]=-t*(i*(h*m-p*g)-r*(a*m-p*_)+s*(a*g-h*_)),this.rawData[10]=t*(i*(o*m-p*f)-n*(a*m-p*_)+s*(a*f-o*_)),this.rawData[11]=-t*(i*(o*g-h*f)-n*(a*g-h*_)+r*(a*f-o*_)),this.rawData[12]=-t*(n*(h*d-p*c)-r*(o*d-p*l)+s*(o*c-h*l)),this.rawData[13]=t*(i*(h*d-p*c)-r*(a*d-p*u)+s*(a*c-h*u)),this.rawData[14]=-t*(i*(o*d-p*l)-n*(a*d-p*u)+s*(a*l-o*u)),this.rawData[15]=t*(i*(o*c-h*l)-n*(a*c-h*u)+r*(a*l-o*u))}return e},i.prototype.prepend=function(t){var e=t.rawData[0],i=t.rawData[4],n=t.rawData[8],r=t.rawData[12],s=t.rawData[1],a=t.rawData[5],o=t.rawData[9],h=t.rawData[13],p=t.rawData[2],u=t.rawData[6],l=t.rawData[10],c=t.rawData[14],d=t.rawData[3],_=t.rawData[7],f=t.rawData[11],g=t.rawData[15],m=this.rawData[0],y=this.rawData[4],b=this.rawData[8],x=this.rawData[12],v=this.rawData[1],w=this.rawData[5],D=this.rawData[9],C=this.rawData[13],S=this.rawData[2],P=this.rawData[6],A=this.rawData[10],T=this.rawData[14],M=this.rawData[3],E=this.rawData[7],O=this.rawData[11],R=this.rawData[15];this.rawData[0]=e*m+s*y+p*b+d*x,this.rawData[1]=e*v+s*w+p*D+d*C,this.rawData[2]=e*S+s*P+p*A+d*T,this.rawData[3]=e*M+s*E+p*O+d*R,this.rawData[4]=i*m+a*y+u*b+_*x,this.rawData[5]=i*v+a*w+u*D+_*C,this.rawData[6]=i*S+a*P+u*A+_*T,this.rawData[7]=i*M+a*E+u*O+_*R,this.rawData[8]=n*m+o*y+l*b+f*x,this.rawData[9]=n*v+o*w+l*D+f*C,this.rawData[10]=n*S+o*P+l*A+f*T,this.rawData[11]=n*M+o*E+l*O+f*R,this.rawData[12]=r*m+h*y+c*b+g*x,this.rawData[13]=r*v+h*w+c*D+g*C,this.rawData[14]=r*S+h*P+c*A+g*T,this.rawData[15]=r*M+h*E+c*O+g*R},i.prototype.prependRotation=function(t,e){var n=i.getAxisRotation(e.x,e.y,e.z,t);this.prepend(n)},i.prototype.prependScale=function(t,e,n){this.prepend(new i([t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1]))},i.prototype.prependTranslation=function(t,n,r){var s=new i;s.position=new e.Vector3D(t,n,r),this.prepend(s)},i.prototype.recompose=function(t){if(t.length<3)return!1;this.identity(),this.appendScale(t[2].x,t[2].y,t[2].z);var e;return e=-t[1].x,this.append(new i([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,0])),e=-t[1].y,this.append(new i([Math.cos(e),0,Math.sin(e),0,0,1,0,0,-Math.sin(e),0,Math.cos(e),0,0,0,0,0])),e=-t[1].z,this.append(new i([Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,0])),this.position=t[0],this.rawData[15]=1,!0},i.prototype.transformVector=function(e){var i=e.x,n=e.y,r=e.z;return new t.geom.Vector3D(i*this.rawData[0]+n*this.rawData[4]+r*this.rawData[8]+this.rawData[12],i*this.rawData[1]+n*this.rawData[5]+r*this.rawData[9]+this.rawData[13],i*this.rawData[2]+n*this.rawData[6]+r*this.rawData[10]+this.rawData[14],i*this.rawData[3]+n*this.rawData[7]+r*this.rawData[11]+this.rawData[15])},i.prototype.transformVectors=function(t,e){for(var i=0,n=0,r=0,s=0;i+3<=t.length;)n=t[i],r=t[i+1],s=t[i+2],e[i]=n*this.rawData[0]+r*this.rawData[4]+s*this.rawData[8]+this.rawData[12],e[i+1]=n*this.rawData[1]+r*this.rawData[5]+s*this.rawData[9]+this.rawData[13],e[i+2]=n*this.rawData[2]+r*this.rawData[6]+s*this.rawData[10]+this.rawData[14],i+=3},i.prototype.transpose=function(){var t=this.rawData.slice(0);this.rawData[1]=t[4],this.rawData[2]=t[8],this.rawData[3]=t[12],this.rawData[4]=t[1],this.rawData[6]=t[9],this.rawData[7]=t[13],this.rawData[8]=t[2],this.rawData[9]=t[6],this.rawData[11]=t[14],this.rawData[12]=t[3],this.rawData[13]=t[7],this.rawData[14]=t[11]},i.getAxisRotation=function(t,e,n,r){var s,a,o=new i,h=r*(Math.PI/180),p=Math.cos(h),u=Math.sin(h),l=1-p;return o.rawData[0]=p+t*t*l,o.rawData[5]=p+e*e*l,o.rawData[10]=p+n*n*l,s=t*e*l,a=n*u,o.rawData[1]=s+a,o.rawData[4]=s-a,s=t*n*l,a=e*u,o.rawData[8]=s+a,o.rawData[2]=s-a,s=e*n*l,a=t*u,o.rawData[9]=s-a,o.rawData[6]=s+a,o},Object.defineProperty(i.prototype,"determinant",{get:function(){return(this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15]-this.rawData[14]*this.rawData[11])-(this.rawData[0]*this.rawData[9]-this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15]-this.rawData[14]*this.rawData[7])+(this.rawData[0]*this.rawData[13]-this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11]-this.rawData[10]*this.rawData[7])+(this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15]-this.rawData[14]*this.rawData[3])-(this.rawData[4]*this.rawData[13]-this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11]-this.rawData[10]*this.rawData[3])+(this.rawData[8]*this.rawData[13]-this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7]-this.rawData[6]*this.rawData[3])},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return new e.Vector3D(this.rawData[12],this.rawData[13],this.rawData[14])},set:function(t){this.rawData[12]=t.x,this.rawData[13]=t.y,this.rawData[14]=t.z},enumerable:!0,configurable:!0}),i.prototype.toFixed=function(t){var e=Math.pow(10,t);return"matrix3d("+Math.round(this.rawData[0]*e)/e+","+Math.round(this.rawData[1]*e)/e+","+Math.round(this.rawData[2]*e)/e+","+Math.round(this.rawData[3]*e)/e+","+Math.round(this.rawData[4]*e)/e+","+Math.round(this.rawData[5]*e)/e+","+Math.round(this.rawData[6]*e)/e+","+Math.round(this.rawData[7]*e)/e+","+Math.round(this.rawData[8]*e)/e+","+Math.round(this.rawData[9]*e)/e+","+Math.round(this.rawData[10]*e)/e+","+Math.round(this.rawData[11]*e)/e+","+Math.round(this.rawData[12]*e)/e+","+Math.round(this.rawData[13]*e)/e+","+Math.round(this.rawData[14]*e)/e+","+Math.round(this.rawData[15]*e)/e+")"},i.prototype.toString=function(){return"matrix3d("+Math.round(1e3*this.rawData[0])/1e3+","+Math.round(1e3*this.rawData[1])/1e3+","+Math.round(1e3*this.rawData[2])/1e3+","+Math.round(1e3*this.rawData[3])/1e3+","+Math.round(1e3*this.rawData[4])/1e3+","+Math.round(1e3*this.rawData[5])/1e3+","+Math.round(1e3*this.rawData[6])/1e3+","+Math.round(1e3*this.rawData[7])/1e3+","+Math.round(1e3*this.rawData[8])/1e3+","+Math.round(1e3*this.rawData[9])/1e3+","+Math.round(1e3*this.rawData[10])/1e3+","+Math.round(1e3*this.rawData[11])/1e3+","+Math.round(1e3*this.rawData[12])/1e3+","+Math.round(1e3*this.rawData[13])/1e3+","+Math.round(1e3*this.rawData[14])/1e3+","+Math.round(1e3*this.rawData[15])/1e3+")"},i}();e.Matrix3D=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(){}return e.quaternion2matrix=function(i,n){"undefined"==typeof n&&(n=null);var r=i.x,s=i.y,a=i.z,o=i.w,h=r*r,p=r*s,u=r*a,l=r*o,c=s*s,d=s*a,_=s*o,f=a*a,g=a*o,m=e.RAW_DATA_CONTAINER;return m[0]=1-2*(c+f),m[1]=2*(p+g),m[2]=2*(u-_),m[4]=2*(p-g),m[5]=1-2*(h+f),m[6]=2*(d+l),m[8]=2*(u+_),m[9]=2*(d-l),m[10]=1-2*(h+c),m[3]=m[7]=m[11]=m[12]=m[13]=m[14]=0,m[15]=1,n?(n.copyRawDataFrom(m),n):new t.Matrix3D(m)},e.getForward=function(e,i){return"undefined"==typeof i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyColumnTo(2,i),i.normalize(),i},e.getUp=function(e,i){return"undefined"==typeof i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyColumnTo(1,i),i.normalize(),i},e.getRight=function(e,i){return"undefined"==typeof i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyColumnTo(0,i),i.normalize(),i},e.compare=function(t,i){var n=e.RAW_DATA_CONTAINER,r=i.rawData;t.copyRawDataTo(n);for(var s=0;16>s;++s)if(n[s]!=r[s])return!1;return!0},e.lookAt=function(t,i,n,r){var s,a,o,h=e.RAW_DATA_CONTAINER;o=n.crossProduct(r),o.normalize(),a=o.crossProduct(n),a.normalize(),s=n.clone(),s.normalize(),h[0]=o.x,h[1]=a.x,h[2]=-s.x,h[3]=0,h[4]=o.y,h[5]=a.y,h[6]=-s.y,h[7]=0,h[8]=o.z,h[9]=a.z,h[10]=-s.z,h[11]=0,h[12]=-o.dotProduct(i),h[13]=-a.dotProduct(i),h[14]=s.dotProduct(i),h[15]=1,t.copyRawDataFrom(h)},e.reflection=function(i,n){"undefined"==typeof n&&(n=null),null===n&&(n=new t.Matrix3D);var r=i.a,s=i.b,a=i.c,o=i.d,h=e.RAW_DATA_CONTAINER,p=-2*r*s,u=-2*r*a,l=-2*s*a;return h[0]=1-2*r*r,h[4]=p,h[8]=u,h[12]=-2*r*o,h[1]=p,h[5]=1-2*s*s,h[9]=l,h[13]=-2*s*o,h[2]=u,h[6]=l,h[10]=1-2*a*a,h[14]=-2*a*o,h[3]=0,h[7]=0,h[11]=0,h[15]=1,n.copyRawDataFrom(h),n},e.transformVector=function(i,n,r){"undefined"==typeof r&&(r=null),r||(r=new t.Vector3D);var s=e.RAW_DATA_CONTAINER;i.copyRawDataTo(s);var a=s[0],o=s[1],h=s[2],p=s[3],u=s[4],l=s[5],c=s[6],d=s[7],_=s[8],f=s[9],g=s[10],m=s[11],y=s[12],b=s[13],x=s[14],v=s[15],w=n.x,D=n.y,C=n.z;return r.x=a*w+u*D+_*C+y,r.y=o*w+l*D+f*C+b,r.z=h*w+c*D+g*C+x,r.w=p*w+d*D+m*C+v,r},e.deltaTransformVector=function(i,n,r){"undefined"==typeof r&&(r=null),r||(r=new t.Vector3D);var s=e.RAW_DATA_CONTAINER;i.copyRawDataTo(s);var a=s[0],o=s[1],h=s[2],p=s[3],u=s[4],l=s[5],c=s[6],d=s[7],_=s[8],f=s[9],g=s[10],m=s[11],y=n.x,b=n.y,x=n.z;return r.x=a*y+u*b+_*x,r.y=o*y+l*b+f*x,r.z=h*y+c*b+g*x,r.w=p*y+d*b+m*x,r},e.getTranslation=function(e,i){return"undefined"==typeof i&&(i=null),i||(i=new t.Vector3D),e.copyColumnTo(3,i),i},e.deltaTransformVectors=function(t,i,n){var r=e.RAW_DATA_CONTAINER;t.copyRawDataTo(r);for(var s=r[0],a=r[1],o=r[2],h=(r[3],r[4]),p=r[5],u=r[6],l=(r[7],r[8]),c=r[9],d=r[10],_=(r[11],0),f=i.length,g=0;f>g;g+=3){var m=i[g],y=i[g+1],b=i[g+2];
n[_++]=s*m+h*y+l*b,n[_++]=a*m+p*y+c*b,n[_++]=o*m+u*y+d*b}},e.RAW_DATA_CONTAINER=new Array(16),e.CALCULATION_MATRIX=new t.Matrix3D,e}();t.Matrix3DUtils=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.AXIS_ANGLE="axisAngle",t.EULER_ANGLES="eulerAngles",t.QUATERNION="quaternion",t}();t.Orientation3D=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.prototype.toMatrix3D=function(){return this._matrix3D},t}();t.PerspectiveProjection=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(t,i,n,r){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),this.a=t,this.b=i,this.c=n,this.d=r,this._iAlignment=0==t&&0==i?e.ALIGN_XY_AXIS:0==i&&0==n?e.ALIGN_YZ_AXIS:0==t&&0==n?e.ALIGN_XZ_AXIS:e.ALIGN_ANY}return e.prototype.fromPoints=function(t,i,n){var r=i.x-t.x,s=i.y-t.y,a=i.z-t.z,o=n.x-t.x,h=n.y-t.y,p=n.z-t.z;this.a=s*p-a*h,this.b=a*o-r*p,this.c=r*h-s*o,this.d=this.a*t.x+this.b*t.y+this.c*t.z,this._iAlignment=0==this.a&&0==this.b?e.ALIGN_XY_AXIS:0==this.b&&0==this.c?e.ALIGN_YZ_AXIS:0==this.a&&0==this.c?e.ALIGN_XZ_AXIS:e.ALIGN_ANY},e.prototype.fromNormalAndPoint=function(t,i){this.a=t.x,this.b=t.y,this.c=t.z,this.d=this.a*i.x+this.b*i.y+this.c*i.z,this._iAlignment=0==this.a&&0==this.b?e.ALIGN_XY_AXIS:0==this.b&&0==this.c?e.ALIGN_YZ_AXIS:0==this.a&&0==this.c?e.ALIGN_XZ_AXIS:e.ALIGN_ANY},e.prototype.normalize=function(){var t=1/Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);return this.a*=t,this.b*=t,this.c*=t,this.d*=t,this},e.prototype.distance=function(t){return this._iAlignment==e.ALIGN_YZ_AXIS?this.a*t.x-this.d:this._iAlignment==e.ALIGN_XZ_AXIS?this.b*t.y-this.d:this._iAlignment==e.ALIGN_XY_AXIS?this.c*t.z-this.d:this.a*t.x+this.b*t.y+this.c*t.z-this.d},e.prototype.classifyPoint=function(i,n){if("undefined"==typeof n&&(n=.01),this.d!=this.d)return t.geom.PlaneClassification.FRONT;var r;return r=this._iAlignment==e.ALIGN_YZ_AXIS?this.a*i.x-this.d:this._iAlignment==e.ALIGN_XZ_AXIS?this.b*i.y-this.d:this._iAlignment==e.ALIGN_XY_AXIS?this.c*i.z-this.d:this.a*i.x+this.b*i.y+this.c*i.z-this.d,-n>r?t.geom.PlaneClassification.BACK:r>n?t.geom.PlaneClassification.FRONT:t.geom.PlaneClassification.INTERSECT},e.prototype.toString=function(){return"Plane3D [a:"+this.a+", b:"+this.b+", c:"+this.c+", d:"+this.d+"]"},e.ALIGN_ANY=0,e.ALIGN_XY_AXIS=1,e.ALIGN_YZ_AXIS=2,e.ALIGN_XZ_AXIS=3,e}();e.Plane3D=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.BACK=0,t.FRONT=1,t.IN=0,t.OUT=1,t.INTERSECT=2,t}();t.PlaneClassification=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.x=t,this.y=e}return Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(){},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t.prototype.normalize=function(t){if("undefined"==typeof t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,void(this.y*=e)}throw"Cannot divide by zero length."},t.prototype.offset=function(t,e){this.x+=t,this.y+=e},t.prototype.setTo=function(){},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.toString=function(){return"[Point] (x="+this.x+", y="+this.y+")"},t.distance=function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},t.interpolate=function(e,i,n){return new t(i.x+(e.x-i.x)*n,i.y+(e.y-i.y)*n)},t.polar=function(e,i){return new t(e*Math.cos(i),e*Math.sin(i))},t}();t.Point=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.initDistributions=function(){this._distributions=new Array,this._distributions[0]=new Array(.3082841,.4320919),this._distributions[1]=new Array(.3082841,.4320919,-.2274942,-.6640266),this._distributions[2]=new Array(.8742689,.0009265686,-.6864116,-.5536607,-.2325206,.7678371),this._distributions[3]=new Array(.3913446,-.7084417,-.7511101,-.5935929,-.2323436,.5320091,.8435315,.5035911),this._distributions[4]=new Array(.2122471,-.5771395,-.8543506,-.1763534,.5189021,.8323698,-.3616908,.5865368,.9523004,-.04948437),this._distributions[5]=new Array(.5791035,.3496495,.2959551,-.6006749,-.2419119,-.06879545,-.7403072,.6110353,-.04555973,.8059174,-.5275017,-.737129),this._distributions[6]=new Array(.06941478,.8519508,-.7441907,.2426432,.6439992,-.2405252,-.1007523,-.2327587,-.6427067,-.7248485,.8050759,.5492936,.3573822,-.8824506),this._distributions[7]=new Array(.8509863,.4452587,-.09507271,.2073005,.1706571,-.6434793,.8029777,-.2718274,-.4401725,.8196304,.2715359,.8598521,-.8121575,-.006447683,-.6486837,-.7237598),this._distributions[8]=new Array(.6951686,-.2680728,-.04933243,.3710589,.6592212,.3661054,-.01579228,-.6909603,-.3275101,-.1756866,.3811549,.9218544,-.216032,.9755028,-.7065172,.3355389,-.6579109,-.6798355),this._distributions[9]=new Array(.6181276,-.09790418,-.2537868,-.5570995,-.1964931,.3459414,.3474613,-.8885581,.5135743,.5753114,-.9549091,.1480672,-.8711916,-.4293123,-.6928071,.6190156,-.13369,.8892705,.0548224,-.1246777),this._distributions[10]=new Array(.4853027,-.5080479,-.1331675,-.506597,.139575,.01316885,.803486,-.07568797,.5240274,.4883182,-.4334005,.1207938,-.7794577,-.3985141,.1576432,-.9861221,-.3712867,.6959021,.1517378,.9847429,-.9762396,.1661073),this._distributions[11]=new Array(-.2790166,-.01252619,.3389016,.3921154,.2408341,-.313211,-.8151779,-.3898362,-.6347761,.3486495,.09471484,-.7722448,-.1385674,.6364574,.2456331,.9295807,-.3864306,-.8247881,.6111673,-.7164014,.8287669,.05466961,.837706,.5415626),this._distributions[12]=new Array(.056417,.3185693,-.8245888,.1882799,.8575996,.1136829,.1070375,.875332,.4076743,-.06000621,-.4311306,.7239349,.2677574,-.538472,-.08486642,-.2083647,-.888989,-.3906443,-.4768958,-.6664082,.09334993,-.9861541,.808736,-.455949,.5889823,.7660807),this._distributions[13]=new Array(-.2681346,-.3955857,-.1315102,-.8852947,-.5143692,.09551838,.4344836,-.546945,-.8620899,-.3813288,.1650431,.02034803,-.1543657,.3842218,-.828457,.5376903,-.6145,-.7818927,-.2639062,.8784655,.1912684,.9720125,.3135219,.5224229,.7850655,.4592297,.7465045,-.1368916),this._distributions[14]=new Array(.4241029,.695281,.150511,-.02304107,-.2482675,.9120338,.8057325,.2622084,-.2445909,.2765962,.8588713,-.1772072,.3117845,-.4385471,-.3923851,-.3298936,-.1751254,-.7405846,.6926506,-.684163,-.9304563,-.3254691,-.8533293,.1523024,.2510415,-.917345,-.6239773,-.7105472,-.6104624,.6041355),this._distributions[15]=new Array(.5844554,.06651045,.1343258,.6756578,.3799674,-.6301104,.5590436,.7940555,.09574714,.02262517,.8697868,.393301,.003945862,-.421735,.9043913,-.2432393,-.4844007,.7190998,-.3201078,.2972371,-.3852352,-.6341155,-.5413069,-.09223081,-.8468984,-.5126905,.004156174,-.8633173,-.9681889,-.03305046,-.846509,.4414353),this._distributions[16]=new Array(.4506488,.657668,.4621297,.07441051,-.2782125,.6201044,.9750003,.09110117,.1019436,.2986514,.03457398,.9631706,.542098,-.5505635,.8675668,.4938077,-.5414361,.2655292,-.7941836,.6003053,-.09847672,-.1001604,-.9316511,-.08572888,.07286467,-.611899,-.5232627,-.4082253,-.5481608,-.827938,-.1551939,-.9621193,.9220031,-.3315949),this._distributions[17]=new Array(.197908,-.4697656,-.4474689,-.3428435,.8529873,-.2228634,.6022478,-.5469642,.2545276,-.931133,-.1507547,-.7855865,-.07606658,.1011628,.3046715,.2785755,.4698432,-.1064076,.6831254,.4152522,.1374381,.8363233,-.2166121,.6682042,.5511393,.7996449,-.4278994,.28836,-.8875198,.2181732,-.8772842,-.2818254,-.7000262,.5762185,-.6062385,-.7439126),this._distributions[18]=new Array(.6645703,-.05678739,.5720971,.4533803,-.07660709,.08802763,.5163431,-.4426552,.1163455,-.3404382,-.4004807,-.5046007,.2932099,-.8201418,-.5322125,.03834766,-.1490209,-.8817304,-.8000439,-.3509448,.5260983,.8421043,.1197811,.6963812,.9498612,.3122156,-.9285746,.02120355,-.6670724,.7217396,.9155889,-.3510147,-.271941,.4727852,.318879,.1634057,-.2686755,.9253026),this._distributions[19]=new Array(.5064292,.422527,.8935515,-.06610427,.1199719,.175568,.403388,-.2003276,.1657927,.8154403,.9301245,.2929218,-.1644068,.6201534,.7113559,-.6589743,-.3364046,-.1799502,.02109996,-.392765,-.382213,.3219992,-.9201946,.1207967,-.726185,.4291916,-.7443482,-.2480059,-.5147594,.7418784,.1935272,-.7406143,-.3643523,-.5559214,-.7147766,-.6326278,-.2524151,-.9096627,.5161405,.7908453),this._distributions[20]=new Array(.7921003,-.3032096,.5992879,-.009052323,.2538549,-.1872749,.7053444,.3677175,.5417761,-.8170255,.9749611,.1210478,.1969143,-.6117041,-.1824499,-.4634196,-.1181338,-.8668742,-.3050112,-.1352596,-.4409327,-.7082354,-.03225285,.1171548,.3113096,.3250439,-.8166144,-.463995,-.01014475,.4715334,-.6868284,.05091889,-.4011163,.2717285,-.06756835,.8307694,-.7938535,.4352129,-.4663842,.7165329,.559729,.8093995),this._distributions[21]=new Array(.07832243,.426151,-.3856795,.5799953,.01970797,.06706189,.4822682,.3014512,-.1532982,.87485,-.4959527,.07888043,.260601,-.2304784,.4996209,.7167382,.585986,-.04265174,-.7679967,.5509416,-.9041753,.1802134,-.8407655,-.4442826,-.2058258,-.2636995,-.4984115,-.5928579,.2926032,-.7886473,-.06933882,-.621177,.578115,-.4813387,.8981777,-.3291056,.1942733,.9255584,.8084362,.5066984,.9920095,.03103104,-.2403206,-.9389018),this._distributions[22]=new Array(-.5691095,.1014316,-.7788262,.384012,-.8253665,-.1645582,-.1830993,.002997211,-.2555013,-.4177977,-.6640869,-.4794711,-.2351242,.5850121,.02436554,.2825883,.006061143,-.8200245,.1618791,-.3063331,-.3765897,-.7249815,.6092919,-.6769328,-.5956934,.6957655,.5383642,.4522677,-.1489165,.9125596,.4167473,.1335986,.1898309,.5874342,.2288171,.9624356,.7540846,-.07672304,.8986252,.2788797,.3555991,-.9262139,.8454325,-.4027667,.4945236,-.2935512),this._distributions[23]=new Array(-.4481403,-.3758374,-.8877251,.08739938,.05015831,-.1339983,-.4070427,-.8534173,.1019274,-.5503222,-.445998,.1997541,-.8686263,-.2788867,-.7695944,-.6033704,-.05515742,-.885711,-.7714347,.5790485,.3466263,-.8799297,.4487582,-.5321087,-.2461368,.6053771,-.05568117,.2457351,-.4668669,.8523816,.8103387,-.4255538,.4054182,-.175663,-.2802011,-.08920153,.2665959,.382935,.555679,.1621837,.105246,.8420411,.6921161,.6902903,.880946,.2483067,.9699264,-.1021767),this._distributions[24]=new Array(-.1703323,-.3119385,.2916039,-.2988263,-.008472982,-.9277695,-.7730271,-.3277904,.3440474,-.6815342,-.2910278,.03461745,-.6764899,-.657078,-.3505501,-.7311988,-.03478927,.3258755,-.6048835,.159423,.2035525,.02212214,.5116573,.2226856,.6664805,-.2500189,.7147882,-.6609634,.03030632,-.5763278,-.2516585,.6116219,-.9434413,-.0116792,.9061816,.2491155,.182867,.6076167,.286593,.9485695,-.5992439,.6970096,-.2082874,.9416641,.9880044,-.1541709,-.9122881,.331555,.7324886,.6725098),this._distributions[25]=new Array(.3869598,-.04974834,.7168844,-.0693711,-.07166742,.1725325,.4599592,.3232779,.5872094,-.4198674,.2442266,-.625667,.1254557,.4500048,-.2290154,-.1803567,.890583,.3373493,.1256081,.7853789,-.2676466,.5305805,-.7063224,.252168,-.3989835,.1189921,.09617215,-.2451447,.6302541,.6085876,.9380925,-.3234899,.5086241,-.8573482,.03576187,-.9876697,-.0876712,-.6365195,-.5276513,.823456,-.6935764,-.2240411,-.5212318,-.5383121,-.2116208,.9639363,-.9840096,.02743555,-.3991577,-.8994547,-.7830126,.614068),this._distributions[26]=new Array(-.8366601,.4464895,-.5917366,-.02073906,-.9845258,.1635625,-.3097973,.4379579,-.5478154,.7173221,-.1685888,.9261969,.01503595,.6046097,.4452421,.5449086,.0315687,.1944619,.3753404,.8688548,.4143643,.1396648,.8711032,.4304703,.7328773,.1461501,.6374492,-.3521495,.145613,-.1341466,.9040975,-.135123,-.7839059,-.5450199,-.516019,-.3320859,-.206158,-.4431106,-.9703014,-.2368356,-.2473119,-.0864351,.2130725,-.4604077,-.003726701,-.7122303,-.4072131,-.6833169,.1632999,-.9776646,.4686888,-.680495,-.2293511,-.9509777),this._distributions[27]=new Array(.107311,-.1311369,-.4194764,-.3148777,.6171439,-.2745973,.2796618,.1937153,-.09106886,.4180236,.6044006,.05577846,.02927299,-.6738263,-.2580845,.1179939,-.09023564,-.3830024,.3570953,-.5000587,.81591,-.5518309,.9300217,-.1257987,.4904627,-.8381903,-.3163182,-.8632009,.1137595,-.9875998,.8390043,.3538185,.2149114,.4993694,.5191584,.3833552,.5002763,.7061465,-.2567276,.9068756,-.5197366,.3467845,.03668867,.9734009,-.5347553,.66747,-.9028882,.1023768,-.8967977,.412834,-.5821944,.0426479,-.8032165,-.2397038,-.5597343,-.6358021),this._distributions[28]=new Array(-.6562496,-.1781036,-.9301494,.1185208,-.3861143,-.4153562,-.1560799,-.1099607,-.5587025,.395218,-.5322112,-.699701,-.5008639,.08726846,-.970524,-.1963461,-.813577,-.5185111,-.1644458,.298,-.3216791,.639982,.3315373,.3339162,.2383235,-.00105722,.1137828,.5450742,-.01899921,.8798413,.2849685,.8255596,.6974412,.2123175,.7588523,.5470437,.5102502,-.1687844,.5853448,.8033476,.2590716,-.5262504,.5607718,-.6342825,.8666443,-.1491841,.8341052,-.4935003,-.1568441,-.6634066,.2512113,-.8769391,-.2559827,-.9572457,-.01928852,-.3966542,-.750667,.6409678),this._distributions[29]=new Array(.3454786,-.04837726,.2649553,.2406852,.5599093,-.3839145,-.1111814,-.05502108,.7586042,-.05818377,.2519488,-.4665135,-.1264972,.2602723,-.08766216,-.3671907,.6428129,.3999204,-.6105871,-.1246869,-.4589451,-.7646643,-.03021116,-.7899352,-.6036922,-.4293956,-.2481938,.6534185,.102798,.6784465,-.6392644,.4821358,-.6789002,.1779133,-.9140783,-.1989647,-.9262617,.3381507,.4794891,-.8093274,.3959447,.668478,.9602883,.2272305,-.123672,.9210883,.2375148,.9523395,-.52898,.7973378,-.382433,.1228794,.695015,.6948439,.7530277,-.6458191,.8777987,-.3272956,.2318525,-.962768),this._distributions[30]=new Array(.4518921,-.1146195,.4720805,-.4238748,.3655423,.1806341,.1589939,-.23568,.7673324,-.5149941,.01163658,.09045836,.7010971,.1245747,.7518286,-.1855433,.4960719,.4601022,.2566979,-.6308268,-.0654714,-.5126389,-.1823319,-.1343282,-.1464312,.4883236,-.3858738,.203523,.1484799,.4432284,-.477109,-.116241,.2719092,.7208626,.9104174,.3578536,-.5956199,.7662588,-.6996251,.3678654,-.2514512,.9251933,.1275825,-.9478135,-.204608,-.8611552,.4264838,-.877443,.9854161,.05521112,.5912951,.7997434,.1140349,.982093,-.9324368,-.2094094,-.42436,-.6441524,-.6722705,-.3554261,-.7844236,.08587621),this._distributions[31]=new Array(-.4206714,-.5613642,-.8733016,-.3373051,-.1046226,-.2902999,-.1318562,-.8434365,.1145093,-.5962623,-.4965627,-.1873259,-.5011808,-.8546229,-.7165636,-.5743566,.1090901,.2017643,.3404809,-.220455,-.1989015,.2372122,-.4538706,.0979171,.4514146,-.572846,.2314168,-.8514503,-.4247236,.5650803,-.943347,.04514639,-.1309718,.5221877,-.7004157,.4561877,.6306441,.04448673,.4301621,.5766876,.1078042,.7245752,.3875354,.2794483,.702876,-.2924213,.7360667,-.6210318,.7486517,.6531103,.4898235,.8591025,.6549174,.3854057,-.2596106,.7916998,.9251194,-.05296265,-.5620695,.820877,-.01228026,.9937211,.9612103,.2628758)},t.getDistribution=function(t){return this._distributions||this.initDistributions(),2>t||t>32?null:this._distributions[t-1]},t}();t.PoissonLookup=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=n}return Object.defineProperty(e.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),e.prototype.multiply=function(t,e){var i=t.w,n=t.x,r=t.y,s=t.z,a=e.w,o=e.x,h=e.y,p=e.z;this.w=i*a-n*o-r*h-s*p,this.x=i*o+n*a+r*p-s*h,this.y=i*h-n*p+r*a+s*o,this.z=i*p+n*h-r*o+s*a},e.prototype.multiplyVector=function(t,i){"undefined"==typeof i&&(i=null),null===i&&(i=new e);var n=t.x,r=t.y,s=t.z;return i.w=-this.x*n-this.y*r-this.z*s,i.x=this.w*n+this.y*s-this.z*r,i.y=this.w*r-this.x*s+this.z*n,i.z=this.w*s+this.x*r-this.y*n,i},e.prototype.fromAxisAngle=function(t,e){var i=Math.sin(e/2),n=Math.cos(e/2);this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=n,this.normalize()},e.prototype.slerp=function(t,e,i){var n=t.w,r=t.x,s=t.y,a=t.z,o=e.w,h=e.x,p=e.y,u=e.z,l=n*o+r*h+s*p+a*u;if(0>l&&(l=-l,o=-o,h=-h,p=-p,u=-u),.95>l){var c=Math.acos(l),d=1/Math.sin(c),_=Math.sin(c*(1-i))*d,f=Math.sin(c*i)*d;this.w=n*_+o*f,this.x=r*_+h*f,this.y=s*_+p*f,this.z=a*_+u*f}else{this.w=n+i*(o-n),this.x=r+i*(h-r),this.y=s+i*(p-s),this.z=a+i*(u-a);var g=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=g,this.x*=g,this.y*=g,this.z*=g}},e.prototype.lerp=function(t,e,i){var n,r=t.w,s=t.x,a=t.y,o=t.z,h=e.w,p=e.x,u=e.y,l=e.z;0>r*h+s*p+a*u+o*l&&(h=-h,p=-p,u=-u,l=-l),this.w=r+i*(h-r),this.x=s+i*(p-s),this.y=a+i*(u-a),this.z=o+i*(l-o),n=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z),this.w*=n,this.x*=n,this.y*=n,this.z*=n},e.prototype.fromEulerAngles=function(t,e,i){var n=.5*t,r=.5*e,s=.5*i,a=Math.cos(n),o=Math.sin(n),h=Math.cos(r),p=Math.sin(r),u=Math.cos(s),l=Math.sin(s);this.w=a*h*u+o*p*l,this.x=o*h*u-a*p*l,this.y=a*p*u+o*h*l,this.z=a*h*l-o*p*u},e.prototype.toEulerAngles=function(e){return"undefined"==typeof e&&(e=null),null===e&&(e=new t.geom.Vector3D),e.x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),e.y=Math.asin(2*(this.w*this.y-this.z*this.x)),e.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z)),e},e.prototype.normalize=function(t){"undefined"==typeof t&&(t=1);var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e,this.y*=e,this.z*=e,this.w*=e},e.prototype.toString=function(){return"{x:"+this.x+" y:"+this.y+" z:"+this.z+" w:"+this.w+"}"},e.prototype.toMatrix3D=function(e){"undefined"==typeof e&&(e=null);var i=t.geom.Matrix3DUtils.RAW_DATA_CONTAINER,n=2*this.x*this.y,r=2*this.x*this.z,s=2*this.x*this.w,a=2*this.y*this.z,o=2*this.y*this.w,h=2*this.z*this.w,p=this.x*this.x,u=this.y*this.y,l=this.z*this.z,c=this.w*this.w;return i[0]=p-u-l+c,i[4]=n-h,i[8]=r+o,i[12]=0,i[1]=n+h,i[5]=-p+u-l+c,i[9]=a-s,i[13]=0,i[2]=r-o,i[6]=a+s,i[10]=-p-u+l+c,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,e?(e.copyRawDataFrom(i),e):new t.geom.Matrix3D(i)},e.prototype.fromMatrix=function(e){var i=e.decompose(t.geom.Orientation3D.QUATERNION)[1];this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w},e.prototype.toRawData=function(t,e){"undefined"==typeof e&&(e=!1);var i=2*this.x*this.y,n=2*this.x*this.z,r=2*this.x*this.w,s=2*this.y*this.z,a=2*this.y*this.w,o=2*this.z*this.w,h=this.x*this.x,p=this.y*this.y,u=this.z*this.z,l=this.w*this.w;t[0]=h-p-u+l,t[1]=i-o,t[2]=n+a,t[4]=i+o,t[5]=-h+p-u+l,t[6]=s-r,t[8]=n-a,t[9]=s+r,t[10]=-h-p+u+l,t[3]=t[7]=t[11]=0,e||(t[12]=t[13]=t[14]=0,t[15]=1)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.rotatePoint=function(e,i){"undefined"==typeof i&&(i=null);var n,r,s,a,o=e.x,h=e.y,p=e.z;return null===i&&(i=new t.geom.Vector3D),a=-this.x*o-this.y*h-this.z*p,n=this.w*o+this.y*p-this.z*h,r=this.w*h-this.x*p+this.z*o,s=this.w*p+this.x*h-this.y*o,i.x=-a*this.x+n*this.w-r*this.z+s*this.y,i.y=-a*this.y+n*this.z+r*this.w-s*this.x,i.z=-a*this.z-n*this.y+r*this.x+s*this.w,i},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},e}();e.Quaternion=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}return Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return null==this._bottomRight&&(this._bottomRight=new t.Point),this._bottomRight.x=this.x+this.width,this._bottomRight.y=this.y+this.height,this._bottomRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return null==this._size&&(this._size=new t.Point),this._size.x=this.width,this._size.y=this.height,this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return null==this._topLeft&&(this._topLeft=new t.Point),this._topLeft.x=this.x,this._topLeft.y=this.y,this._topLeft},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e},e.prototype.containsPoint=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},e.prototype.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},e.prototype.copyFrom=function(){},e.prototype.equals=function(t){return this.x==t.x&&this.y==t.y&&this.width==t.width&&this.height==t.height},e.prototype.inflate=function(t,e){this.x-=t/2,this.y-=e/2,this.width+=t/2,this.height+=e/2},e.prototype.inflatePoint=function(t){this.x-=t.x/2,this.y-=t.y/2,this.width+=t.x/2,this.height+=t.y/2},e.prototype.intersection=function(t){if(this.intersects(t)){var i=new e;return this.x>t.x?(i.x=this.x,i.width=t.x-this.x+t.width,i.width>this.width&&(i.width=this.width)):(i.x=t.x,i.width=this.x-t.x+this.width,i.width>t.width&&(i.width=t.width)),this.y>t.y?(i.y=this.y,i.height=t.y-this.y+t.height,i.height>this.height&&(i.height=this.height)):(i.y=t.y,i.height=this.y-t.y+this.height,i.height>t.height&&(i.height=t.height)),i}return new e},e.prototype.intersects=function(t){return this.x+this.width>t.x&&this.x<t.x+t.width&&this.y+this.height>t.y&&this.y<t.y+t.height},e.prototype.isEmpty=function(){return 0==this.x&&0==this.y&&0==this.width&&0==this.height},e.prototype.offset=function(t,e){this.x+=t,this.y+=e},e.prototype.offsetPoint=function(t){this.x+=t.x,this.y+=t.y},e.prototype.setEmpty=function(){this.x=0,this.y=0,this.width=0,this.height=0},e.prototype.setTo=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},e.prototype.toString=function(){return"[Rectangle] (x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"},e.prototype.union=function(t){var i=new e;return this.x<t.x?(i.x=this.x,i.width=t.x-this.x+t.width,i.width<this.width&&(i.width=this.width)):(i.x=t.x,i.width=this.x-t.x+this.width,i.width<t.width&&(i.width=t.width)),this.y<t.y?(i.y=this.y,i.height=t.y-this.y+t.height,i.height<this.height&&(i.height=this.height)):(i.y=t.y,i.height=this.y-t.y+this.height,i.height<t.height&&(i.height=t.height)),i},e}();t.Rectangle=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=function(){function i(e){this._position=new t.geom.Vector3D,this._displayObject=e}return Object.defineProperty(i.prototype,"backVector",{get:function(){var e=t.geom.Matrix3DUtils.getForward(this._displayObject._iMatrix3D);return e.negate(),e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"concatenatedColorTransform",{get:function(){return this._concatenatedColorTransform},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"concatenatedMatrix",{get:function(){return this._concatenatedMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"downVector",{get:function(){var e=t.geom.Matrix3DUtils.getUp(this._displayObject._iMatrix3D);return e.negate(),e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"forwardVector",{get:function(){return t.geom.Matrix3DUtils.getForward(this._displayObject._iMatrix3D)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"leftVector",{get:function(){var e=t.geom.Matrix3DUtils.getRight(this._displayObject._iMatrix3D);return e.negate(),e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrix3D",{get:function(){return this._displayObject._iMatrix3D},set:function(t){this._displayObject._iMatrix3D=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pixelBounds",{get:function(){return this._pixelBounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._displayObject._iMatrix3D.position},set:function(t){this._displayObject.x=t.x,this._displayObject.y=t.y,this._displayObject.z=t.z},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightVector",{get:function(){return t.geom.Matrix3DUtils.getRight(this._displayObject._iMatrix3D)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return new e.Vector3D(this._displayObject.rotationX,this._displayObject.rotationY,this._displayObject.rotationZ)},set:function(t){this._displayObject.rotationX=t.x,this._displayObject.rotationY=t.y,this._displayObject.rotationZ=t.z},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return new e.Vector3D(this._displayObject.scaleX,this._displayObject.scaleY,this._displayObject.scaleZ)},set:function(t){this._displayObject.scaleX=t.x,this._displayObject.scaleY=t.y,this._displayObject.scaleZ=t.z},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"upVector",{get:function(){return t.geom.Matrix3DUtils.getUp(this._displayObject._iMatrix3D)},enumerable:!0,configurable:!0}),i.prototype.getRelativeMatrix3D=function(){return new e.Matrix3D},i.prototype.moveForward=function(e){this._displayObject.translateLocal(t.geom.Vector3D.Z_AXIS,e)},i.prototype.moveBackward=function(e){this._displayObject.translateLocal(t.geom.Vector3D.Z_AXIS,-e)},i.prototype.moveLeft=function(e){this._displayObject.translateLocal(t.geom.Vector3D.X_AXIS,-e)},i.prototype.moveRight=function(e){this._displayObject.translateLocal(t.geom.Vector3D.X_AXIS,e)},i.prototype.moveUp=function(e){this._displayObject.translateLocal(t.geom.Vector3D.Y_AXIS,e)},i.prototype.moveDown=function(e){this._displayObject.translateLocal(t.geom.Vector3D.Y_AXIS,-e)},i}();e.Transform=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(){this._uvMatrix=new t.geom.Matrix,this._rotation=0,this._scaleU=1,this._scaleV=1,this._offsetU=0,this._offsetV=0}return Object.defineProperty(e.prototype,"offsetU",{get:function(){return this._offsetU},set:function(t){t!=this._offsetU&&(this._offsetU=t,this._uvMatrixDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetV",{get:function(){return this._offsetV},set:function(t){t!=this._offsetV&&(this._offsetV=t,this._uvMatrixDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){t!=this._rotation&&(this._rotation=t,this._uvMatrixDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleU",{get:function(){return this._scaleU},set:function(t){t!=this._scaleU&&(this._scaleU=t,this._uvMatrixDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleV",{get:function(){return this._scaleV},set:function(t){t!=this._scaleV&&(this._scaleV=t,this._uvMatrixDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this._uvMatrixDirty&&this.updateUVMatrix(),this._uvMatrix},enumerable:!0,configurable:!0}),e.prototype.updateUVMatrix=function(){this._uvMatrix.identity(),0!=this._rotation&&this._uvMatrix.rotate(this._rotation),(1!=this._scaleU||1!=this._scaleV)&&this._uvMatrix.scale(this._scaleU,this._scaleV),this._uvMatrix.translate(this._offsetU,this._offsetV),this._uvMatrixDirty=!1},e}();e.UVTransform=i}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x=t,this.y=e,this.z=i,this.w=n}return Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},t.angleBetween=function(t,e){return Math.acos(t.dotProduct(e)/(t.length*e.length))},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},t.prototype.crossProduct=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x,1)},t.prototype.decrementBy=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},t.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y,r=t.z-e.z;return Math.sqrt(i*i+n*n+r*r)},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.equals=function(t,e){return"undefined"==typeof e&&(e=!1),this.x==t.x&&this.y==t.y&&this.z==t.z&&(!e||this.w==t.w)},t.prototype.incrementBy=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},t.prototype.nearEquals=function(t,e,i){return"undefined"==typeof i&&(i=!0),Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&(!i||Math.abs(this.w-t.w)<e)},t.prototype.negate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},t.prototype.normalize=function(t){if("undefined"==typeof t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,this.y*=e,void(this.z*=e)}},t.prototype.project=function(){this.x/=this.w,this.y/=this.w,this.z/=this.w},t.prototype.scaleBy=function(t){this.x*=t,this.y*=t,this.z*=t},t.prototype.setTo=function(t,e,i){this.x=t,this.y=e,this.z=i},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.toString=function(){return"[Vector3D] (x:"+this.x+" ,y:"+this.y+", z"+this.z+", w:"+this.w+")"},t.X_AXIS=new t(1,0,0),t.Y_AXIS=new t(0,1,0),t.Z_AXIS=new t(0,0,1),t}();t.Vector3D=e}(t.geom||(t.geom={})),t.geom}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Box,n=function(){function e(){this._pAabbPoints=new Array,this._pAabbPointsDirty=!0,this._aabb=new i}return Object.defineProperty(e.prototype,"aabb",{get:function(){return this._aabb},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aabbPoints",{get:function(){return this._pAabbPointsDirty&&this.pUpdateAABBPoints(),this._pAabbPoints},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingEntity",{get:function(){return this._pBoundingEntity||(this._pBoundingEntity=this.pCreateBoundingEntity(),this.pUpdateBoundingEntity()),this._pBoundingEntity},enumerable:!0,configurable:!0}),e.prototype.nullify=function(){this._aabb.x=this._aabb.y=this._aabb.z=0,this._aabb.width=this._aabb.height=this._aabb.depth=0,this._pAabbPointsDirty=!0,this._pBoundingEntity&&this.pUpdateBoundingEntity()},e.prototype.disposeRenderable=function(){this._pBoundingEntity&&this._pBoundingEntity.dispose(),this._pBoundingEntity=null},e.prototype.fromVertices=function(t){var e,i,n,r,s,a,o,h=t.length;if(0==h)return void this.nullify();var p;for(i=s=t[e++],n=a=t[e++],r=o=t[e++];h>e;)p=t[e++],i>p?i=p:p>s&&(s=p),p=t[e++],n>p?n=p:p>a&&(a=p),p=t[e++],r>p?r=p:p>o&&(o=p);this.fromExtremes(i,n,r,s,a,o)},e.prototype.fromGeometry=function(t){var e,i,n,r,s,a,o,h,p,u,l,c=t.subGeometries,d=c.length;if(d>0){for(e=0,r=c[0],s=r.getBoundingPositions(),a=p=s[e],o=u=s[e+1],h=l=s[e+2],i=d;i--;)for(r=c[i],s=r.getBoundingPositions(),e=s.length;e--;)n=s[e],a>n?a=n:n>p&&(p=n),n=s[e+1],o>n?o=n:n>u&&(u=n),n=s[e+2],h>n?h=n:n>l&&(l=n);this.fromExtremes(a,o,h,p,u,l)}else this.fromExtremes(0,0,0,0,0,0)},e.prototype.fromSphere=function(t,e){this.fromExtremes(t.x-e,t.y-e,t.z-e,t.x+e,t.y+e,t.z+e)},e.prototype.fromExtremes=function(t,e,i,n,r,s){this._aabb.x=t,this._aabb.y=r,this._aabb.z=i,this._aabb.width=n-t,this._aabb.height=r-e,this._aabb.depth=s-i,this._pAabbPointsDirty=!0,this._pBoundingEntity&&this.pUpdateBoundingEntity()},e.prototype.isInFrustum=function(){throw new t.errors.AbstractMethodError},e.prototype.overlaps=function(t){return this._aabb.intersects(t.aabb)
},e.prototype.clone=function(){throw new t.errors.AbstractMethodError},e.prototype.rayIntersection=function(){return-1},e.prototype.containsPoint=function(){return!1},e.prototype.pUpdateAABBPoints=function(){var t=this._aabb.x,e=this._aabb.y-this._aabb.height,i=this._aabb.z,n=this._aabb.x+this._aabb.width,r=this._aabb.y,s=this._aabb.z+this._aabb.depth;this._pAabbPoints[0]=t,this._pAabbPoints[1]=e,this._pAabbPoints[2]=i,this._pAabbPoints[3]=n,this._pAabbPoints[4]=e,this._pAabbPoints[5]=i,this._pAabbPoints[6]=t,this._pAabbPoints[7]=r,this._pAabbPoints[8]=i,this._pAabbPoints[9]=n,this._pAabbPoints[10]=r,this._pAabbPoints[11]=i,this._pAabbPoints[12]=t,this._pAabbPoints[13]=e,this._pAabbPoints[14]=s,this._pAabbPoints[15]=n,this._pAabbPoints[16]=e,this._pAabbPoints[17]=s,this._pAabbPoints[18]=t,this._pAabbPoints[19]=r,this._pAabbPoints[20]=s,this._pAabbPoints[21]=n,this._pAabbPoints[22]=r,this._pAabbPoints[23]=s,this._pAabbPointsDirty=!1},e.prototype.pUpdateBoundingEntity=function(){throw new t.errors.AbstractMethodError},e.prototype.pCreateBoundingEntity=function(){throw new t.errors.AbstractMethodError},e.prototype.classifyToPlane=function(){throw new t.errors.AbstractMethodError},e.prototype.transformFrom=function(){throw new t.errors.AbstractMethodError},e}();e.BoundingVolumeBase=n}(t.bounds||(t.bounds={})),t.bounds}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.PlaneClassification,n=function(t){function e(e){"undefined"==typeof e&&(e=!0),t.call(this),this._alwaysIn=e,this._aabb.width=this._aabb.height=this._aabb.depth=Number.POSITIVE_INFINITY,this._aabb.x=this._aabb.y=this._aabb.z=this._alwaysIn?Number.NEGATIVE_INFINITY/2:Number.POSITIVE_INFINITY}return __extends(e,t),e.prototype.clone=function(){return new e(this._alwaysIn)},e.prototype.pCreateBoundingEntity=function(){return null},e.prototype.isInFrustum=function(){return this._alwaysIn},e.prototype.fromSphere=function(){},e.prototype.fromExtremes=function(){},e.prototype.classifyToPlane=function(){return i.INTERSECT},e.prototype.transformFrom=function(t){this._alwaysIn=t._alwaysIn},e}(e.BoundingVolumeBase);e.NullBounds=n}(t.bounds||(t.bounds={})),t.bounds}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.PlaneClassification,n=t.geom.Vector3D,r=function(t){function e(){t.call(this),this._radius=0,this._centerX=0,this._centerY=0,this._centerZ=0}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),e.prototype.nullify=function(){t.prototype.nullify.call(this),this._centerX=this._centerY=this._centerZ=0,this._radius=0},e.prototype.isInFrustum=function(t,e){for(var i=0;e>i;++i){var n=t[i],r=n.a<0?-this._radius:this._radius,s=n.b<0?-this._radius:this._radius,a=n.c<0?-this._radius:this._radius,o=n.a*(this._centerX+r)+n.b*(this._centerY+s)+n.c*(this._centerZ+a)-n.d;if(0>o)return!1}return!0},e.prototype.fromSphere=function(t,e){this._centerX=t.x,this._centerY=t.y,this._centerZ=t.z,this._radius=e,this._aabb.width=this._aabb.height=this._aabb.depth=2*e,this._aabb.x=this._centerX-e,this._aabb.y=this._centerY+e,this._aabb.z=this._centerZ-e,this._pAabbPointsDirty=!0,this._pBoundingEntity&&this.pUpdateBoundingEntity()},e.prototype.fromExtremes=function(e,i,n,r,s,a){this._centerX=.5*(r+e),this._centerY=.5*(s+i),this._centerZ=.5*(a+n);var o=r-e,h=s-i,p=a-n;h>o&&(o=h),p>o&&(o=p),this._radius=o*Math.sqrt(.5),t.prototype.fromExtremes.call(this,e,i,n,r,s,a)},e.prototype.clone=function(){var t=new e;return t.fromSphere(new n(this._centerX,this._centerY,this._centerZ),this._radius),t},e.prototype.rayIntersection=function(t,e,i){if(this.containsPoint(t))return 0;var n,r=t.x-this._centerX,s=t.y-this._centerY,a=t.z-this._centerZ,o=e.x,h=e.y,p=e.z,u=o*o+h*h+p*p,l=2*(r*o+s*h+a*p),c=r*r+s*s+a*a-this._radius*this._radius,d=l*l-4*u*c;if(d>=0){var _=Math.sqrt(d);if(n=(-l-_)/(2*u),n>=0)return i.x=r+n*o,i.y=s+n*h,i.z=a+n*p,i.normalize(),n}return-1},e.prototype.containsPoint=function(t){var e=t.x-this._centerX,i=t.y-this._centerY,n=t.z-this._centerZ,r=Math.sqrt(e*e+i*i+n*n);return r<=this._radius},e.prototype.pUpdateBoundingEntity=function(){var t=this._radius;0==t&&(t=.001);var e=this._pBoundingEntity.transform;e.scale=new n(t,t,t),e.position=new n(this._centerX,this._centerY,this._centerZ)},e.prototype.pCreateBoundingEntity=function(){return null},e.prototype.classifyToPlane=function(t){var e=t.a,n=t.b,r=t.c,s=e*this._centerX+n*this._centerY+r*this._centerZ-t.d;0>e&&(e=-e),0>n&&(n=-n),0>r&&(r=-r);var a=(e+n+r)*this._radius;return s>a?i.FRONT:-a>s?i.BACK:i.INTERSECT},e.prototype.transformFrom=function(t,e){var i=t,n=i._centerX,r=i._centerY,s=i._centerZ,a=new Array(16);e.copyRawDataTo(a);var o=a[0],h=a[4],p=a[8],u=a[12],l=a[1],c=a[5],d=a[9],_=a[13],f=a[2],g=a[6],m=a[10],y=a[14];this._centerX=n*o+r*h+s*p+u,this._centerY=n*l+r*c+s*d+_,this._centerZ=n*f+r*g+s*m+y,0>o&&(o=-o),0>h&&(h=-h),0>p&&(p=-p),0>l&&(l=-l),0>c&&(c=-c),0>d&&(d=-d),0>f&&(f=-f),0>g&&(g=-g),0>m&&(m=-m);var b=i._radius,x=o+h+p,v=l+c+d,w=f+g+m;this._radius=b*Math.sqrt(x*x+v*v+w*w),this._aabb.width=this._aabb.height=this._aabb.depth=2*this._radius,this._aabb.x=this._centerX-this._radius,this._aabb.y=this._centerY+this._radius,this._aabb.z=this._centerZ-this._radius},e}(e.BoundingVolumeBase);e.BoundingSphere=r}(t.bounds||(t.bounds={})),t.bounds}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Matrix3DUtils,n=t.geom.PlaneClassification,r=t.geom.Vector3D,s=function(t){function e(){t.call(this),this._centerX=0,this._centerY=0,this._centerZ=0,this._halfExtentsX=0,this._halfExtentsY=0,this._halfExtentsZ=0}return __extends(e,t),e.prototype.nullify=function(){t.prototype.nullify.call(this),this._centerX=this._centerY=this._centerZ=0,this._halfExtentsX=this._halfExtentsY=this._halfExtentsZ=0},e.prototype.isInFrustum=function(t,e){for(var i=0;e>i;++i){var n=t[i],r=n.a,s=n.b,a=n.c,o=0>r?-this._halfExtentsX:this._halfExtentsX,h=0>s?-this._halfExtentsY:this._halfExtentsY,p=0>a?-this._halfExtentsZ:this._halfExtentsZ,u=r*(this._centerX+o)+s*(this._centerY+h)+a*(this._centerZ+p)-n.d;if(0>u)return!1}return!0},e.prototype.rayIntersection=function(t,e,i){if(this.containsPoint(t))return 0;var n,r,s,a,o,h=t.x-this._centerX,p=t.y-this._centerY,u=t.z-this._centerZ,l=e.x,c=e.y,d=e.z;return 0>l&&(a=(this._halfExtentsX-h)/l,a>0&&(r=p+a*c,s=u+a*d,r>-this._halfExtentsY&&r<this._halfExtentsY&&s>-this._halfExtentsZ&&s<this._halfExtentsZ&&(i.x=1,i.y=0,i.z=0,o=!0))),!o&&l>0&&(a=(-this._halfExtentsX-h)/l,a>0&&(r=p+a*c,s=u+a*d,r>-this._halfExtentsY&&r<this._halfExtentsY&&s>-this._halfExtentsZ&&s<this._halfExtentsZ&&(i.x=-1,i.y=0,i.z=0,o=!0))),!o&&0>c&&(a=(this._halfExtentsY-p)/c,a>0&&(n=h+a*l,s=u+a*d,n>-this._halfExtentsX&&n<this._halfExtentsX&&s>-this._halfExtentsZ&&s<this._halfExtentsZ&&(i.x=0,i.y=1,i.z=0,o=!0))),!o&&c>0&&(a=(-this._halfExtentsY-p)/c,a>0&&(n=h+a*l,s=u+a*d,n>-this._halfExtentsX&&n<this._halfExtentsX&&s>-this._halfExtentsZ&&s<this._halfExtentsZ&&(i.x=0,i.y=-1,i.z=0,o=!0))),!o&&0>d&&(a=(this._halfExtentsZ-u)/d,a>0&&(n=h+a*l,r=p+a*c,r>-this._halfExtentsY&&r<this._halfExtentsY&&n>-this._halfExtentsX&&n<this._halfExtentsX&&(i.x=0,i.y=0,i.z=1,o=!0))),!o&&d>0&&(a=(-this._halfExtentsZ-u)/d,a>0&&(n=h+a*l,r=p+a*c,r>-this._halfExtentsY&&r<this._halfExtentsY&&n>-this._halfExtentsX&&n<this._halfExtentsX&&(i.x=0,i.y=0,i.z=-1,o=!0))),o?a:-1},e.prototype.containsPoint=function(t){var e=t.x-this._centerX,i=t.y-this._centerY,n=t.z-this._centerZ;return e<=this._halfExtentsX&&e>=-this._halfExtentsX&&i<=this._halfExtentsY&&i>=-this._halfExtentsY&&n<=this._halfExtentsZ&&n>=-this._halfExtentsZ},e.prototype.fromExtremes=function(e,i,n,r,s,a){this._centerX=.5*(r+e),this._centerY=.5*(s+i),this._centerZ=.5*(a+n),this._halfExtentsX=.5*(r-e),this._halfExtentsY=.5*(s-i),this._halfExtentsZ=.5*(a-n),t.prototype.fromExtremes.call(this,e,i,n,r,s,a)},e.prototype.clone=function(){var t=new e;return t.fromExtremes(this._aabb.x,this._aabb.y+this._aabb.height,this._aabb.z,this._aabb.x+this._aabb.width,this._aabb.y,this._aabb.z+this._aabb.depth),t},Object.defineProperty(e.prototype,"halfExtentsX",{get:function(){return this._halfExtentsX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfExtentsY",{get:function(){return this._halfExtentsY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfExtentsZ",{get:function(){return this._halfExtentsZ},enumerable:!0,configurable:!0}),e.prototype.closestPointToPoint=function(t,e){"undefined"==typeof e&&(e=null);var i;return null==e&&(e=new r),i=t.x,i<this._aabb.x&&(i=this._aabb.x),i>this._aabb.x+this._aabb.width&&(i=this._aabb.x+this._aabb.width),e.x=i,i=t.y,i<this._aabb.y+this._aabb.height&&(i=this._aabb.y+this._aabb.height),i>this._aabb.y&&(i=this._aabb.y),e.y=i,i=t.z,i<this._aabb.z&&(i=this._aabb.z),i>this._aabb.z+this._aabb.depth&&(i=this._aabb.z+this._aabb.depth),e.z=i,e},e.prototype.pUpdateBoundingRenderable=function(){this._pBoundingEntity.transform.scale.x=Math.max(2*this._halfExtentsX,.001),this._pBoundingEntity.transform.scale.y=Math.max(2*this._halfExtentsY,.001),this._pBoundingEntity.transform.scale.z=Math.max(2*this._halfExtentsZ,.001),this._pBoundingEntity.transform.position.x=this._centerX,this._pBoundingEntity.transform.position.y=this._centerY,this._pBoundingEntity.transform.position.z=this._centerZ},e.prototype.pCreateBoundingEntity=function(){return null},e.prototype.classifyToPlane=function(t){var e=t.a,i=t.b,r=t.c,s=e*this._centerX+i*this._centerY+r*this._centerZ-t.d;0>e&&(e=-e),0>i&&(i=-i),0>r&&(r=-r);var a=e*this._halfExtentsX+i*this._halfExtentsY+r*this._halfExtentsZ;return s>a?n.FRONT:-a>s?n.BACK:n.INTERSECT},e.prototype.transformFrom=function(t,e){var n=t,r=n._centerX,s=n._centerY,a=n._centerZ,o=i.RAW_DATA_CONTAINER;e.copyRawDataTo(o);var h=o[0],p=o[4],u=o[8],l=o[12],c=o[1],d=o[5],_=o[9],f=o[13],g=o[2],m=o[6],y=o[10],b=o[14];this._centerX=r*h+s*p+a*u+l,this._centerY=r*c+s*d+a*_+f,this._centerZ=r*g+s*m+a*y+b,0>h&&(h=-h),0>p&&(p=-p),0>u&&(u=-u),0>c&&(c=-c),0>d&&(d=-d),0>_&&(_=-_),0>g&&(g=-g),0>m&&(m=-m),0>y&&(y=-y);var x=n._halfExtentsX,v=n._halfExtentsY,w=n._halfExtentsZ;this._halfExtentsX=x*h+v*p+w*u,this._halfExtentsY=x*c+v*d+w*_,this._halfExtentsZ=x*g+v*m+w*y,this._aabb.width=this._aabb.height=this._aabb.depth=2*this._halfExtentsX,this._aabb.x=this._centerX-this._halfExtentsX,this._aabb.y=this._centerY+this._halfExtentsY,this._aabb.z=this._centerZ-this._halfExtentsZ},e}(e.BoundingVolumeBase);e.AxisAlignedBoundingBox=s}(t.bounds||(t.bounds={})),t.bounds}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(e){"undefined"==typeof e&&(e=null),this.method=t.URLRequestMethod.GET,this.async=!0,this._url=e}return Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(t){this._url=t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.data=null,this._url=null},e}();t.URLRequest=e}(t.net||(t.net={})),t.net}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.TEXT="text",t.VARIABLES="variables",t.BLOB="blob",t.ARRAY_BUFFER="arraybuffer",t.BINARY="binary",t}();t.URLLoaderDataFormat=e}(t.net||(t.net={})),t.net}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.POST="POST",t.GET="GET",t}();t.URLRequestMethod=e}(t.net||(t.net={})),t.net}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(){i.call(this),this._bytesLoaded=0,this._bytesTotal=0,this._dataFormat=e.URLLoaderDataFormat.TEXT,this._loadError=!1}return __extends(n,i),Object.defineProperty(n.prototype,"url",{get:function(){return this._request?this._request.url:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataFormat",{get:function(){return this._dataFormat},set:function(t){this._dataFormat=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:!0,configurable:!0}),n.prototype.load=function(t){this._request=t,this.initXHR(),t.method===e.URLRequestMethod.POST?this.postRequest(t):this.getRequest(t)},n.prototype.close=function(){this._XHR.abort(),this.disposeXHR()},n.prototype.dispose=function(){this._XHR&&this._XHR.abort(),this.disposeXHR(),this._data=null,this._dataFormat=null,this._bytesLoaded=null,this._bytesTotal=null},n.prototype.setResponseType=function(t,i){switch(i){case e.URLLoaderDataFormat.ARRAY_BUFFER:case e.URLLoaderDataFormat.BLOB:case e.URLLoaderDataFormat.TEXT:t.responseType=i;break;case e.URLLoaderDataFormat.VARIABLES:t.responseType=e.URLLoaderDataFormat.TEXT;break;case e.URLLoaderDataFormat.BINARY:t.responseType=""}},n.prototype.getRequest=function(t){try{this._XHR.open(t.method,t.url,t.async),this.setResponseType(this._XHR,this._dataFormat),this._XHR.send()}catch(e){this.handleXmlHttpRequestException(e)}},n.prototype.postRequest=function(t){if(this._loadError=!1,this._XHR.open(t.method,t.url,t.async),null!=t.data)if(t.data instanceof e.URLVariables){var i=t.data;try{this._XHR.responseType="text",this._XHR.send(i.formData)}catch(n){this.handleXmlHttpRequestException(n)}}else this.setResponseType(this._XHR,this._dataFormat),t.data?this._XHR.send(t.data):this._XHR.send();else this._XHR.send()},n.prototype.handleXmlHttpRequestException=function(t){switch(t.code){case 101:}},n.prototype.initXHR=function(){var t=this;this._XHR||(this._XHR=new XMLHttpRequest,this._XHR.onloadstart=function(e){return t.onLoadStart(e)},this._XHR.onprogress=function(e){return t.onProgress(e)},this._XHR.onabort=function(e){return t.onAbort(e)},this._XHR.onerror=function(e){return t.onLoadError(e)},this._XHR.onload=function(e){return t.onLoadComplete(e)},this._XHR.ontimeout=function(e){return t.onTimeOut(e)},this._XHR.onloadend=function(e){return t.onLoadEnd(e)},this._XHR.onreadystatechange=function(e){return t.onReadyStateChange(e)})},n.prototype.disposeXHR=function(){null!==this._XHR&&(this._XHR.onloadstart=null,this._XHR.onprogress=null,this._XHR.onabort=null,this._XHR.onerror=null,this._XHR.onload=null,this._XHR.ontimeout=null,this._XHR.onloadend=null,this._XHR=null)},n.prototype.decodeURLVariables=function(t){var e=new Object;t=t.split("+").join(" ");for(var i,n=/[?&]?([^=]+)=([^&]*)/g;i=n.exec(t);)e[decodeURIComponent(i[1])]=decodeURIComponent(i[2]);return e},n.prototype.onReadyStateChange=function(){4==this._XHR.readyState&&(404==this._XHR.status&&(this._loadError=!0,this._loadErrorEvent||(this._loadErrorEvent=new t.events.IOErrorEvent(t.events.IOErrorEvent.IO_ERROR)),this.dispatchEvent(this._loadErrorEvent)),this.dispatchEvent(new t.events.HTTPStatusEvent(t.events.HTTPStatusEvent.HTTP_STATUS,this._XHR.status)))},n.prototype.onLoadEnd=function(){this._loadError===!0},n.prototype.onTimeOut=function(){},n.prototype.onAbort=function(){},n.prototype.onProgress=function(e){this._progressEvent||(this._progressEvent=new t.events.ProgressEvent(t.events.ProgressEvent.PROGRESS)),this._progressEvent.bytesTotal=e.total,this._progressEvent.bytesLoaded=e.loaded,this.dispatchEvent(this._progressEvent)},n.prototype.onLoadStart=function(){this._loadStartEvent||(this._loadStartEvent=new t.events.Event(t.events.Event.OPEN)),this.dispatchEvent(this._loadStartEvent)},n.prototype.onLoadComplete=function(){if(this._loadError!==!0){switch(this._dataFormat){case e.URLLoaderDataFormat.TEXT:this._data=this._XHR.responseText;break;case e.URLLoaderDataFormat.VARIABLES:this._data=this.decodeURLVariables(this._XHR.responseText);break;case e.URLLoaderDataFormat.BLOB:case e.URLLoaderDataFormat.ARRAY_BUFFER:case e.URLLoaderDataFormat.BINARY:this._data=this._XHR.response;break;default:this._data=this._XHR.responseText}this._loadCompleteEvent||(this._loadCompleteEvent=new t.events.Event(t.events.Event.COMPLETE)),this.dispatchEvent(this._loadCompleteEvent)}},n.prototype.onLoadError=function(){this._loadError=!0,this._loadErrorEvent||(this._loadErrorEvent=new t.events.IOErrorEvent(t.events.IOErrorEvent.IO_ERROR)),this.dispatchEvent(this._loadErrorEvent)},n}(t.events.EventDispatcher);e.URLLoader=i}(t.net||(t.net={})),t.net}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){"undefined"==typeof t&&(t=null),this._variables=new Object,null!==t&&this.decode(t)}return t.prototype.decode=function(t){t=t.split("+").join(" ");for(var e,i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);)this._variables[decodeURIComponent(e[1])]=decodeURIComponent(e[2])},t.prototype.toString=function(){return""},Object.defineProperty(t.prototype,"variables",{get:function(){return this._variables},set:function(t){this._variables=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formData",{get:function(){var t=new FormData;for(var e in this._variables)t.append(e,this._variables[e]);return t},enumerable:!0,configurable:!0}),t}();t.URLVariables=e}(t.net||(t.net={})),t.net}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=function(e){function n(t){"undefined"==typeof t&&(t=null),e.call(this),this._id=n.ID_COUNT++,null==t&&(t="null"),this._name=t,this._originalName=t,this.updateFullPath()}return __extends(n,e),Object.defineProperty(n.prototype,"assetType",{get:function(){throw new i},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"originalName",{get:function(){return this._originalName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(e){var i;i=this._name,this._name=e,null==this._name&&(this._name="null"),this.updateFullPath(),this.dispatchEvent(new t.events.AssetEvent(t.events.AssetEvent.ASSET_RENAME,this,i))},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){throw new i},Object.defineProperty(n.prototype,"assetNamespace",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"assetFullPath",{get:function(){return this._full_path},enumerable:!0,configurable:!0}),n.prototype.assetPathEquals=function(t,e){return this._name==t&&(!e||this._namespace==e)},n.prototype.resetAssetPath=function(t,e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!0),this._name=t?t:"null",this._namespace=e?e:n.DEFAULT_NAMESPACE,i&&(this._originalName=this._name),this.updateFullPath()},n.prototype.updateFullPath=function(){this._full_path=[this._namespace,this._name]},n.ID_COUNT=0,n.DEFAULT_NAMESPACE="default",n}(t.events.EventDispatcher);e.NamedAssetBase=n}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ANIMATION_NODE="animationNode",t.ANIMATION_SET="animationSet",t.ANIMATION_STATE="animationState",t.ANIMATOR="animator",t.BILLBOARD="billboard",t.CAMERA="camera",t.CONTAINER="container",t.EFFECTS_METHOD="effectsMethod",t.GEOMETRY="geometry",t.LINE_SEGMENT="lineSegment",t.LIGHT="light",t.LIGHT_PICKER="lightPicker",t.MATERIAL="material",t.MESH="mesh",t.TRIANGLE_SUB_MESH="triangleSubMesh",t.LINE_SUB_MESH="lineSubMesh",t.PRIMITIVE_PREFAB="primitivePrefab",t.SHADOW_MAP_METHOD="shadowMapMethod",t.SKELETON="skeleton",t.SKELETON_POSE="skeletonPose",t.SKYBOX="skybox",t.STATE_TRANSITION="stateTransition",t.TEXTURE="texture",t.TEXTURE_PROJECTOR="textureProjector",t}();t.AssetType=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.AUTO="auto",t.WEBGL="webgl",t.FLASH="flash",t.NATIVE="native",t}();t.ContextMode=e}(t.display||(t.display={})),t.display}(away||(away={}));var away;!function(t){!function(){}(t.display||(t.display={})),t.display}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ADD="add",t.ALPHA="alpha",t.DARKEN="darken",t.DIFFERENCE="difference",t.ERASE="erase",t.HARDLIGHT="hardlight",t.INVERT="invert",t.LAYER="layer",t.LIGHTEN="lighten",t.MULTIPLY="multiply",t.NORMAL="normal",t.OVERLAY="overlay",t.SCREEN="screen",t.SHADER="shader",t.SUBTRACT="subtract",t}();t.BlendMode=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.REGISTRATION_POINT="registrationPoint",t.PIVOT_POINT="pivot",t}();t.AlignmentMode=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.DEFAULT="default",t.CAMERA_PLANE="cameraPlane",t.CAMERA_POSITION="cameraPosition",t}();t.OrientationMode=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Rectangle,n=t.utils.ColorUtils,r=function(){function e(e,n,r,s){"undefined"==typeof r&&(r=!0),"undefined"==typeof s&&(s=null),this._alpha=1,this._locked=!1,this._transparent=r,this._imageCanvas=document.createElement("canvas"),this._imageCanvas.width=e,this._imageCanvas.height=n,this._context=this._imageCanvas.getContext("2d"),this._rect=new i(0,0,e,n),null!=s&&(this._alpha=this._transparent?t.utils.ColorUtils.float32ColorToARGB(s)[0]/255:1,this.fillRect(this._rect,s))}return e.prototype.dispose=function(){this._context=null,this._imageCanvas=null,this._imageData=null,this._rect=null,this._transparent=null,this._locked=null},e.prototype.lock=function(){this._locked=!0,this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)},e.prototype.unlock=function(){this._locked=!1,this._imageData&&(this._context.putImageData(this._imageData,0,0),this._imageData=null)},e.prototype.getPixel=function(t,e){var i,n,r,s;if(this._locked){var a=4*(t+e*this._imageCanvas.width);this._imageData||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)),i=this._imageData.data[a+0],n=this._imageData.data[a+1],r=this._imageData.data[a+2],s=this._imageData.data[a+3]}else{var o=this._context.getImageData(t,e,1,1);i=o.data[0],n=o.data[1],r=o.data[2],s=o.data[3]}return this._locked||(this._imageData=null),s<<24|i<<16|n<<8|r},e.prototype.setPixel=function(e,i,n){var r=t.utils.ColorUtils.float32ColorToARGB(n);if(this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)),this._imageData){var s=4*(e+i*this._imageCanvas.width);this._imageData.data[s+0]=r[1],this._imageData.data[s+1]=r[2],this._imageData.data[s+2]=r[3],this._imageData.data[s+3]=255}this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)},e.prototype.setPixels=function(t,e){if(this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)),this._imageData){e.position=0;var i,n,r;for(i=0;i<t.width;++i)for(n=0;n<t.height;++n)r=4*(i+t.x+(n+t.y)*this._imageCanvas.width),this._imageData.data[r+0]=e.readUnsignedInt(),this._imageData.data[r+1]=e.readUnsignedInt(),this._imageData.data[r+2]=e.readUnsignedInt(),this._imageData.data[r+3]=e.readUnsignedInt()}this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)},e.prototype.setPixel32=function(e,i,n){var r=t.utils.ColorUtils.float32ColorToARGB(n);if(this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)),this._imageData){var s=4*(e+i*this._imageCanvas.width);this._imageData.data[s+0]=r[1],this._imageData.data[s+1]=r[2],this._imageData.data[s+2]=r[3],this._imageData.data[s+3]=r[0]}this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)},e.prototype.setVector=function(e,i){if(this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)),this._imageData){var n,r,s,a;for(n=0;n<e.width;++n)for(r=0;r<e.height;++r)a=t.utils.ColorUtils.float32ColorToARGB(i[n+r*e.width]),s=4*(n+e.x+(r+e.y)*this._imageCanvas.width),this._imageData.data[s+0]=a[1],this._imageData.data[s+1]=a[2],this._imageData.data[s+2]=a[3],this._imageData.data[s+3]=a[0]}this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)},e.prototype.drawImage=function(t,e,i){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._drawImage(t,e,i),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):this._drawImage(t,e,i)},e.prototype._drawImage=function(e,i,n){e instanceof t.base.BitmapData?this._context.drawImage(e.canvas,i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height):e instanceof HTMLImageElement&&this._context.drawImage(e,i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height)},e.prototype.copyPixels=function(t,e,i){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._copyPixels(t,e,i),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):this._copyPixels(t,e,i)},e.prototype._copyPixels=function(e,i,n){e instanceof t.base.BitmapData?this._context.drawImage(e.canvas,i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height):e instanceof HTMLImageElement&&this._context.drawImage(e,i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height)},e.prototype.fillRect=function(t,e){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._context.fillStyle=this.hexToRGBACSS(e),this._context.fillRect(t.x,t.y,t.width,t.height),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):(this._context.fillStyle=this.hexToRGBACSS(e),this._context.fillRect(t.x,t.y,t.width,t.height))},e.prototype.draw=function(t,e){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._draw(t,e),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):this._draw(t,e)},e.prototype._draw=function(e,i){e instanceof t.base.BitmapData?(this._context.save(),null!=i&&this._context.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this._context.drawImage(e.canvas,0,0),this._context.restore()):e instanceof HTMLImageElement&&(this._context.save(),null!=i&&this._context.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this._context.drawImage(e,0,0),this._context.restore())},e.prototype.copyChannel=function(t,e,i,n,r){if(t.imageData,this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)),this._imageData){var s,a,o,h,p=t.imageData.data,u=this._imageData.data,l=Math.round(Math.log(n)/Math.log(2)),c=Math.round(Math.log(r)/Math.log(2));for(s=0;s<e.width;++s)for(a=0;a<e.height;++a)o=4*(s+e.x+(a+e.y)*t.width),h=4*(s+i.x+(a+i.y)*this.width),u[h+c]=p[o+l]}this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)},e.prototype.colorTransform=function(t,e){if(this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)),this._imageData){var i,n,r,s=this._imageData.data;for(i=0;i<t.width;++i)for(n=0;n<t.height;++n)r=4*(i+t.x+(n+t.y)*this.width),s[r]=s[r]*e.redMultiplier+e.redOffset,s[r+1]=s[r+1]*e.greenMultiplier+e.greenOffset,s[r+2]=s[r+2]*e.blueMultiplier+e.blueOffset,s[r+3]=s[r+3]*e.alphaMultiplier+e.alphaOffset}this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)},Object.defineProperty(e.prototype,"imageData",{get:function(){return this._context.getImageData(0,0,this._rect.width,this._rect.height)},set:function(t){this._context.putImageData(t,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._imageCanvas.width},set:function(t){this._rect.width=t,this._imageCanvas.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._imageCanvas.height},set:function(t){this._rect.height=t,this._imageCanvas.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rect",{get:function(){return this._rect},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._imageCanvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.hexToRGBACSS=function(t){var e=n.float32ColorToARGB(t);return 0==this._transparent?(e[0]=1,"rgba("+e[1]+","+e[2]+","+e[3]+","+e[0]+")"):"rgba("+e[1]+","+e[2]+","+e[3]+","+e[0]/255+")"},e}();e.BitmapData=r}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ALPHA=8,t.BLUE=4,t.GREEN=2,t.RED=1,t}();t.BitmapDataChannel=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ROUND="round",t.NONE="none",t.SQUARE="square",t}();t.CapsStyle=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(){i.call(this),this._pSceneTransform=new t.geom.Matrix3D,this._pSceneTransformDirty=!0,this._matrix3D=new t.geom.Matrix3D,this._matrix3DDirty=!0,this._inverseSceneTransform=new t.geom.Matrix3D,this._inverseSceneTransformDirty=!0,this._scenePosition=new t.geom.Vector3D,this._scenePositionDirty=!0,this._explicitVisibility=!0,this._pImplicitVisibility=!0,this._explicitMouseEnabled=!0,this._pImplicitMouseEnabled=!0,this._positionDirty=!0,this._rotationDirty=!0,this._scaleDirty=!0,this._rotationX=0,this._rotationY=0,this._rotationZ=0,this._eulers=new t.geom.Vector3D,this._flipY=new t.geom.Matrix3D,this._zOffset=0,this._pScaleX=1,this._pScaleY=1,this._pScaleZ=1,this._x=0,this._y=0,this._z=0,this._pivot=new t.geom.Vector3D,this._orientationMatrix=new t.geom.Matrix3D,this._pivotZero=!0,this._pivotDirty=!0,this._pos=new t.geom.Vector3D,this._rot=new t.geom.Vector3D,this._sca=new t.geom.Vector3D,this._pIgnoreTransform=!1,this._pBoundsInvalid=!0,this._worldBoundsInvalid=!0,this._pRenderables=new Array,this.alignmentMode=e.AlignmentMode.REGISTRATION_POINT,this.castsShadows=!0,this.orientationMode=e.OrientationMode.DEFAULT,this._transformComponents=new Array(3),this._transformComponents[0]=this._pos,this._transformComponents[1]=this._rot,this._transformComponents[2]=this._sca,this._transform=new t.geom.Transform(this),this._matrix3D.identity(),this._flipY.appendScale(1,-1,1),this._pBounds=this.pCreateDefaultBoundingVolume(),this._worldBounds=this.pCreateDefaultBoundingVolume()}return __extends(n,i),Object.defineProperty(n.prototype,"bounds",{get:function(){return this._pBoundsInvalid&&this.pUpdateBounds(),this._pBounds},set:function(t){this._pBounds!=t&&(this._pBounds=t,this._worldBounds=t.clone(),this.pInvalidateBounds(),this._boundsVisible&&this._partitionNode._iUpdateEntityBounds())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"depth",{get:function(){return this._pBoundsInvalid&&this.pUpdateBounds(),this._depth},set:function(t){this._depth!=t&&(this._depth==t,this._pScaleZ=t/this.bounds.aabb.depth,this.invalidateScale())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"eulers",{get:function(){return this._eulers.x=this._rotationX*t.geom.MathConsts.RADIANS_TO_DEGREES,this._eulers.y=this._rotationY*t.geom.MathConsts.RADIANS_TO_DEGREES,this._eulers.z=this._rotationZ*t.geom.MathConsts.RADIANS_TO_DEGREES,this._eulers},set:function(e){this._rotationX=e.x*t.geom.MathConsts.DEGREES_TO_RADIANS,this._rotationY=e.y*t.geom.MathConsts.DEGREES_TO_RADIANS,this._rotationZ=e.z*t.geom.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._pBoundsInvalid&&this.pUpdateBounds(),this._height},set:function(t){this._height!=t&&(this._height==t,this._pScaleY=t/this.bounds.aabb.height,this.invalidateScale())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"index",{get:function(){return this._pParent?this._pParent.getChildIndex(this):0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inverseSceneTransform",{get:function(){return this._inverseSceneTransformDirty&&(this._inverseSceneTransform.copyFrom(this.sceneTransform),this._inverseSceneTransform.invert(),this._inverseSceneTransformDirty=!1),this._inverseSceneTransform},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ignoreTransform",{get:function(){return this._pIgnoreTransform},set:function(t){this._pIgnoreTransform!=t&&(this._pIgnoreTransform=t,t&&(this._pSceneTransform.identity(),this._scenePosition.setTo(0,0,0)),this.pInvalidateSceneTransform())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEntity",{get:function(){return this._pIsEntity},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loaderInfo",{get:function(){return this._loaderInfo
},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mouseEnabled",{get:function(){return this._explicitMouseEnabled},set:function(t){this._explicitMouseEnabled!=t&&(this._explicitMouseEnabled=t,this._pUpdateImplicitMouseEnabled(this._pParent?this._pParent.mouseChildren:!0))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mouseX",{get:function(){return this._mouseX},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mouseY",{get:function(){return this._mouseY},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._pParent},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"partition",{get:function(){return this._explicitPartition},set:function(t){this._explicitPartition!=t&&(this._pScene&&this._explicitPartition&&this._pScene.iUnregisterPartition(this._explicitPartition),this._explicitPartition=t,this._pScene&&t&&this._pScene.iRegisterPartition(t),this._pUpdateImplicitPartition(this._pParent?this._pParent._iAssignedPartition:null))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"partitionNode",{get:function(){return this._partitionNode||(this._partitionNode=this.pCreateEntityPartitionNode()),this._partitionNode},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pickingCollider",{get:function(){return this._pPickingCollider},set:function(t){this._pPickingCollider=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pivot",{get:function(){return this._pivot},set:function(t){this._pivot=t.clone(),this.invalidatePivot()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotationX",{get:function(){return this._rotationX*t.geom.MathConsts.RADIANS_TO_DEGREES},set:function(e){this.rotationX!=e&&(this._rotationX=e*t.geom.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotationY",{get:function(){return this._rotationY*t.geom.MathConsts.RADIANS_TO_DEGREES},set:function(e){this.rotationY!=e&&(this._rotationY=e*t.geom.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotationZ",{get:function(){return this._rotationZ*t.geom.MathConsts.RADIANS_TO_DEGREES},set:function(e){this.rotationZ!=e&&(this._rotationZ=e*t.geom.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleX",{get:function(){return this._pScaleX},set:function(t){this._pScaleX!=t&&(this._pScaleX=t,this.invalidateScale())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleY",{get:function(){return this._pScaleY},set:function(t){this._pScaleY!=t&&(this._pScaleY=t,this.invalidateScale())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleZ",{get:function(){return this._pScaleZ},set:function(t){this._pScaleZ!=t&&(this._pScaleZ=t,this.invalidateScale())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scene",{get:function(){return this._pScene},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scenePosition",{get:function(){if(this._scenePositionDirty){if(this._pivotZero||this.alignmentMode!=e.AlignmentMode.PIVOT_POINT)this.sceneTransform.copyColumnTo(3,this._scenePosition);else{var i=new t.geom.Vector3D(this._pivot.x/this._pScaleX,this._pivot.y/this._pScaleY,this._pivot.z/this._pScaleZ);this._scenePosition=this.sceneTransform.transformVector(i)}this._scenePositionDirty=!1}return this._scenePosition},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sceneTransform",{get:function(){return this._pSceneTransformDirty&&this.pUpdateSceneTransform(),this._pSceneTransform},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"shaderPickingDetails",{get:function(){return this._shaderPickingDetails},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boundsVisible",{get:function(){return this._boundsVisible},set:function(t){t!=this._boundsVisible&&(this._boundsVisible=t,this._partitionNode.boundsVisible=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this._explicitVisibility},set:function(t){this._explicitVisibility!=t&&(this._explicitVisibility=t,this._pUpdateImplicitVisibility(this._pParent?this._pParent._iIsVisible():!0))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._pBoundsInvalid&&this.pUpdateBounds(),this._width},set:function(t){this._width!=t&&(this._width==t,this._pScaleX=t/this.bounds.aabb.width,this.invalidateScale())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"worldBounds",{get:function(){return this._iSourcePrefab&&this._iSourcePrefab._iValidate(),this._worldBoundsInvalid&&(this._worldBoundsInvalid=!1,this._worldBounds.transformFrom(this.bounds,this.sceneTransform)),this._worldBounds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"x",{get:function(){return this._x},set:function(t){this._x!=t&&(this._x=t,this.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},set:function(t){this._y!=t&&(this._y=t,this.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"z",{get:function(){return this._z},set:function(t){this._z!=t&&(this._z=t,this.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"zOffset",{get:function(){return this._zOffset},set:function(t){this._zOffset=t},enumerable:!0,configurable:!0}),n.prototype.addEventListener=function(e,n){switch(i.prototype.addEventListener.call(this,e,n),e){case t.events.DisplayObjectEvent.POSITION_CHANGED:this._listenToPositionChanged=!0;break;case t.events.DisplayObjectEvent.ROTATION_CHANGED:this._listenToRotationChanged=!0;break;case t.events.DisplayObjectEvent.SCALE_CHANGED:this._listenToScaleChanged=!0}},n.prototype.clone=function(){var t=new n;return t.pivot=this.pivot,t._iMatrix3D=this._iMatrix3D,t.name=name,t},n.prototype.dispose=function(){for(this.parent&&this.parent.removeChild(this);this._pRenderables.length;)this._pRenderables[0].dispose()},n.prototype.disposeAsset=function(){this.dispose()},n.prototype.getBounds=function(){return this._bounds},n.prototype.getRect=function(){return this._bounds},n.prototype.globalToLocal=function(t){return t},n.prototype.globalToLocal3D=function(){return new t.geom.Vector3D},n.prototype.hitTestObject=function(){return!1},n.prototype.hitTestPoint=function(t,e,i){return"undefined"==typeof i&&(i=!1),!1},n.prototype.isIntersectingRay=function(e,i){var n=this.inverseSceneTransform.transformVector(e),r=this.inverseSceneTransform.deltaTransformVector(i),s=this._iPickingCollisionVO;s.localNormal||(s.localNormal=new t.geom.Vector3D);var a=this.bounds.rayIntersection(n,r,s.localNormal);return 0>a?!1:(s.rayEntryDistance=a,s.localRayPosition=n,s.localRayDirection=r,s.rayPosition=e,s.rayDirection=i,s.rayOriginIsInsideBounds=0==a,!0)},n.prototype.local3DToGlobal=function(){return new t.geom.Point},n.prototype.lookAt=function(e,i){"undefined"==typeof i&&(i=null);var n,r,s,a;null==i?i=t.geom.Vector3D.Y_AXIS:i.normalize(),r=e.subtract(this._iMatrix3D.position),r.normalize(),s=i.crossProduct(r),s.normalize(),s.length<.05&&(s.x=i.y,s.y=i.x,s.z=0,s.normalize()),n=r.crossProduct(s),a=t.geom.Matrix3DUtils.RAW_DATA_CONTAINER,a[0]=s.x,a[1]=s.y,a[2]=s.z,a[3]=0,a[4]=n.x,a[5]=n.y,a[6]=n.z,a[7]=0,a[8]=r.x,a[9]=r.y,a[10]=r.z,a[11]=0;var o=new t.geom.Matrix3D;o.copyRawDataFrom(a);var h=o.decompose()[1];this._rotationX=h.x,this._rotationY=h.y,this._rotationZ=h.z,this.invalidateRotation()},n.prototype.localToGlobal=function(){return new t.geom.Point},n.prototype.moveTo=function(t,e,i){(this._x!=t||this._y!=e||this._z!=i)&&(this._x=t,this._y=e,this._z=i,this.invalidatePosition())},n.prototype.movePivot=function(e,i,n){null==this._pivot&&(this._pivot=new t.geom.Vector3D),this._pivot.x+=e,this._pivot.y+=i,this._pivot.z+=n,this.invalidatePivot()},n.prototype.pitch=function(e){this.rotate(t.geom.Vector3D.X_AXIS,e)},n.prototype.getRenderSceneTransform=function(t){if(this.orientationMode==e.OrientationMode.CAMERA_PLANE){var i=t.sceneTransform.decompose(),n=i[2];return i[0]=this.scenePosition,n.x=this._pScaleX,n.y=this._pScaleY,n.z=this._pScaleZ,this._orientationMatrix.recompose(i),this._pivotZero||this.alignmentMode!=e.AlignmentMode.PIVOT_POINT||this._orientationMatrix.prependTranslation(-this._pivot.x/this._pScaleX,-this._pivot.y/this._pScaleY,-this._pivot.z/this._pScaleZ),this._orientationMatrix}return this.sceneTransform},n.prototype.roll=function(e){this.rotate(t.geom.Vector3D.Z_AXIS,e)},n.prototype.rotate=function(e,i){var n=new t.geom.Matrix3D;n.prependRotation(i,e);var r=n.decompose()[1];this._rotationX+=r.x,this._rotationY+=r.y,this._rotationZ+=r.z,this.invalidateRotation()},n.prototype.rotateTo=function(e,i,n){this._rotationX=e*t.geom.MathConsts.DEGREES_TO_RADIANS,this._rotationY=i*t.geom.MathConsts.DEGREES_TO_RADIANS,this._rotationZ=n*t.geom.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation()},n.prototype.removeEventListener=function(e,n){if(i.prototype.removeEventListener.call(this,e,n),!this.hasEventListener(e,n))switch(e){case t.events.DisplayObjectEvent.POSITION_CHANGED:this._listenToPositionChanged=!1;break;case t.events.DisplayObjectEvent.ROTATION_CHANGED:this._listenToRotationChanged=!1;break;case t.events.DisplayObjectEvent.SCALE_CHANGED:this._listenToScaleChanged=!1}},n.prototype.translate=function(t,e){var i=t.x,n=t.y,r=t.z,s=e/Math.sqrt(i*i+n*n+r*r);this._x+=i*s,this._y+=n*s,this._z+=r*s,this.invalidatePosition()},n.prototype.translateLocal=function(t,e){var i=t.x,n=t.y,r=t.z,s=e/Math.sqrt(i*i+n*n+r*r);this._iMatrix3D.prependTranslation(i*s,n*s,r*s),this._matrix3D.copyColumnTo(3,this._pos),this._x=this._pos.x,this._y=this._pos.y,this._z=this._pos.z,this.invalidatePosition()},n.prototype.yaw=function(e){this.rotate(t.geom.Vector3D.Y_AXIS,e)},Object.defineProperty(n.prototype,"_iAssignedPartition",{get:function(){return this._pImplicitPartition},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_iMatrix3D",{get:function(){return this._matrix3DDirty&&this._pUpdateMatrix3D(),this._matrix3D},set:function(t){var e,i=t.decompose();e=i[0],(this._x!=e.x||this._y!=e.y||this._z!=e.z)&&(this._x=e.x,this._y=e.y,this._z=e.z,this.invalidatePosition()),e=i[1],(this._rotationX!=e.x||this._rotationY!=e.y||this._rotationZ!=e.z)&&(this._rotationX=e.x,this._rotationY=e.y,this._rotationZ=e.z,this.invalidateRotation()),e=i[2],(this._pScaleX!=e.x||this._pScaleY!=e.y||this._pScaleZ!=e.z)&&(this._pScaleX=e.x,this._pScaleY=e.y,this._pScaleZ=e.z,this.invalidateScale())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_iPickingCollisionVO",{get:function(){return this._pPickingCollisionVO||(this._pPickingCollisionVO=new t.pick.PickingCollisionVO(this)),this._pPickingCollisionVO},enumerable:!0,configurable:!0}),n.prototype.iSetParent=function(t){this._pParent=t,t?(this._pUpdateImplicitMouseEnabled(t.mouseChildren),this._pUpdateImplicitVisibility(t._iIsVisible()),this._pUpdateImplicitPartition(t._iAssignedPartition),this._iSetScene(t._pScene)):(this._pUpdateImplicitMouseEnabled(!0),this._pUpdateImplicitVisibility(!0),this._pUpdateImplicitPartition(null),this._iSetScene(null))},n.prototype.pCreateDefaultBoundingVolume=function(){return new t.bounds.AxisAlignedBoundingBox},n.prototype.pCreateEntityPartitionNode=function(){throw new t.errors.AbstractMethodError},n.prototype.pInvalidateBounds=function(){this._pBoundsInvalid=!0,this._worldBoundsInvalid=!0,this.isEntity&&this.invalidatePartition()},n.prototype.pInvalidateSceneTransform=function(){this._pSceneTransformDirty=!this._pIgnoreTransform,this._inverseSceneTransformDirty=!this._pIgnoreTransform,this._scenePositionDirty=!this._pIgnoreTransform,this._worldBoundsInvalid=!this._pIgnoreTransform,this.isEntity&&this.invalidatePartition(),this._listenToSceneTransformChanged&&this.notifySceneTransformChange()},n.prototype.pUpdateBounds=function(){this._width=this._pBounds.aabb.width*this._pScaleX,this._height=this._pBounds.aabb.height*this._pScaleY,this._depth=this._pBounds.aabb.depth*this._pScaleZ,this._pBoundsInvalid=!1},n.prototype._pUpdateImplicitMouseEnabled=function(t){this._pImplicitMouseEnabled=this._explicitMouseEnabled&&t,this._pImplicitMouseEnabled&&this._pParent&&!this._pPickingCollider&&(this._pPickingCollider=this._pParent._pPickingCollider)},n.prototype._pUpdateImplicitPartition=function(t){this._pImplicitPartition=this._explicitPartition||t},n.prototype._pUpdateImplicitVisibility=function(t){this._pImplicitVisibility=this._explicitVisibility&&t},n.prototype._pUpdateMatrix3D=function(){this._pos.x=this._x,this._pos.y=this._y,this._pos.z=this._z,this._rot.x=this._rotationX,this._rot.y=this._rotationY,this._rot.z=this._rotationZ,this._sca.x=this._pScaleX,this._sca.y=this._pScaleY,this._sca.z=this._pScaleZ,this._matrix3D.recompose(this._transformComponents),this._pivotZero||(this._matrix3D.prependTranslation(-this._pivot.x/this._pScaleX,-this._pivot.y/this._pScaleY,-this._pivot.z/this._pScaleZ),this.alignmentMode!=e.AlignmentMode.PIVOT_POINT&&this._matrix3D.appendTranslation(this._pivot.x,this._pivot.y,this._pivot.z)),this._matrix3DDirty=!1,this._positionDirty=!1,this._rotationDirty=!1,this._scaleDirty=!1,this._pivotDirty=!1},n.prototype.pUpdateSceneTransform=function(){this._pParent&&!this._pParent._iIsRoot?(this._pSceneTransform.copyFrom(this._pParent.sceneTransform),this._pSceneTransform.prepend(this._iMatrix3D)):this._pSceneTransform.copyFrom(this._iMatrix3D),this._pSceneTransformDirty=!1},n.prototype._iAddRenderable=function(t){return this._pRenderables.push(t),t},n.prototype._iRemoveRenderable=function(t){var e=this._pRenderables.indexOf(t);return this._pRenderables.splice(e,1),t},n.prototype._iTestCollision=function(){return!1},n.prototype._iInternalUpdate=function(){this._iController&&this._iController.update()},n.prototype._iIsVisible=function(){return this._pImplicitVisibility},n.prototype._iIsMouseEnabled=function(){return this._pImplicitMouseEnabled},n.prototype._iSetScene=function(t){this._pScene!=t&&(this._pUpdateScene(t),this._pSceneTransformDirty||this._pIgnoreTransform||this.pInvalidateSceneTransform())},n.prototype._pUpdateScene=function(e){this._pScene&&(this._pScene.dispatchEvent(new t.events.SceneEvent(t.events.SceneEvent.REMOVED_FROM_SCENE,this)),this._pScene.iUnregisterEntity(this)),this._pScene=e,e&&(e.dispatchEvent(new t.events.SceneEvent(t.events.SceneEvent.ADDED_TO_SCENE,this)),e.iRegisterEntity(this)),this.notifySceneChange()},n.prototype.notifyPositionChanged=function(){this._positionChanged||(this._positionChanged=new t.events.DisplayObjectEvent(t.events.DisplayObjectEvent.POSITION_CHANGED,this)),this.dispatchEvent(this._positionChanged)},n.prototype.notifyRotationChanged=function(){this._rotationChanged||(this._rotationChanged=new t.events.DisplayObjectEvent(t.events.DisplayObjectEvent.ROTATION_CHANGED,this)),this.dispatchEvent(this._rotationChanged)},n.prototype.notifyScaleChanged=function(){this._scaleChanged||(this._scaleChanged=new t.events.DisplayObjectEvent(t.events.DisplayObjectEvent.SCALE_CHANGED,this)),this.dispatchEvent(this._scaleChanged)},n.prototype.notifySceneChange=function(){this._listenToSceneChanged&&(this._scenechanged||(this._scenechanged=new t.events.DisplayObjectEvent(t.events.DisplayObjectEvent.SCENE_CHANGED,this)),this.dispatchEvent(this._scenechanged))},n.prototype.notifySceneTransformChange=function(){this._sceneTransformChanged||(this._sceneTransformChanged=new t.events.DisplayObjectEvent(t.events.DisplayObjectEvent.SCENETRANSFORM_CHANGED,this)),this.dispatchEvent(this._sceneTransformChanged)},n.prototype.invalidateMatrix3D=function(){this._matrix3DDirty||(this._matrix3DDirty=!0,this._pSceneTransformDirty||this._pIgnoreTransform||this.pInvalidateSceneTransform())},n.prototype.invalidatePartition=function(){this._iAssignedPartition&&this._iAssignedPartition.iMarkForUpdate(this)},n.prototype.invalidatePivot=function(){this._pivotZero=0==this._pivot.x&&0==this._pivot.y&&0==this._pivot.z,this._pivotDirty||(this._pivotDirty=!0,this.invalidateMatrix3D())},n.prototype.invalidatePosition=function(){this._positionDirty||(this._positionDirty=!0,this.invalidateMatrix3D(),this._listenToPositionChanged&&this.notifyPositionChanged())},n.prototype.invalidateRotation=function(){this._rotationDirty||(this._rotationDirty=!0,this.invalidateMatrix3D(),this._listenToRotationChanged&&this.notifyRotationChanged())},n.prototype.invalidateScale=function(){this._scaleDirty||(this._scaleDirty=!0,this.invalidateMatrix3D(),this._listenToScaleChanged&&this.notifyScaleChanged())},n}(t.library.NamedAssetBase);e.DisplayObject=i}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this),this._subGeometries=new Array}return __extends(i,e),Object.defineProperty(i.prototype,"assetType",{get:function(){return t.library.AssetType.GEOMETRY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subGeometries",{get:function(){return this._subGeometries},enumerable:!0,configurable:!0}),i.prototype.getSubGeometries=function(){return this._subGeometries},i.prototype.applyTransformation=function(t){for(var e=this._subGeometries.length,i=0;e>i;++i)this._subGeometries[i].applyTransformation(t)},i.prototype.addSubGeometry=function(e){this._subGeometries.push(e),e.parentGeometry=this,this.hasEventListener(t.events.GeometryEvent.SUB_GEOMETRY_ADDED)&&this.dispatchEvent(new t.events.GeometryEvent(t.events.GeometryEvent.SUB_GEOMETRY_ADDED,e)),this.iInvalidateBounds(e)},i.prototype.removeSubGeometry=function(e){this._subGeometries.splice(this._subGeometries.indexOf(e),1),e.parentGeometry=null,this.hasEventListener(t.events.GeometryEvent.SUB_GEOMETRY_REMOVED)&&this.dispatchEvent(new t.events.GeometryEvent(t.events.GeometryEvent.SUB_GEOMETRY_REMOVED,e)),this.iInvalidateBounds(e)},i.prototype.clone=function(){for(var t=new i,e=this._subGeometries.length,n=0;e>n;++n)t.addSubGeometry(this._subGeometries[n].clone());return t},i.prototype.scale=function(t){for(var e=this._subGeometries.length,i=0;e>i;++i)this._subGeometries[i].scale(t)},i.prototype.dispose=function(){for(var t=this._subGeometries.length,e=0;t>e;++e){var i=this._subGeometries[0];this.removeSubGeometry(i),i.dispose()}},i.prototype.scaleUV=function(t,e){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=1);for(var i=this._subGeometries.length,n=0;i>n;++n)this._subGeometries[n].scaleUV(t,e)},i.prototype.iInvalidateBounds=function(e){this.hasEventListener(t.events.GeometryEvent.BOUNDS_INVALID)&&this.dispatchEvent(new t.events.GeometryEvent(t.events.GeometryEvent.BOUNDS_INVALID,e))},i}(t.library.NamedAssetBase);e.Geometry=i}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.LINEAR="linear",t.RADIAL="radial",t}();t.GradientType=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.prototype.beginBitmapFill=function(t,e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=!1)},t.prototype.beginFill=function(t,e){"undefined"==typeof e&&(e=1)},t.prototype.beginGradientFill=function(t,e,i,n,r,s,a,o){"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s="pad"),"undefined"==typeof a&&(a="rgb"),"undefined"==typeof o&&(o=0)},t.prototype.clear=function(){},t.prototype.copyFrom=function(){},t.prototype.cubicCurveTo=function(){},t.prototype.curveTo=function(){},t.prototype.drawCircle=function(){},t.prototype.drawEllipse=function(){},t.prototype.drawGraphicsData=function(){},t.prototype.drawPath=function(){},t.prototype.drawRect=function(){},t.prototype.drawRoundRect=function(t,e,i,n,r,s){"undefined"==typeof s&&(s=0/0)},t.prototype.drawTriangles=function(t,e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null)},t.prototype.endFill=function(){},t.prototype.lineBitmapStyle=function(t,e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=!1)},t.prototype.lineGradientStyle=function(t,e,i,n,r,s,a,o){"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=null),"undefined"==typeof a&&(a=null),"undefined"==typeof o&&(o=0)},t.prototype.lineStyle=function(t,e,i,n,r,s,a,o){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=null),"undefined"==typeof a&&(a=null),"undefined"==typeof o&&(o=3)},t.prototype.lineTo=function(){},t.prototype.moveTo=function(){},t}();t.Graphics=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.EVEN_ODD="evenOdd",t.NON_ZERO="nonZero",t}();t.GraphicsPathWinding=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(){}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.LINEAR_RGB="linearRGB",t.RGB="rgb",t}();t.InterpolationMethod=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(){}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(){}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t){e.call(this),this._pStrideOffsetDirty=!0,this._pConcatenateArrays=!0,this._pStride=new Object,this._pOffset=new Object,this._pConcatenateArrays=t}return __extends(i,e),i.prototype._pUpdateStrideOffset=function(){throw new t.errors.AbstractMethodError},Object.defineProperty(i.prototype,"subMeshClass",{get:function(){return this._pSubMeshClass},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"concatenateArrays",{get:function(){return this._pConcatenateArrays},set:function(t){this._pConcatenateArrays!=t&&(this._pConcatenateArrays=t,this._pStrideOffsetDirty=!0,t&&this._pNotifyVerticesUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"indices",{get:function(){return this._pIndices},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vertices",{get:function(){return this.updateVertices(),this._pVertices},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"numTriangles",{get:function(){return this._numTriangles},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"numVertices",{get:function(){return this._pNumVertices},enumerable:!0,configurable:!0}),i.prototype.getStride=function(t){return this._pStrideOffsetDirty&&this._pUpdateStrideOffset(),this._pStride[t]},i.prototype.getOffset=function(t){return this._pStrideOffsetDirty&&this._pUpdateStrideOffset(),this._pOffset[t]},i.prototype.updateVertices=function(){throw new t.errors.AbstractMethodError},i.prototype.dispose=function(){this._pIndices=null,this._pVertices=null},i.prototype.updateIndices=function(t){this._pIndices=t,this._numIndices=t.length,this._numTriangles=this._numIndices/3,this.notifyIndicesUpdate()},i.prototype.pInvalidateBounds=function(){this.parentGeometry&&this.parentGeometry.iInvalidateBounds(this)},i.prototype.clone=function(){throw new t.errors.AbstractMethodError},i.prototype.applyTransformation=function(){},i.prototype.scale=function(){},i.prototype.scaleUV=function(t,e){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=1)},i.prototype.getBoundingPositions=function(){throw new t.errors.AbstractMethodError},i.prototype.notifyIndicesUpdate=function(){this._indicesUpdated||(this._indicesUpdated=new t.events.SubGeometryEvent(t.events.SubGeometryEvent.INDICES_UPDATED)),this.dispatchEvent(this._indicesUpdated)},i.prototype._pNotifyVerticesUpdate=function(){throw new t.errors.AbstractMethodError},i.VERTEX_DATA="vertices",i}(t.library.NamedAssetBase);e.SubGeometryBase=i}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this),this._iIndex=0,this._renderables=new Array}return __extends(i,e),Object.defineProperty(i.prototype,"animator",{get:function(){return this._pParentMesh.animator},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._material||this._pParentMesh.material},set:function(t){this.material&&this.material.iRemoveOwner(this),this._material=t,this.material&&this.material.iAddOwner(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sceneTransform",{get:function(){return this._pParentMesh.sceneTransform},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parentMesh",{get:function(){return this._pParentMesh},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"uvTransform",{get:function(){return this._uvTransform||this._pParentMesh.uvTransform},set:function(t){this._uvTransform=t},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.material=null;for(var t=this._renderables.length,e=0;t>e;e++)this._renderables[e].dispose()},i.prototype.getRenderSceneTransform=function(t){return this._pParentMesh.getRenderSceneTransform(t)},i.prototype._iAddRenderable=function(t){return this._renderables.push(t),t},i.prototype._iRemoveRenderable=function(t){var e=this._renderables.indexOf(t);return this._renderables.splice(e,1),t},i.prototype._iInvalidateRenderableGeometry=function(){for(var t=this._renderables.length,e=0;t>e;e++)this._renderables[e].invalidateGeometry()},i.prototype._iCollectRenderable=function(){throw new t.errors.AbstractMethodError},i.prototype._iGetExplicitMaterial=function(){return this._material},i}(t.library.NamedAssetBase);e.SubMeshBase=i}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.BEVEL="bevel",t.MITER="miter",t.ROUND="round",t}();t.JointStyle=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.HORIZONTAL="horizontal",t.NONE="none",t.NORMAL="normal",t.VERTICAL="vertical",t}();t.LineScaleMode=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(){i.call(this,!0),this._positionsDirty=!0,this._boundingPositionDirty=!0,this._thicknessDirty=!0,this._colorsDirty=!0,this._pSubMeshClass=e.LineSubMesh}return __extends(n,i),n.prototype._pUpdateStrideOffset=function(){this._pOffset[n.VERTEX_DATA]=0;var t=0;this._pOffset[n.START_POSITION_DATA]=t,t+=3,this._pOffset[n.END_POSITION_DATA]=t,t+=3,this._pOffset[n.THICKNESS_DATA]=t,t+=1,this._pOffset[n.COLOR_DATA]=t,t+=4,this._pStride[n.VERTEX_DATA]=t,this._pStride[n.START_POSITION_DATA]=t,this._pStride[n.END_POSITION_DATA]=t,this._pStride[n.THICKNESS_DATA]=t,this._pStride[n.COLOR_DATA]=t;var e=this._pNumVertices*t;null==this._pVertices?this._pVertices=new Array(e):this._pVertices.length!=e&&(this._pVertices.length=e),this._pStrideOffsetDirty=!1},Object.defineProperty(n.prototype,"vertices",{get:function(){return this._positionsDirty&&this.updatePositions(this._startPositions,this._endPositions),this._thicknessDirty&&this.updateThickness(this._thickness),this._colorsDirty&&this.updateColors(this._startColors,this._endColors),this._pVertices},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"startPositions",{get:function(){return this._positionsDirty&&this.updatePositions(this._startPositions,this._endPositions),this._startPositions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endPositions",{get:function(){return this._positionsDirty&&this.updatePositions(this._startPositions,this._endPositions),this._endPositions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"thickness",{get:function(){return this._thicknessDirty&&this.updateThickness(this._thickness),this._thickness},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"startColors",{get:function(){return this._colorsDirty&&this.updateColors(this._startColors,this._endColors),this._startColors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endColors",{get:function(){return this._colorsDirty&&this.updateColors(this._startColors,this._endColors),this._endColors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"numSegments",{get:function(){return this._numSegments},enumerable:!0,configurable:!0}),n.prototype.getBoundingPositions=function(){return this._boundingPositionDirty&&(this._boundingPositions=this.startPositions.concat(this.endPositions)),this._boundingPositions},n.prototype.updatePositions=function(t,e){var i,r,s,a,o,h,p;this._startPositions=t,null==this._startPositions&&(this._startPositions=new Array),this._endPositions=e,null==this._endPositions&&(this._endPositions=new Array),this._boundingPositionDirty=!0,this._numSegments=this._startPositions.length/3,this._pNumVertices=4*this._numSegments;var u=this._pNumVertices*this.getStride(n.VERTEX_DATA);for(null==this._pVertices?this._pVertices=new Array(u):this._pVertices.length!=u&&(this._pVertices.length=u),i=0,r=0,a=this.getOffset(n.START_POSITION_DATA),o=this.getStride(n.START_POSITION_DATA),h=this._pVertices,p=new Array;i<t.length;){if(s=a/o&1?e:t,h[a]=s[i],h[a+1]=s[i+1],h[a+2]=s[i+2],s=a/o&1?t:e,h[a+3]=s[i],h[a+4]=s[i+1],h[a+5]=s[i+2],4==++r){var l=a/o-3;p.push(l,l+1,l+2,l+3,l+2,l+1),r=0,i+=3}a+=o}this.updateIndices(p),this.pInvalidateBounds(),this.notifyPositionsUpdate(),this._positionsDirty=!1},n.prototype.updateThickness=function(t){var e,i,r,s,a,o;if(this._thickness=t,null!=t)for(e=0,i=0,s=this.getOffset(n.THICKNESS_DATA),a=this.getStride(n.THICKNESS_DATA),o=this._pVertices,r=s;e<t.length;)o[r]=1&Math.floor(.5*(r-s)/a+.5)?-t[e]:t[e],4==++i&&(i=0,e++),r+=a;this.notifyThicknessUpdate(),this._thicknessDirty=!1},n.prototype.updateColors=function(t,e){var i,r,s,a,o,h,p;if(this._startColors=t,this._endColors=e,null==this._startColors)for(this._startColors=new Array(4*this._numSegments),i=0;i<this._startColors.length;)this._startColors[i++]=1;if(null==this._endColors)for(this._endColors=new Array(4*this._numSegments),i=0;i<this._endColors.length;)this._endColors[i++]=1;for(i=0,r=0,o=this.getOffset(n.COLOR_DATA),h=this.getStride(n.COLOR_DATA),p=this._pVertices,a=o;i<this._startColors.length;)s=(a-o)/h&1?this._endColors:this._startColors,p[a]=s[i],p[a+1]=s[i+1],p[a+2]=s[i+2],p[a+3]=s[i+3],4==++r&&(r=0,i+=4),a+=h;this.notifyColorsUpdate(),this._colorsDirty=!1},n.prototype.dispose=function(){i.prototype.dispose.call(this),this._startPositions=null,this._endPositions=null,this._thickness=null,this._startColors=null,this._endColors=null},n.prototype.pInvalidateBounds=function(){this.parentGeometry&&this.parentGeometry.iInvalidateBounds(this)},n.prototype.clone=function(){var t=new n;return t.updateIndices(this._pIndices.concat()),t.updatePositions(this._startPositions.concat(),this._endPositions.concat()),t.updateThickness(this._thickness.concat()),t.updatePositions(this._startPositions.concat(),this._endPositions.concat()),t},n.prototype._pNotifyVerticesUpdate=function(){this._pStrideOffsetDirty=!0,this.notifyPositionsUpdate(),this.notifyThicknessUpdate(),this.notifyColorsUpdate()},n.prototype.notifyPositionsUpdate=function(){this._positionsDirty||(this._positionsDirty=!0,this._positionsUpdated||(this._positionsUpdated=new t.events.SubGeometryEvent(t.events.SubGeometryEvent.VERTICES_UPDATED,e.TriangleSubGeometry.POSITION_DATA)),this.dispatchEvent(this._positionsUpdated))},n.prototype.notifyThicknessUpdate=function(){this._thicknessDirty||(this._thicknessDirty=!0,this._thicknessUpdated||(this._thicknessUpdated=new t.events.SubGeometryEvent(t.events.SubGeometryEvent.VERTICES_UPDATED,n.THICKNESS_DATA)),this.dispatchEvent(this._thicknessUpdated))},n.prototype.notifyColorsUpdate=function(){this._colorsDirty||(this._colorsDirty=!0,this._colorUpdated||(this._colorUpdated=new t.events.SubGeometryEvent(t.events.SubGeometryEvent.VERTICES_UPDATED,n.COLOR_DATA)),this.dispatchEvent(this._colorUpdated))},n.VERTEX_DATA="vertices",n.START_POSITION_DATA="startPositions",n.END_POSITION_DATA="endPositions",n.THICKNESS_DATA="thickness",n.COLOR_DATA="colors",n.POSITION_FORMAT="float3",n.COLOR_FORMAT="float4",n.THICKNESS_FORMAT="float1",n}(e.SubGeometryBase);e.LineSubGeometry=i}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=t.library.AssetType,n=function(t){function e(e,i,n){"undefined"==typeof n&&(n=null),t.call(this),this._pParentMesh=i,this._subGeometry=e,this.material=n
}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return i.LINE_SUB_MESH},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subGeometry",{get:function(){return this._subGeometry},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.material=null,t.prototype.dispose.call(this)},e.prototype._iCollectRenderable=function(t){t.applyLineSubMesh(this)},e}(e.SubMeshBase);e.LineSubMesh=n}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"bytes",{get:function(){return this._bytes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loader",{get:function(){return this._loader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),e}(t.events.EventDispatcher);e.LoaderInfo=i}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ALWAYS="always",t.AUTO="auto",t.NEVER="never",t}();t.PixelSnapping=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.PAD="pad",t.REFLECT="reflect",t.REPEAT="repeat",t}();t.SpreadMethod=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=t.display.ContextMode,n=t.events.Event,r=t.events.StageEvent,s=t.geom.Rectangle,a=t.utils.CSS,o=function(e){function o(t,i,n,r,o){"undefined"==typeof r&&(r=!1),"undefined"==typeof o&&(o="baseline"),e.call(this),this._x=0,this._y=0,this._stageIndex=-1,this._antiAlias=0,this._renderTarget=null,this._renderSurfaceSelector=0,this._initialised=!1,this._container=t,this._stageIndex=i,this._stageManager=n,this._viewPort=new s,this._enableDepthAndStencil=!0,a.setElementX(this._container,0),a.setElementY(this._container,0),this.visible=!0}return __extends(o,e),o.prototype.requestContext=function(e,r,s){var a=this;"undefined"==typeof e&&(e=!1),"undefined"==typeof r&&(r="baseline"),"undefined"==typeof s&&(s="auto"),null!=this._usesSoftwareRendering&&(this._usesSoftwareRendering=e),this._profile=r;try{s==i.FLASH?new t.stagegl.ContextStage3D(this._container,this._stageIndex,function(t){return a._callback(t)}):this._context=new t.stagegl.ContextWebGL(this._container,this._stageIndex)}catch(o){try{s==i.AUTO?new t.stagegl.ContextStage3D(this._container,this._stageIndex,function(t){return a._callback(t)}):this.dispatchEvent(new n(n.ERROR))}catch(o){this.dispatchEvent(new n(n.ERROR))}}this._context&&this._callback(this._context)},Object.defineProperty(o.prototype,"width",{get:function(){return this._width},set:function(t){this._width!=t&&(a.setElementWidth(this._container,t),this._width=this._viewPort.width=t,this._backBufferDirty=!0,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){return this._height},set:function(t){this._height!=t&&(a.setElementHeight(this._container,t),this._height=this._viewPort.height=t,this._backBufferDirty=!0,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"x",{get:function(){return this._x},set:function(t){this._x!=t&&(a.setElementX(this._container,t),this._x=this._viewPort.x=t,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"y",{get:function(){return this._y},set:function(t){this._y!=t&&(a.setElementY(this._container,t),this._y=this._viewPort.y=t,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"visible",{get:function(){return a.getElementVisibility(this._container)},set:function(t){a.setElementVisibility(this._container,t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),o.prototype.notifyViewportUpdated=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewportUpdated=new r(r.VIEWPORT_UPDATED),this.dispatchEvent(this._viewportUpdated))},o.prototype.notifyEnterFrame=function(){this._enterFrame||(this._enterFrame=new n(n.ENTER_FRAME)),this.dispatchEvent(this._enterFrame)},o.prototype.notifyExitFrame=function(){this._exitFrame||(this._exitFrame=new n(n.EXIT_FRAME)),this.dispatchEvent(this._exitFrame)},Object.defineProperty(o.prototype,"profile",{get:function(){return this._profile},enumerable:!0,configurable:!0}),o.prototype.dispose=function(){this._stageManager.iRemoveStage(this),this.freeContext(),this._stageManager=null,this._stageIndex=-1},o.prototype.configureBackBuffer=function(t,e,i,n){this.width=t,this.height=e,this._antiAlias=i,this._enableDepthAndStencil=n,this._context&&this._context.configureBackBuffer(t,e,i,n)},Object.defineProperty(o.prototype,"enableDepthAndStencil",{get:function(){return this._enableDepthAndStencil},set:function(t){this._enableDepthAndStencil=t,this._backBufferDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"renderSurfaceSelector",{get:function(){return this._renderSurfaceSelector},enumerable:!0,configurable:!0}),o.prototype.clear=function(){this._context&&(this._backBufferDirty&&(this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil),this._backBufferDirty=!1),this._context.clear((4278190080&this._color)>>>24,(16711680&this._color)>>>16,(65280&this._color)>>>8,255&this._color),this._bufferClear=!0)},o.prototype.addEventListener=function(t,i){e.prototype.addEventListener.call(this,t,i)},o.prototype.removeEventListener=function(t,i){e.prototype.removeEventListener.call(this,t,i)},Object.defineProperty(o.prototype,"scissorRect",{get:function(){return this._scissorRect},set:function(t){this._scissorRect=t,this._context.setScissorRectangle(this._scissorRect)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"stageIndex",{get:function(){return this._stageIndex},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"usesSoftwareRendering",{get:function(){return this._usesSoftwareRendering},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(t){this._antiAlias=t,this._backBufferDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"viewPort",{get:function(){return this._viewportDirty=!1,this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bufferClear",{get:function(){return this._bufferClear},set:function(t){this._bufferClear=t},enumerable:!0,configurable:!0}),o.prototype.freeContext=function(){this._context&&(this._context.dispose(),this.dispatchEvent(new r(r.CONTEXT_DISPOSED))),this._context=null,this._initialised=!1},o.prototype.onEnterFrame=function(){this._context&&(this.clear(),this.notifyEnterFrame(),this._context||this._context.present(),this.notifyExitFrame())},o.prototype.recoverFromDisposal=function(){return this._context?!0:!1},o.prototype._callback=function(t){this._context=t,this._container=this._context.container,this._width&&this._height&&this._context.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil),this.dispatchEvent(new r(this._initialised?r.CONTEXT_RECREATED:r.CONTEXT_CREATED)),this._initialised=!0},o}(t.events.EventDispatcher);e.Stage=o}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.NEGATIVE="negative",t.NONE="none",t.POSITIVE="positive",t}();t.TriangleCulling=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=t.events.SubGeometryEvent,n=function(n){function r(t){n.call(this,t),this._positionsDirty=!0,this._faceNormalsDirty=!0,this._faceTangentsDirty=!0,this._vertexNormalsDirty=!0,this._vertexTangentsDirty=!0,this._uvsDirty=!0,this._secondaryUVsDirty=!0,this._jointIndicesDirty=!0,this._jointWeightsDirty=!0,this._concatenateArrays=!0,this._autoDeriveNormals=!0,this._autoDeriveTangents=!0,this._autoDeriveUVs=!1,this._useFaceWeights=!1,this._scaleU=1,this._scaleV=1,this._pSubMeshClass=e.TriangleSubMesh}return __extends(r,n),Object.defineProperty(r.prototype,"scaleU",{get:function(){return this._scaleU},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleV",{get:function(){return this._scaleV},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(t){this._useCondensedIndices!=t&&(this._useCondensedIndices=t,this.notifyJointIndicesUpdate())},enumerable:!0,configurable:!0}),r.prototype._pUpdateStrideOffset=function(){if(this._concatenateArrays){this._pOffset[r.VERTEX_DATA]=0,this._pOffset[r.POSITION_DATA]=0;var t=3;null!=this._vertexNormals&&(this._pOffset[r.NORMAL_DATA]=t,t+=3),null!=this._vertexTangents&&(this._pOffset[r.TANGENT_DATA]=t,t+=3),null!=this._uvs&&(this._pOffset[r.UV_DATA]=t,t+=2),null!=this._secondaryUVs&&(this._pOffset[r.SECONDARY_UV_DATA]=t,t+=2),null!=this._jointIndices&&(this._pOffset[r.JOINT_INDEX_DATA]=t,t+=this._jointsPerVertex),null!=this._jointWeights&&(this._pOffset[r.JOINT_WEIGHT_DATA]=t,t+=this._jointsPerVertex),this._pStride[r.VERTEX_DATA]=t,this._pStride[r.POSITION_DATA]=t,this._pStride[r.NORMAL_DATA]=t,this._pStride[r.TANGENT_DATA]=t,this._pStride[r.UV_DATA]=t,this._pStride[r.SECONDARY_UV_DATA]=t,this._pStride[r.JOINT_INDEX_DATA]=t,this._pStride[r.JOINT_WEIGHT_DATA]=t;var e=this._pNumVertices*t;null==this._pVertices?this._pVertices=new Array(e):this._pVertices.length!=e&&(this._pVertices.length=e)}else this._pOffset[r.POSITION_DATA]=0,this._pOffset[r.NORMAL_DATA]=0,this._pOffset[r.TANGENT_DATA]=0,this._pOffset[r.UV_DATA]=0,this._pOffset[r.SECONDARY_UV_DATA]=0,this._pOffset[r.JOINT_INDEX_DATA]=0,this._pOffset[r.JOINT_WEIGHT_DATA]=0,this._pStride[r.POSITION_DATA]=3,this._pStride[r.NORMAL_DATA]=3,this._pStride[r.TANGENT_DATA]=3,this._pStride[r.UV_DATA]=2,this._pStride[r.SECONDARY_UV_DATA]=2,this._pStride[r.JOINT_INDEX_DATA]=this._jointsPerVertex,this._pStride[r.JOINT_WEIGHT_DATA]=this._jointsPerVertex;this._pStrideOffsetDirty=!1},Object.defineProperty(r.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},set:function(t){this._jointsPerVertex!=t&&(this._jointsPerVertex=t,this._pStrideOffsetDirty=!0,this._pConcatenateArrays&&this._pNotifyVerticesUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"autoDeriveUVs",{get:function(){return this._autoDeriveUVs},set:function(t){this._autoDeriveUVs!=t&&(this._autoDeriveUVs=t,t&&this.notifyUVsUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"autoDeriveNormals",{get:function(){return this._autoDeriveNormals},set:function(t){this._autoDeriveNormals!=t&&(this._autoDeriveNormals=t,t&&this.notifyNormalsUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"autoDeriveTangents",{get:function(){return this._autoDeriveTangents},set:function(t){this._autoDeriveTangents!=t&&(this._autoDeriveTangents=t,t&&this.notifyTangentsUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vertices",{get:function(){return this._positionsDirty&&this.updatePositions(this._positions),this._vertexNormalsDirty&&this.updateVertexNormals(this._vertexNormals),this._vertexTangentsDirty&&this.updateVertexTangents(this._vertexTangents),this._uvsDirty&&this.updateUVs(this._uvs),this._secondaryUVsDirty&&this.updateSecondaryUVs(this._secondaryUVs),this._jointIndicesDirty&&this.updateJointIndices(this._jointIndices),this._jointWeightsDirty&&this.updateJointWeights(this._jointWeights),this._pVertices},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positionsDirty&&this.updatePositions(this._positions),this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vertexNormals",{get:function(){return this._vertexNormalsDirty&&this.updateVertexNormals(this._vertexNormals),this._vertexNormals},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vertexTangents",{get:function(){return this._vertexTangentsDirty&&this.updateVertexTangents(this._vertexTangents),this._vertexTangents},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"faceNormals",{get:function(){return this._faceNormalsDirty&&this.updateFaceNormals(),this._faceNormals},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"faceTangents",{get:function(){return this._faceTangentsDirty&&this.updateFaceTangents(),this._faceTangents},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uvs",{get:function(){return this._uvsDirty&&this.updateUVs(this._uvs),this._uvs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"secondaryUVs",{get:function(){return this._secondaryUVsDirty&&this.updateSecondaryUVs(this._secondaryUVs),this._secondaryUVs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"jointIndices",{get:function(){return this._jointIndicesDirty&&this.updateJointIndices(this._jointIndices),this._useCondensedIndices?this._condensedJointIndices:this._jointIndices},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"jointWeights",{get:function(){return this._jointWeightsDirty&&this.updateJointWeights(this._jointWeights),this._jointWeights},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useFaceWeights",{get:function(){return this._useFaceWeights},set:function(t){this._useFaceWeights!=t&&(this._useFaceWeights=t,this._autoDeriveNormals&&this.notifyNormalsUpdate(),this._autoDeriveTangents&&this.notifyTangentsUpdate(),this._faceNormalsDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numCondensedJoints",{get:function(){return this._jointIndicesDirty&&this.updateJointIndices(this._jointIndices),this._numCondensedJoints},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"condensedIndexLookUp",{get:function(){return this._jointIndicesDirty&&this.updateJointIndices(this._jointIndices),this._condensedIndexLookUp},enumerable:!0,configurable:!0}),r.prototype.getBoundingPositions=function(){return this._positionsDirty&&this.updatePositions(this._positions),this._positions},r.prototype.updatePositions=function(t){var e,i,n,s;if(this._positions=t,null==this._positions&&(this._positions=new Array),this._pNumVertices=this._positions.length/3,this._concatenateArrays){var a=this._pNumVertices*this.getStride(r.VERTEX_DATA);for(null==this._pVertices?this._pVertices=new Array(a):this._pVertices.length!=a&&(this._pVertices.length=a),e=0,i=this.getOffset(r.POSITION_DATA),n=this.getStride(r.POSITION_DATA),s=this._pVertices;e<t.length;)s[i]=t[e++],s[i+1]=t[e++],s[i+2]=t[e++],i+=n}this._autoDeriveNormals&&this.notifyNormalsUpdate(),this._autoDeriveTangents&&this.notifyTangentsUpdate(),this._autoDeriveUVs&&this.notifyUVsUpdate(),this.pInvalidateBounds(),this.notifyPositionsUpdate(),this._positionsDirty=!1},r.prototype.updateVertexNormals=function(t){var e,i,n,s,a;if(this._autoDeriveNormals){null==this._vertexNormals&&(this._vertexNormals=new Array(this._positions.length),this._concatenateArrays?this._pNotifyVerticesUpdate():this._pStrideOffsetDirty=!0),this._faceNormalsDirty&&this.updateFaceNormals(),n=this.getOffset(r.NORMAL_DATA),s=this.getStride(r.NORMAL_DATA),a=this._concatenateArrays?this._pVertices:this._vertexNormals;var o=0,h=1,p=2;i=n;for(var u=a.length;u>i;)a[i]=0,a[i+1]=0,a[i+2]=0,i+=s;var l,c=0,d=this._pIndices.length;for(e=0;d>e;)l=this._useFaceWeights?this._faceWeights[c++]:1,i=n+this._pIndices[e++]*s,a[i]+=this._faceNormals[o]*l,a[i+1]+=this._faceNormals[h]*l,a[i+2]+=this._faceNormals[p]*l,i=n+this._pIndices[e++]*s,a[i]+=this._faceNormals[o]*l,a[i+1]+=this._faceNormals[h]*l,a[i+2]+=this._faceNormals[p]*l,i=n+this._pIndices[e++]*s,a[i]+=this._faceNormals[o]*l,a[i+1]+=this._faceNormals[h]*l,a[i+2]+=this._faceNormals[p]*l,o+=3,h+=3,p+=3;for(e=0,i=n;u>i;){var _=a[i],f=a[i+1],g=a[i+2],m=1/Math.sqrt(_*_+f*f+g*g);this._concatenateArrays?(this._vertexNormals[e++]=a[i]=_*m,this._vertexNormals[e++]=a[i+1]=f*m,this._vertexNormals[e++]=a[i+2]=g*m):(a[i]=_*m,a[i+1]=f*m,a[i+2]=g*m),i+=s}}else if(null!=this._vertexNormals&&null!=t||null==this._vertexNormals&&null==t||(this._concatenateArrays?this._pNotifyVerticesUpdate():this._pStrideOffsetDirty=!0),this._vertexNormals=t,null!=t&&this._concatenateArrays)for(e=0,i=this.getOffset(r.NORMAL_DATA),s=this.getStride(r.NORMAL_DATA),a=this._pVertices;e<t.length;)a[i]=t[e++],a[i+1]=t[e++],a[i+2]=t[e++],i+=s;this.notifyNormalsUpdate(),this._vertexNormalsDirty=!1},r.prototype.updateVertexTangents=function(t){var e,i,n,s,a;if(this._autoDeriveTangents){null==this._vertexTangents&&(this._vertexTangents=new Array(this._positions.length),this._concatenateArrays?this._pNotifyVerticesUpdate():this._pStrideOffsetDirty=!0),this._faceTangentsDirty&&this.updateFaceTangents(),n=this.getOffset(r.TANGENT_DATA),s=this.getStride(r.TANGENT_DATA),a=this._concatenateArrays?this._pVertices:this._vertexTangents,i=n;for(var o=a.length;o>i;)a[i]=0,a[i+1]=0,a[i+2]=0,i+=s;var h,p=0,u=0,l=1,c=2;e=0;for(var d=this._pIndices.length;d>e;)h=this._useFaceWeights?this._faceWeights[p++]:1,i=n+this._pIndices[e++]*s,a[i++]+=this._faceTangents[u]*h,a[i++]+=this._faceTangents[l]*h,a[i]+=this._faceTangents[c]*h,i=n+this._pIndices[e++]*s,a[i++]+=this._faceTangents[u]*h,a[i++]+=this._faceTangents[l]*h,a[i]+=this._faceTangents[c]*h,i=n+this._pIndices[e++]*s,a[i++]+=this._faceTangents[u]*h,a[i++]+=this._faceTangents[l]*h,a[i]+=this._faceTangents[c]*h,u+=3,l+=3,c+=3;for(e=0,i=n;o>i;){var _=a[i],f=a[i+1],g=a[i+2],m=1/Math.sqrt(_*_+f*f+g*g);this._concatenateArrays?(this._vertexTangents[e++]=a[i]=_*m,this._vertexTangents[e++]=a[i+1]=f*m,this._vertexTangents[e++]=a[i+2]=g*m):(a[i]=_*m,a[i+1]=f*m,a[i+2]=g*m),i+=s}}else if(null!=this._vertexTangents&&null!=t||null==this._vertexTangents&&null==t||(this._concatenateArrays?this._pNotifyVerticesUpdate():this._pStrideOffsetDirty=!0),this._vertexTangents=t,null!=t&&this._concatenateArrays)for(e=0,i=this.getOffset(r.TANGENT_DATA),s=this.getStride(r.TANGENT_DATA),a=this._pVertices;e<t.length;)a[i]=t[e++],a[i+1]=t[e++],a[i+2]=t[e++],i+=s;this.notifyTangentsUpdate(),this._vertexTangentsDirty=!1},r.prototype.updateUVs=function(t){var e,i,n,s,a;if(this._autoDeriveUVs){null==this._uvs&&(this._uvs=new Array(2*this._positions.length/3),this._concatenateArrays?this._pNotifyVerticesUpdate():this._pStrideOffsetDirty=!0),n=this.getOffset(r.UV_DATA),s=this.getStride(r.UV_DATA),a=this._concatenateArrays?this._pVertices:this._uvs,e=0,i=n;for(var o=0,h=a.length;h>i;)this._concatenateArrays?(this._uvs[e++]=a[i]=.5*o,this._uvs[e++]=a[i+1]=1-(1&o)):(a[i]=.5*o,a[i+1]=1-(1&o)),3==++o&&(o=0),i+=s}else if(null!=this._uvs&&null!=t||null==this._uvs&&null==t||(this._concatenateArrays?this._pNotifyVerticesUpdate():this._pStrideOffsetDirty=!0),this._uvs=t,null!=t&&this._concatenateArrays)for(e=0,i=this.getOffset(r.UV_DATA),s=this.getStride(r.UV_DATA),a=this._pVertices;e<t.length;)a[i]=t[e++],a[i+1]=t[e++],i+=s;this._autoDeriveTangents&&this.notifyTangentsUpdate(),this.notifyUVsUpdate(),this._uvsDirty=!1},r.prototype.updateSecondaryUVs=function(t){var e,i,n,s,a;if(!this._concatenateArrays||null!=this._secondaryUVs&&null!=t||null==this._secondaryUVs&&null==t||this._pNotifyVerticesUpdate(),this._secondaryUVs=t,null!=t&&this._concatenateArrays)for(n=this.getOffset(r.SECONDARY_UV_DATA),s=this.getStride(r.SECONDARY_UV_DATA),e=0,i=n,a=this._pVertices;e<t.length;)a[i]=t[e++],a[i+1]=t[e++],i+=s;this.notifySecondaryUVsUpdate(),this._secondaryUVsDirty=!1},r.prototype.updateJointIndices=function(t){var e,i,n,s,a,o;if(!this._concatenateArrays||null!=this._jointIndices&&null!=t||null==this._jointIndices&&null==t||this._pNotifyVerticesUpdate(),this._jointIndices=t,null!=t)if(s=this.getOffset(r.JOINT_INDEX_DATA),a=this.getStride(r.JOINT_INDEX_DATA),this._useCondensedIndices){e=0,i=0,n=s,o=this._concatenateArrays?this._pVertices:this._condensedJointIndices;var h,p=0,u=new Object;for(this._concatenateArrays||(this._condensedJointIndices=new Array(t.length)),this._condensedIndexLookUp=new Array;e<t.length;){for(i=0;i<this._jointsPerVertex;i++)h=t[e++],void 0==u[h]&&(u[h]=3*p,this._condensedIndexLookUp[p++]=h),o[n+i]=u[h];n+=a}this._numCondensedJoints=p}else if(this._concatenateArrays)for(e=0,n=s,o=this._pVertices;e<t.length;){for(i=0;i<this._jointsPerVertex;)o[n+i++]=t[e++];n+=a}this.notifyJointIndicesUpdate(),this._jointIndicesDirty=!1},r.prototype.updateJointWeights=function(t){var e,i,n,s,a,o;if(!this._concatenateArrays||null!=this._jointWeights&&null!=t||null==this._jointWeights&&null==t||this._pNotifyVerticesUpdate(),this._jointWeights=t,null!=t&&this._concatenateArrays)for(s=this.getOffset(r.JOINT_WEIGHT_DATA),a=this.getStride(r.JOINT_WEIGHT_DATA),e=0,n=s,o=this._pVertices;e<t.length;){for(i=0;i<this._jointsPerVertex;)o[n+i++]=t[e++];n+=a}this.notifyJointWeightsUpdate(),this._jointWeightsDirty=!1},r.prototype.dispose=function(){n.prototype.dispose.call(this),this._positions=null,this._vertexNormals=null,this._vertexTangents=null,this._uvs=null,this._secondaryUVs=null,this._jointIndices=null,this._jointWeights=null,this._faceNormals=null,this._faceWeights=null,this._faceTangents=null},r.prototype.updateIndices=function(t){n.prototype.updateIndices.call(this,t),this._faceNormalsDirty=!0,this._autoDeriveNormals&&(this._vertexNormalsDirty=!0),this._autoDeriveTangents&&(this._vertexTangentsDirty=!0),this._autoDeriveUVs&&(this._uvsDirty=!0)},r.prototype.clone=function(){var t=new r(this._concatenateArrays);return t.updateIndices(this._pIndices.concat()),t.updatePositions(this._positions.concat()),t.updateVertexNormals(this._vertexNormals&&!this._autoDeriveNormals?this._vertexNormals.concat():null),t.updateUVs(this._uvs&&!this._autoDeriveUVs?this._uvs.concat():null),t.updateVertexTangents(this._vertexTangents&&!this._autoDeriveTangents?this._vertexTangents.concat():null),this._secondaryUVs&&t.updateSecondaryUVs(this._secondaryUVs.concat()),this._jointIndices&&(t.jointsPerVertex=this._jointsPerVertex,t.updateJointIndices(this._jointIndices.concat())),this._jointWeights&&t.updateJointWeights(this._jointWeights.concat()),t},r.prototype.scaleUV=function(t,e){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=1);var i,n,r,s;s=this._uvs;var a=t/this._scaleU,o=e/this._scaleV;this._scaleU=t,this._scaleV=e;var h=s.length;for(n=0,r=2,i=n;h>i;)s[i]*=a,s[i+1]*=o,i+=r;this.notifyUVsUpdate()},r.prototype.scale=function(t){var e,i,n,r,s;s=this._positions;var a=s.length;for(n=0,r=3,e=0,i=n;a>e;)s[i]*=t,s[i+1]*=t,s[i+2]*=t,e+=3,i+=r;this.notifyPositionsUpdate()},r.prototype.applyTransformation=function(e){var i,n,s;this._concatenateArrays?(i=this._pVertices,n=this._pVertices,s=this._pVertices):(i=this._positions,n=this._vertexNormals,s=this._vertexTangents);var a,o,h,p,u=this._positions.length/3,l=new t.geom.Vector3D,c=null!=this._vertexNormals,d=null!=this._vertexTangents;(c||d)&&(p=e.clone(),p.invert(),p.transpose());var _=this.getOffset(r.POSITION_DATA),f=this.getOffset(r.NORMAL_DATA),g=this.getOffset(r.TANGENT_DATA),m=this.getStride(r.POSITION_DATA),y=this.getStride(r.NORMAL_DATA),b=this.getStride(r.TANGENT_DATA);for(a=0;u>a;++a)o=_+1,h=_+2,l.x=i[_],l.y=i[o],l.z=i[h],l=e.transformVector(l),i[_]=l.x,i[o]=l.y,i[h]=l.z,_+=m,c&&(o=f+1,h=f+2,l.x=n[f],l.y=n[o],l.z=n[h],l=p.deltaTransformVector(l),l.normalize(),n[f]=l.x,n[o]=l.y,n[h]=l.z,f+=y),d&&(o=g+1,h=g+2,l.x=s[g],l.y=s[o],l.z=s[h],l=p.deltaTransformVector(l),l.normalize(),s[g]=l.x,s[o]=l.y,s[h]=l.z,g+=b);this.notifyPositionsUpdate(),this.notifyNormalsUpdate(),this.notifyTangentsUpdate()},r.prototype.updateFaceTangents=function(){var t,e,i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x=0,v=this._positions,w=this._uvs,D=this._pIndices.length;for(null==this._faceTangents&&(this._faceTangents=new Array(D));D>x;)t=this._pIndices[x],e=this._pIndices[x+1],i=this._pIndices[x+2],r=w[2*t+1],s=w[2*e+1]-r,a=w[2*i+1]-r,n=3*t,h=v[n],p=v[n+1],u=v[n+2],n=3*e,l=v[n]-h,c=v[n+1]-p,d=v[n+2]-u,n=3*i,_=v[n]-h,f=v[n+1]-p,g=v[n+2]-u,m=a*l-s*_,y=a*c-s*f,b=a*d-s*g,o=1/Math.sqrt(m*m+y*y+b*b),this._faceTangents[x++]=o*m,this._faceTangents[x++]=o*y,this._faceTangents[x++]=o*b;this._faceTangentsDirty=!1},r.prototype.updateFaceNormals=function(){var t,e,i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x=0,v=0,w=0,D=this._positions,C=this._pIndices.length;for(null==this._faceNormals&&(this._faceNormals=new Array(C)),this._useFaceWeights&&null==this._faceWeights&&(this._faceWeights=new Array(C/3));C>x;){if(t=3*this._pIndices[x++],e=D[t],r=D[t+1],o=D[t+2],t=3*this._pIndices[x++],i=D[t],s=D[t+1],h=D[t+2],t=3*this._pIndices[x++],n=D[t],a=D[t+1],p=D[t+2],u=n-e,l=a-r,c=p-o,d=i-e,_=s-r,f=h-o,g=c*_-l*f,m=u*f-c*d,y=l*d-u*_,b=Math.sqrt(g*g+m*m+y*y),this._useFaceWeights){var S=1e4*b;1>S&&(S=1),this._faceWeights[w++]=S}b=1/b,this._faceNormals[v++]=g*b,this._faceNormals[v++]=m*b,this._faceNormals[v++]=y*b}this._faceNormalsDirty=!1},r.prototype._pNotifyVerticesUpdate=function(){this._pStrideOffsetDirty=!0,this.notifyPositionsUpdate(),this.notifyNormalsUpdate(),this.notifyTangentsUpdate(),this.notifyUVsUpdate(),this.notifySecondaryUVsUpdate(),this.notifyJointIndicesUpdate(),this.notifyJointWeightsUpdate()},r.prototype.notifyPositionsUpdate=function(){this._positionsDirty||(this._positionsDirty=!0,this._positionsUpdated||(this._positionsUpdated=new i(i.VERTICES_UPDATED,r.POSITION_DATA)),this.dispatchEvent(this._positionsUpdated))},r.prototype.notifyNormalsUpdate=function(){this._vertexNormalsDirty||(this._vertexNormalsDirty=!0,this._normalsUpdated||(this._normalsUpdated=new i(i.VERTICES_UPDATED,r.NORMAL_DATA)),this.dispatchEvent(this._normalsUpdated))},r.prototype.notifyTangentsUpdate=function(){this._vertexTangentsDirty||(this._vertexTangentsDirty=!0,this._tangentsUpdated||(this._tangentsUpdated=new i(i.VERTICES_UPDATED,r.TANGENT_DATA)),this.dispatchEvent(this._tangentsUpdated))},r.prototype.notifyUVsUpdate=function(){this._uvsDirty||(this._uvsDirty=!0,this._uvsUpdated||(this._uvsUpdated=new i(i.VERTICES_UPDATED,r.UV_DATA)),this.dispatchEvent(this._uvsUpdated))},r.prototype.notifySecondaryUVsUpdate=function(){this._secondaryUVsDirty||(this._secondaryUVsDirty=!0,this._secondaryUVsUpdated||(this._secondaryUVsUpdated=new i(i.VERTICES_UPDATED,r.SECONDARY_UV_DATA)),this.dispatchEvent(this._secondaryUVsUpdated))},r.prototype.notifyJointIndicesUpdate=function(){this._jointIndicesDirty||(this._jointIndicesDirty=!0,this._jointIndicesUpdated||(this._jointIndicesUpdated=new i(i.VERTICES_UPDATED,r.JOINT_INDEX_DATA)),this.dispatchEvent(this._jointIndicesUpdated))},r.prototype.notifyJointWeightsUpdate=function(){this._jointWeightsDirty||(this._jointWeightsDirty=!0,this._jointWeightsUpdated||(this._jointWeightsUpdated=new i(i.VERTICES_UPDATED,r.JOINT_WEIGHT_DATA)),this.dispatchEvent(this._jointWeightsUpdated))},r.POSITION_DATA="positions",r.NORMAL_DATA="vertexNormals",r.TANGENT_DATA="vertexTangents",r.UV_DATA="uvs",r.SECONDARY_UV_DATA="secondaryUVs",r.JOINT_INDEX_DATA="jointIndices",r.JOINT_WEIGHT_DATA="jointWeights",r.POSITION_FORMAT="float3",r.NORMAL_FORMAT="float3",r.TANGENT_FORMAT="float3",r.UV_FORMAT="float2",r.SECONDARY_UV_FORMAT="float2",r}(e.SubGeometryBase);e.TriangleSubGeometry=n}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=t.library.AssetType,n=function(t){function e(e,i,n){"undefined"==typeof n&&(n=null),t.call(this),this._pParentMesh=i,this._subGeometry=e,this.material=n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return i.TRIANGLE_SUB_MESH},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subGeometry",{get:function(){return this._subGeometry},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype._iCollectRenderable=function(t){t.applyTriangleSubMesh(this)},e}(e.SubMeshBase);e.TriangleSubMesh=n}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t){"undefined"==typeof t&&(t=!1),e.call(this),this._pFormat="bgra",this._textureData=new Array,this._generateMipmaps=this._hasMipmaps=t}return __extends(i,e),Object.defineProperty(i.prototype,"size",{get:function(){return this._pSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasMipmaps",{get:function(){return this._hasMipmaps},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"format",{get:function(){return this._pFormat},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"generateMipmaps",{get:function(){return this._generateMipmaps},set:function(t){this._generateMipmaps!=t&&(this._generateMipmaps=this._hasMipmaps=t,this.invalidateContent())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"assetType",{get:function(){return t.library.AssetType.TEXTURE},enumerable:!0,configurable:!0}),i.prototype.invalidateContent=function(){for(var t=this._textureData.length,e=0;t>e;e++)this._textureData[e].invalidate()},i.prototype.invalidateSize=function(){for(;this._textureData.length;)this._textureData[0].dispose()},i.prototype.dispose=function(){for(;this._textureData.length;)this._textureData[0].dispose()},i.prototype._iAddTextureData=function(t){return this._textureData.push(t),t},i.prototype._iRemoveTextureData=function(t){return this._textureData.splice(this._textureData.indexOf(t),1),t},i}(t.library.NamedAssetBase);e.TextureProxyBase=i}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(t){"undefined"==typeof t&&(t=!1),i.call(this,t)}return __extends(n,i),Object.defineProperty(n.prototype,"width",{get:function(){return this._pWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._pHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._pWidth},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){if(i.prototype.dispose.call(this),this._mipmapData)for(var t=this._mipmapData.length,n=0;t>n;n++)e.MipmapGenerator.freeMipMapHolder(this._mipmapData[n])},n.prototype.invalidateContent=function(){i.prototype.invalidateContent.call(this),this._mipmapDataDirty=!0},n.prototype._pSetSize=function(t,e){(this._pWidth!=t||this._pHeight!=e)&&this.invalidateSize(),this._mipmapDataDirty=!0,this._pWidth=t,this._pHeight=e},n.prototype._iGetMipmapData=function(){return this._mipmapDataDirty&&(this._mipmapDataDirty=!1,this._mipmapData||(this._mipmapData=new Array),t.textures.MipmapGenerator.generateMipMaps(this._iGetTextureData(),this._mipmapData,!0)),this._mipmapData},n.prototype._iGetTextureData=function(){throw new t.errors.AbstractMethodError},n}(e.TextureProxyBase);e.Texture2DBase=i}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=function(t){function n(e){"undefined"==typeof e&&(e=!1),t.call(this,e),this._mipmapDataArray=new Array(6),this._mipmapDataDirtyArray=new Array(6)}return __extends(n,t),n.prototype._pSetSize=function(t){this._pSize!=t&&this.invalidateSize();for(var e=0;6>e;e++)this._mipmapDataDirtyArray[e]=!0;this._pSize=t},n.prototype.dispose=function(){t.prototype.dispose.call(this);for(var i=0;6>i;i++)for(var n=this._mipmapDataArray[i],r=n.length,s=0;r>s;s++)e.MipmapGenerator.freeMipMapHolder(n[s])},n.prototype.invalidateContent=function(){t.prototype.invalidateContent.call(this);for(var e=0;6>e;e++)this._mipmapDataDirtyArray[e]=!0},n.prototype._iGetMipmapData=function(t){if(this._mipmapDataDirtyArray[t]){this._mipmapDataDirtyArray[t]=!1;var i=this._mipmapDataArray[t]||(this._mipmapDataArray[t]=new Array);e.MipmapGenerator.generateMipMaps(this._iGetTextureData(t),i,!0)
}return this._mipmapDataArray[t]},n.prototype._iGetTextureData=function(){throw new i},n}(e.TextureProxyBase);e.CubeTextureBase=n}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i){"undefined"==typeof i&&(i=!1),e.call(this,i),this.htmlImageElement=t}return __extends(i,e),Object.defineProperty(i.prototype,"htmlImageElement",{get:function(){return this._htmlImageElement},set:function(e){if(this._htmlImageElement!=e){if(!t.utils.TextureUtils.isHTMLImageElementValid(e))throw new t.errors.Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048");this._htmlImageElement=e,this.invalidateContent(),this._pSetSize(e.width,e.height)}},enumerable:!0,configurable:!0}),i.prototype._iGetTextureData=function(){return this._htmlImageElement},i}(e.Texture2DBase);e.ImageTexture=i}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i){"undefined"==typeof i&&(i=!1),e.call(this,i),this.bitmapData=t}return __extends(i,e),Object.defineProperty(i.prototype,"bitmapData",{get:function(){return this._bitmapData},set:function(e){if(this._bitmapData!=e){if(!t.utils.TextureUtils.isBitmapDataValid(e))throw new Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048");this._bitmapData=e,this.invalidateContent(),this._pSetSize(e.width,e.height)}},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){e.prototype.dispose.call(this),this._bitmapData.dispose(),this._bitmapData=null},i.prototype._iGetTextureData=function(){return this._bitmapData},i}(e.Texture2DBase);e.BitmapTexture=i}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i){e.call(this,!1),this._pSetSize(t,i)}return __extends(i,e),Object.defineProperty(i.prototype,"width",{get:function(){return this._pWidth},set:function(e){if(e!=this._pWidth){if(!t.utils.TextureUtils.isDimensionValid(e))throw new Error("Invalid size: Width and height must be power of 2 and cannot exceed 2048");this.invalidateContent(),this._pSetSize(e,this._pHeight)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._pHeight},set:function(e){if(e!=this._pHeight){if(!t.utils.TextureUtils.isDimensionValid(e))throw new Error("Invalid size: Width and height must be power of 2 and cannot exceed 2048");this.invalidateContent(),this._pSetSize(this._pWidth,e)}},enumerable:!0,configurable:!0}),i}(e.Texture2DBase);e.RenderTexture=i}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i,n,r,s,a,o){"undefined"==typeof o&&(o=!1),e.call(this,o),this._htmlImageElements=new Array(6),this._testSize(this._htmlImageElements[0]=t),this._testSize(this._htmlImageElements[1]=i),this._testSize(this._htmlImageElements[2]=n),this._testSize(this._htmlImageElements[3]=r),this._testSize(this._htmlImageElements[4]=s),this._testSize(this._htmlImageElements[5]=a),this.invalidateContent(),this._pSetSize(t.width)}return __extends(i,e),Object.defineProperty(i.prototype,"positiveX",{get:function(){return this._htmlImageElements[0]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._htmlImageElements[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"negativeX",{get:function(){return this._htmlImageElements[1]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._htmlImageElements[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"positiveY",{get:function(){return this._htmlImageElements[2]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._htmlImageElements[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"negativeY",{get:function(){return this._htmlImageElements[3]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._htmlImageElements[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"positiveZ",{get:function(){return this._htmlImageElements[4]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._htmlImageElements[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"negativeZ",{get:function(){return this._htmlImageElements[5]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._htmlImageElements[5]=t},enumerable:!0,configurable:!0}),i.prototype._testSize=function(e){if(e.width!=e.height)throw new Error("BitmapData should have equal width and height!");if(!t.utils.TextureUtils.isHTMLImageElementValid(e))throw new Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048")},i.prototype._iGetTextureData=function(t){return this._htmlImageElements[t]},i}(e.CubeTextureBase);e.ImageCubeTexture=i}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i,n,r,s,a,o){"undefined"==typeof o&&(o=!1),e.call(this,o),this._bitmapDatas=new Array(6),this._testSize(this._bitmapDatas[0]=t),this._testSize(this._bitmapDatas[1]=i),this._testSize(this._bitmapDatas[2]=n),this._testSize(this._bitmapDatas[3]=r),this._testSize(this._bitmapDatas[4]=s),this._testSize(this._bitmapDatas[5]=a),this.invalidateContent(),this._pSetSize(t.width)}return __extends(i,e),Object.defineProperty(i.prototype,"positiveX",{get:function(){return this._bitmapDatas[0]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._bitmapDatas[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"negativeX",{get:function(){return this._bitmapDatas[1]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._bitmapDatas[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"positiveY",{get:function(){return this._bitmapDatas[2]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._bitmapDatas[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"negativeY",{get:function(){return this._bitmapDatas[3]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._bitmapDatas[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"positiveZ",{get:function(){return this._bitmapDatas[4]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._bitmapDatas[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"negativeZ",{get:function(){return this._bitmapDatas[5]},set:function(t){this._testSize(t),this.invalidateContent(),this._pSetSize(t.width),this._bitmapDatas[5]=t},enumerable:!0,configurable:!0}),i.prototype._testSize=function(e){if(e.width!=e.height)throw new Error("BitmapData should have equal width and height!");if(!t.utils.TextureUtils.isBitmapDataValid(e))throw new Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048")},i.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=this._bitmapDatas.length,i=0;t>i;i++)this._bitmapDatas[i].dispose(),this._bitmapDatas[i]=null;this._bitmapDatas=null},i.prototype._iGetTextureData=function(t){return this._bitmapDatas[t]},i}(e.CubeTextureBase);e.BitmapCubeTexture=i}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=t.base.BitmapData,n=t.geom.Matrix,r=t.geom.Rectangle,s=function(){function t(){}return t.generateMipMaps=function(e,i,n){"undefined"==typeof n&&(n=!1);var r,s=e.width,a=e.height,o=0;for(t._rect.width=s,t._rect.height=a;s>=1&&a>=1;)r=i[o]=t._getMipmapHolder(i[o],s,a),n&&r.fillRect(t._rect,0),t._matrix.a=t._rect.width/e.width,t._matrix.d=t._rect.height/e.height,r.draw(e,t._matrix),s>>=1,a>>=1,t._rect.width=s>1?s:1,t._rect.height=a>1?a:1,o++},t._getMipmapHolder=function(e,n,r){if(e){if(e.width==n&&e.height==r)return e;t.freeMipMapHolder(e)}return t._mipMaps[n]||(t._mipMaps[n]=[],t._mipMapUses[n]=[]),t._mipMaps[n][r]?(t._mipMapUses[n][r]=t._mipMapUses[n][r]+1,e=t._mipMaps[n][r]):(e=t._mipMaps[n][r]=new i(n,r,!0),t._mipMapUses[n][r]=1),e},t.freeMipMapHolder=function(e){var i=e.width,n=e.height;0==--t._mipMapUses[i][n]&&(t._mipMaps[i][n].dispose(),t._mipMaps[i][n]=null)},t._mipMaps=[],t._mipMapUses=[],t._matrix=new n,t._rect=new r,t}();e.MipmapGenerator=s}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=t.base.BitmapData,n=t.base.BitmapDataChannel,r=t.geom.Point,s=function(t){function e(e,n,r){"undefined"==typeof e&&(e=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=!0);var s=e?e:n;s=s?new i(s.width,s.height,!1,16777215):new i(1,1,!1,16777215),t.call(this,s,r),this.specularMap=e,this.glossMap=n}return __extends(e,t),Object.defineProperty(e.prototype,"specularMap",{get:function(){return this._specularMap},set:function(t){this._specularMap=t,this.invalidateContent(),this._testSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glossMap",{get:function(){return this._glossMap},set:function(t){this._glossMap=t,this.invalidateContent(),this._testSize()},enumerable:!0,configurable:!0}),e.prototype._testSize=function(){var t,e;if(this._specularMap?(t=this._specularMap.width,e=this._specularMap.height):this._glossMap?(t=this._glossMap.width,e=this._glossMap.height):(t=1,e=1),t!=this._bitmapData.width&&e!=this._bitmapData.height){var n=this._bitmapData;this.bitmapData=new i(this._specularMap.width,this._specularMap.height,!1,16777215),n.dispose()}},e.prototype._iGetTextureData=function(){var t=this._specularMap.rect,e=new r;return this._bitmapData.fillRect(t,16777215),this._glossMap&&this._bitmapData.copyChannel(this._glossMap,t,e,n.GREEN,n.GREEN),this._specularMap&&this._bitmapData.copyChannel(this._specularMap,t,e,n.RED,n.RED),this._bitmapData},e}(e.BitmapTexture);e.SpecularBitmapTexture=s}(t.textures||(t.textures={})),t.textures}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=t.events.AssetEvent,r=t.events.ParserEvent,s=t.events.TimerEvent,a=t.utils.TextureUtils,o=t.utils.Timer,h=function(h){function p(e){h.call(this),this._materialMode=0,this._dataFormat=e,this._dependencies=new Array,this._pOnIntervalDelegate=t.utils.Delegate.create(this,this._pOnInterval)}return __extends(p,h),p.supportsType=function(){throw new i},Object.defineProperty(p.prototype,"content",{get:function(){return this._pContent},enumerable:!0,configurable:!0}),p.prototype.isBitmapDataValid=function(t){var e=a.isBitmapDataValid(t);return e||console.log(">> Bitmap loaded is not having power of 2 dimensions or is higher than 2048"),e},Object.defineProperty(p.prototype,"parsingFailure",{get:function(){return this._parsingFailure},set:function(t){this._parsingFailure=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"parsingPaused",{get:function(){return this._parsingPaused},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"parsingComplete",{get:function(){return this._parsingComplete},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"materialMode",{get:function(){return this._materialMode},set:function(t){this._materialMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"dataFormat",{get:function(){return this._dataFormat},enumerable:!0,configurable:!0}),p.prototype.parseAsync=function(t,e){"undefined"==typeof e&&(e=30),this._data=t,this._pStartParsing(e)},Object.defineProperty(p.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:!0,configurable:!0}),p.prototype._iResolveDependency=function(){throw new i},p.prototype._iResolveDependencyFailure=function(){throw new i},p.prototype._iResolveDependencyName=function(t,e){return e.name},p.prototype._iResumeParsingAfterDependencies=function(){this._parsingPaused=!1,this._timer&&this._timer.start()},p.prototype._pFinalizeAsset=function(t,e){"undefined"==typeof e&&(e=null),null!=e&&(t.name=e),t.name||(t.name=t.assetType),this.dispatchEvent(new n(n.ASSET_COMPLETE,t))},p.prototype._pProceedParsing=function(){throw new i},p.prototype._pDieWithError=function(t){"undefined"==typeof t&&(t="Unknown parsing error"),this._timer&&(this._timer.removeEventListener(s.TIMER,this._pOnIntervalDelegate),this._timer.stop(),this._timer=null),this.dispatchEvent(new r(r.PARSE_ERROR,t))},p.prototype._pAddDependency=function(t,i,n,r,s){"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=!1);var a=new e.ResourceDependency(t,i,r,null,this,n,s);return this._dependencies.push(a),a},p.prototype._pPauseAndRetrieveDependencies=function(){this._timer&&this._timer.stop(),this._parsingPaused=!0,this.dispatchEvent(new r(r.READY_FOR_DEPENDENCIES))},p.prototype._pHasTime=function(){return t.utils.getTimer()-this._lastFrameTime<this._frameLimit},p.prototype._pOnInterval=function(e){"undefined"==typeof e&&(e=null),this._lastFrameTime=t.utils.getTimer(),this._pProceedParsing()&&!this._parsingFailure&&this._pFinishParsing()},p.prototype._pStartParsing=function(t){this._frameLimit=t,this._timer=new o(this._frameLimit,0),this._timer.addEventListener(s.TIMER,this._pOnIntervalDelegate),this._timer.start()},p.prototype._pFinishParsing=function(){this._timer&&(this._timer.removeEventListener(s.TIMER,this._pOnIntervalDelegate),this._timer.stop()),this._timer=null,this._parsingComplete=!0,this.dispatchEvent(new r(r.PARSE_COMPLETE))},p.prototype._pGetTextData=function(){return e.ParserUtils.toString(this._data)},p.prototype._pGetByteData=function(){return e.ParserUtils.toByteArray(this._data)},p.PARSING_DONE=!0,p.MORE_TO_PARSE=!1,p}(t.events.EventDispatcher);e.ParserBase=h}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(e){var i=t.textures.ImageCubeTexture,n=function(n){function r(){n.call(this,t.net.URLLoaderDataFormat.TEXT)}return __extends(r,n),r.supportsType=function(t){return t=t.toLowerCase(),"cube"==t},r.supportsData=function(t){try{var e=JSON.parse(t);return e?!0:!1}catch(i){return!1}return!1},r.prototype._iResolveDependency=function(){},r.prototype._iResolveDependencyFailure=function(){},r.prototype._pProceedParsing=function(){if(null!=this._imgDependencyDictionary){var n=new i(this._getHTMLImageElement(r.posX),this._getHTMLImageElement(r.negX),this._getHTMLImageElement(r.posY),this._getHTMLImageElement(r.negY),this._getHTMLImageElement(r.posZ),this._getHTMLImageElement(r.negZ));return this._imgDependencyDictionary=null,n.name=this._iFileName,this._pFinalizeAsset(n,this._iFileName),e.ParserBase.PARSING_DONE}try{var s,a=JSON.parse(this.data),o=a.data;if(6!=o.length&&this._pDieWithError("CubeTextureParser: Error - cube texture should have exactly 6 images"),a){this._imgDependencyDictionary=new Object;for(var h=0;h<o.length;h++)s=o[h],this._imgDependencyDictionary[s.id]=this._pAddDependency(s.id,new t.net.URLRequest(s.image.toString()));return this._validateCubeData()?(this._pPauseAndRetrieveDependencies(),e.ParserBase.MORE_TO_PARSE):(this._pDieWithError("CubeTextureParser: JSON data error - cubes require id of:   \n"+r.posX+", "+r.negX+",  \n"+r.posY+", "+r.negY+",  \n"+r.posZ+", "+r.negZ),e.ParserBase.PARSING_DONE)}}catch(p){this._pDieWithError("CubeTexturePaser Error parsing JSON")}return e.ParserBase.PARSING_DONE},r.prototype._validateCubeData=function(){return null!=this._imgDependencyDictionary[r.posX]&&null!=this._imgDependencyDictionary[r.negX]&&null!=this._imgDependencyDictionary[r.posY]&&null!=this._imgDependencyDictionary[r.negY]&&null!=this._imgDependencyDictionary[r.posZ]&&null!=this._imgDependencyDictionary[r.negZ]},r.prototype._getHTMLImageElement=function(t){var e=this._imgDependencyDictionary[t];return e?e.assets[0].htmlImageElement:null},r.posX="posX",r.negX="negX",r.posY="posY",r.negY="negY",r.posZ="posZ",r.negZ="negZ",r}(e.ParserBase);e.CubeTextureParser=n}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(e){var i=t.net.URLLoaderDataFormat,n=t.textures.ImageTexture,r=t.utils.ByteArray,s=t.utils.TextureUtils,a=function(a){function o(){a.call(this,i.ARRAY_BUFFER)}return __extends(o,a),o.supportsType=function(t){return t=t.toLowerCase(),"jpg"==t||"jpeg"==t||"png"==t||"gif"==t},o.supportsData=function(t){if(t instanceof HTMLImageElement)return!0;if(!(t instanceof r))return!1;var e=t;return e.position=0,65496==e.readUnsignedShort()?!0:(e.position=0,16973==e.readShort()?!0:(e.position=1,"PNG"==e.readUTFBytes(3)?!0:(e.position=0,"GIF"==e.readUTFBytes(3)&&14393==e.readShort()&&97==e.readByte()?!0:(e.position=0,"ATF"==e.readUTFBytes(3)?!0:!1))))},o.prototype._pProceedParsing=function(){var i,a=this,o=!1;if(this._loadingImage)return e.ParserBase.MORE_TO_PARSE;if(this._htmlImageElement)s.isHTMLImageElementValid(this._htmlImageElement)&&(i=new n(this._htmlImageElement),this._pFinalizeAsset(i,this._iFileName));else if(this.data instanceof HTMLImageElement)s.isHTMLImageElementValid(this.data)?(i=new n(this.data),this._pFinalizeAsset(i,this._iFileName)):o=!0;else if(this.data instanceof r){var h=this.data;h.position=0;var p=e.ParserUtils.byteArrayToImage(this.data);s.isHTMLImageElementValid(p)?(i=new n(p),this._pFinalizeAsset(i,this._iFileName)):o=!0}else if(this.data instanceof ArrayBuffer)this._htmlImageElement=e.ParserUtils.arrayBufferToImage(this.data),i=new n(this._htmlImageElement),this._pFinalizeAsset(i,this._iFileName);else if(this.data instanceof Blob)return this._htmlImageElement=e.ParserUtils.blobToImage(this.data),this._htmlImageElement.onload=function(t){return a.onLoadComplete(t)},this._loadingImage=!0,e.ParserBase.MORE_TO_PARSE;return this._pContent=new t.entities.Billboard(new t.materials.CSSMaterialBase(i)),e.ParserBase.PARSING_DONE},o.prototype.onLoadComplete=function(){this._loadingImage=!1},o}(e.ParserBase);e.Texture2DParser=a}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.BINARY="binary",t.PLAIN_TEXT="plainText",t.IMAGE="image",t}();t.ParserDataFormat=e}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(e){var i=t.utils.ByteArray,n=function(){function t(){}return t.arrayBufferToImage=function(t){for(var e="",i=new Uint8Array(t),n=i.byteLength,r=0;n>r;r++)e+=String.fromCharCode(i[r]);var s=window.btoa(e),a="data:image/png;base64,"+s,o=new Image;return o.src=a,o},t.byteArrayToImage=function(t){for(var e="",i=new Uint8Array(t.arraybytes),n=i.byteLength,r=0;n>r;r++)e+=String.fromCharCode(i[r]);var s=window.btoa(e),a="data:image/png;base64,"+s,o=new Image;return o.src=a,o},t.blobToImage=function(t){var e=window.URL||window.webkitURL,i=e.createObjectURL(t),n=new Image;return n.src=i,n},t.toByteArray=function(t){var e=new i;return e.setArrayBuffer(t),e},t.toString=function(t,e){if("undefined"==typeof e&&(e=0),"string"==typeof t){var n=t;if(null!=n.substr)return n.substr(0,n.length)}if(t instanceof i){var r=t;return r.position=0,r.readUTFBytes(Math.min(r.getBytesAvailable(),e))}return null},t}();e.ParserUtils=n}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i,n,r,s,a){"undefined"==typeof s&&(s=!1),"undefined"==typeof a&&(a=!1),this._id=t,this._request=e,this._data=i,this._parser=n,this._parentParser=r,this._retrieveAsRawData=s,this._suppressAssetEvents=a,this._assets=new Array,this._dependencies=new Array}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parser",{get:function(){return this._parser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentParser",{get:function(){return this._parentParser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retrieveAsRawData",{get:function(){return this._retrieveAsRawData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suppresAssetEvents",{get:function(){return this._suppressAssetEvents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:!0,configurable:!0}),t.prototype._iSetData=function(t){this._data=t},t.prototype._iSetParser=function(t){this._parser=t},t.prototype.resolve=function(){this._parentParser&&this._parentParser._iResolveDependency(this)},t.prototype.resolveFailure=function(){this._parentParser&&this._parentParser._iResolveDependencyFailure(this)},t.prototype.resolveName=function(t){return this._parentParser?this._parentParser._iResolveDependencyName(this,t):t.name},t}();t.ResourceDependency=e}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(e,i){"undefined"==typeof e&&(e=!0),"undefined"==typeof i&&(i=null),this._includeDependencies=e,this._dependencyBaseUrl=i||"",this._embeddedDataByUrl={},this._remappedUrls={},this._materialMode=t.UNDEFINED}return Object.defineProperty(t.prototype,"includeDependencies",{get:function(){return this._includeDependencies},set:function(t){this._includeDependencies=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"materialMode",{get:function(){return this._materialMode},set:function(t){this._materialMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dependencyBaseUrl",{get:function(){return this._dependencyBaseUrl},set:function(t){this._dependencyBaseUrl=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"overrideAbsolutePaths",{get:function(){return this._overrideAbsPath},set:function(t){this._overrideAbsPath=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"overrideFullURLs",{get:function(){return this._overrideFullUrls},set:function(t){this._overrideFullUrls=t},enumerable:!0,configurable:!0}),t.prototype.mapUrl=function(t,e){this._remappedUrls[t]=e},t.prototype.mapUrlToData=function(t,e){this._embeddedDataByUrl[t]=e},t.prototype._iHasDataForUrl=function(t){return this._embeddedDataByUrl.hasOwnProperty(t)},t.prototype._iGetDataForUrl=function(t){return this._embeddedDataByUrl[t]},t.prototype._iHasMappingForUrl=function(t){return this._remappedUrls.hasOwnProperty(t)},t.prototype._iGetRemappedUrl=function(t){return this._remappedUrls[t]},t.UNDEFINED=0,t.SINGLEPASS_MATERIALS=1,t.MULTIPASS_MATERIALS=2,t}();t.AssetLoaderContext=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(e){var i=t.net.URLLoader,n=t.net.URLLoaderDataFormat,r=t.parsers.CubeTextureParser,s=t.parsers.ResourceDependency,a=t.parsers.Texture2DParser,o=function(o){function h(e){"undefined"==typeof e&&(e=0),o.call(this),this._materialMode=e,this._stack=new Array,this._errorHandlers=new Array,this._parseErrorHandlers=new Array,this._onReadyForDependenciesDelegate=t.utils.Delegate.create(this,this.onReadyForDependencies),this._onParseCompleteDelegate=t.utils.Delegate.create(this,this.onParseComplete),this._onParseErrorDelegate=t.utils.Delegate.create(this,this.onParseError),this._onLoadCompleteDelegate=t.utils.Delegate.create(this,this.onLoadComplete),this._onLoadErrorDelegate=t.utils.Delegate.create(this,this.onLoadError),this._onTextureSizeErrorDelegate=t.utils.Delegate.create(this,this.onTextureSizeError),this._onAssetCompleteDelegate=t.utils.Delegate.create(this,this.onAssetComplete)}return __extends(h,o),h.enableParser=function(t){h._parsers.indexOf(t)<0&&h._parsers.push(t)},h.enableParsers=function(t){for(var e=0;e<t.length;e++)h.enableParser(t[e])},Object.defineProperty(h.prototype,"baseDependency",{get:function(){return this._baseDependency},enumerable:!0,configurable:!0}),h.prototype.load=function(t,i,n,r){return"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),this._token?null:(this._token=new e.AssetLoaderToken(this),this._uri=t.url=t.url.replace(/\\/g,"/"),this._context=i,this._namespace=n,this._baseDependency=new s("",t,null,r,null),this.retrieveDependency(this._baseDependency),this._token)},h.prototype.loadData=function(t,i,n,r,a){return"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof a&&(a=null),this._token?null:(this._token=new e.AssetLoaderToken(this),this._uri=i,this._context=n,this._namespace=r,this._baseDependency=new s(i,null,t,a,null),this.retrieveDependency(this._baseDependency),this._token)},h.prototype.retrieveNext=function(e){if("undefined"==typeof e&&(e=null),this._currentDependency.dependencies.length){var i=this._currentDependency.dependencies.pop();this._stack.push(this._currentDependency),this.retrieveDependency(i)}else if(this._currentDependency.parser&&this._currentDependency.parser.parsingPaused)this._currentDependency.parser._iResumeParsingAfterDependencies(),this._stack.pop();else if(this._stack.length){var n=this._currentDependency;this._currentDependency=this._stack.pop(),n._iSuccess&&n.resolve(),this.retrieveNext(e)}else this.dispatchEvent(new t.events.LoaderEvent(t.events.LoaderEvent.RESOURCE_COMPLETE,this._uri,this._baseDependency.parser.content,this._baseDependency.assets))},h.prototype.retrieveDependency=function(t){var e;this._context&&0!=this._context.materialMode&&(this._materialMode=this._context.materialMode),this._currentDependency=t,t._iLoader=new i,this.addEventListeners(t._iLoader),e=t.data,this._context&&t.request&&this._context._iHasDataForUrl(t.request.url)&&(e=this._context._iGetDataForUrl(t.request.url)),e?(e.constructor===Function&&(e=new e),t._iSetData(e),t.retrieveAsRawData?(t.resolve(),this.retrieveNext()):this.parseDependency(t)):(t.request.url=this.resolveDependencyUrl(t),t.retrieveAsRawData?t._iLoader.dataFormat=n.BINARY:(t.parser||t._iSetParser(this.getParserFromSuffix(t.request.url)),t._iLoader.dataFormat=t.parser?t.parser.dataFormat:n.BINARY),t._iLoader.load(t.request))},h.prototype.joinUrl=function(t,e){return"/"==e.charAt(0)&&(e=e.substr(1)),0==t.length?e:("/"==t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),t.concat("/",e))},h.prototype.resolveDependencyUrl=function(t){var e,i,n=t.request.url;if(this._context&&this._context._iHasMappingForUrl(n))return this._context._iGetRemappedUrl(n);if(n==this._uri)return n;if(e=new RegExp("/^[a-zA-Z]{3,4}:///"),"/"==n.charAt(0))return this._context&&this._context.overrideAbsolutePaths?this.joinUrl(this._context.dependencyBaseUrl,n):n;if(e.test(n)&&this._context&&this._context.overrideFullURLs){var r=n.replace(e,"");return this.joinUrl(this._context.dependencyBaseUrl,r)}return this._context&&this._context.dependencyBaseUrl?(i=this._context.dependencyBaseUrl,this.joinUrl(i,n)):(i=this._uri.substring(0,this._uri.lastIndexOf("/")+1),this.joinUrl(i,n))},h.prototype.retrieveParserDependencies=function(){if(this._currentDependency){var t,e=this._currentDependency.parser.dependencies,i=e.length;for(t=0;i>t;t++)this._currentDependency.dependencies[t]=e[t];e.length=0,this._stack.push(this._currentDependency),this.retrieveNext()}},h.prototype.resolveParserDependencies=function(){this._currentDependency._iSuccess=!0,this._currentDependency.parser&&this._currentDependency.parser.dependencies.length&&(!this._context||this._context.includeDependencies)?this.retrieveParserDependencies():this.retrieveNext()},h.prototype.onLoadError=function(e){var i,n=this._currentDependency!=this._baseDependency,r=e.target;if(this.removeEventListeners(r),this.hasEventListener(t.events.IOErrorEvent.IO_ERROR))this.dispatchEvent(e),i=!0;else{var s,a=this._errorHandlers.length;for(s=0;a>s;s++)i||(i=this._errorHandlers[s](e))}if(!i)throw new t.errors.Error;return n?(this._currentDependency.resolveFailure(),void this.retrieveNext()):void this.dispose()},h.prototype.onParseError=function(e){var i,n=(this._currentDependency!=this._baseDependency,e.target);if(this.removeEventListeners(n),this.hasEventListener(t.events.ParserEvent.PARSE_ERROR))this.dispatchEvent(e),i=!0;else{var r,s=this._parseErrorHandlers.length;for(r=0;s>r;r++)i||(i=this._parseErrorHandlers[r](e))}if(i)return void this.dispose();throw new t.errors.Error(e.message)},h.prototype.onAssetComplete=function(t){this._currentDependency&&this._currentDependency.assets.push(t.asset),t.asset.resetAssetPath(t.asset.name,this._namespace),this._currentDependency.suppresAssetEvents||this.dispatchEvent(t)},h.prototype.onReadyForDependencies=function(t){var e=t.target;this._context&&!this._context.includeDependencies?e._iResumeParsingAfterDependencies():this.retrieveParserDependencies()},h.prototype.onLoadComplete=function(t){var e=t.target;this.removeEventListeners(e),this._currentDependency._iSetData(e.data),this._currentDependency.retrieveAsRawData?this.resolveParserDependencies():this.parseDependency(this._currentDependency)},h.prototype.onParseComplete=function(e){var i=e.target;this.resolveParserDependencies(),i.removeEventListener(t.events.ParserEvent.READY_FOR_DEPENDENCIES,this._onReadyForDependenciesDelegate),i.removeEventListener(t.events.ParserEvent.PARSE_COMPLETE,this._onParseCompleteDelegate),i.removeEventListener(t.events.ParserEvent.PARSE_ERROR,this._onParseErrorDelegate),i.removeEventListener(t.events.AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),i.removeEventListener(t.events.AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate)},h.prototype.onTextureSizeError=function(t){t.asset.name=this._currentDependency.resolveName(t.asset),this.dispatchEvent(t)},h.prototype.addEventListeners=function(e){e.addEventListener(t.events.Event.COMPLETE,this._onLoadCompleteDelegate),e.addEventListener(t.events.IOErrorEvent.IO_ERROR,this._onLoadErrorDelegate)},h.prototype.removeEventListeners=function(e){e.removeEventListener(t.events.Event.COMPLETE,this._onLoadCompleteDelegate),e.removeEventListener(t.events.IOErrorEvent.IO_ERROR,this._onLoadErrorDelegate)},h.prototype.stop=function(){this.dispose()},h.prototype.dispose=function(){this._errorHandlers=null,this._parseErrorHandlers=null,this._context=null,this._token=null,this._stack=null,this._currentDependency&&this._currentDependency._iLoader&&this.removeEventListeners(this._currentDependency._iLoader),this._currentDependency=null},h.prototype._iAddParseErrorHandler=function(t){this._parseErrorHandlers.indexOf(t)<0&&this._parseErrorHandlers.push(t)},h.prototype._iAddErrorHandler=function(t){this._errorHandlers.indexOf(t)<0&&this._errorHandlers.push(t)},h.prototype.getParserFromData=function(t){for(var e=h._parsers.length,i=e-1;i>=0;i--)if(h._parsers[i].supportsData(t))return new h._parsers[i];return null},h.prototype.parseDependency=function(e){var i=e.parser;if(i||e._iSetParser(i=this.getParserFromData(e.data)),i)i.addEventListener(t.events.ParserEvent.READY_FOR_DEPENDENCIES,this._onReadyForDependenciesDelegate),i.addEventListener(t.events.ParserEvent.PARSE_COMPLETE,this._onParseCompleteDelegate),i.addEventListener(t.events.ParserEvent.PARSE_ERROR,this._onParseErrorDelegate),i.addEventListener(t.events.AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),i.addEventListener(t.events.AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),e.request&&e.request.url&&(i._iFileName=e.request.url),i.materialMode=this._materialMode,i.parseAsync(e.data);else{var n="No parser defined. To enable all parsers for auto-detection, use Parsers.enableAllBundled()";if(!this.hasEventListener(t.events.ParserEvent.PARSE_ERROR))throw new Error(n);this.dispatchEvent(new t.events.ParserEvent(t.events.ParserEvent.PARSE_ERROR,n))}},h.prototype.getParserFromSuffix=function(t){for(var e=t.indexOf("?")>0?t.split("?")[0]:t,i=e.substr(e.lastIndexOf(".")+1).toLowerCase(),n=h._parsers.length,r=n-1;r>=0;r--){var s=h._parsers[r];if(s.supportsType(i))return new s}return null},h._parsers=new Array(a,r),h}(t.events.EventDispatcher);e.AssetLoader=o}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){t.call(this),this._iLoader=e}return __extends(e,t),e.prototype.addEventListener=function(t,e){this._iLoader.addEventListener(t,e)},e.prototype.removeEventListener=function(t,e){this._iLoader.removeEventListener(t,e)},e.prototype.hasEventListener=function(t,e){return"undefined"==typeof e&&(e=null),this._iLoader.hasEventListener(t,e)
},e}(t.events.EventDispatcher);e.AssetLoaderToken=i}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.createUID=function(){var e,i,n=new Array(36),r=0;for(e=0;8>e;e++)n[r++]=t.ALPHA_CHAR_CODES[Math.floor(16*Math.random())];for(e=0;3>e;e++)for(n[r++]=45,i=0;4>i;i++)n[r++]=t.ALPHA_CHAR_CODES[Math.floor(16*Math.random())];n[r++]=45;var s=(new Date).getTime(),a=("0000000"+s.toString(16).toUpperCase()).substr(-8);for(e=0;8>e;e++)n[r++]=a.charCodeAt(e);for(e=0;4>e;e++)n[r++]=t.ALPHA_CHAR_CODES[Math.floor(16*Math.random())];return String.fromCharCode.apply(null,n)},t.ALPHA_CHAR_CODES=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],t}();t.IDUtil=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i,n){this._assets=t,this.filter(e,i,n)}return Object.defineProperty(t.prototype,"currentAsset",{get:function(){return this._idx<this._filtered.length?this._filtered[this._idx]:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numAssets",{get:function(){return this._filtered.length},enumerable:!0,configurable:!0}),t.prototype.next=function(){var t=null;return this._idx<this._filtered.length&&(t=this._filtered[this._idx]),this._idx++,t},t.prototype.reset=function(){this._idx=0},t.prototype.setIndex=function(t){this._idx=t},t.prototype.filter=function(t,e,i){if(t||e){var n,r;n=0,this._filtered=new Array;for(var s=this._assets.length,a=0;s>a;a++)r=this._assets[a],t&&r.assetType!=t||e&&r.assetNamespace!=e||(null==i||i(r))&&(this._filtered[n++]=r)}else this._filtered=this._assets},t}();t.AssetLibraryIterator=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=function(){function n(){}return n.prototype.resolveConflict=function(){throw new i},n.prototype.create=function(){throw new i},n.prototype._pUpdateNames=function(i,n,r,s,a,o){var h,p,u;p=o===e.ConflictPrecedence.FAVOR_NEW?s:r,u=o===e.ConflictPrecedence.FAVOR_NEW?r:s,h=u.name,a[p.name]=p,a[n]=u,u.resetAssetPath(n,i,!1),u.dispatchEvent(new t.events.AssetEvent(t.events.AssetEvent.ASSET_CONFLICT_RESOLVED,u,h))},n}();e.ConflictStrategyBase=n}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e="."),t.call(this),this._separator=e,this._next_suffix={}}return __extends(e,t),e.prototype.resolveConflict=function(t,e,i,n){var r,s,a,o;r=t.name,r.indexOf(this._separator)>=0?(a=r.substring(0,r.lastIndexOf(this._separator)),o=parseInt(r.substring(a.length-1)),isNaN(o)&&(a=r,o=0)):(a=r,o=0),0==o&&this._next_suffix.hasOwnProperty(a)&&(o=this._next_suffix[a]);do o++,s=a.concat(this._separator,o.toString());while(i.hasOwnProperty(s));this._next_suffix[a]=o,this._pUpdateNames(e.assetNamespace,s,e,t,i,n)},e.prototype.create=function(){return new e(this._separator)},e}(t.ConflictStrategyBase);t.NumSuffixConflictStrategy=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.resolveConflict=function(){},e.prototype.create=function(){return new e},e}(t.ConflictStrategyBase);t.IgnoreConflictStrategy=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.resolveConflict=function(e){throw new t.errors.Error("Asset name collision while AssetLibrary.namingStrategy set to AssetLibrary.THROW_ERROR. Asset path: "+e.assetFullPath)},i.prototype.create=function(){return new i},i}(e.ConflictStrategyBase);e.ErrorConflictStrategy=i}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.FAVOR_OLD="favorOld",t.FAVOR_NEW="favorNew",t}();t.ConflictPrecedence=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(){}return e.APPEND_NUM_SUFFIX=new t.NumSuffixConflictStrategy,e.IGNORE=new t.IgnoreConflictStrategy,e.THROW_ERROR=new t.ErrorConflictStrategy,e}();t.ConflictStrategy=e}(t.library||(t.library={})),t.library}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(){i.call(this),this._loadingSessionsGarbage=new Array,this._assets=new Array,this._assetDictionary=new Object,this._loadingSessions=new Array,this.conflictStrategy=e.ConflictStrategy.IGNORE.create(),this.conflictPrecedence=e.ConflictPrecedence.FAVOR_NEW,this._onAssetRenameDelegate=t.utils.Delegate.create(this,this.onAssetRename),this._onAssetConflictResolvedDelegate=t.utils.Delegate.create(this,this.onAssetConflictResolved),this._onResourceCompleteDelegate=t.utils.Delegate.create(this,this.onResourceComplete),this._onTextureSizeErrorDelegate=t.utils.Delegate.create(this,this.onTextureSizeError),this._onAssetCompleteDelegate=t.utils.Delegate.create(this,this.onAssetComplete),this._onLoadErrorDelegate=t.utils.Delegate.create(this,this.onLoadError),this._onParseErrorDelegate=t.utils.Delegate.create(this,this.onParseError)}return __extends(n,i),n.getInstance=function(t){return"undefined"==typeof t&&(t="default"),t||(t="default"),e.AssetLibrary._iInstances.hasOwnProperty(t)||(e.AssetLibrary._iInstances[t]=new n(new AssetLibraryBundleSingletonEnforcer)),e.AssetLibrary._iInstances[t]},n.prototype.enableParser=function(t){e.AssetLoader.enableParser(t)},n.prototype.enableParsers=function(t){e.AssetLoader.enableParsers(t)},Object.defineProperty(n.prototype,"conflictStrategy",{get:function(){return this._strategy},set:function(e){if(!e)throw new t.errors.Error("namingStrategy must not be null. To ignore naming, use AssetLibrary.IGNORE");this._strategy=e.create()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"conflictPrecedence",{get:function(){return this._strategyPreference},set:function(t){this._strategyPreference=t},enumerable:!0,configurable:!0}),n.prototype.createIterator=function(t,i,n){return"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),new e.AssetLibraryIterator(this._assets,t,i,n)},n.prototype.load=function(i,n,r,s){"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=null);var a=new e.AssetLoader;return this._loadingSessions||(this._loadingSessions=new Array),this._loadingSessions.push(a),a.addEventListener(t.events.LoaderEvent.RESOURCE_COMPLETE,this._onResourceCompleteDelegate),a.addEventListener(t.events.AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),a.addEventListener(t.events.AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),a._iAddErrorHandler(this._onLoadErrorDelegate),a._iAddParseErrorHandler(this._onParseErrorDelegate),a.load(i,n,r,s)},n.prototype.loadData=function(i,n,r,s){"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=null);var a=new e.AssetLoader;return this._loadingSessions||(this._loadingSessions=new Array),this._loadingSessions.push(a),a.addEventListener(t.events.LoaderEvent.RESOURCE_COMPLETE,this._onResourceCompleteDelegate),a.addEventListener(t.events.AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),a.addEventListener(t.events.AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),a._iAddErrorHandler(this._onLoadErrorDelegate),a._iAddParseErrorHandler(this._onParseErrorDelegate),a.loadData(i,"",n,r,s)},n.prototype.getAsset=function(t,i){return"undefined"==typeof i&&(i=null),this._assetDictDirty&&this.rehashAssetDict(),null==i&&(i=e.NamedAssetBase.DEFAULT_NAMESPACE),this._assetDictionary.hasOwnProperty(i)?this._assetDictionary[i][t]:null},n.prototype.addAsset=function(i){var n,r;this._assets.indexOf(i)>=0||(r=this.getAsset(i.name,i.assetNamespace),n=i.assetNamespace||e.NamedAssetBase.DEFAULT_NAMESPACE,null!=r&&this._strategy.resolveConflict(i,r,this._assetDictionary[n],this._strategyPreference),this._assets.push(i),this._assetDictionary.hasOwnProperty(n)||(this._assetDictionary[n]=new Object),this._assetDictionary[n][i.name]=i,i.addEventListener(t.events.AssetEvent.ASSET_RENAME,this._onAssetRenameDelegate),i.addEventListener(t.events.AssetEvent.ASSET_CONFLICT_RESOLVED,this._onAssetConflictResolvedDelegate))},n.prototype.removeAsset=function(e,i){"undefined"==typeof i&&(i=!0);var n;this.removeAssetFromDict(e),e.removeEventListener(t.events.AssetEvent.ASSET_RENAME,this._onAssetRenameDelegate),e.removeEventListener(t.events.AssetEvent.ASSET_CONFLICT_RESOLVED,this._onAssetConflictResolvedDelegate),n=this._assets.indexOf(e),n>=0&&this._assets.splice(n,1),i&&e.dispose()},n.prototype.removeAssetByName=function(t,e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!0);var n=this.getAsset(t,e);return n&&this.removeAsset(n,i),n},n.prototype.removeAllAssets=function(t){if("undefined"==typeof t&&(t=!0),t)for(var e,i=0;i<this._assets.length;i++)e=this._assets[i],e.dispose();this._assets.length=0,this.rehashAssetDict()},n.prototype.removeNamespaceAssets=function(t,i){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=!0);var n,r,s=0;r=this._assets.concat(),this._assets.length=0,null==t&&(t=e.NamedAssetBase.DEFAULT_NAMESPACE);for(var a=0;a<r.length;a++)n=r[a],n.assetNamespace==t?(i&&n.dispose(),this.removeAssetFromDict(n,!1)):this._assets[s++]=n;this._assetDictionary.hasOwnProperty(t)&&delete this._assetDictionary[t]},n.prototype.removeAssetFromDict=function(t,e){if("undefined"==typeof e&&(e=!0),this._assetDictDirty&&this.rehashAssetDict(),this._assetDictionary.hasOwnProperty(t.assetNamespace)&&(this._assetDictionary[t.assetNamespace].hasOwnProperty(t.name)&&delete this._assetDictionary[t.assetNamespace][t.name],e)){var i,n=!0;for(i in this._assetDictionary[t.assetNamespace]){n=!1;break}n&&delete this._assetDictionary[t.assetNamespace]}},n.prototype.stopAllLoadingSessions=function(){var t;this._loadingSessions||(this._loadingSessions=new Array);var e=this._loadingSessions.length;for(t=0;e>t;t++)this.killLoadingSession(this._loadingSessions[t]);this._loadingSessions=null},n.prototype.rehashAssetDict=function(){var t;this._assetDictionary={};for(var e=this._assets.length,i=0;e>i;i++)t=this._assets[i],this._assetDictionary.hasOwnProperty(t.assetNamespace)||(this._assetDictionary[t.assetNamespace]={}),this._assetDictionary[t.assetNamespace][t.name]=t;this._assetDictDirty=!1},n.prototype.onLoadError=function(e){return this.hasEventListener(t.events.IOErrorEvent.IO_ERROR)?(this.dispatchEvent(e),!0):!1},n.prototype.onParseError=function(e){return this.hasEventListener(t.events.ParserEvent.PARSE_ERROR)?(this.dispatchEvent(e),!0):!1},n.prototype.onAssetComplete=function(e){e.type==t.events.AssetEvent.ASSET_COMPLETE&&this.addAsset(e.asset),this.dispatchEvent(e)},n.prototype.onTextureSizeError=function(t){this.dispatchEvent(t)},n.prototype.onResourceComplete=function(t){var e=this,i=t.target;this.dispatchEvent(t);var n=this._loadingSessions.indexOf(i);this._loadingSessions.splice(n,1),this._loadingSessionsGarbage.push(i),this._gcTimeoutIID=setTimeout(function(){e.loadingSessionGC()},100)},n.prototype.loadingSessionGC=function(){for(var t;this._loadingSessionsGarbage.length>0;)t=this._loadingSessionsGarbage.pop(),this.killLoadingSession(t);clearTimeout(this._gcTimeoutIID),this._gcTimeoutIID=null},n.prototype.killLoadingSession=function(e){e.removeEventListener(t.events.LoaderEvent.RESOURCE_COMPLETE,this._onResourceCompleteDelegate),e.removeEventListener(t.events.AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),e.removeEventListener(t.events.AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),e.stop()},n.prototype.onAssetRename=function(t){var e=t.target,i=this.getAsset(e.assetNamespace,e.name);if(null!=i)this._strategy.resolveConflict(e,i,this._assetDictionary[e.assetNamespace],this._strategyPreference);else{var n=this._assetDictionary[t.asset.assetNamespace];if(null==n)return;n[t.assetPrevName]=null,n[t.asset.name]=t.asset}},n.prototype.onAssetConflictResolved=function(t){this.dispatchEvent(t.clone())},n}(t.events.EventDispatcher);e.AssetLibraryBundle=i}(t.library||(t.library={})),t.library}(away||(away={}));var AssetLibraryBundleSingletonEnforcer=function(){function t(){}return t}(),away;!function(t){!function(t){var e=function(){function e(t){t=t}return e.getBundle=function(e){return"undefined"==typeof e&&(e="default"),t.AssetLibraryBundle.getInstance(e)},e.enableParser=function(e){t.AssetLoader.enableParser(e)},e.enableParsers=function(e){t.AssetLoader.enableParsers(e)},Object.defineProperty(e,"conflictStrategy",{get:function(){return e.getBundle().conflictStrategy},set:function(t){e.getBundle().conflictStrategy=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"conflictPrecedence",{get:function(){return e.getBundle().conflictPrecedence},set:function(t){e.getBundle().conflictPrecedence=t},enumerable:!0,configurable:!0}),e.createIterator=function(t,i,n){return"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),e.getBundle().createIterator(t,i,n)},e.load=function(t,i,n,r){return"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),e.getBundle().load(t,i,n,r)},e.loadData=function(t,i,n,r){return"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),e.getBundle().loadData(t,i,n,r)},e.stopLoad=function(){e.getBundle().stopAllLoadingSessions()},e.getAsset=function(t,i){return"undefined"==typeof i&&(i=null),e.getBundle().getAsset(t,i)},e.addEventListener=function(t,i){e.getBundle().addEventListener(t,i)},e.removeEventListener=function(t,i){e.getBundle().removeEventListener(t,i)},e.addAsset=function(t){e.getBundle().addAsset(t)},e.removeAsset=function(t,i){"undefined"==typeof i&&(i=!0),e.getBundle().removeAsset(t,i)},e.removeAssetByName=function(t,i,n){return"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=!0),e.getBundle().removeAssetByName(t,i,n)},e.removeAllAssets=function(t){"undefined"==typeof t&&(t=!0),e.getBundle().removeAllAssets(t)},e.removeNamespaceAssets=function(t,i){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=!0),e.getBundle().removeNamespaceAssets(t,i)},e._iInstances={},e}();t.AssetLibrary=e}(t.library||(t.library={})),t.library}(away||(away={}));var AssetLibrarySingletonEnforcer=function(){function t(){}return t}(),away;!function(t){!function(t){var e=function(){function t(){}return t}();t.EntityListItem=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(){this._index=0,this._poolSize=0,this._pool=[]}return e.prototype.getItem=function(){var e;return this._index==this._poolSize?(e=new t.EntityListItem,this._pool[this._index++]=e,++this._poolSize):e=this._pool[this._index++],e},e.prototype.freeAll=function(){this._index=0},e.prototype.dispose=function(){this._pool.length=0},e}();t.EntityListItemPool=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){this._pool=new Object,this._renderableClass=t}return t.prototype.getItem=function(t){return this._pool[t.id]||(this._pool[t.id]=t._iAddRenderable(new this._renderableClass(this,t)))},t.prototype.disposeItem=function(t){t._iRemoveRenderable(this._pool[t.id]),this._pool[t.id]=null},t.getPool=function(e){var i=t._pools[e.id];return void 0!=i?i:t._pools[e.id]=new t(e)},t.disposePool=function(e){t._pools[e.id]&&(t._pools[e.id]=void 0)},t._pools=new Object,t}();t.RenderablePool=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i){this._pool=t,this.sourceEntity=e,this.materialOwner=i}return t.prototype.dispose=function(){this._pool.disposeItem(this.materialOwner)},t.prototype.invalidateGeometry=function(){},t.prototype.invalidateIndexData=function(){},t.prototype.invalidateVertexData=function(){},t}();t.CSSRenderableBase=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){t.call(this,e,i,i);var n=document.createElement("div");n.onmousedown=function(){return!1},this.htmlElement=n;var r=n.style;r.position="absolute",r.transformOrigin=r["-webkit-transform-origin"]=r["-moz-transform-origin"]=r["-o-transform-origin"]=r["-ms-transform-origin"]="0% 0%";var s=document.createElement("div");n.appendChild(s),s.className="material"+i.material.id}return __extends(e,t),e.id="billboard",e}(t.CSSRenderableBase);t.CSSBillboardRenderable=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){t.call(this,e,i,i);var n=document.createElement("div");n.onmousedown=function(){return!1},this.htmlElement=n;var r=n.style;r.position="absolute",r.transformOrigin=r["-webkit-transform-origin"]=r["-moz-transform-origin"]=r["-o-transform-origin"]=r["-ms-transform-origin"]="0% 0%";var s=document.createElement("div");n.appendChild(s),s.className="material"+i.material.id}return __extends(e,t),e.id="lineSegment",e}(t.CSSRenderableBase);t.CSSLineSegmentRenderable=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){t.call(this,e,i,i);var n=document.createElement("div");n.onmousedown=function(){return!1},this.htmlElement=n;var r,s=n.style;s.position="absolute",s.transformOrigin=s["-webkit-transform-origin"]=s["-moz-transform-origin"]=s["-o-transform-origin"]=s["-ms-transform-origin"]="0% 0%",r=document.createElement("div"),n.appendChild(r),r.className="material"+i.material.id}return __extends(e,t),e.id="skybox",e}(t.CSSRenderableBase);t.CSSSkyboxRenderable=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.pool.EntityListItemPool,n=function(){function t(){this._numCullPlanes=0,this._pNumEntities=0,this._pNumInteractiveEntities=0,this._pEntityListItemPool=new i}return Object.defineProperty(t.prototype,"camera",{get:function(){return this._pCamera},set:function(t){this._pCamera=t,this._cullPlanes=this._pCamera.frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cullPlanes",{get:function(){return this._customCullPlanes},set:function(t){this._customCullPlanes=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityHead",{get:function(){return this._pEntityHead},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numEntities",{get:function(){return this._pNumEntities},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numInteractiveEntities",{get:function(){return this._pNumInteractiveEntities},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._pNumEntities=this._pNumInteractiveEntities=0,this._cullPlanes=this._customCullPlanes?this._customCullPlanes:this._pCamera?this._pCamera.frustumPlanes:null,this._numCullPlanes=this._cullPlanes?this._cullPlanes.length:0,this._pEntityHead=null,this._pEntityListItemPool.freeAll()},t.prototype.enterNode=function(t){var e=this.scene._iCollectionMark!=t._iCollectionMark&&t.isInFrustum(this._cullPlanes,this._numCullPlanes);return t._iCollectionMark=this.scene._iCollectionMark,e},t.prototype.applyDirectionalLight=function(){},t.prototype.applyEntity=function(t){this._pNumEntities++,t._iIsMouseEnabled()&&this._pNumInteractiveEntities++;var e=this._pEntityListItemPool.getItem();e.entity=t,e.next=this._pEntityHead,this._pEntityHead=e},t.prototype.applyLightProbe=function(){},t.prototype.applyPointLight=function(){},t.prototype.applySkybox=function(){},t}();e.CollectorBase=n}(t.traverse||(t.traverse={})),t.traverse}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this),this._pNumLights=0,this._numDirectionalLights=0,this._numPointLights=0,this._numLightProbes=0,this._pLights=new Array,this._directionalLights=new Array,this._pointLights=new Array,this._lightProbes=new Array}return __extends(e,t),Object.defineProperty(e.prototype,"directionalLights",{get:function(){return this._directionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightProbes",{get:function(){return this._lightProbes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lights",{get:function(){return this._pLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointLights",{get:function(){return this._pointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyBox",{get:function(){return this._pSkybox},enumerable:!0,configurable:!0}),e.prototype.applyDirectionalLight=function(t){this._directionalLights[this._numDirectionalLights++]=t},e.prototype.applyLightProbe=function(t){this._lightProbes[this._numLightProbes++]=t},e.prototype.applyPointLight=function(t){this._pointLights[this._numPointLights++]=t},e.prototype.applySkybox=function(t){this._pSkybox=t},e.prototype.clear=function(){t.prototype.clear.call(this),this._pSkybox=null,this._pNumLights>0&&(this._pLights.length=this._pNumLights=0),this._numDirectionalLights>0&&(this._directionalLights.length=this._numDirectionalLights=0),this._numPointLights>0&&(this._pointLights.length=this._numPointLights=0),this._numLightProbes>0&&(this._lightProbes.length=this._numLightProbes=0)},e}(t.CollectorBase);t.EntityCollector=e}(t.traverse||(t.traverse={})),t.traverse}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=function(t){function e(){t.call(this),this._rayPosition=new i,this._rayDirection=new i,this._iCollectionMark=0}return __extends(e,t),Object.defineProperty(e.prototype,"rayPosition",{get:function(){return this._rayPosition},set:function(t){this._rayPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayDirection",{get:function(){return this._rayDirection},set:function(t){this._rayDirection=t},enumerable:!0,configurable:!0}),e.prototype.enterNode=function(t){return t.isIntersectingRay(this._rayPosition,this._rayDirection)},e}(e.CollectorBase);e.RaycastCollector=n}(t.traverse||(t.traverse={})),t.traverse}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.CollectorBase);t.CSSEntityCollector=e}(t.traverse||(t.traverse={})),t.traverse}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.enterNode=function(e){var i=this.scene._iCollectionMark!=e._iCollectionMark&&e.isCastingShadow();return i?t.prototype.enterNode.call(this,e):(e._iCollectionMark=this.scene._iCollectionMark,!1)},e}(t.CollectorBase);t.ShadowCasterCollector=e}(t.traverse||(t.traverse={})),t.traverse}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){this._pNumChildNodes=0,this._iNumEntities=0,this._pChildNodes=new Array}return Object.defineProperty(t.prototype,"boundsVisible",{get:function(){return this._explicitBoundsVisible},set:function(t){this._explicitBoundsVisible!=t&&(this._explicitBoundsVisible=t,this._iUpdateImplicitBoundsVisible(this._iParent?this._iParent.boundsChildrenVisible:!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boundsChildrenVisible",{get:function(){return this._boundsChildrenVisible},set:function(t){if(this._boundsChildrenVisible!=t){this._boundsChildrenVisible=t;for(var e=0;e<this._pNumChildNodes;++e)this._pChildNodes[e]._iUpdateImplicitBoundsVisible(this._boundsChildrenVisible)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._iParent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_pNumEntities",{get:function(){return this._iNumEntities},enumerable:!0,configurable:!0}),t.prototype.isInFrustum=function(){return!0},t.prototype.isIntersectingRay=function(){return!0},t.prototype.isCastingShadow=function(){return!0},t.prototype.findPartitionForEntity=function(){return this},t.prototype.acceptTraverser=function(t){if((0!=this._pNumEntities||this._implicitBoundsVisible)&&t.enterNode(this)){for(var e=0;e<this._pNumChildNodes;)this._pChildNodes[e++].acceptTraverser(t);this._implicitBoundsVisible&&this._pBoundsPrimitive.partitionNode.acceptTraverser(t)}},t.prototype._pCreateBoundsPrimitive=function(){return null},t.prototype.iAddNode=function(t){t._iParent=this,this._iNumEntities+=t._pNumEntities,this._pChildNodes[this._pNumChildNodes++]=t,t._iUpdateImplicitBoundsVisible(this.boundsChildrenVisible);var e=t._pNumEntities;t=this;do t._iNumEntities+=e;while(null!=(t=t._iParent))},t.prototype.iRemoveNode=function(t){var e=this._pChildNodes.indexOf(t);this._pChildNodes[e]=this._pChildNodes[--this._pNumChildNodes],this._pChildNodes.pop(),t._iUpdateImplicitBoundsVisible(!1);var i=t._pNumEntities;t=this;do t._pNumEntities-=i;while(null!=(t=t._iParent))},t.prototype._iUpdateImplicitBoundsVisible=function(t){if(this._implicitBoundsVisible!=this._explicitBoundsVisible&&!t){this._implicitBoundsVisible=this._explicitBoundsVisible||t,this._iUpdateEntityBounds();for(var e=0;e<this._pNumChildNodes;++e)this._pChildNodes[e]._iUpdateImplicitBoundsVisible(this._boundsChildrenVisible)}},t.prototype._iIsBoundsVisible=function(){return this._implicitBoundsVisible},t.prototype._iUpdateEntityBounds=function(){this._pBoundsPrimitive&&(this._pBoundsPrimitive.dispose(),this._pBoundsPrimitive=null),this._implicitBoundsVisible&&(this._pBoundsPrimitive=this._pCreateBoundsPrimitive())},t}();t.NodeBase=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t}();t.NullNode=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(e){this._updatesMade=!1,this._rootNode=e||new t.NullNode}return Object.defineProperty(e.prototype,"rootNode",{get:function(){return this._rootNode},enumerable:!0,configurable:!0}),e.prototype.traverse=function(t){this._updatesMade&&this.updateEntities(),this._rootNode.acceptTraverser(t)},e.prototype.iMarkForUpdate=function(t){for(var e=t.partitionNode,i=this._updateQueue;i;){if(e==i)return;i=i._iUpdateQueueNext}e._iUpdateQueueNext=this._updateQueue,this._updateQueue=e,this._updatesMade=!0},e.prototype.iRemoveEntity=function(t){var e,i=t.partitionNode;if(i.removeFromParent(),i==this._updateQueue)this._updateQueue=i._iUpdateQueueNext;else{for(e=this._updateQueue;e&&e._iUpdateQueueNext!=i;)e=e._iUpdateQueueNext;e&&(e._iUpdateQueueNext=i._iUpdateQueueNext)}i._iUpdateQueueNext=null,this._updateQueue||(this._updatesMade=!1)},e.prototype.updateEntities=function(){var t,e,i=this._updateQueue;this._updateQueue=null,this._updatesMade=!1;do t=this._rootNode.findPartitionForEntity(i.entity),i.parent!=t&&(i&&i.removeFromParent(),t.iAddNode(i)),e=i._iUpdateQueueNext,i._iUpdateQueueNext=null,i.entity._iInternalUpdate();while(null!=(i=e))},e}();t.Partition=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this),this._entity=e,this._iNumEntities=1}return __extends(e,t),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),e.prototype.removeFromParent=function(){this._iParent&&this._iParent.iRemoveNode(this),this._iParent=null},e.prototype.isCastingShadow=function(){return this.entity.castsShadows},e.prototype.isInFrustum=function(t,e){return this._entity._iIsVisible()?this._entity.worldBounds.isInFrustum(t,e):!1},e.prototype.acceptTraverser=function(t){t.enterNode(this)&&t.applyEntity(this._entity)},e.prototype.isIntersectingRay=function(t,e){return this._entity._iIsVisible()?this._entity.isIntersectingRay(t,e):!1},e.prototype._pCreateBoundsPrimitive=function(){return this._entity.bounds.boundingEntity},e}(t.NodeBase);t.EntityNode=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype.acceptTraverser=function(){},e}(t.EntityNode);t.CameraNode=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e),this._directionalLight=e}return __extends(e,t),e.prototype.acceptTraverser=function(t){t.enterNode(this)&&t.applyDirectionalLight(this._directionalLight)},e.prototype.isCastingShadow=function(){return!1},e}(t.EntityNode);t.DirectionalLightNode=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e),this._lightProbe=e}return __extends(e,t),e.prototype.acceptTraverser=function(t){t.enterNode(this)&&t.applyLightProbe(this._lightProbe)},e.prototype.isCastingShadow=function(){return!1},e}(t.EntityNode);t.LightProbeNode=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e),this._pointLight=e}return __extends(e,t),e.prototype.acceptTraverser=function(t){t.enterNode(this)&&t.applyPointLight(this._pointLight)},e.prototype.isCastingShadow=function(){return!1},e}(t.EntityNode);t.PointLightNode=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e),this._skyBox=e}return __extends(e,t),e.prototype.acceptTraverser=function(t){t.enterNode(this)&&t.applySkybox(this._skyBox)},e.prototype.isInFrustum=function(){return this._skyBox._iIsVisible?!0:!1},e}(t.EntityNode);t.SkyboxNode=e}(t.partition||(t.partition={})),t.partition}(away||(away={}));var away;!function(t){!function(){}(t.pick||(t.pick={})),t.pick}(away||(away={}));var away;!function(t){!function(){}(t.pick||(t.pick={})),t.pick}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){this.displayObject=t}return t}();t.PickingCollisionVO=e}(t.pick||(t.pick={})),t.pick}(away||(away={}));var away;!function(t){!function(e){var i=t.traverse.RaycastCollector,n=function(){function e(t){"undefined"==typeof t&&(t=!1),this._ignoredEntities=[],this._onlyMouseEnabled=!0,this._numEntities=0,this._raycastCollector=new i,this._findClosestCollision=t,this._entities=new Array}return Object.defineProperty(e.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},set:function(t){this._onlyMouseEnabled=t},enumerable:!0,configurable:!0}),e.prototype.getViewCollision=function(t,e,i){var n=i.unproject(t,e,0),r=i.unproject(t,e,1).subtract(n);return this.getSceneCollision(n,r,i.scene)},e.prototype.getSceneCollision=function(t,e,i){this._raycastCollector.clear(),this._raycastCollector.rayPosition=t,this._raycastCollector.rayDirection=e,i.traversePartitions(this._raycastCollector),this._numEntities=0;for(var n,r=this._raycastCollector.entityHead;r;)this.isIgnored(n=r.entity)||(this._entities[this._numEntities++]=n),r=r.next;return this._numEntities?this.getPickingCollisionVO(this._raycastCollector):null},e.prototype.setIgnoreList=function(t){this._ignoredEntities=t},e.prototype.isIgnored=function(t){if(this._onlyMouseEnabled&&!t._iIsMouseEnabled())return!0;for(var e=this._ignoredEntities.length,i=0;e>i;i++)if(this._ignoredEntities[i]==t)return!0;return!1},e.prototype.sortOnNearT=function(t,e){return t._iPickingCollisionVO.rayEntryDistance>e._iPickingCollisionVO.rayEntryDistance?1:-1},e.prototype.getPickingCollisionVO=function(){this._entities.length=this._numEntities,this._entities=this._entities.sort(this.sortOnNearT);var t,e,i,n,r=Number.MAX_VALUE;for(n=0;n<this._numEntities;++n)if(i=this._entities[n],e=i._iPickingCollisionVO,i.pickingCollider){if((null==t||e.rayEntryDistance<t.rayEntryDistance)&&i._iTestCollision(r,this._findClosestCollision)&&(r=e.rayEntryDistance,t=e,!this._findClosestCollision))return this.updateLocalPosition(e),e}else if((null==t||e.rayEntryDistance<t.rayEntryDistance)&&!e.rayOriginIsInsideBounds)return this.updateLocalPosition(e),e;return t},e.prototype.updateLocalPosition=function(e){var i=null==e.localPosition?new t.geom.Vector3D:e.localPosition,n=e.localRayDirection,r=e.localRayPosition,s=e.rayEntryDistance;i.x=r.x+s*n.x,i.y=r.y+s*n.y,i.z=r.z+s*n.z},e.prototype.dispose=function(){},e}();e.RaycastPicker=n}(t.pick||(t.pick={})),t.pick}(away||(away={}));var away;!function(t){!function(){}(t.render||(t.render={})),t.render}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(i,n,r){"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r="baseline"),e.call(this),this._backgroundR=0,this._backgroundG=0,this._backgroundB=0,this._backgroundAlpha=1,this._shareContext=!1,this._pBackBufferInvalid=!0,this._depthTextureInvalid=!0,this._viewPort=new t.geom.Rectangle,this._scissorRect=new t.geom.Rectangle,this._localPos=new t.geom.Point,this._globalPos=new t.geom.Point,this._billboardRenderablePool=t.pool.RenderablePool.getPool(t.pool.CSSBillboardRenderable),this._lineSegmentRenderablePool=t.pool.RenderablePool.getPool(t.pool.CSSLineSegmentRenderable),this._viewPort=new t.geom.Rectangle,0==this._width&&(this.width=window.innerWidth),0==this._height&&(this.height=window.innerHeight)
}return __extends(i,e),Object.defineProperty(i.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scissorRect",{get:function(){return this._scissorRect},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._localPos.x},set:function(t){this.x!=t&&this.updateGlobalPos()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._localPos.y},set:function(t){this.y!=t&&(this._globalPos.y=this._localPos.y=t,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){this._width!=t&&(this._width=t,this._scissorRect.width=t,this._viewPort.width=t,this._pBackBufferInvalid=!0,this._depthTextureInvalid=!0,this.notifyViewportUpdate(),this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height!=t&&(this._height=t,this._scissorRect.height=t,this._viewPort.height=t,this._pBackBufferInvalid=!0,this._depthTextureInvalid=!0,this.notifyViewportUpdate(),this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(t){this._backgroundR!=t&&(this._backgroundR=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(t){this._backgroundG!=t&&(this._backgroundG=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(t){this._backgroundB!=t&&(this._backgroundB=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shareContext",{get:function(){return this._shareContext},set:function(t){this._shareContext!=t&&(this._shareContext=t,this.updateGlobalPos())},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){},i.prototype.render=function(){this._viewportDirty=!1,this._scissorDirty=!1},i.prototype._iRender=function(t,e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=0),t.entityHead&&this.pExecuteRender(t,i)},i.prototype._iRenderCascades=function(){},i.prototype.pCollectRenderables=function(t){this._renderableHead=null;var e=t.entityHead;for(this._pCamera=t.camera,this._iEntryPoint=this._pCamera.scenePosition,this._pCameraForward=this._pCamera.transform.forwardVector;e;)e.entity._iCollectRenderables(this),e=e.next},i.prototype.pExecuteRender=function(t,e){"undefined"==typeof e&&(e=null),this.pCollectRenderables(t),this.pDraw(t)},i.prototype.pDraw=function(){throw new t.errors.AbstractMethodError},Object.defineProperty(i.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(t){this._backgroundAlpha!=t&&(this._backgroundAlpha=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),i.prototype.applyBillboard=function(t){this._applyRenderable(this._billboardRenderablePool.getItem(t))},i.prototype.applyLineSubMesh=function(){},i.prototype.applySkybox=function(){},i.prototype.applyTriangleSubMesh=function(){},i.prototype._applyRenderable=function(t){var e=t.materialOwner.material,i=t.sourceEntity,n=i.scenePosition;e&&(t.materialId=e._iMaterialId,t.renderOrderId=e._iRenderOrderId,t.cascaded=!1,n=this._iEntryPoint.subtract(n),t.zIndex=i.zOffset-n.dotProduct(this._pCameraForward),t.renderSceneTransform=t.sourceEntity.getRenderSceneTransform(this._pCamera),t.next=this._renderableHead,this._renderableHead=t)},i.prototype.notifyScissorUpdate=function(){this._scissorDirty||(this._scissorDirty=!0,this._scissorUpdated||(this._scissorUpdated=new t.events.RendererEvent(t.events.RendererEvent.SCISSOR_UPDATED)),this.dispatchEvent(this._scissorUpdated))},i.prototype.notifyViewportUpdate=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewPortUpdated||(this._viewPortUpdated=new t.events.RendererEvent(t.events.RendererEvent.VIEWPORT_UPDATED)),this.dispatchEvent(this._viewPortUpdated))},i.prototype.updateGlobalPos=function(){this._viewPort.x=this._globalPos.x,this._viewPort.y=this._globalPos.y,this.notifyViewportUpdate(),this.notifyScissorUpdate()},i.prototype._iCreateEntityCollector=function(){throw new t.errors.AbstractMethodError},i}(t.events.EventDispatcher);e.CSSRendererBase=i}(t.render||(t.render={})),t.render}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this),this._contextMatrix=new t.geom.Matrix3D,this._skyboxProjection=new t.geom.Matrix3D,this._transform=new t.geom.Matrix3D,this._container=document.createElement("div"),this._container.style.overflow="hidden",this._container.style.position="absolute",document.body.appendChild(this._container),this._context=document.createElement("div"),this._contextStyle=this._context.style,this._contextStyle.position="absolute",this._contextStyle.transformStyle=this._contextStyle["-webkit-transform-style"]=this._contextStyle["-moz-transform-style"]=this._contextStyle["-o-transform-style"]=this._contextStyle["-ms-transform-style"]="preserve-3d",this._contextStyle.transformOrigin=this._contextStyle["-webkit-transform-origin"]=this._contextStyle["-moz-transform-origin"]=this._contextStyle["-o-transform-origin"]=this._contextStyle["-ms-transform-origin"]="0% 0%",this._container.appendChild(this._context)}return __extends(i,e),i.prototype.render=function(t){e.prototype.render.call(this,t),this._pBackBufferInvalid&&this.pUpdateBackBuffer(),this._iRender(t),this._pBackBufferInvalid=!1},i.prototype.pDraw=function(e){for(var i=document.styleSheets[document.styleSheets.length-1],n=0;n<i.cssRules.length;n++){var r=i.cssRules[n].style;r.transform=r["-webkit-transform"]=r["-moz-transform"]=r["-o-transform"]=r["-ms-transform"]=e.camera.projection.coordinateSystem==t.projections.CoordinateSystem.RIGHT_HANDED?"":"scale3d(1, -1, 1) translateY(-"+r.height+")"}this.drawRenderables(this._renderableHead,e),this._activeMaterial=null},i.prototype.pUpdateBackBuffer=function(){this._container.style.width=this._width+"px",this._container.style.height=this._height+"px",this._container.style.clip="rect(0px, "+this._width+"px, "+this._height+"px, 0px)",this._contextMatrix.rawData[0]=this._width/2,this._contextMatrix.rawData[5]=-this._height/2,this._contextMatrix.rawData[10]=-1,this._contextMatrix.rawData[12]=this._width/2,this._contextMatrix.rawData[13]=this._height/2,this._contextStyle.transform=this._contextStyle["-webkit-transform"]=this._contextStyle["-moz-transform"]=this._contextStyle["-o-transform"]=this._contextStyle["-ms-transform"]=this._contextMatrix.toString(),this._pBackBufferInvalid=!1},i.prototype.drawSkybox=function(){},i.prototype.drawRenderables=function(t,e){for(var i=e.camera.viewProjection.clone();t;){this._activeMaterial=t.materialOwner.material,this._transform.copyRawDataFrom(t.renderSceneTransform.rawData),this._transform.append(i);var n=t.htmlElement.style;n.transform=n["-webkit-transform"]=n["-moz-transform"]=n["-o-transform"]=n["-ms-transform"]=this._transform.toString(),n.transformStyle=n["-webkit-transform-style"]=n["-moz-transform-style"]=n["-o-transform-style"]=n["-ms-transform-style"]="preserve-3d",this._context.contains(t.htmlElement)||this._context.appendChild(t.htmlElement),t=t.next}},i.prototype.dispose=function(){e.prototype.dispose.call(this)},i.prototype._iCreateEntityCollector=function(){return new t.traverse.CSSEntityCollector},i}(e.CSSRendererBase);e.CSSDefaultRenderer=i}(t.render||(t.render={})),t.render}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.prototype.sortBlendedRenderables=function(t){var e,i,n;if(!t||!t.next)return t;for(n=t,i=t.next;i;)i=i.next,i&&(n=n.next,i=i.next);e=n.next,n.next=null,t=this.sortBlendedRenderables(t),e=this.sortBlendedRenderables(e);var r,s,a;if(!t)return e;if(!e)return t;for(;t&&e;)t.zIndex<e.zIndex?(a=t,t=t.next):(a=e,e=e.next),r?s.next=a:r=a,s=a;return t?s.next=t:e&&(s.next=e),r},t.prototype.sortOpaqueRenderables=function(t){var e,i,n;if(!t||!t.next)return t;for(n=t,i=t.next;i;)i=i.next,i&&(n=n.next,i=i.next);e=n.next,n.next=null,t=this.sortOpaqueRenderables(t),e=this.sortOpaqueRenderables(e);var r,s,a,o=0;if(!t)return e;if(!e)return t;for(;t&&e&&null!=t&&null!=e;){var h=t.renderOrderId,p=e.renderOrderId;if(h==p){var u=t.materialId,l=e.materialId;o=u==l?t.zIndex<e.zIndex?1:-1:u>l?1:-1}else o=h>p?1:-1;0>o?(a=t,t=t.next):(a=e,e=e.next),r?(s.next=a,s=a):(r=a,s=a)}return t?s.next=t:e&&(s.next=e),r},t}();t.RenderableMergeSort=e}(t.sort||(t.sort={})),t.sort}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ADVANCED="advanced",t.NORMAL="normal",t}();t.AntiAliasType=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.NONE="none",t.PIXEL="pixel",t.SUBPIXEL="subpixel",t}();t.GridFitType=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.CENTER="center",t.LEFT="left",t.NONE="none",t.RIGHT="right",t}();t.TextFieldAutoSize=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.DYNAMIC="dynamic",t.INPUT="input",t}();t.TextFieldType=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i,n,r,s,a,o,h,p,u,l,c){"undefined"==typeof t&&(t="Times New Roman"),"undefined"==typeof e&&(e=12),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof s&&(s=!1),"undefined"==typeof a&&(a=""),"undefined"==typeof o&&(o=""),"undefined"==typeof h&&(h="left"),"undefined"==typeof p&&(p=0),"undefined"==typeof u&&(u=0),"undefined"==typeof l&&(l=0),"undefined"==typeof c&&(c=0),this.tabStops=new Array,this.font=t,this.size=e,this.bold=n,this.italic=r,this.underline=s,this.url=a,this.target=o,this.align=h,this.leftMargin=p,this.rightMargin=u,this.indent=l,this.leading=c}return t}();t.TextFormat=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){this.CENTER="center",this.JUSTIFY="justify",this.LEFT="left",this.RIGHT="right"}return t}();t.TextFormatAlign=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.NORMAL="normal",t.SELECTION="selection",t}();t.TextInteractionMode=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i,n,r,s){"undefined"==typeof t&&(t=0/0),"undefined"==typeof e&&(e=0/0),"undefined"==typeof i&&(i=0/0),"undefined"==typeof n&&(n=0/0),"undefined"==typeof r&&(r=0/0),"undefined"==typeof s&&(s=0/0)}return t}();t.TextLineMetrics=e}(t.text||(t.text={})),t.text}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.A=65,t.ALTERNATE=18,t.AUDIO=16777239,t.B=66,t.BACK=16777238,t.BACKQUOTE=192,t.BACKSLASH=220,t.BACKSPACE=8,t.BLUE=16777219,t.C=67,t.CAPS_LOCK=20,t.CHANNEL_DOWN=16777221,t.CHANNEL_UP=16777221,t.COMMA=188,t.COMMAND=15,t.CONTROL=17,t.D=68,t.DELETE=46,t.DOWN=40,t.DVR=16777241,t.E=69,t.END=35,t.ENTER=13,t.EQUAL=187,t.ESCAPE=27,t.EXIT=16777237,t.F=70,t.F1=112,t.F10=121,t.F11=122,t.F12=123,t.F13=124,t.F14=125,t.F15=126,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.FAST_FORWARD=16777226,t.G=71,t.GREEN=16777217,t.GUIDE=16777236,t.H=72,t.HELP=16777245,t.HOME=36,t.I=73,t.INFO=16777235,t.INPUT=16777243,t.INSERT=45,t.J=74,t.K=75,t.KEYNAME_BEGIN="Begin",t.KEYNAME_BREAK="Break",t.KEYNAME_CLEARDISPLAY="ClrDsp",t.KEYNAME_CLEARLINE="ClrLn",t.KEYNAME_DELETE="Delete",t.KEYNAME_DELETECHAR="DelChr",t.KEYNAME_DELETELINE="DelLn",t.KEYNAME_DOWNARROW="Down",t.KEYNAME_END="End",t.KEYNAME_EXECUTE="Exec",t.KEYNAME_F1="F1",t.KEYNAME_F10="F10",t.KEYNAME_F11="F11",t.KEYNAME_F12="F12",t.KEYNAME_F13="F13",t.KEYNAME_F14="F14",t.KEYNAME_F15="F15",t.KEYNAME_F16="F16",t.KEYNAME_F17="F17",t.KEYNAME_F18="F18",t.KEYNAME_F19="F19",t.KEYNAME_F2="F2",t.KEYNAME_F20="F20",t.KEYNAME_F21="F21",t.KEYNAME_F22="F22",t.KEYNAME_F23="F23",t.KEYNAME_F24="F24",t.KEYNAME_F25="F25",t.KEYNAME_F26="F26",t.KEYNAME_F27="F27",t.KEYNAME_F28="F28",t.KEYNAME_F29="F29",t.KEYNAME_F3="F3",t.KEYNAME_F30="F30",t.KEYNAME_F31="F31",t.KEYNAME_F32="F32",t.KEYNAME_F33="F33",t.KEYNAME_F34="F34",t.KEYNAME_F35="F35",t.KEYNAME_F4="F4",t.KEYNAME_F5="F5",t.KEYNAME_F6="F6",t.KEYNAME_F7="F7",t.KEYNAME_F8="F8",t.KEYNAME_F9="F9",t.KEYNAME_FIND="Find",t.KEYNAME_HELP="Help",t.KEYNAME_HOME="Home",t.KEYNAME_INSERT="Insert",t.KEYNAME_INSERTCHAR="InsChr",t.KEYNAME_INSERTLINE="LnsLn",t.KEYNAME_LEFTARROW="Left",t.KEYNAME_MENU="Menu",t.KEYNAME_MODESWITCH="ModeSw",t.KEYNAME_NEXT="Next",t.KEYNAME_PAGEDOWN="PgDn",t.KEYNAME_PAGEUP="PgUp",t.KEYNAME_PAUSE="Pause",t.KEYNAME_PREV="Prev",t.KEYNAME_PRINT="Print",t.KEYNAME_PRINTSCREEN="PrntScrn",t.KEYNAME_REDO="Redo",t.KEYNAME_RESET="Reset",t.KEYNAME_RIGHTARROW="Right",t.KEYNAME_SCROLLLOCK="ScrlLck",t.KEYNAME_SELECT="Select",t.KEYNAME_STOP="Stop",t.KEYNAME_SYSREQ="SysReq",t.KEYNAME_SYSTEM="Sys",t.KEYNAME_UNDO="Undo",t.KEYNAME_UPARROW="Up",t.KEYNAME_USER="User",t.L=76,t.LAST=16777233,t.LEFT=37,t.LEFTBRACKET=219,t.LIVE=16777232,t.M=77,t.MASTER_SHELL=16777246,t.MENU=16777234,t.MINUS=189,t.N=78,t.NEXT=16777230,t.NUMBER_0=48,t.NUMBER_1=49,t.NUMBER_2=50,t.NUMBER_3=51,t.NUMBER_4=52,t.NUMBER_5=53,t.NUMBER_6=54,t.NUMBER_7=55,t.NUMBER_8=56,t.NUMBER_9=57,t.NUMPAD=21,t.NUMPAD_0=96,t.NUMPAD_1=97,t.NUMPAD_2=98,t.NUMPAD_3=99,t.NUMPAD_4=100,t.NUMPAD_5=101,t.NUMPAD_6=102,t.NUMPAD_7=103,t.NUMPAD_8=104,t.NUMPAD_9=105,t.NUMPAD_ADD=107,t.NUMPAD_DECIMAL=110,t.NUMPAD_DIVIDE=111,t.NUMPAD_ENTER=108,t.NUMPAD_MULTIPLY=106,t.NUMPAD_SUBTRACT=109,t.O=79,t.P=80,t.PAGE_DOWN=34,t.PAGE_UP=33,t.PAUSE=16777224,t.PERIOD=190,t.PLAY=16777223,t.PREVIOUS=16777231,t.Q=81,t.QUOTE=222,t.R=82,t.RECORD=16777222,t.RED=16777216,t.REWIND=16777227,t.RIGHT=39,t.RIGHTBRACKET=221,t.S=83,t.SEARCH=16777247,t.SEMICOLON=186,t.SETUP=16777244,t.SHIFT=16,t.SKIP_BACKWARD=16777229,t.SKIP_FORWARD=16777228,t.SLASH=191,t.SPACE=32,t.STOP=16777225,t.SUBTITLE=16777240,t.T=84,t.TAB=9,t.U=85,t.UP=38,t.V=86,t.VOD=16777242,t.W=87,t.X=88,t.Y=89,t.YELLOW=16777218,t.Z=90,t}();t.Keyboard=e}(t.ui||(t.ui={})),t.ui}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.ArgumentError,n=t.errors.Error,r=t.errors.RangeError,s=t.library.AssetType,a=function(t){function e(){t.call(this),this._mouseChildren=!0,this._children=new Array}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return s.CONTAINER},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseChildren",{get:function(){return this._mouseChildren},set:function(t){this._mouseChildren!=t&&(this._mouseChildren=t,this._pUpdateImplicitMouseEnabled(this._pParent?this._pParent.mouseChildren:!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),e.prototype.addChild=function(t){if(null==t)throw new n("Parameter child cannot be null.");return t._pParent&&t._pParent.removeChildInternal(t),t.iSetParent(this),this._children.push(t),t},e.prototype.addChildAt=function(t){return t},e.prototype.addChildren=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];for(var i=t.length,n=0;i>n;n++)this.addChild(t[n])},e.prototype.clone=function(){var t=new e;t.pivot=this.pivot,t._iMatrix3D=this._iMatrix3D,t.partition=this.partition,t.name=name;for(var i=this._children.length,n=0;i>n;++n)t.addChild(this._children[n].clone());return t},e.prototype.contains=function(t){return this._children.indexOf(t)>=0},e.prototype.disposeWithChildren=function(){for(this.dispose();this.numChildren>0;)this.getChildAt(0).dispose()},e.prototype.getChildAt=function(t){var e=this._children[t];if(null==e)throw new r("Index does not exist in the child list of the caller");return e},e.prototype.getChildByName=function(t){for(var e=this._children.length,i=0;e>i;++i)if(this._children[i].name==t)return this._children[i];return null},e.prototype.getChildIndex=function(t){var e=this._children.indexOf(t);if(-1==e)throw new i("Child parameter is not a child of the caller");return e},e.prototype.getObjectsUnderPoint=function(){return new Array},e.prototype.removeChild=function(t){if(null==t)throw new n("Parameter child cannot be null");return this.removeChildInternal(t),t.iSetParent(null),t},e.prototype.removeChildAt=function(t){return this.removeChild(this._children[t])},e.prototype.removeChildren=function(t,e){if("undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=2147483647),0>t)throw new r("beginIndex is out of range of the child list");if(e>this._children.length)throw new r("endIndex is out of range of the child list");for(var i=t;e>i;i++)this.removeChild(this._children[i])},e.prototype.setChildIndex=function(){},e.prototype.swapChildren=function(){},e.prototype.swapChildrenAt=function(){},e.prototype.pInvalidateSceneTransform=function(){t.prototype.pInvalidateSceneTransform.call(this);for(var e=this._children.length,i=0;e>i;++i)this._children[i].pInvalidateSceneTransform()},e.prototype._pUpdateScene=function(e){t.prototype._pUpdateScene.call(this,e);for(var i=this._children.length,n=0;i>n;++n)this._children[n]._pUpdateScene(e)},e.prototype._pUpdateImplicitMouseEnabled=function(e){t.prototype._pUpdateImplicitMouseEnabled.call(this,e);for(var i=this._children.length,n=0;i>n;++n)this._children[n]._pUpdateImplicitMouseEnabled(this._mouseChildren)},e.prototype._pUpdateImplicitVisibility=function(e){t.prototype._pUpdateImplicitVisibility.call(this,e);for(var i=this._children.length,n=0;i>n;++n)this._children[n]._pUpdateImplicitVisibility(this._pImplicitVisibility)},e.prototype._pUpdateImplicitPartition=function(e){t.prototype._pUpdateImplicitPartition.call(this,e);for(var i=this._children.length,n=0;i>n;++n)this._children[n]._pUpdateImplicitPartition(this._pImplicitPartition)},e.prototype.removeChildInternal=function(t){return this._children.splice(this.getChildIndex(t),1),t},e}(t.base.DisplayObject);e.DisplayObjectContainer=a}(t.containers||(t.containers={})),t.containers}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=t.events.LightEvent,r=t.library.AssetType,s=function(t){function e(){t.call(this),this._color=16777215,this._colorR=1,this._colorG=1,this._colorB=1,this._ambientColor=16777215,this._ambient=0,this._iAmbientR=0,this._iAmbientG=0,this._iAmbientB=0,this._specular=1,this._iSpecularR=1,this._iSpecularG=1,this._iSpecularB=1,this._diffuse=1,this._iDiffuseR=1,this._iDiffuseG=1,this._iDiffuseB=1,this._castsShadows=!1}return __extends(e,t),Object.defineProperty(e.prototype,"castsShadows",{get:function(){return this._castsShadows},set:function(t){this._castsShadows!=t&&(this._castsShadows=t,t?(null==this._shadowMapper&&(this._shadowMapper=this.pCreateShadowMapper()),this._shadowMapper.light=this):(this._shadowMapper.dispose(),this._shadowMapper=null),this.dispatchEvent(new n(n.CASTS_SHADOW_CHANGE)))},enumerable:!0,configurable:!0}),e.prototype.pCreateShadowMapper=function(){throw new i},Object.defineProperty(e.prototype,"specular",{get:function(){return this._specular},set:function(t){0>t&&(t=0),this._specular=t,this.updateSpecular()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuse",{get:function(){return this._diffuse},set:function(t){0>t&&(t=0),this._diffuse=t,this.updateDiffuse()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._colorR=(this._color>>16&255)/255,this._colorG=(this._color>>8&255)/255,this._colorB=(255&this._color)/255,this.updateDiffuse(),this.updateSpecular()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambient",{get:function(){return this._ambient},set:function(t){0>t?t=0:t>1&&(t=1),this._ambient=t,this.updateAmbient()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(t){this._ambientColor=t,this.updateAmbient()},enumerable:!0,configurable:!0}),e.prototype.updateAmbient=function(){this._iAmbientR=(this._ambientColor>>16&255)/255*this._ambient,this._iAmbientG=(this._ambientColor>>8&255)/255*this._ambient,this._iAmbientB=(255&this._ambientColor)/255*this._ambient},e.prototype.iGetObjectProjectionMatrix=function(t,e,n){throw"undefined"==typeof n&&(n=null),new i},Object.defineProperty(e.prototype,"assetType",{get:function(){return r.LIGHT},enumerable:!0,configurable:!0}),e.prototype.updateSpecular=function(){this._iSpecularR=this._colorR*this._specular,this._iSpecularG=this._colorG*this._specular,this._iSpecularB=this._colorB*this._specular},e.prototype.updateDiffuse=function(){this._iDiffuseR=this._colorR*this._diffuse,this._iDiffuseG=this._colorG*this._diffuse,this._iDiffuseB=this._colorB*this._diffuse},Object.defineProperty(e.prototype,"shadowMapper",{get:function(){return this._shadowMapper},set:function(t){this._shadowMapper=t,this._shadowMapper.light=this},enumerable:!0,configurable:!0}),e}(t.containers.DisplayObjectContainer);e.LightBase=s}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.LEFT_HANDED="leftHanded",t.RIGHT_HANDED="rightHanded",t}();t.CoordinateSystem=e}(t.projections||(t.projections={})),t.projections}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(i){"undefined"==typeof i&&(i="leftHanded"),e.call(this),this._pMatrix=new t.geom.Matrix3D,this._pScissorRect=new t.geom.Rectangle,this._pViewPort=new t.geom.Rectangle,this._pNear=20,this._pFar=3e3,this._pAspectRatio=1,this._pMatrixInvalid=!0,this._pFrustumCorners=[],this._pOriginX=.5,this._pOriginY=.5,this._unprojectionInvalid=!0,this.coordinateSystem=i}return __extends(i,e),Object.defineProperty(i.prototype,"coordinateSystem",{get:function(){return this._pCoordinateSystem},set:function(t){this._pCoordinateSystem!=t&&(this._pCoordinateSystem=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frustumCorners",{get:function(){return this._pFrustumCorners},set:function(t){this._pFrustumCorners=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrix",{get:function(){return this._pMatrixInvalid&&(this.pUpdateMatrix(),this._pMatrixInvalid=!1),this._pMatrix},set:function(t){this._pMatrix=t,this.pInvalidateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"near",{get:function(){return this._pNear},set:function(t){t!=this._pNear&&(this._pNear=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"originX",{get:function(){return this._pOriginX},set:function(t){this._pOriginX!=t&&(this._pOriginX=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"originY",{get:function(){return this._pOriginY},set:function(t){this._pOriginY!=t&&(this._pOriginY=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"far",{get:function(){return this._pFar},set:function(t){t!=this._pFar&&(this._pFar=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),i.prototype.project=function(t){var e=this.matrix.transformVector(t);return e.x=e.x/e.w,e.y=-e.y/e.w,e.z=t.z,e},Object.defineProperty(i.prototype,"unprojectionMatrix",{get:function(){return this._unprojectionInvalid&&(this._unprojection||(this._unprojection=new t.geom.Matrix3D),this._unprojection.copyFrom(this.matrix),this._unprojection.invert(),this._unprojectionInvalid=!1),this._unprojection},enumerable:!0,configurable:!0}),i.prototype.unproject=function(){throw new t.errors.AbstractMethodError},i.prototype.clone=function(){throw new t.errors.AbstractMethodError},Object.defineProperty(i.prototype,"_iAspectRatio",{get:function(){return this._pAspectRatio},set:function(t){this._pAspectRatio!=t&&(this._pAspectRatio=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),i.prototype.pInvalidateMatrix=function(){this._pMatrixInvalid=!0,this._unprojectionInvalid=!0,this.dispatchEvent(new t.events.ProjectionEvent(t.events.ProjectionEvent.MATRIX_CHANGED,this))},i.prototype.pUpdateMatrix=function(){throw new t.errors.AbstractMethodError},i.prototype._iUpdateScissorRect=function(t,e,i,n){this._pScissorRect.x=t,this._pScissorRect.y=e,this._pScissorRect.width=i,this._pScissorRect.height=n,this.pInvalidateMatrix()},i.prototype._iUpdateViewport=function(t,e,i,n){this._pViewPort.x=t,this._pViewPort.y=e,this._pViewPort.width=i,this._pViewPort.height=n,this.pInvalidateMatrix()},i}(t.events.EventDispatcher);e.ProjectionBase=i}(t.projections||(t.projections={})),t.projections}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(t,e){"undefined"==typeof t&&(t=60),"undefined"==typeof e&&(e="leftHanded"),i.call(this,e),this._fieldOfView=60,this._focalLength=1e3,this._hFieldOfView=60,this._hFocalLength=1e3,this._preserveAspectRatio=!0,this._preserveFocalLength=!1,this.fieldOfView=t}return __extends(n,i),Object.defineProperty(n.prototype,"preserveAspectRatio",{get:function(){return this._preserveAspectRatio},set:function(t){this._preserveAspectRatio!=t&&(this._preserveAspectRatio=t,this._preserveAspectRatio&&this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"preserveFocalLength",{get:function(){return this._preserveFocalLength},set:function(t){this._preserveFocalLength!=t&&(this._preserveFocalLength=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fieldOfView",{get:function(){return this._fieldOfView},set:function(t){this._fieldOfView!=t&&(this._fieldOfView=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"focalLength",{get:function(){return this._focalLength},set:function(t){this._focalLength!=t&&(this._focalLength=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hFieldOfView",{get:function(){return this._hFieldOfView},set:function(t){this._hFieldOfView!=t&&(this._hFieldOfView=t,this._hFocalLength=1/Math.tan(this._hFieldOfView*Math.PI/360),this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hFocalLength",{get:function(){return this._hFocalLength},set:function(t){this._hFocalLength!=t&&(this._hFocalLength=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),n.prototype.unproject=function(e,i,n){var r=new t.geom.Vector3D(e,-i,n,1);return r.x*=n,r.y*=n,r=this.unprojectionMatrix.transformVector(r),r.z=n,r},n.prototype.clone=function(){var t=new n(this._fieldOfView);return t._pNear=this._pNear,t._pFar=this._pFar,t._pAspectRatio=this._pAspectRatio,t._pCoordinateSystem=this._pCoordinateSystem,t},n.prototype.pUpdateMatrix=function(){var t=[];this._preserveFocalLength?(this._preserveAspectRatio&&(this._hFocalLength=this._focalLength),this._fieldOfView=360*Math.atan(.5*this._pScissorRect.height/this._focalLength)/Math.PI,this._hFieldOfView=360*Math.atan(.5*this._pScissorRect.width/this._hFocalLength)/Math.PI):(this._focalLength=.5*this._pScissorRect.height/Math.tan(this._fieldOfView*Math.PI/360),this._hFocalLength=this._preserveAspectRatio?this._focalLength:.5*this._pScissorRect.width/Math.tan(this._hFieldOfView*Math.PI/360));var i,n,r,s,a=-this._pOriginX/this._hFocalLength,o=(1-this._pOriginX)/this._hFocalLength,h=-this._pOriginY/this._focalLength,p=(1-this._pOriginY)/this._focalLength,u=-((a-o)*this._pScissorRect.x+a*this._pScissorRect.width),l=(h-p)*this._pScissorRect.y+h*this._pScissorRect.height;i=u-(o-a)*this._pViewPort.width,n=u,r=l,s=l+(p-h)*this._pViewPort.height,t[0]=2/(n-i),t[5]=2/(s-r),t[8]=(n+i)/(n-i),t[9]=(s+r)/(s-r),t[10]=(this._pFar+this._pNear)/(this._pFar-this._pNear),t[11]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[12]=t[13]=t[15]=0,t[14]=-2*this._pFar*this._pNear/(this._pFar-this._pNear),this._pCoordinateSystem==e.CoordinateSystem.RIGHT_HANDED&&(t[5]=-t[5]),this._pMatrix.copyRawDataFrom(t),this._pFrustumCorners[0]=this._pFrustumCorners[9]=this._pNear*i,this._pFrustumCorners[3]=this._pFrustumCorners[6]=this._pNear*n,this._pFrustumCorners[1]=this._pFrustumCorners[4]=this._pNear*r,this._pFrustumCorners[7]=this._pFrustumCorners[10]=this._pNear*s,this._pFrustumCorners[12]=this._pFrustumCorners[21]=this._pFar*i,this._pFrustumCorners[15]=this._pFrustumCorners[18]=this._pFar*n,this._pFrustumCorners[13]=this._pFrustumCorners[16]=this._pFar*r,this._pFrustumCorners[19]=this._pFrustumCorners[22]=this._pFar*s,this._pFrustumCorners[2]=this._pFrustumCorners[5]=this._pFrustumCorners[8]=this._pFrustumCorners[11]=this._pNear,this._pFrustumCorners[14]=this._pFrustumCorners[17]=this._pFrustumCorners[20]=this._pFrustumCorners[23]=this._pFar,this._pMatrixInvalid=!1},n}(e.ProjectionBase);e.PerspectiveProjection=i}(t.projections||(t.projections={})),t.projections}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(){e.call(this),this._pMatrix.copyFrom((new t.PerspectiveProjection).matrix)}return __extends(i,e),Object.defineProperty(i.prototype,"near",{set:function(t){this._pNear=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"far",{set:function(t){this._pFar=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iAspectRatio",{set:function(t){this._pAspectRatio=t},enumerable:!0,configurable:!0}),i.prototype.clone=function(){var t=new i;return t._pMatrix.copyFrom(this._pMatrix),t._pNear=this._pNear,t._pFar=this._pFar,t._pAspectRatio=this._pAspectRatio,t.pInvalidateMatrix(),t},i.prototype.pUpdateMatrix=function(){this._pMatrixInvalid=!1},i}(t.ProjectionBase);t.FreeMatrixProjection=e}(t.projections||(t.projections={})),t.projections}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t){"undefined"==typeof t&&(t=500),e.call(this),this._projectionHeight=t}return __extends(i,e),Object.defineProperty(i.prototype,"projectionHeight",{get:function(){return this._projectionHeight},set:function(t){t!=this._projectionHeight&&(this._projectionHeight=t,this.pInvalidateMatrix())},enumerable:!0,configurable:!0}),i.prototype.unproject=function(e,i,n){var r=new t.geom.Vector3D(e+this.matrix.rawData[12],-i+this.matrix.rawData[13],n,1);return r=this.unprojectionMatrix.transformVector(r),r.z=n,r},i.prototype.clone=function(){var t=new i;return t._pNear=this._pNear,t._pFar=this._pFar,t._pAspectRatio=this._pAspectRatio,t.projectionHeight=this._projectionHeight,t},i.prototype.pUpdateMatrix=function(){var t=[];this._yMax=.5*this._projectionHeight,this._xMax=this._yMax*this._pAspectRatio;var e,i,n,r;if(0==this._pScissorRect.x&&0==this._pScissorRect.y&&this._pScissorRect.width==this._pViewPort.width&&this._pScissorRect.height==this._pViewPort.height)e=-this._xMax,i=this._xMax,n=-this._yMax,r=this._yMax,t[0]=2/(this._projectionHeight*this._pAspectRatio),t[5]=2/this._projectionHeight,t[10]=1/(this._pFar-this._pNear),t[14]=this._pNear/(this._pNear-this._pFar),t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=0,t[15]=1;else{var s=this._xMax*(this._pViewPort.width/this._pScissorRect.width),a=this._yMax*(this._pViewPort.height/this._pScissorRect.height),o=this._xMax*(2*this._pScissorRect.x-this._pViewPort.width)/this._pScissorRect.width+this._xMax,h=-this._yMax*(2*this._pScissorRect.y-this._pViewPort.height)/this._pScissorRect.height-this._yMax;e=o-s,i=o+s,n=h-a,r=h+a,t[0]=2/(i-e),t[5]=-2/(n-r),t[10]=1/(this._pFar-this._pNear),t[12]=(i+e)/(i-e),t[13]=(r+n)/(r-n),t[14]=this._pNear/(this.near-this.far),t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=0,t[15]=1}this._pFrustumCorners[0]=this._pFrustumCorners[9]=this._pFrustumCorners[12]=this._pFrustumCorners[21]=e,this._pFrustumCorners[3]=this._pFrustumCorners[6]=this._pFrustumCorners[15]=this._pFrustumCorners[18]=i,this._pFrustumCorners[1]=this._pFrustumCorners[4]=this._pFrustumCorners[13]=this._pFrustumCorners[16]=n,this._pFrustumCorners[7]=this._pFrustumCorners[10]=this._pFrustumCorners[19]=this._pFrustumCorners[22]=r,this._pFrustumCorners[2]=this._pFrustumCorners[5]=this._pFrustumCorners[8]=this._pFrustumCorners[11]=this._pNear,this._pFrustumCorners[14]=this._pFrustumCorners[17]=this._pFrustumCorners[20]=this._pFrustumCorners[23]=this._pFar,this._pMatrix.copyRawDataFrom(t),this._pMatrixInvalid=!1},i}(e.ProjectionBase);e.OrthographicProjection=i}(t.projections||(t.projections={})),t.projections}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i,n,r){e.call(this),this._minX=t,this._maxX=i,this._minY=n,this._maxY=r
}return __extends(i,e),Object.defineProperty(i.prototype,"minX",{get:function(){return this._minX},set:function(t){this._minX=t,this.pInvalidateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxX",{get:function(){return this._maxX},set:function(t){this._maxX=t,this.pInvalidateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minY",{get:function(){return this._minY},set:function(t){this._minY=t,this.pInvalidateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxY",{get:function(){return this._maxY},set:function(t){this._maxY=t,this.pInvalidateMatrix()},enumerable:!0,configurable:!0}),i.prototype.unproject=function(e,i,n){var r=new t.geom.Vector3D(e,-i,n,1);return r=this.unprojectionMatrix.transformVector(r),r.z=n,r},i.prototype.clone=function(){var t=new i(this._minX,this._maxX,this._minY,this._maxY);return t._pNear=this._pNear,t._pFar=this._pFar,t._pAspectRatio=this._pAspectRatio,t},i.prototype.pUpdateMatrix=function(){var t=[],e=1/(this._maxX-this._minX),i=1/(this._maxY-this._minY),n=1/(this._pFar-this._pNear);t[0]=2*e,t[5]=2*i,t[10]=n,t[12]=-(this._maxX+this._minX)*e,t[13]=-(this._maxY+this._minY)*i,t[14]=-this._pNear*n,t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=0,this._pMatrix.copyRawDataFrom(t),this._pFrustumCorners[0]=this._pFrustumCorners[9]=this._pFrustumCorners[12]=this._pFrustumCorners[21]=this._minX,this._pFrustumCorners[3]=this._pFrustumCorners[6]=this._pFrustumCorners[15]=this._pFrustumCorners[18]=this._maxX,this._pFrustumCorners[1]=this._pFrustumCorners[4]=this._pFrustumCorners[13]=this._pFrustumCorners[16]=this._minY,this._pFrustumCorners[7]=this._pFrustumCorners[10]=this._pFrustumCorners[19]=this._pFrustumCorners[22]=this._maxY,this._pFrustumCorners[2]=this._pFrustumCorners[5]=this._pFrustumCorners[8]=this._pFrustumCorners[11]=this._pNear,this._pFrustumCorners[14]=this._pFrustumCorners[17]=this._pFrustumCorners[20]=this._pFrustumCorners[23]=this._pFar,this._pMatrixInvalid=!1},i}(e.ProjectionBase);e.OrthographicOffCenterProjection=i}(t.projections||(t.projections={})),t.projections}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(i,n){e.call(this),this.baseProjection=i,this.plane=n,this._onProjectionMatrixChangedDelegate=t.utils.Delegate.create(this,this.onProjectionMatrixChanged)}return __extends(i,e),Object.defineProperty(i.prototype,"frustumCorners",{get:function(){return this._baseProjection.frustumCorners},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"near",{get:function(){return this._baseProjection.near},set:function(t){this._baseProjection.near=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"far",{get:function(){return this._baseProjection.far},set:function(t){this._baseProjection.far=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iAspectRatio",{get:function(){return this._baseProjection._iAspectRatio},set:function(t){this._baseProjection._iAspectRatio=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"plane",{get:function(){return this._plane},set:function(t){this._plane=t,this.pInvalidateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"baseProjection",{set:function(e){this._baseProjection&&this._baseProjection.removeEventListener(t.events.ProjectionEvent.MATRIX_CHANGED,this._onProjectionMatrixChangedDelegate),this._baseProjection=e,this._baseProjection&&this._baseProjection.addEventListener(t.events.ProjectionEvent.MATRIX_CHANGED,this._onProjectionMatrixChangedDelegate),this.pInvalidateMatrix()},enumerable:!0,configurable:!0}),i.prototype.onProjectionMatrixChanged=function(){this.pInvalidateMatrix()},i.prototype.pUpdateMatrix=function(){this._pMatrix.copyFrom(this._baseProjection.matrix);var e=this._plane.a,i=this._plane.b,n=this._plane.c,r=-this._plane.d+.05,s=e>=0?1:-1,a=i>=0?1:-1,o=new t.geom.Vector3D(s,a,1,1),h=this._pMatrix.clone();h.invert();var p=h.transformVector(o);this._pMatrix.copyRowTo(3,o);var u=(p.x*o.x+p.y*o.y+p.z*o.z+p.w*o.w)/(e*p.x+i*p.y+n*p.z+r*p.w);this._pMatrix.copyRowFrom(2,new t.geom.Vector3D(e*u,i*u,n*u,r*u))},i}(e.ProjectionBase);e.ObliqueNearPlaneProjection=i}(t.projections||(t.projections={})),t.projections}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(i){"undefined"==typeof i&&(i=null),e.call(this),this._viewProjection=new t.geom.Matrix3D,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0,this._pIsEntity=!0,this._onProjectionMatrixChangedDelegate=t.utils.Delegate.create(this,this.onProjectionMatrixChanged),this._projection=i||new t.projections.PerspectiveProjection,this._projection.addEventListener(t.events.ProjectionEvent.MATRIX_CHANGED,this._onProjectionMatrixChangedDelegate),this._frustumPlanes=[];for(var n=0;6>n;++n)this._frustumPlanes[n]=new t.geom.Plane3D;this.z=-1e3}return __extends(i,e),i.prototype.pCreateDefaultBoundingVolume=function(){return new t.bounds.NullBounds},i.prototype.pCreateEntityPartitionNode=function(){return new t.partition.CameraNode(this)},Object.defineProperty(i.prototype,"assetType",{get:function(){return t.library.AssetType.CAMERA},enumerable:!0,configurable:!0}),i.prototype.onProjectionMatrixChanged=function(t){this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0,this.dispatchEvent(t)},Object.defineProperty(i.prototype,"frustumPlanes",{get:function(){return this._frustumPlanesDirty&&this.updateFrustum(),this._frustumPlanes},enumerable:!0,configurable:!0}),i.prototype.updateFrustum=function(){var t,e,i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v=new Array(16);this.viewProjection.copyRawDataTo(v),n=v[0],r=v[4],s=v[8],a=v[12],o=v[1],h=v[5],p=v[9],u=v[13],l=v[2],c=v[6],d=v[10],_=v[14],f=v[3],g=v[7],m=v[11],y=v[15],b=this._frustumPlanes[0],t=f+n,e=g+r,i=m+s,x=1/Math.sqrt(t*t+e*e+i*i),b.a=t*x,b.b=e*x,b.c=i*x,b.d=-(y+a)*x,b=this._frustumPlanes[1],t=f-n,e=g-r,i=m-s,x=1/Math.sqrt(t*t+e*e+i*i),b.a=t*x,b.b=e*x,b.c=i*x,b.d=(a-y)*x,b=this._frustumPlanes[2],t=f+o,e=g+h,i=m+p,x=1/Math.sqrt(t*t+e*e+i*i),b.a=t*x,b.b=e*x,b.c=i*x,b.d=-(y+u)*x,b=this._frustumPlanes[3],t=f-o,e=g-h,i=m-p,x=1/Math.sqrt(t*t+e*e+i*i),b.a=t*x,b.b=e*x,b.c=i*x,b.d=(u-y)*x,b=this._frustumPlanes[4],t=l,e=c,i=d,x=1/Math.sqrt(t*t+e*e+i*i),b.a=t*x,b.b=e*x,b.c=i*x,b.d=-_*x,b=this._frustumPlanes[5],t=f-l,e=g-c,i=m-d,x=1/Math.sqrt(t*t+e*e+i*i),b.a=t*x,b.b=e*x,b.c=i*x,b.d=(_-y)*x,this._frustumPlanesDirty=!1},i.prototype.pInvalidateSceneTransform=function(){e.prototype.pInvalidateSceneTransform.call(this),this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},i.prototype.pUpdateBounds=function(){this._pBoundsInvalid=!1,this._pBounds.nullify()},Object.defineProperty(i.prototype,"projection",{get:function(){return this._projection},set:function(e){if(this._projection!=e){if(!e)throw new Error("Projection cannot be null!");this._projection.removeEventListener(t.events.ProjectionEvent.MATRIX_CHANGED,this._onProjectionMatrixChangedDelegate),this._projection=e,this._projection.addEventListener(t.events.ProjectionEvent.MATRIX_CHANGED,this._onProjectionMatrixChangedDelegate),this.dispatchEvent(new t.events.CameraEvent(t.events.CameraEvent.PROJECTION_CHANGED,this))}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewProjection",{get:function(){return this._viewProjectionDirty&&(this._viewProjection.copyFrom(this.inverseSceneTransform),this._viewProjection.append(this._projection.matrix),this._viewProjectionDirty=!1),this._viewProjection},enumerable:!0,configurable:!0}),i.prototype.getRay=function(t,e,i){return this.sceneTransform.deltaTransformVector(this._projection.unproject(t,e,i))},i.prototype.project=function(t){return this._projection.project(this.inverseSceneTransform.transformVector(t))},i.prototype.unproject=function(t,e,i){return this.sceneTransform.transformVector(this._projection.unproject(t,e,i))},i.prototype._iCollectRenderables=function(t){this._iSourcePrefab&&this._iSourcePrefab._iValidate(),this._iCollectRenderable(t)},i.prototype._iCollectRenderable=function(){},i}(t.containers.DisplayObjectContainer);e.Camera=i}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=t.traverse.ShadowCasterCollector,r=t.textures.RenderTexture,s=function(){function t(){this._pDepthMapSize=2048,this._autoUpdateShadows=!0,this._pCasterCollector=this.pCreateCasterCollector()}return t.prototype.pCreateCasterCollector=function(){return new n},Object.defineProperty(t.prototype,"autoUpdateShadows",{get:function(){return this._autoUpdateShadows},set:function(t){this._autoUpdateShadows=t},enumerable:!0,configurable:!0}),t.prototype.updateShadows=function(){this._iShadowsInvalid=!0},t.prototype.iSetDepthMap=function(t){this._depthMap!=t&&(this._depthMap&&!this._explicitDepthMap&&this._depthMap.dispose(),this._depthMap=t,this._depthMap?(this._explicitDepthMap=!0,this._pDepthMapSize=this._depthMap.size):this._explicitDepthMap=!1)},Object.defineProperty(t.prototype,"light",{get:function(){return this._pLight},set:function(t){this._pLight=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMap",{get:function(){return this._depthMap||(this._depthMap=this.pCreateDepthTexture()),this._depthMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMapSize",{get:function(){return this._pDepthMapSize},set:function(t){t!=this._pDepthMapSize&&this._pSetDepthMapSize(t)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._pCasterCollector=null,this._depthMap&&!this._explicitDepthMap&&this._depthMap.dispose(),this._depthMap=null},t.prototype.pCreateDepthTexture=function(){return new r(this._pDepthMapSize,this._pDepthMapSize)},t.prototype.iRenderDepthMap=function(t,e,i){this._iShadowsInvalid=!1,this.pUpdateDepthProjection(e.camera),this._depthMap||(this._depthMap=this.pCreateDepthTexture()),this.pDrawDepthMap(this._depthMap,e.scene,i)},t.prototype.pUpdateDepthProjection=function(){throw new i},t.prototype.pDrawDepthMap=function(){throw new i},t.prototype._pSetDepthMapSize=function(t){if(this._pDepthMapSize=t,this._explicitDepthMap)throw Error("Cannot set depth map size for the current renderer.");this._depthMap&&(this._depthMap.dispose(),this._depthMap=null)},t}();e.ShadowMapperBase=s}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.entities.Camera,n=function(e){function n(){e.call(this),this._pDepthMapSize=512,this._needsRender=new Array,this.initCameras()}return __extends(n,e),n.prototype.initCameras=function(){this._depthCameras=new Array,this._projections=new Array,this.addCamera(0,90,0),this.addCamera(0,-90,0),this.addCamera(-90,0,0),this.addCamera(90,0,0),this.addCamera(0,0,0),this.addCamera(0,180,0)},n.prototype.addCamera=function(t,e,n){var r=new i;r.rotationX=t,r.rotationY=e,r.rotationZ=n,r.projection.near=.01;var s=r.projection;s.fieldOfView=90,this._projections.push(s),r.projection._iAspectRatio=1,this._depthCameras.push(r)},n.prototype.pCreateDepthTexture=function(){throw new t.errors.PartialImplementationError},n.prototype.pUpdateDepthProjection=function(){for(var t=this._pLight,e=t._pFallOff,i=this._pLight.scenePosition,n=0;6>n;++n)this._projections[n].far=e,this._depthCameras[n].transform.position=i,this._needsRender[n]=!0},n.prototype.pDrawDepthMap=function(t,e,i){for(var n=0;6>n;++n)this._needsRender[n]&&(this._pCasterCollector.camera=this._depthCameras[n],this._pCasterCollector.clear(),e.traversePartitions(this._pCasterCollector),i._iRender(this._pCasterCollector,t,null,n))},n}(e.ShadowMapperBase);e.CubeMapShadowMapper=n}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.entities.Camera,n=t.geom.Matrix3D,r=t.projections.FreeMatrixProjection,s=function(t){function e(){t.call(this),this._pLightOffset=1e4,this._pSnap=64,this._pCullPlanes=[],this._pOverallDepthProjection=new r,this._pOverallDepthCamera=new i(this._pOverallDepthProjection),this._pLocalFrustum=[],this._pMatrix=new n}return __extends(e,t),Object.defineProperty(e.prototype,"snap",{get:function(){return this._pSnap},set:function(t){this._pSnap=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightOffset",{get:function(){return this._pLightOffset},set:function(t){this._pLightOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iDepthProjection",{get:function(){return this._pOverallDepthCamera.viewProjection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this._pMaxZ-this._pMinZ},enumerable:!0,configurable:!0}),e.prototype.pDrawDepthMap=function(t,e,i){this._pCasterCollector.camera=this._pOverallDepthCamera,this._pCasterCollector.cullPlanes=this._pCullPlanes,this._pCasterCollector.clear(),e.traversePartitions(this._pCasterCollector),i._iRender(this._pCasterCollector,t)},e.prototype.pUpdateCullPlanes=function(t){var e=this._pOverallDepthCamera.frustumPlanes,i=t.frustumPlanes;this._pCullPlanes.length=4,this._pCullPlanes[0]=e[0],this._pCullPlanes[1]=e[1],this._pCullPlanes[2]=e[2],this._pCullPlanes[3]=e[3];for(var n=this._pLight,r=n.sceneDirection,s=r.x,a=r.y,o=r.z,h=4,p=0;6>p;++p){var u=i[p];u.a*s+u.b*a+u.c*o<0&&(this._pCullPlanes[h++]=u)}},e.prototype.pUpdateDepthProjection=function(t){this.pUpdateProjectionFromFrustumCorners(t,t.projection.frustumCorners,this._pMatrix),this._pOverallDepthProjection.matrix=this._pMatrix,this.pUpdateCullPlanes(t)},e.prototype.pUpdateProjectionFromFrustumCorners=function(t,e,i){var n,r,s,a,o,h,p,u,l,c=new Array,d=this._pLight;for(n=d.sceneDirection,this._pOverallDepthCamera.transform.matrix3D=this._pLight.sceneTransform,r=Math.floor((t.x-n.x*this._pLightOffset)/this._pSnap)*this._pSnap,s=Math.floor((t.y-n.y*this._pLightOffset)/this._pSnap)*this._pSnap,a=Math.floor((t.z-n.z*this._pLightOffset)/this._pSnap)*this._pSnap,this._pOverallDepthCamera.x=r,this._pOverallDepthCamera.y=s,this._pOverallDepthCamera.z=a,this._pMatrix.copyFrom(this._pOverallDepthCamera.inverseSceneTransform),this._pMatrix.prepend(t.sceneTransform),this._pMatrix.transformVectors(e,this._pLocalFrustum),o=p=this._pLocalFrustum[0],h=u=this._pLocalFrustum[1],this._pMaxZ=this._pLocalFrustum[2],l=3;24>l;)r=this._pLocalFrustum[l],s=this._pLocalFrustum[l+1],a=this._pLocalFrustum[l+2],o>r&&(o=r),r>p&&(p=r),h>s&&(h=s),s>u&&(u=s),a>this._pMaxZ&&(this._pMaxZ=a),l+=3;this._pMinZ=1;var _=p-o,f=u-h,g=1/(this._pMaxZ-this._pMinZ);0>o&&(o-=this._pSnap),0>h&&(h-=this._pSnap),o=Math.floor(o/this._pSnap)*this._pSnap,h=Math.floor(h/this._pSnap)*this._pSnap;var m=2*this._pSnap;_=Math.floor(_/m+2)*m,f=Math.floor(f/m+2)*m,p=o+_,u=h+f,_=1/_,f=1/f,c[0]=2*_,c[5]=2*f,c[10]=g,c[12]=-(p+o)*_,c[13]=-(u+h)*f,c[14]=-this._pMinZ*g,c[15]=1,c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=0,i.copyRawDataFrom(c)},e}(e.ShadowMapperBase);e.DirectionalShadowMapper=s}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.entities.Camera,n=t.events.Event,r=t.events.EventDispatcher,s=t.geom.Matrix3DUtils,a=t.geom.Rectangle,o=t.projections.FreeMatrixProjection,h=function(t){function e(e){if("undefined"==typeof e&&(e=3),t.call(this),this._pScissorRectsInvalid=!0,1>e||e>4)throw new Error("numCascades must be an integer between 1 and 4");this._numCascades=e,this._changeDispatcher=new r(this),this.init()}return __extends(e,t),e.prototype.getSplitRatio=function(t){return this._splitRatios[t]},e.prototype.setSplitRatio=function(t,e){if(0>e?e=0:e>1&&(e=1),t>=this._numCascades)throw new Error("index must be smaller than the number of cascades!");this._splitRatios[t]=e},e.prototype.getDepthProjections=function(t){return this._depthCameras[t].viewProjection},e.prototype.init=function(){this._splitRatios=new Array(this._numCascades),this._nearPlaneDistances=new Array(this._numCascades);for(var t=1,e=this._numCascades-1;e>=0;--e)this._splitRatios[e]=t,t*=.4;for(this._texOffsetsX=Array(-1,1,-1,1),this._texOffsetsY=Array(1,1,-1,-1),this._pScissorRects=new Array(4),this._depthLenses=new Array,this._depthCameras=new Array,e=0;e<this._numCascades;++e)this._depthLenses[e]=new o,this._depthCameras[e]=new i(this._depthLenses[e])},e.prototype._pSetDepthMapSize=function(e){t.prototype._pSetDepthMapSize.call(this,e),this.invalidateScissorRects()},e.prototype.invalidateScissorRects=function(){this._pScissorRectsInvalid=!0},Object.defineProperty(e.prototype,"numCascades",{get:function(){return this._numCascades},set:function(t){if(t!=this._numCascades){if(1>t||t>4)throw new Error("numCascades must be an integer between 1 and 4");this._numCascades=t,this.invalidateScissorRects(),this.init(),this.dispatchEvent(new n(n.CHANGE))}},enumerable:!0,configurable:!0}),e.prototype.pDrawDepthMap=function(t,e,i){this._pScissorRectsInvalid&&this.updateScissorRects(),this._pCasterCollector.cullPlanes=this._pCullPlanes,this._pCasterCollector.camera=this._pOverallDepthCamera,this._pCasterCollector.clear(),e.traversePartitions(this._pCasterCollector),i._iRenderCascades(this._pCasterCollector,t,this._numCascades,this._pScissorRects,this._depthCameras)},e.prototype.updateScissorRects=function(){var t=.5*this._pDepthMapSize;this._pScissorRects[0]=new a(0,0,t,t),this._pScissorRects[1]=new a(t,0,t,t),this._pScissorRects[2]=new a(0,t,t,t),this._pScissorRects[3]=new a(t,t,t,t),this._pScissorRectsInvalid=!1},e.prototype.pUpdateDepthProjection=function(t){var e,i=t.projection,n=i.near,r=i.far-n;this.pUpdateProjectionFromFrustumCorners(t,t.projection.frustumCorners,this._pMatrix),this._pMatrix.appendScale(.96,.96,1),this._pOverallDepthProjection.matrix=this._pMatrix,this.pUpdateCullPlanes(t);for(var s=0;s<this._numCascades;++s)e=this._depthLenses[s].matrix,this._nearPlaneDistances[s]=n+this._splitRatios[s]*r,this._depthCameras[s].transform=this._pOverallDepthCamera.transform,this.updateProjectionPartition(e,this._splitRatios[s],this._texOffsetsX[s],this._texOffsetsY[s]),this._depthLenses[s].matrix=e},e.prototype.updateProjectionPartition=function(t,e,i,n){for(var r,a,o,h,p,u,l,c=s.RAW_DATA_CONTAINER,d=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=Number.NEGATIVE_INFINITY,m=Number.NEGATIVE_INFINITY,y=0;12>y;)r=this._pLocalFrustum[y],a=this._pLocalFrustum[y+1],o=this._pLocalFrustum[y+2],h=r+(this._pLocalFrustum[y+12]-r)*e,p=a+(this._pLocalFrustum[y+13]-a)*e,u=o+(this._pLocalFrustum[y+14]-o)*e,d>r&&(d=r),r>f&&(f=r),_>a&&(_=a),a>g&&(g=a),o>m&&(m=o),d>h&&(d=h),h>f&&(f=h),_>p&&(_=p),p>g&&(g=p),u>m&&(m=u),y+=3;l=1;var b=f-d,x=g-_,v=1/(m-l);0>d&&(d-=this._pSnap),0>_&&(_-=this._pSnap),d=Math.floor(d/this._pSnap)*this._pSnap,_=Math.floor(_/this._pSnap)*this._pSnap;var w=2*this._pSnap;b=Math.floor(b/w+1)*w,x=Math.floor(x/w+1)*w,f=d+b,g=_+x,b=1/b,x=1/x,c[0]=2*b,c[5]=2*x,c[10]=v,c[12]=-(f+d)*b,c[13]=-(g+_)*x,c[14]=-l*v,c[15]=1,c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=0,t.copyRawDataFrom(c),t.appendScale(.96,.96,1),t.appendTranslation(i,n,0),t.appendScale(.5,.5,1)},e.prototype.addEventListener=function(t,e){this._changeDispatcher.addEventListener(t,e)},e.prototype.removeEventListener=function(t,e){this._changeDispatcher.removeEventListener(t,e)},e.prototype.dispatchEvent=function(t){return this._changeDispatcher.dispatchEvent(t)},e.prototype.hasEventListener=function(t){return this._changeDispatcher.hasEventListener(t)},Object.defineProperty(e.prototype,"_iNearPlaneDistances",{get:function(){return this._nearPlaneDistances},enumerable:!0,configurable:!0}),e}(e.DirectionalShadowMapper);e.CascadeShadowMapper=h}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=.5),t.call(this),this.coverageRatio=e}return __extends(e,t),Object.defineProperty(e.prototype,"coverageRatio",{get:function(){return this._coverageRatio},set:function(t){t>1?t=1:0>t&&(t=0),this._coverageRatio=t},enumerable:!0,configurable:!0}),e.prototype.pUpdateDepthProjection=function(t){for(var e=t.projection.frustumCorners,i=0;12>i;++i){var n=e[i];this._pLocalFrustum[i]=n,this._pLocalFrustum[i+12]=n+(e[i+12]-n)*this._coverageRatio}this.pUpdateProjectionFromFrustumCorners(t,this._pLocalFrustum,this._pMatrix),this._pOverallDepthProjection.matrix=this._pMatrix},e}(t.DirectionalShadowMapper);t.NearDirectionalShadowMapper=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.events.MaterialEvent,n=function(e){function n(t,i,n){"undefined"==typeof i&&(i="auto"),"undefined"==typeof n&&(n=!1);var r=this;e.call(this),this._pIsEntity=!0,this.onSizeChangedDelegate=function(t){return r.onSizeChanged(t)},this.material=t,this._billboardWidth=t.width,this._billboardHeight=t.height}return __extends(n,e),Object.defineProperty(n.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"assetType",{get:function(){return t.library.AssetType.BILLBOARD},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"billboardHeight",{get:function(){return this._billboardHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"billboardWidth",{get:function(){return this._billboardWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"material",{get:function(){return this._material},set:function(t){t!=this._material&&(this._material&&(this._material.iRemoveOwner(this),this._material.removeEventListener(i.SIZE_CHANGED,this.onSizeChangedDelegate)),this._material=t,this._material&&(this._material.iAddOwner(this),this._material.addEventListener(i.SIZE_CHANGED,this.onSizeChangedDelegate)))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"uvTransform",{get:function(){return this._uvTransform},set:function(t){this._uvTransform=t},enumerable:!0,configurable:!0}),n.prototype.pCreateEntityPartitionNode=function(){return new t.partition.EntityNode(this)},n.prototype.pUpdateBounds=function(){this._pBounds.fromExtremes(0,0,0,this._billboardWidth,this._billboardHeight,0),e.prototype.pUpdateBounds.call(this)},n.prototype._iTestCollision=function(t){return this._pPickingCollider.testBillboardCollision(this,this._pPickingCollisionVO,t)},n.prototype.onSizeChanged=function(){this._billboardWidth=this._material.width,this._billboardHeight=this._material.height,this._pBoundsInvalid=!0;for(var t=this._pRenderables.length,e=0;t>e;e++)this._pRenderables[e].invalidateVertexData("vertices")},n.prototype._iCollectRenderables=function(t){this._iSourcePrefab&&this._iSourcePrefab._iValidate(),this._iCollectRenderable(t)},n.prototype._iCollectRenderable=function(t){t.applyBillboard(this)},n}(t.base.DisplayObject);e.Billboard=n}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=t.bounds.NullBounds,n=t.geom.Matrix3D,r=t.geom.Vector3D,s=t.materials.DirectionalShadowMapper,a=t.partition.DirectionalLightNode,o=function(t){function e(e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=-1),"undefined"==typeof n&&(n=1),t.call(this),this._pIsEntity=!0,this.direction=new r(e,i,n),this._sceneDirection=new r}return __extends(e,t),Object.defineProperty(e.prototype,"sceneDirection",{get:function(){return this._pSceneTransformDirty&&this.pUpdateSceneTransform(),this._sceneDirection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t,this._tmpLookAt||(this._tmpLookAt=new r),this._tmpLookAt.x=this.x+this._direction.x,this._tmpLookAt.y=this.y+this._direction.y,this._tmpLookAt.z=this.z+this._direction.z,this.lookAt(this._tmpLookAt)},enumerable:!0,configurable:!0}),e.prototype.pCreateDefaultBoundingVolume=function(){return new i},e.prototype.pUpdateBounds=function(){},e.prototype.pUpdateSceneTransform=function(){t.prototype.pUpdateSceneTransform.call(this),this.sceneTransform.copyColumnTo(2,this._sceneDirection),this._sceneDirection.normalize()},e.prototype.pCreateShadowMapper=function(){return new s},e.prototype.pCreateEntityPartitionNode=function(){return new a(this)},e.prototype.iGetObjectProjectionMatrix=function(t,e,i){"undefined"==typeof i&&(i=null);var r=new Array,s=t.bounds,a=new n;a.copyFrom(t.getRenderSceneTransform(e)),a.append(this.inverseSceneTransform),this._projAABBPoints||(this._projAABBPoints=[]),a.transformVectors(s.aabbPoints,this._projAABBPoints);for(var o,h=1/0,p=-1/0,u=1/0,l=-1/0,c=1/0,d=-1/0,_=0;24>_;)o=this._projAABBPoints[_++],h>o&&(h=o),o>p&&(p=o),o=this._projAABBPoints[_++],u>o&&(u=o),o>l&&(l=o),o=this._projAABBPoints[_++],c>o&&(c=o),o>d&&(d=o);var f=1/(p-h),g=1/(l-u),m=1/(d-c);return r[0]=2*f,r[5]=2*g,r[10]=m,r[12]=-(p+h)*f,r[13]=-(l+u)*g,r[14]=-c*m,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=0,r[15]=1,i||(i=new n),i.copyRawDataFrom(r),i.prepend(a),i},e.prototype._iCollectRenderables=function(){},e}(t.base.LightBase);e.DirectionalLight=o}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=t.bounds.NullBounds,n=t.partition.LightProbeNode,r=function(e){function r(t,i){"undefined"==typeof i&&(i=null),e.call(this),this._pIsEntity=!0,this._diffuseMap=t,this._specularMap=i}return __extends(r,e),Object.defineProperty(r.prototype,"diffuseMap",{get:function(){return this._diffuseMap},set:function(t){this._diffuseMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"specularMap",{get:function(){return this._specularMap},set:function(t){this._specularMap=t},enumerable:!0,configurable:!0}),r.prototype.pCreateEntityPartitionNode=function(){return new n(this)},r.prototype.pUpdateBounds=function(){this._pBoundsInvalid=!1},r.prototype.pCreateDefaultBoundingVolume=function(){return new i},r.prototype.iGetObjectProjectionMatrix=function(e,i,n){throw"undefined"==typeof n&&(n=null),new t.errors.Error("Object projection matrices are not supported for LightProbe objects!")},r.prototype._iCollectRenderables=function(){},r}(t.base.LightBase);e.LightProbe=r}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=t.events.MaterialEvent,n=t.partition.EntityNode,r=function(e){function r(t,i,n,r){"undefined"==typeof r&&(r=1);var s=this;e.call(this),this._pIsEntity=!0,this.onSizeChangedDelegate=function(t){return s.onSizeChanged(t)},this.material=t,this._startPosition=i,this._endPosition=n,this._halfThickness=.5*r}return __extends(r,e),Object.defineProperty(r.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"assetType",{get:function(){return t.library.AssetType.LINE_SEGMENT},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"startPostion",{get:function(){return this._startPosition},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"startPosition",{set:function(t){this._startPosition!=t&&(this._startPosition=t,this.notifyRenderableUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"endPosition",{get:function(){return this._endPosition},set:function(t){this._endPosition!=t&&(this._endPosition=t,this.notifyRenderableUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this._material},set:function(t){t!=this._material&&(this._material&&(this._material.iRemoveOwner(this),this._material.removeEventListener(i.SIZE_CHANGED,this.onSizeChangedDelegate)),this._material=t,this._material&&(this._material.iAddOwner(this),this._material.addEventListener(i.SIZE_CHANGED,this.onSizeChangedDelegate)))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"thickness",{get:function(){return 2*this._halfThickness},set:function(t){this._halfThickness!=t&&(this._halfThickness=.5*t,this.notifyRenderableUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uvTransform",{get:function(){return this._uvTransform},set:function(t){this._uvTransform=t},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this._startPosition=null,this._endPosition=null},r.prototype.pCreateEntityPartitionNode=function(){return new n(this)},r.prototype.pUpdateBounds=function(){this._pBounds.fromExtremes(this._startPosition.x,this._startPosition.y,this._startPosition.z,this._endPosition.x,this._endPosition.y,this._endPosition.z),e.prototype.pUpdateBounds.call(this)},r.prototype.onSizeChanged=function(){this.notifyRenderableUpdate()},r.prototype.notifyRenderableUpdate=function(){for(var t=this._pRenderables.length,e=0;t>e;e++)this._pRenderables[e].invalidateVertexData("vertices")},r.prototype._iCollectRenderables=function(t){this._iSourcePrefab&&this._iSourcePrefab._iValidate(),this._iCollectRenderable(t)},r.prototype._iCollectRenderable=function(){},r}(t.base.DisplayObject);e.LineSegment=r}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=t.base.Geometry,n=t.events.GeometryEvent,r=function(e){function r(t,n){"undefined"==typeof n&&(n=null);var r=this;e.call(this),this._castsShadows=!0,this._shareAnimationGeometry=!0,this._pIsEntity=!0,this._subMeshes=new Array,this._onGeometryBoundsInvalidDelegate=function(t){return r.onGeometryBoundsInvalid(t)},this._onSubGeometryAddedDelegate=function(t){return r.onSubGeometryAdded(t)},this._onSubGeometryRemovedDelegate=function(t){return r.onSubGeometryRemoved(t)},this.geometry=t||new i,this.material=n}return __extends(r,e),Object.defineProperty(r.prototype,"animator",{get:function(){return this._animator},set:function(t){this._animator&&this._animator.removeOwner(this),this._animator=t;for(var e,i=this._subMeshes.length,n=0;i>n;++n)e=this._subMeshes[n],e.material&&(e.material.iRemoveOwner(e),e.material.iAddOwner(e)),e._iInvalidateRenderableGeometry();this._animator&&this._animator.addOwner(this)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"assetType",{get:function(){return t.library.AssetType.MESH},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"castsShadows",{get:function(){return this._castsShadows},set:function(t){this._castsShadows=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"geometry",{get:function(){return this._iSourcePrefab&&this._iSourcePrefab._iValidate(),this._geometry},set:function(t){var e;if(this._geometry){for(this._geometry.removeEventListener(n.BOUNDS_INVALID,this._onGeometryBoundsInvalidDelegate),this._geometry.removeEventListener(n.SUB_GEOMETRY_ADDED,this._onSubGeometryAddedDelegate),this._geometry.removeEventListener(n.SUB_GEOMETRY_REMOVED,this._onSubGeometryRemovedDelegate),e=0;e<this._subMeshes.length;++e)this._subMeshes[e].dispose();this._subMeshes.length=0}if(this._geometry=t,this._geometry){this._geometry.addEventListener(n.BOUNDS_INVALID,this._onGeometryBoundsInvalidDelegate),this._geometry.addEventListener(n.SUB_GEOMETRY_ADDED,this._onSubGeometryAddedDelegate),this._geometry.addEventListener(n.SUB_GEOMETRY_REMOVED,this._onSubGeometryRemovedDelegate);var i=this._geometry.subGeometries;for(e=0;e<i.length;++e)this.addSubMesh(i[e])}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this._material},set:function(t){if(t!=this._material){var e,i,n=this._subMeshes.length;for(e=0;n>e;e++)this._material&&(i=this._subMeshes[e]).material==this._material&&this._material.iRemoveOwner(i);for(this._material=t,e=0;n>e;e++)this._material&&(i=this._subMeshes[e]).material==this._material&&this._material.iAddOwner(i)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shareAnimationGeometry",{get:function(){return this._shareAnimationGeometry},set:function(t){this._shareAnimationGeometry=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subMeshes",{get:function(){return this._iSourcePrefab&&this._iSourcePrefab._iValidate(),this._subMeshes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uvTransform",{get:function(){return this._uvTransform},set:function(t){this._uvTransform=t},enumerable:!0,configurable:!0}),r.prototype.bakeTransformations=function(){this.geometry.applyTransformation(this._iMatrix3D),this._iMatrix3D.identity()},r.prototype.dispose=function(){e.prototype.dispose.call(this),this.material=null,this.geometry=null},r.prototype.disposeWithAnimatorAndChildren=function(){this.disposeWithChildren(),this._animator&&this._animator.dispose()},r.prototype.clone=function(){var t=new r(this._geometry,this._material);t._iMatrix3D=this._iMatrix3D,t.pivot=this.pivot,t.partition=this.partition,t.bounds=this.bounds.clone(),t.name=this.name,t.castsShadows=this.castsShadows,t.shareAnimationGeometry=this.shareAnimationGeometry,t.mouseEnabled=this.mouseEnabled,t.mouseChildren=this.mouseChildren,t.extra=this.extra;
for(var e=this._subMeshes.length,i=0;e>i;++i)t._subMeshes[i].material=this._subMeshes[i]._iGetExplicitMaterial();e=this.numChildren;var n;for(i=0;e>i;++i)n=this.getChildAt(i).clone(),t.addChild(n);return this._animator&&(t.animator=this._animator.clone()),t},r.prototype.getSubMeshFromSubGeometry=function(t){return this._subMeshes[this._geometry.subGeometries.indexOf(t)]},r.prototype.pCreateEntityPartitionNode=function(){return new t.partition.EntityNode(this)},r.prototype.pUpdateBounds=function(){this._pBounds.fromGeometry(this._geometry),e.prototype.pUpdateBounds.call(this)},r.prototype.onGeometryBoundsInvalid=function(){this.pInvalidateBounds()},r.prototype.onSubGeometryAdded=function(t){this.addSubMesh(t.subGeometry)},r.prototype.onSubGeometryRemoved=function(t){var e,i,n=t.subGeometry,r=this._subMeshes.length;for(i=0;r>i;++i)if(e=this._subMeshes[i],e.subGeometry==n){e.dispose(),this._subMeshes.splice(i,1);break}for(--r;r>i;++i)this._subMeshes[i]._iIndex=i},r.prototype.addSubMesh=function(t){var e=t.subMeshClass,i=new e(t,this,null),n=this._subMeshes.length;i._iIndex=n,this._subMeshes[n]=i,this.pInvalidateBounds()},r.prototype._iTestCollision=function(t,e){return this._pPickingCollider.testMeshCollision(this,this._pPickingCollisionVO,t,e)},r.prototype._iCollectRenderables=function(t){this._iSourcePrefab&&this._iSourcePrefab._iValidate();for(var e=this._subMeshes.length,i=0;e>i;i++)this._subMeshes[i]._iCollectRenderable(t)},r.prototype._iInvalidateRenderableGeometries=function(){for(var t=this._subMeshes.length,e=0;t>e;++e)this._subMeshes[e]._iInvalidateRenderableGeometry()},r}(t.containers.DisplayObjectContainer);e.Mesh=r}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=t.bounds.BoundingSphere,n=t.geom.Matrix3D,r=t.geom.Vector3D,s=t.materials.CubeMapShadowMapper,a=t.partition.PointLightNode,o=function(t){function e(){t.call(this),this._pRadius=9e4,this._pFallOff=1e5,this._pIsEntity=!0,this._pFallOffFactor=1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius)}return __extends(e,t),e.prototype.pCreateShadowMapper=function(){return new s},Object.defineProperty(e.prototype,"radius",{get:function(){return this._pRadius},set:function(t){this._pRadius=t,this._pRadius<0?this._pRadius=0:this._pRadius>this._pFallOff&&(this._pFallOff=this._pRadius,this.pInvalidateBounds()),this._pFallOffFactor=1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius)},enumerable:!0,configurable:!0}),e.prototype.iFallOffFactor=function(){return this._pFallOffFactor},Object.defineProperty(e.prototype,"fallOff",{get:function(){return this._pFallOff},set:function(t){this._pFallOff=t,this._pFallOff<0&&(this._pFallOff=0),this._pFallOff<this._pRadius&&(this._pRadius=this._pFallOff),this._pFallOffFactor=1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius),this.pInvalidateBounds()},enumerable:!0,configurable:!0}),e.prototype.pCreateEntityPartitionNode=function(){return new a(this)},e.prototype.pUpdateBounds=function(){this._pBounds.fromSphere(new r,this._pFallOff),this._pBoundsInvalid=!1},e.prototype.pCreateDefaultBoundingVolume=function(){return new i},e.prototype.iGetObjectProjectionMatrix=function(t,e,i){"undefined"==typeof i&&(i=null);var s=new Array(16),a=t.bounds,o=new n;o.copyFrom(t.getRenderSceneTransform(e)),o.append(this._pParent.inverseSceneTransform),this.lookAt(o.position),o.copyFrom(t.getRenderSceneTransform(e)),o.append(this.inverseSceneTransform);var h,p,u=a.aabb,l=o.deltaTransformVector(new r(u.left,u.bottom,u.front)),c=o.deltaTransformVector(new r(u.right,u.top,u.back)),d=l.x*l.x+l.y*l.y+l.z*l.z,_=c.x*c.x+c.y*c.y+c.z*c.z,f=Math.sqrt(d>_?d:_),g=o.rawData[14];return h=g-f,p=g+f,s[5]=s[0]=h/f,s[10]=p/(p-h),s[11]=1,s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[12]=s[13]=s[15]=0,s[14]=-h*s[10],i||(i=new n),i.copyRawDataFrom(s),i.prepend(o),i},e.prototype._iCollectRenderables=function(){},e}(t.base.LightBase);e.PointLight=o}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(){t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"graphics",{get:function(){return this._graphics},enumerable:!0,configurable:!0}),e}(t.base.DisplayObject);e.Shape=i}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=t.bounds.NullBounds,n=t.partition.SkyboxNode,r=function(e){function r(t){e.call(this),this._pIsEntity=!0,this.material=t}return __extends(r,e),Object.defineProperty(r.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uvTransform",{get:function(){return this._uvTransform},set:function(t){this._uvTransform=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this._material},set:function(t){t!=this._material&&(this._material&&this._material.iRemoveOwner(this),this._material=t,this._material&&this._material.iAddOwner(this))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"assetType",{get:function(){return t.library.AssetType.SKYBOX},enumerable:!0,configurable:!0}),r.prototype.pInvalidateBounds=function(){},r.prototype.pCreateEntityPartitionNode=function(){return new n(this)},r.prototype.pCreateDefaultBoundingVolume=function(){return new i},r.prototype.pUpdateBounds=function(){this._pBoundsInvalid=!1},Object.defineProperty(r.prototype,"castsShadows",{get:function(){return!1},enumerable:!0,configurable:!0}),r.prototype._iCollectRenderables=function(){},r.prototype._iCollectRenderable=function(){},r}(t.base.DisplayObject);e.Skybox=r}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(){t.call(this),this._text=""}return __extends(e,t),Object.defineProperty(e.prototype,"bottomScrollV",{get:function(){return this._bottomScrollV},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caretIndex",{get:function(){return this._caretIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.maxScrollH=function(){return this._maxScrollH},e.prototype.maxScrollV=function(){return this._maxScrollV},Object.defineProperty(e.prototype,"numLines",{get:function(){return this._numLines},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionBeginIndex",{get:function(){return this._selectionBeginIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionEndIndex",{get:function(){return this._selectionEndIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!=t&&(this._text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textInteractionMode",{get:function(){return this._textInteractionMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!0,configurable:!0}),e.prototype.appendText=function(){},e.prototype.getCharBoundaries=function(){return this._charBoundaries},e.prototype.getCharIndexAtPoint=function(){return this._charIndexAtPoint},e.prototype.getFirstCharInParagraph=function(){return this._firstCharInParagraph},e.prototype.getImageReference=function(){return this._imageReference},e.prototype.getLineIndexAtPoint=function(){return this._lineIndexAtPoint},e.prototype.getLineIndexOfChar=function(){return this._lineIndexOfChar},e.prototype.getLineLength=function(){return this._lineLength},e.prototype.getLineMetrics=function(){return this._lineMetrics},e.prototype.getLineOffset=function(){return this._lineOffset},e.prototype.getLineText=function(){return this._lineText},e.prototype.getParagraphLength=function(){return this._paragraphLength},e.prototype.getTextFormat=function(t,e){return"undefined"==typeof t&&(t=-1),"undefined"==typeof e&&(e=-1),this._textFormat},e.prototype.replaceSelectedText=function(){},e.prototype.replaceText=function(){},e.prototype.setSelection=function(){},e.prototype.setTextFormat=function(t,e,i){"undefined"==typeof e&&(e=-1),"undefined"==typeof i&&(i=-1)},e.isFontCompatible=function(){return!1},e}(t.base.DisplayObject);e.TextField=i}(t.entities||(t.entities={})),t.entities}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(){var e=this;this._viewLookup=new Array,this._nullVector=new t.geom.Vector3D,this._queuedEvents=new Array,this._mouseUp=new t.events.MouseEvent(t.events.MouseEvent.MOUSE_UP),this._mouseClick=new t.events.MouseEvent(t.events.MouseEvent.CLICK),this._mouseOut=new t.events.MouseEvent(t.events.MouseEvent.MOUSE_OUT),this._mouseDown=new t.events.MouseEvent(t.events.MouseEvent.MOUSE_DOWN),this._mouseMove=new t.events.MouseEvent(t.events.MouseEvent.MOUSE_MOVE),this._mouseOver=new t.events.MouseEvent(t.events.MouseEvent.MOUSE_OVER),this._mouseWheel=new t.events.MouseEvent(t.events.MouseEvent.MOUSE_WHEEL),this._mouseDoubleClick=new t.events.MouseEvent(t.events.MouseEvent.DOUBLE_CLICK),this.onClickDelegate=function(t){return e.onClick(t)},this.onDoubleClickDelegate=function(t){return e.onDoubleClick(t)},this.onMouseDownDelegate=function(t){return e.onMouseDown(t)},this.onMouseMoveDelegate=function(t){return e.onMouseMove(t)},this.onMouseUpDelegate=function(t){return e.onMouseUp(t)},this.onMouseWheelDelegate=function(t){return e.onMouseWheel(t)},this.onMouseOverDelegate=function(t){return e.onMouseOver(t)},this.onMouseOutDelegate=function(t){return e.onMouseOut(t)}}return e.getInstance=function(){return this._instance?this._instance:this._instance=new e},e.prototype.fireMouseEvents=function(t){this._iCollidingObject!=this._previousCollidingObject&&(this._previousCollidingObject&&this.queueDispatch(this._mouseOut,this._mouseMoveEvent,this._previousCollidingObject),this._iCollidingObject&&this.queueDispatch(this._mouseOver,this._mouseMoveEvent)),t&&this._iCollidingObject&&this.queueDispatch(this._mouseMove,this._mouseMoveEvent);for(var e,i,n=this._queuedEvents.length,r=0;n>r;++r){for(e=this._queuedEvents[r],i=e.object;i&&!i._iIsMouseEnabled();)i=i.parent;i&&i.dispatchEvent(e)}this._queuedEvents.length=0,this._previousCollidingObject=this._iCollidingObject,this._iUpdateDirty=!1},e.prototype.registerView=function(t){t.htmlElement.addEventListener("click",this.onClickDelegate),t.htmlElement.addEventListener("dblclick",this.onDoubleClickDelegate),t.htmlElement.addEventListener("mousedown",this.onMouseDownDelegate),t.htmlElement.addEventListener("mousemove",this.onMouseMoveDelegate),t.htmlElement.addEventListener("mouseup",this.onMouseUpDelegate),t.htmlElement.addEventListener("mousewheel",this.onMouseWheelDelegate),t.htmlElement.addEventListener("mouseover",this.onMouseOverDelegate),t.htmlElement.addEventListener("mouseout",this.onMouseOutDelegate),this._viewLookup.push(t)},e.prototype.unregisterView=function(t){t.htmlElement.removeEventListener("click",this.onClickDelegate),t.htmlElement.removeEventListener("dblclick",this.onDoubleClickDelegate),t.htmlElement.removeEventListener("mousedown",this.onMouseDownDelegate),t.htmlElement.removeEventListener("mousemove",this.onMouseMoveDelegate),t.htmlElement.removeEventListener("mouseup",this.onMouseUpDelegate),t.htmlElement.removeEventListener("mousewheel",this.onMouseWheelDelegate),t.htmlElement.removeEventListener("mouseover",this.onMouseOverDelegate),t.htmlElement.removeEventListener("mouseout",this.onMouseOutDelegate),this._viewLookup.slice(this._viewLookup.indexOf(t),1)},e.prototype.queueDispatch=function(t,e,i){"undefined"==typeof i&&(i=null),e&&(t.ctrlKey=e.ctrlKey,t.altKey=e.altKey,t.shiftKey=e.shiftKey,t.screenX=e.clientX,t.screenY=e.clientY),null==i&&(i=this._iCollidingObject),i?(t.object=i.displayObject,t.materialOwner=i.materialOwner,t.uv=i.uv,t.localPosition=i.localPosition?i.localPosition.clone():null,t.localNormal=i.localNormal?i.localNormal.clone():null,t.index=i.index):(t.uv=null,t.object=null,t.localPosition=this._nullVector,t.localNormal=this._nullVector,t.index=0,t.subGeometryIndex=0),this._queuedEvents.push(t)},e.prototype.onMouseMove=function(t){this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseMove,this._mouseMoveEvent=t)},e.prototype.onMouseOut=function(t){this._iActiveDiv=null,this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseOut,t)},e.prototype.onMouseOver=function(t){this._iActiveDiv=t.target,this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseOver,t)},e.prototype.onClick=function(t){this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseClick,t)},e.prototype.onDoubleClick=function(t){this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseDoubleClick,t)},e.prototype.onMouseDown=function(t){this._iActiveDiv=t.target,this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseDown,t)},e.prototype.onMouseUp=function(t){this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseUp,t)},e.prototype.onMouseWheel=function(t){this.updateColliders(t),this._iCollidingObject&&this.queueDispatch(this._mouseWheel,t)},e.prototype.updateColliders=function(t){if(!this._iUpdateDirty){for(var e,i,n=t.clientX,r=t.clientY,s=this._viewLookup.length,a=0;s>a;a++)if(e=this._viewLookup[a],i=e.htmlElement.getBoundingClientRect(),n<i.left||n>i.right||r<i.top||r>i.bottom)e._pMouseX=null,e._pMouseY=null;else if(e._pMouseX=n+i.left,e._pMouseY=r+i.top,e.updateCollider(),e.layeredView&&this._iCollidingObject)break;this._iUpdateDirty=!0}},e}();e.MouseManager=i}(t.managers||(t.managers={})),t.managers}(away||(away={}));var away;!function(t){!function(e){var i=t.base.Stage,n=t.events.StageEvent,r=function(e){function r(t){var i=this;if(e.call(this),!t)throw new Error("This class is a multiton and cannot be instantiated manually. Use StageManager.getInstance instead.");this._stages=new Array(r.STAGE_MAX_QUANTITY),this._onContextCreatedDelegate=function(t){return i.onContextCreated(t)}}return __extends(r,e),r.getInstance=function(){return null==this._instance&&(this._instance=new r(new StageManagerSingletonEnforcer)),this._instance},r.prototype.getStageAt=function(e,s,a,o){if("undefined"==typeof s&&(s=!1),"undefined"==typeof a&&(a="baseline"),"undefined"==typeof o&&(o="auto"),0>e||e>=r.STAGE_MAX_QUANTITY)throw new t.errors.ArgumentError("Index is out of bounds [0.."+r.STAGE_MAX_QUANTITY+"]");if(!this._stages[e]){r._numStages++;var h=document.createElement("canvas");h.id="stage"+e,document.body.appendChild(h);var p=this._stages[e]=new i(h,e,this,s,a);p.addEventListener(n.CONTEXT_CREATED,this._onContextCreatedDelegate),p.requestContext(s,a,o)}return p},r.prototype.iRemoveStage=function(t){r._numStages--,t.removeEventListener(n.CONTEXT_CREATED,this._onContextCreatedDelegate),this._stages[t.stageIndex]=null},r.prototype.getFreeStage=function(t,e,i){"undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e="baseline"),"undefined"==typeof i&&(i="auto");for(var n=0,r=this._stages.length;r>n;){if(!this._stages[n])return this.getStageAt(n,t,e,i);++n}return null},Object.defineProperty(r.prototype,"hasFreeStage",{get:function(){return r._numStages<r.STAGE_MAX_QUANTITY?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numSlotsFree",{get:function(){return r.STAGE_MAX_QUANTITY-r._numStages},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numSlotsUsed",{get:function(){return r._numStages},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numSlotsTotal",{get:function(){return this._stages.length},enumerable:!0,configurable:!0}),r.prototype.onContextCreated=function(){},r.STAGE_MAX_QUANTITY=8,r._numStages=0,r}(t.events.EventDispatcher);e.StageManager=r}(t.managers||(t.managers={})),t.managers}(away||(away={}));var StageManagerSingletonEnforcer=function(){function t(){}return t}(),away;!function(t){!function(e){var i=t.events.AssetEvent,n=t.events.IOErrorEvent,r=t.events.LoaderEvent,s=t.events.ParserEvent,a=t.library.AssetLoader,o=function(e){function o(i,n){"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=null),e.call(this),this._loadingSessions=new Array,this._useAssetLib=i,this._assetLibId=n,this._onResourceCompleteDelegate=t.utils.Delegate.create(this,this.onResourceComplete),this._onAssetCompleteDelegate=t.utils.Delegate.create(this,this.onAssetComplete)}return __extends(o,e),Object.defineProperty(o.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"contentLoaderInfo",{get:function(){return this._contentLoaderInfo},enumerable:!0,configurable:!0}),o.prototype.close=function(){if(this._useAssetLib){var e;return e=t.library.AssetLibraryBundle.getInstance(this._assetLibId),e.stopAllLoadingSessions(),void(this._loadingSessions=null)}var i,n=this._loadingSessions.length;for(i=0;n>i;i++)this.removeListeners(this._loadingSessions[i]),this._loadingSessions[i].stop(),this._loadingSessions[i]=null;this._loadingSessions=null},o.prototype.load=function(e,i,n,r){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null);var s;if(this._useAssetLib){var o;o=t.library.AssetLibraryBundle.getInstance(this._assetLibId),s=o.load(e,i,n,r)}else{var h=new a;this._loadingSessions.push(h),s=h.load(e,i,n,r)}return s.addEventListener(t.events.LoaderEvent.RESOURCE_COMPLETE,this._onResourceCompleteDelegate),s.addEventListener(t.events.AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),s._iLoader._iAddErrorHandler(this.onLoadError),s._iLoader._iAddParseErrorHandler(this.onParseError),s},o.prototype.loadData=function(e,i,n,r){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null);var s;if(this._useAssetLib){var o;o=t.library.AssetLibraryBundle.getInstance(this._assetLibId),s=o.loadData(e,i,n,r)}else{var h=new a;this._loadingSessions.push(h),s=h.loadData(e,"",i,n,r)}return s.addEventListener(t.events.LoaderEvent.RESOURCE_COMPLETE,this._onResourceCompleteDelegate),s.addEventListener(t.events.AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),s._iLoader._iAddErrorHandler(this.onLoadError),s._iLoader._iAddParseErrorHandler(this.onParseError),s},o.prototype.unload=function(){},o.enableParser=function(t){a.enableParser(t)},o.enableParsers=function(t){a.enableParsers(t)},o.prototype.removeListeners=function(t){t.removeEventListener(r.RESOURCE_COMPLETE,this._onResourceCompleteDelegate),t.removeEventListener(i.ASSET_COMPLETE,this._onAssetCompleteDelegate)},o.prototype.onAssetComplete=function(t){this.dispatchEvent(t)},o.prototype.onLoadError=function(t){return this.hasEventListener(n.IO_ERROR)?(this.dispatchEvent(t),!0):!1},o.prototype.onParseError=function(t){return this.hasEventListener(s.PARSE_ERROR)?(this.dispatchEvent(t),!0):!1},o.prototype.onResourceComplete=function(t){var e=t.content;this._content=e,e&&this.addChild(e),this.dispatchEvent(t)},o}(e.DisplayObjectContainer);e.Loader=o}(t.containers||(t.containers={})),t.containers}(away||(away={}));var away;!function(t){!function(e){var i=t.containers.DisplayObjectContainer,n=t.events.SceneEvent,r=t.partition.NodeBase,s=t.partition.Partition,a=function(t){function e(){t.call(this),this._expandedPartitions=new Array,this._partitions=new Array,this._iCollectionMark=0,this._iSceneGraphRoot=new i,this._iSceneGraphRoot._iSetScene(this),this._iSceneGraphRoot._iIsRoot=!0,this._iSceneGraphRoot.partition=new s(new r)}return __extends(e,t),e.prototype.traversePartitions=function(t){var e=0,i=this._partitions.length;for(t.scene=this;i>e;)this._iCollectionMark++,this._partitions[e++].traverse(t)},Object.defineProperty(e.prototype,"partition",{get:function(){return this._iSceneGraphRoot.partition},set:function(t){this._iSceneGraphRoot.partition=t,this.dispatchEvent(new n(n.PARTITION_CHANGED,this._iSceneGraphRoot))},enumerable:!0,configurable:!0}),e.prototype.contains=function(t){return this._iSceneGraphRoot.contains(t)},e.prototype.addChild=function(t){return this._iSceneGraphRoot.addChild(t)},e.prototype.removeChild=function(t){this._iSceneGraphRoot.removeChild(t)},e.prototype.removeChildAt=function(t){this._iSceneGraphRoot.removeChildAt(t)},e.prototype.getChildAt=function(t){return this._iSceneGraphRoot.getChildAt(t)},Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._iSceneGraphRoot.numChildren},enumerable:!0,configurable:!0}),e.prototype.iRegisterEntity=function(t){t.partition&&this.iRegisterPartition(t.partition),t.isEntity&&t._iAssignedPartition.iMarkForUpdate(t)},e.prototype.iRegisterPartition=function(t){this._expandedPartitions.push(t),-1==this._partitions.indexOf(t)&&this._partitions.push(t)},e.prototype.iUnregisterEntity=function(t){t.partition&&this.iUnregisterPartition(t.partition),t.isEntity&&t._iAssignedPartition.iRemoveEntity(t)},e.prototype.iUnregisterPartition=function(t){this._expandedPartitions.splice(this._expandedPartitions.indexOf(t),1),-1==this._expandedPartitions.indexOf(t)&&this._partitions.splice(this._partitions.indexOf(t),1)},e}(t.events.EventDispatcher);e.Scene=a}(t.containers||(t.containers={})),t.containers}(away||(away={}));var away;!function(t){!function(e){var i=t.containers.Scene,n=t.entities.Camera,r=t.events.CameraEvent,s=t.events.SceneEvent,a=t.events.RendererEvent,o=t.managers.MouseManager,h=t.pick.RaycastPicker,p=t.utils.Delegate,u=function(){function e(t,e,r){"undefined"==typeof e&&(e=null),"undefined"==typeof r&&(r=null),this._width=0,this._height=0,this._time=0,this._deltaTime=0,this._backgroundColor=0,this._backgroundAlpha=1,this._viewportDirty=!0,this._scissorDirty=!0,this._mousePicker=new h,this._onScenePartitionChangedDelegate=p.create(this,this.onScenePartitionChanged),this._onProjectionChangedDelegate=p.create(this,this.onProjectionChanged),this._onViewportUpdatedDelegate=p.create(this,this.onViewportUpdated),this._onScissorUpdatedDelegate=p.create(this,this.onScissorUpdated),this.scene=e||new i,this.camera=r||new n,this.renderer=t,document.body.style.margin="0px",this._htmlElement=document.createElement("div"),this._htmlElement.style.position="absolute",document.body.appendChild(this._htmlElement),this._mouseManager=o.getInstance(),this._mouseManager.registerView(this)}return e.prototype.onScenePartitionChanged=function(){this._pCamera&&(this._pCamera.partition=this.scene.partition)},Object.defineProperty(e.prototype,"mouseX",{get:function(){return this._pMouseX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseY",{get:function(){return this._pMouseY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"htmlElement",{get:function(){return this._htmlElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){return this._pRenderer},set:function(t){this._pRenderer!=t&&(this._pRenderer&&(this._pRenderer.dispose(),this._pRenderer.removeEventListener(a.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pRenderer.removeEventListener(a.SCISSOR_UPDATED,this._onScissorUpdatedDelegate)),this._pRenderer=t,this._pRenderer.addEventListener(a.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pRenderer.addEventListener(a.SCISSOR_UPDATED,this._onScissorUpdatedDelegate),this._pEntityCollector=this._pRenderer._iCreateEntityCollector(),this._pCamera&&(this._pEntityCollector.camera=this._pCamera),this._pRenderer._iBackgroundR=(this._backgroundColor>>16&255)/255,this._pRenderer._iBackgroundG=(this._backgroundColor>>8&255)/255,this._pRenderer._iBackgroundB=(255&this._backgroundColor)/255,this._pRenderer._iBackgroundAlpha=this._backgroundAlpha,this._pRenderer.width=this._width,this._pRenderer.height=this._height,this._pRenderer.shareContext=this._shareContext)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shareContext",{get:function(){return this._shareContext},set:function(t){this._shareContext!=t&&(this._shareContext=t,this._pRenderer&&(this._pRenderer.shareContext=this._shareContext))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor!=t&&(this._backgroundColor=t,this._pRenderer._iBackgroundR=(t>>16&255)/255,this._pRenderer._iBackgroundG=(t>>8&255)/255,this._pRenderer._iBackgroundB=(255&t)/255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(t){t>1?t=1:0>t&&(t=0),this._backgroundAlpha!=t&&(this._pRenderer._iBackgroundAlpha=this._backgroundAlpha=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera",{get:function(){return this._pCamera},set:function(t){this._pCamera!=t&&(this._pCamera&&this._pCamera.removeEventListener(r.PROJECTION_CHANGED,this._onProjectionChangedDelegate),this._pCamera=t,this._pEntityCollector&&(this._pEntityCollector.camera=this._pCamera),this._pScene&&(this._pCamera.partition=this._pScene.partition),this._pCamera.addEventListener(r.PROJECTION_CHANGED,this._onProjectionChangedDelegate),this._scissorDirty=!0,this._viewportDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._pScene},set:function(t){this._pScene!=t&&(this._pScene&&this._pScene.removeEventListener(s.PARTITION_CHANGED,this._onScenePartitionChangedDelegate),this._pScene=t,this._pScene.addEventListener(s.PARTITION_CHANGED,this._onScenePartitionChangedDelegate),this._pCamera&&(this._pCamera.partition=this._pScene.partition))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deltaTime",{get:function(){return this._deltaTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width!=t&&(this._width=t,this._aspectRatio=this._width/this._height,this._pCamera.projection._iAspectRatio=this._aspectRatio,this._pRenderer.width=t,this._htmlElement.style.width=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height!=t&&(this._height=t,this._aspectRatio=this._width/this._height,this._pCamera.projection._iAspectRatio=this._aspectRatio,this._pRenderer.height=t,this._htmlElement.style.height=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mousePicker",{get:function(){return this._mousePicker},set:function(t){this._mousePicker!=t&&(this._mousePicker=null==t?new h:t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._pRenderer.x},set:function(t){this._pRenderer.x!=t&&(this._pRenderer.x==t,this._htmlElement.style.left=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._pRenderer.y},set:function(t){this._pRenderer.y!=t&&(this._pRenderer.y==t,this._htmlElement.style.top=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return"visible"==this._htmlElement.style.visibility},set:function(t){this._htmlElement.style.visibility=t?"visible":"hidden"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedFacesCount",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.render=function(){this.pUpdateTime(),this._pCamera.projection._iAspectRatio=this._aspectRatio,this._scissorDirty&&(this._scissorDirty=!1,this._pCamera.projection._iUpdateScissorRect(this._pRenderer.scissorRect.x,this._pRenderer.scissorRect.y,this._pRenderer.scissorRect.width,this._pRenderer.scissorRect.height)),this._viewportDirty&&(this._viewportDirty=!1,this._pCamera.projection._iUpdateViewport(this._pRenderer.viewPort.x,this._pRenderer.viewPort.y,this._pRenderer.viewPort.width,this._pRenderer.viewPort.height)),this._shareContext||(this.forceMouseMove&&this._htmlElement==this._mouseManager._iActiveDiv&&!this._mouseManager._iUpdateDirty&&(this._mouseManager._iCollidingObject=this.mousePicker.getViewCollision(this._pMouseX,this._pMouseY,this)),this._mouseManager.fireMouseEvents(this.forceMouseMove)),this._pEntityCollector.clear(),this._pScene.traversePartitions(this._pEntityCollector),this._pRenderer.render(this._pEntityCollector)},e.prototype.pUpdateTime=function(){var e=t.utils.getTimer();0==this._time&&(this._time=e),this._deltaTime=e-this._time,this._time=e},e.prototype.dispose=function(){this._pRenderer.dispose(),this._mouseManager.unregisterView(this),this._mouseManager=null,this._pRenderer=null,this._pEntityCollector=null},Object.defineProperty(e.prototype,"iEntityCollector",{get:function(){return this._pEntityCollector},enumerable:!0,configurable:!0}),e.prototype.onProjectionChanged=function(){this._scissorDirty=!0,this._viewportDirty=!0},e.prototype.onViewportUpdated=function(){this._viewportDirty=!0},e.prototype.onScissorUpdated=function(){this._scissorDirty=!0},e.prototype.project=function(t){var e=this._pCamera.project(t);return e.x=e.x*this._pRenderer.viewPort.width/2+this._width*this._pCamera.projection.originX,e.y=e.y*this._pRenderer.viewPort.height/2+this._height*this._pCamera.projection.originY,e},e.prototype.unproject=function(t,e,i){return this._pCamera.unproject(2*(t-this._width*this._pCamera.projection.originX)/this._pRenderer.viewPort.width,2*(e-this._height*this._pCamera.projection.originY)/this._pRenderer.viewPort.height,i)},e.prototype.getRay=function(t,e,i){return this._pCamera.getRay((2*t-this._width)/this._width,(2*e-this._height)/this._height,i)},e.prototype.updateCollider=function(){if(this._shareContext){var t=this.mousePicker.getViewCollision(this._pMouseX,this._pMouseY,this);(this.layeredView||null==this._mouseManager._iCollidingObject||t.rayEntryDistance<this._mouseManager._iCollidingObject.rayEntryDistance)&&(this._mouseManager._iCollidingObject=t)}else this._htmlElement==this._mouseManager._iActiveDiv&&(this._mouseManager._iCollidingObject=this.mousePicker.getViewCollision(this._pMouseX,this._pMouseY,this))},e}();e.View=u}(t.containers||(t.containers={})),t.containers}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=function(){function t(t){"undefined"==typeof t&&(t=null),this._pAutoUpdate=!0,this.targetObject=t}return t.prototype.pNotifyUpdate=function(){this._pTargetObject&&this._pTargetObject._iAssignedPartition&&this._pAutoUpdate&&this._pTargetObject._iAssignedPartition.iMarkForUpdate(this._pTargetObject)},Object.defineProperty(t.prototype,"targetObject",{get:function(){return this._pTargetObject},set:function(t){this._pTargetObject!=t&&(this._pTargetObject&&this._pAutoUpdate&&(this._pTargetObject._iController=null),this._pTargetObject=t,this._pTargetObject&&this._pAutoUpdate&&(this._pTargetObject._iController=this),this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._pAutoUpdate},set:function(t){this._pAutoUpdate!=t&&(this._pAutoUpdate=t,this._pTargetObject&&(this._pTargetObject._iController=this._pTargetObject?this:null))},enumerable:!0,configurable:!0}),t.prototype.update=function(t){throw"undefined"==typeof t&&(t=!0),new i},t}();e.ControllerBase=n}(t.controllers||(t.controllers={})),t.controllers}(away||(away={}));var away;!function(t){!function(e){var i=t.events.DisplayObjectEvent,n=t.geom.Vector3D,r=function(e){function r(i,r){"undefined"==typeof i&&(i=null),"undefined"==typeof r&&(r=null),e.call(this,i),this._pOrigin=new n(0,0,0),this._onLookAtObjectChangedDelegate=t.utils.Delegate.create(this,this.onLookAtObjectChanged),r?this.lookAtObject=r:this.lookAtPosition=new n}return __extends(r,e),Object.defineProperty(r.prototype,"lookAtPosition",{get:function(){return this._pLookAtPosition},set:function(t){this._pLookAtObject&&(this._pLookAtObject.removeEventListener(i.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate),this._pLookAtObject=null),this._pLookAtPosition=t,this.pNotifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lookAtObject",{get:function(){return this._pLookAtObject},set:function(t){this._pLookAtPosition&&(this._pLookAtPosition=null),this._pLookAtObject!=t&&(this._pLookAtObject&&this._pLookAtObject.removeEventListener(i.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate),this._pLookAtObject=t,this._pLookAtObject&&this._pLookAtObject.addEventListener(i.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate),this.pNotifyUpdate())},enumerable:!0,configurable:!0}),r.prototype.update=function(t){"undefined"==typeof t&&(t=!0),this._pTargetObject&&(this._pLookAtPosition?this._pTargetObject.lookAt(this._pLookAtPosition):this._pLookAtObject&&this._pTargetObject.lookAt(this._pLookAtObject.scene?this._pLookAtObject.scenePosition:this._pLookAtObject.transform.position))
},r.prototype.onLookAtObjectChanged=function(){this.pNotifyUpdate()},r}(e.ControllerBase);e.LookAtController=r}(t.controllers||(t.controllers={})),t.controllers}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.MathConsts,n=t.geom.Vector3D,r=function(t){function e(e,i,r,s,a,o,h,p,u,l,c,d){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=90),"undefined"==typeof a&&(a=1e3),"undefined"==typeof o&&(o=-90),"undefined"==typeof h&&(h=90),"undefined"==typeof p&&(p=null),"undefined"==typeof u&&(u=null),"undefined"==typeof l&&(l=8),"undefined"==typeof c&&(c=2),"undefined"==typeof d&&(d=!1),t.call(this,e,i),this._iCurrentPanAngle=0,this._iCurrentTiltAngle=90,this._panAngle=0,this._tiltAngle=90,this._distance=1e3,this._minPanAngle=-1/0,this._maxPanAngle=1/0,this._minTiltAngle=-90,this._maxTiltAngle=90,this._steps=8,this._yFactor=2,this._wrapPanAngle=!1,this._upAxis=new n,this.distance=a,this.panAngle=r,this.tiltAngle=s,this.minPanAngle=null!=p?p:-1/0,this.maxPanAngle=null!=u?u:1/0,this.minTiltAngle=o,this.maxTiltAngle=h,this.steps=l,this.yFactor=c,this.wrapPanAngle=d,this._iCurrentPanAngle=this._panAngle,this._iCurrentTiltAngle=this._tiltAngle}return __extends(e,t),Object.defineProperty(e.prototype,"steps",{get:function(){return this._steps},set:function(t){t=1>t?1:t,this._steps!=t&&(this._steps=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){t=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,t)),this._panAngle!=t&&(this._panAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!=t&&(this._tiltAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance!=t&&(this._distance=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(t){this._minPanAngle!=t&&(this._minPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(t){this._maxPanAngle!=t&&(this._maxPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!=t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!=t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yFactor",{get:function(){return this._yFactor},set:function(t){this._yFactor!=t&&(this._yFactor=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!=t&&(this._wrapPanAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),e.prototype.update=function(t){if("undefined"==typeof t&&(t=!0),this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){if(this.pNotifyUpdate(),this._wrapPanAngle){for(this._panAngle<0?(this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle,this._panAngle=this._panAngle%360+360):(this._iCurrentPanAngle+=this._panAngle%360-this._panAngle,this._panAngle=this._panAngle%360);this._panAngle-this._iCurrentPanAngle<-180;)this._iCurrentPanAngle-=360;for(;this._panAngle-this._iCurrentPanAngle>180;)this._iCurrentPanAngle+=360}t?(this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1),this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+1)):(this._iCurrentPanAngle=this._panAngle,this._iCurrentTiltAngle=this._tiltAngle),Math.abs(this.tiltAngle-this._iCurrentTiltAngle)<.01&&Math.abs(this._panAngle-this._iCurrentPanAngle)<.01&&(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle)}var e=this.lookAtObject?this.lookAtObject.transform.position:this.lookAtPosition?this.lookAtPosition:this._pOrigin;this.targetObject.x=e.x+this.distance*Math.sin(this._iCurrentPanAngle*i.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*i.DEGREES_TO_RADIANS),this.targetObject.y=e.y+this.distance*Math.sin(this._iCurrentTiltAngle*i.DEGREES_TO_RADIANS)*this.yFactor,this.targetObject.z=e.z+this.distance*Math.cos(this._iCurrentPanAngle*i.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*i.DEGREES_TO_RADIANS),this._upAxis.x=-Math.sin(this._iCurrentPanAngle*i.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*i.DEGREES_TO_RADIANS),this._upAxis.y=Math.cos(this._iCurrentTiltAngle*i.DEGREES_TO_RADIANS),this._upAxis.z=-Math.cos(this._iCurrentPanAngle*i.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*i.DEGREES_TO_RADIANS),this._pTargetObject&&(this._pLookAtPosition?this._pTargetObject.lookAt(this._pLookAtPosition,this._upAxis):this._pLookAtObject&&this._pTargetObject.lookAt(this._pLookAtObject.scene?this._pLookAtObject.scenePosition:this._pLookAtObject.transform.position,this._upAxis))},e}(e.LookAtController);e.HoverController=r}(t.controllers||(t.controllers={})),t.controllers}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i,n,r,s,a,o){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=90),"undefined"==typeof r&&(r=-90),"undefined"==typeof s&&(s=90),"undefined"==typeof a&&(a=8),"undefined"==typeof o&&(o=!1),e.call(this,t),this._iCurrentPanAngle=0,this._iCurrentTiltAngle=90,this._panAngle=0,this._tiltAngle=90,this._minTiltAngle=-90,this._maxTiltAngle=90,this._steps=8,this._walkIncrement=0,this._strafeIncrement=0,this._wrapPanAngle=!1,this.fly=!1,this.panAngle=i,this.tiltAngle=n,this.minTiltAngle=r,this.maxTiltAngle=s,this.steps=a,this.wrapPanAngle=o,this._iCurrentPanAngle=this._panAngle,this._iCurrentTiltAngle=this._tiltAngle}return __extends(i,e),Object.defineProperty(i.prototype,"steps",{get:function(){return this._steps},set:function(t){t=1>t?1:t,this._steps!=t&&(this._steps=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){this._panAngle!=t&&(this._panAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!=t&&(this._tiltAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!=t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!=t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!=t&&(this._wrapPanAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),i.prototype.update=function(e){if("undefined"==typeof e&&(e=!0),this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){if(this.pNotifyUpdate(),this._wrapPanAngle){for(this._panAngle<0?(this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle,this._panAngle=this._panAngle%360+360):(this._iCurrentPanAngle+=this._panAngle%360-this._panAngle,this._panAngle=this._panAngle%360);this._panAngle-this._iCurrentPanAngle<-180;)this._iCurrentPanAngle-=360;for(;this._panAngle-this._iCurrentPanAngle>180;)this._iCurrentPanAngle+=360}e?(this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1),this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+1)):(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle),Math.abs(this.tiltAngle-this._iCurrentTiltAngle)<.01&&Math.abs(this._panAngle-this._iCurrentPanAngle)<.01&&(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle)}this.targetObject.rotationX=this._iCurrentTiltAngle,this.targetObject.rotationY=this._iCurrentPanAngle,this._walkIncrement&&(this.fly?this.targetObject.transform.moveForward(this._walkIncrement):(this.targetObject.x+=this._walkIncrement*Math.sin(this._panAngle*t.geom.MathConsts.DEGREES_TO_RADIANS),this.targetObject.z+=this._walkIncrement*Math.cos(this._panAngle*t.geom.MathConsts.DEGREES_TO_RADIANS)),this._walkIncrement=0),this._strafeIncrement&&(this.targetObject.transform.moveRight(this._strafeIncrement),this._strafeIncrement=0)},i.prototype.incrementWalk=function(t){0!=t&&(this._walkIncrement+=t,this.pNotifyUpdate())},i.prototype.incrementStrafe=function(t){0!=t&&(this._strafeIncrement+=t,this.pNotifyUpdate())},i}(e.ControllerBase);e.FirstPersonController=i}(t.controllers||(t.controllers={})),t.controllers}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=45),"undefined"==typeof r&&(r=700),t.call(this,e,i,0,n,r)}return __extends(e,t),e.prototype.update=function(e){"undefined"==typeof e&&(e=!0),e=e,this.lookAtObject&&(this.panAngle=this._pLookAtObject.rotationY-180,t.prototype.update.call(this))},e}(t.HoverController);t.FollowController=e}(t.controllers||(t.controllers={})),t.controllers}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=function(t){function e(e,n,r,s,a){"undefined"==typeof e&&(e=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=40),"undefined"==typeof a&&(a=4),t.call(this,e,n),this.positionOffset=new i(0,500,-1e3),this.stiffness=r,this.damping=a,this.mass=s,this._velocity=new i,this._dv=new i,this._stretch=new i,this._force=new i,this._acceleration=new i,this._desiredPosition=new i}return __extends(e,t),e.prototype.update=function(e){"undefined"==typeof e&&(e=!0);var i;this._pLookAtObject&&this._pTargetObject&&(i=this._pLookAtObject.transform.matrix3D.deltaTransformVector(this.positionOffset),this._desiredPosition.x=this._pLookAtObject.x+i.x,this._desiredPosition.y=this._pLookAtObject.y+i.y,this._desiredPosition.z=this._pLookAtObject.z+i.z,this._stretch=this._pTargetObject.transform.position.add(this._desiredPosition),this._stretch.scaleBy(-this.stiffness),this._dv.copyFrom(this._velocity),this._dv.scaleBy(this.damping),this._force.x=this._stretch.x-this._dv.x,this._force.y=this._stretch.y-this._dv.y,this._force.z=this._stretch.z-this._dv.z,this._acceleration.copyFrom(this._force),this._acceleration.scaleBy(1/this.mass),this._velocity.incrementBy(this._acceleration),this._pTargetObject.transform.position=this._pTargetObject.transform.position.add(this._velocity),t.prototype.update.call(this))},e}(e.LookAtController);e.SpringController=n}(t.controllers||(t.controllers={})),t.controllers}(away||(away={}));var away;!function(t){!function(e){var i=t.library.AssetType,n=function(t){function e(){t.call(this),this._pNumPointLights=0,this._pNumDirectionalLights=0,this._pNumCastingPointLights=0,this._pNumCastingDirectionalLights=0,this._pNumLightProbes=0}return __extends(e,t),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"assetType",{get:function(){return i.LIGHT_PICKER},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numPointLights",{get:function(){return this._pNumPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numCastingDirectionalLights",{get:function(){return this._pNumCastingDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numCastingPointLights",{get:function(){return this._pNumCastingPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numLightProbes",{get:function(){return this._pNumLightProbes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointLights",{get:function(){return this._pPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalLights",{get:function(){return this._pDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"castingPointLights",{get:function(){return this._pCastingPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"castingDirectionalLights",{get:function(){return this._pCastingDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightProbes",{get:function(){return this._pLightProbes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightProbeWeights",{get:function(){return this._pLightProbeWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allPickedLights",{get:function(){return this._pAllPickedLights},enumerable:!0,configurable:!0}),e.prototype.collectLights=function(t){this.updateProbeWeights(t)},e.prototype.updateProbeWeights=function(t){var e,i,n,r,s,a,o=t.sourceEntity.scenePosition,h=o.x,p=o.y,u=o.z,l=0;for(a=0;a<this._pNumLightProbes;++a)e=this._pLightProbes[a].scenePosition,i=h-e.x,n=p-e.y,r=u-e.z,s=i*i+n*n+r*r,s=s>1e-5?1/s:5e7,this._pLightProbeWeights[a]=s,l+=s;for(l=1/l,a=0;a<this._pNumLightProbes;++a)this._pLightProbeWeights[a]*=l},e}(t.library.NamedAssetBase);e.LightPickerBase=n}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.entities.DirectionalLight,n=t.entities.LightProbe,r=t.entities.PointLight,s=t.events.Event,a=t.events.LightEvent,o=function(t){function e(e){var i=this;t.call(this),this._onCastShadowChangeDelegate=function(t){return i.onCastShadowChange(t)},this.lights=e}return __extends(e,t),Object.defineProperty(e.prototype,"lights",{get:function(){return this._lights},set:function(t){var e,o=0,h=0,p=0,u=0,l=0;this._lights&&this.clearListeners(),this._lights=t,this._pAllPickedLights=t,this._pPointLights=new Array,this._pCastingPointLights=new Array,this._pDirectionalLights=new Array,this._pCastingDirectionalLights=new Array,this._pLightProbes=new Array;for(var c=t.length,d=0;c>d;++d)e=t[d],e.addEventListener(a.CASTS_SHADOW_CHANGE,this._onCastShadowChangeDelegate),e instanceof r?e.castsShadows?this._pCastingPointLights[p++]=e:this._pPointLights[o++]=e:e instanceof i?e.castsShadows?this._pCastingDirectionalLights[u++]=e:this._pDirectionalLights[h++]=e:e instanceof n&&(this._pLightProbes[l++]=e);(this._pNumDirectionalLights!=h||this._pNumPointLights!=o||this._pNumLightProbes!=l||this._pNumCastingPointLights!=p||this._pNumCastingDirectionalLights!=u)&&(this._pNumDirectionalLights=h,this._pNumCastingDirectionalLights=u,this._pNumPointLights=o,this._pNumCastingPointLights=p,this._pNumLightProbes=l,this._pLightProbeWeights=new Array(4*Math.ceil(l/4)),this.dispatchEvent(new s(s.CHANGE)))},enumerable:!0,configurable:!0}),e.prototype.clearListeners=function(){for(var t=this._lights.length,e=0;t>e;++e)this._lights[e].removeEventListener(a.CASTS_SHADOW_CHANGE,this._onCastShadowChangeDelegate)},e.prototype.onCastShadowChange=function(t){var e=t.target;e instanceof r?this.updatePointCasting(e):e instanceof i&&this.updateDirectionalCasting(e),this.dispatchEvent(new s(s.CHANGE))},e.prototype.updateDirectionalCasting=function(t){var e=t;t.castsShadows?(--this._pNumDirectionalLights,++this._pNumCastingDirectionalLights,this._pDirectionalLights.splice(this._pDirectionalLights.indexOf(e),1),this._pCastingDirectionalLights.push(t)):(++this._pNumDirectionalLights,--this._pNumCastingDirectionalLights,this._pCastingDirectionalLights.splice(this._pCastingDirectionalLights.indexOf(e),1),this._pDirectionalLights.push(t))},e.prototype.updatePointCasting=function(t){var e=t;t.castsShadows?(--this._pNumPointLights,++this._pNumCastingPointLights,this._pPointLights.splice(this._pPointLights.indexOf(e),1),this._pCastingPointLights.push(t)):(++this._pNumPointLights,--this._pNumCastingPointLights,this._pCastingPointLights.splice(this._pCastingPointLights.indexOf(e),1),this._pPointLights.push(t))},e}(e.LightPickerBase);e.StaticLightPicker=o}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(){}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.BlendMode,n=t.events.Event,r=t.library.AssetType,s=function(t){function e(){var e=this;t.call(this),this._iMaterialId=0,this._iRenderOrderId=0,this._iBaseScreenPassIndex=0,this._bothSides=!1,this._pScreenPassesInvalid=!0,this._pBlendMode=i.NORMAL,this._numPasses=0,this._pMipmap=!1,this._smooth=!0,this._repeat=!1,this._pHeight=1,this._pWidth=1,this._pRequiresBlending=!1,this._iMaterialId=Number(this.id),this._owners=new Array,this._passes=new Array,this._onPassChangeDelegate=function(t){return e.onPassChange(t)},this._onLightChangeDelegate=function(t){return e.onLightsChange(t)},this.alphaPremultiplied=!1}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return r.MATERIAL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._pHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(t){this._pLightPicker!=t&&(this._pLightPicker&&this._pLightPicker.removeEventListener(n.CHANGE,this._onLightChangeDelegate),this._pLightPicker=t,this._pLightPicker&&this._pLightPicker.addEventListener(n.CHANGE,this._onLightChangeDelegate),this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._pMipmap},set:function(t){if(this._pMipmap!=t){this._pMipmap=t;for(var e=0;e<this._numPasses;++e)this._passes[e].mipmap=t}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth=t;for(var e=0;e<this._numPasses;++e)this._passes[e].smooth=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repeat",{get:function(){return this._repeat},set:function(t){this._repeat=t;for(var e=0;e<this._numPasses;++e)this._passes[e].repeat=t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t;for(t=0;t<this._numPasses;++t)this._passes[t].dispose()},Object.defineProperty(e.prototype,"bothSides",{get:function(){return this._bothSides},set:function(t){this._bothSides=t;for(var e=0;e<this._numPasses;++e)this._passes[e].bothSides=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._pBlendMode},set:function(t){this._pBlendMode!=t&&(this._pBlendMode=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaPremultiplied",{get:function(){return this._alphaPremultiplied},set:function(t){this._alphaPremultiplied=t;for(var e=0;e<this._numPasses;++e)this._passes[e].alphaPremultiplied=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requiresBlending",{get:function(){return this._pRequiresBlending},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._pWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_iNumPasses",{get:function(){return this._numPasses},enumerable:!0,configurable:!0}),e.prototype.iPassRendersToTexture=function(t){return this._passes[t].renderToTexture},e.prototype.iActivatePass=function(t,e,i){this._passes[t].iActivate(e,i)},e.prototype.iDeactivatePass=function(t,e){this._passes[t].iDeactivate(e)},e.prototype.iRenderPass=function(t,e,i,n,r){this._pLightPicker&&this._pLightPicker.collectLights(e,n);var s=this._passes[t];e.materialOwner.animator&&s.iUpdateAnimationState(e,i,n.camera),s.iRender(e,i,n.camera,r)},e.prototype.iAddOwner=function(t){this._owners.push(t);var e,i=t.animator;if(i&&(e=i.animationSet),t.animator){if(this._animationSet&&e!=this._animationSet)throw new Error("A Material instance cannot be shared across material owners with different animation sets");if(this._animationSet!=e){this._animationSet=e;for(var n=0;n<this._numPasses;++n)this._passes[n].animationSet=this._animationSet;this.iInvalidatePasses(null)}}},e.prototype.iRemoveOwner=function(t){if(this._owners.splice(this._owners.indexOf(t),1),0==this._owners.length){this._animationSet=null;for(var e=0;e<this._numPasses;++e)this._passes[e].animationSet=this._animationSet;this.iInvalidatePasses(null)}},Object.defineProperty(e.prototype,"iOwners",{get:function(){return this._owners},enumerable:!0,configurable:!0}),e.prototype.iUpdateMaterial=function(){},e.prototype.iDeactivate=function(t){this._passes[this._numPasses-1].iDeactivate(t)},e.prototype.iInvalidatePasses=function(t){var e,i,n,r;this._animationSet&&this._animationSet.resetGPUCompatibility();for(var s=0;s<this._numPasses;++s)if(this._passes[s]!=t&&this._passes[s].iInvalidateShaderProgram(!1),this._animationSet)for(n=this._owners.length,r=0;n>r;r++)e=this._owners[r],i=e.animator,i&&i.testGPUCompatibility(this._passes[s])},e.prototype.pRemovePass=function(t){this._passes.splice(this._passes.indexOf(t),1),--this._numPasses},e.prototype.pClearPasses=function(){for(var t=0;t<this._numPasses;++t)this._passes[t].removeEventListener(n.CHANGE,this._onPassChangeDelegate);this._passes.length=0,this._numPasses=0},e.prototype.pAddPass=function(t){this._passes[this._numPasses++]=t,t.animationSet=this._animationSet,t.alphaPremultiplied=this._alphaPremultiplied,t.mipmap=this._pMipmap,t.smooth=this._smooth,t.repeat=this._repeat,t.lightPicker=this._pLightPicker,t.bothSides=this._bothSides,t.addEventListener(n.CHANGE,this._onPassChangeDelegate),this.iInvalidatePasses(null)},e.prototype.pAddChildPassesFor=function(t){if(t&&t._iPasses)for(var e=t._iPasses.length,i=0;e>i;++i)this.pAddPass(t._iPasses[i])},e.prototype.onPassChange=function(){var t,e,i=1;this._iRenderOrderId=0;for(var n=0;n<this._numPasses;++n){t=this._passes[n]._iProgramids,e=t.length;for(var r=0;e>r;++r)-1!=t[r]&&(this._iRenderOrderId+=i*t[r],r=e);i*=1e3}},e.prototype.pInvalidateScreenPasses=function(){this._pScreenPassesInvalid=!0},e.prototype.onLightsChange=function(){this.pInvalidateScreenPasses()},e}(t.library.NamedAssetBase);e.MaterialBase=s}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.events.MaterialEvent,n=function(e){function n(t,i,n){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=!1),e.call(this),this._iMaterialId=Number(this.id),this.texture=t,this.smooth=i,this.repeat=n}return __extends(n,e),Object.defineProperty(n.prototype,"imageElement",{get:function(){return this._imageElement},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageStyle",{get:function(){return this._imageStyle},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"texture",{get:function(){return this._texture},set:function(e){if(this._texture!=e&&(this._texture=e,e instanceof t.textures.ImageTexture)){this._imageElement=e.htmlImageElement;var i=document.createElement("style");i.type="text/css",document.getElementsByTagName("head")[0].appendChild(i);var n=document.styleSheets[document.styleSheets.length-1];n.insertRule(".material"+this.id+"{ }",0);var r=n.cssRules[0].style;r.backgroundImage="url("+this._imageElement.src+")",r.backgroundSize="100% 100%",r.position="absolute",r.width=this._imageElement.width+"px",r.height=this._imageElement.height+"px",r.transformOrigin=r["-webkit-transform-origin"]=r["-moz-transform-origin"]=r["-o-transform-origin"]=r["-ms-transform-origin"]="0% 0%",this._pHeight=this._imageElement.height,this._pWidth=this._imageElement.width,this.notifySizeChanged()}},enumerable:!0,configurable:!0}),n.prototype.notifySizeChanged=function(){this._sizeChanged||(this._sizeChanged=new i(i.SIZE_CHANGED)),this.dispatchEvent(this._sizeChanged)},n}(e.MaterialBase);e.CSSMaterialBase=n}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=function(t){function e(){t.call(this),this._pObjects=new Array}return __extends(e,t),e.prototype.getNewObject=function(){var t=this._pCreateObject();return this._pObjects.push(t),t},e.prototype._pCreateObject=function(){throw new i},e.prototype._iValidate=function(){},e}(t.library.NamedAssetBase);e.PrefabBase=n}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(e){var i=t.base.Geometry,n=t.base.TriangleSubGeometry,r=t.base.LineSubGeometry,s=t.entities.Mesh,a=function(e){function a(t,n){"undefined"==typeof t&&(t=null),"undefined"==typeof n&&(n="triangleSubGeometry"),e.call(this),this._geomDirty=!0,this._uvDirty=!0,this._geometryTypeDirty=!0,this._geometry=new i,this._material=t,this._geometryType=n}return __extends(a,e),Object.defineProperty(a.prototype,"assetType",{get:function(){return t.library.AssetType.PRIMITIVE_PREFAB},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"geometryType",{get:function(){return this._geometryType},set:function(t){this._geometryType!=t&&(this._geometryType=t,this.invalidateGeometryType())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"geometry",{get:function(){return this._iValidate(),this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"material",{get:function(){return this._material},set:function(t){if(t!=this._material){this._material=t;for(var e=this._pObjects.length,i=0;e>i;i++)this._pObjects[i].material=this._material}},enumerable:!0,configurable:!0}),a.prototype._pBuildGeometry=function(){throw new t.errors.AbstractMethodError},a.prototype._pBuildUVs=function(){throw new t.errors.AbstractMethodError},a.prototype.invalidateGeometryType=function(){this._geometryTypeDirty=!0,this._geomDirty=!0,this._uvDirty=!0},a.prototype._pInvalidateGeometry=function(){this._geomDirty=!0},a.prototype._pInvalidateUVs=function(){this._uvDirty=!0},a.prototype.updateGeometryType=function(){if(this._subGeometry&&this._geometry.removeSubGeometry(this._subGeometry),"triangleSubGeometry"==this._geometryType){var t=new n(!0);t.autoDeriveNormals=!1,t.autoDeriveTangents=!1,t.autoDeriveUVs=!1,this._geometry.addSubGeometry(t),this._subGeometry=t}else"lineSubGeometry"==this._geometryType&&this._geometry.addSubGeometry(this._subGeometry=new r);this._geometryTypeDirty=!1},a.prototype.updateGeometry=function(){this._pBuildGeometry(this._subGeometry,this._geometryType),this._geomDirty=!1},a.prototype.updateUVs=function(){this._pBuildUVs(this._subGeometry,this._geometryType),this._uvDirty=!1},a.prototype._iValidate=function(){this._geometryTypeDirty&&this.updateGeometryType(),this._geomDirty&&this.updateGeometry(),this._uvDirty&&this.updateUVs()},a.prototype._pCreateObject=function(){var t=new s(this._geometry,this._material);return t._iSourcePrefab=this,t},a}(e.PrefabBase);e.PrimitivePrefabBase=a}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r,s){"undefined"==typeof e&&(e=50),"undefined"==typeof i&&(i=50),"undefined"==typeof n&&(n=16),"undefined"==typeof r&&(r=8),"undefined"==typeof s&&(s=!0),t.call(this),this._numVertices=0,this._radius=e,this._tubeRadius=i,this._segmentsR=n,this._segmentsT=r,this._yUp=s}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tubeRadius",{get:function(){return this._tubeRadius},set:function(t){this._tubeRadius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsR",{get:function(){return this._segmentsR},set:function(t){this._segmentsR=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsT",{get:function(){return this._segmentsT},set:function(t){this._segmentsT=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),e.prototype._pBuildGeometry=function(t,e){var i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y=0;if("triangleSubGeometry"==e){var b=t;this._numVertices=(this._segmentsT+1)*(this._segmentsR+1),y=this._segmentsT*this._segmentsR*6,this._numVertices==b.numVertices?(i=b.indices,n=b.positions,r=b.vertexNormals,s=b.vertexTangents):(i=new Array(y),n=new Array(3*this._numVertices),r=new Array(3*this._numVertices),s=new Array(3*this._numVertices),this._pInvalidateUVs()),g=0,m=0;var x,v,w,D,C,S,P,A,T,M,E,O=2*Math.PI/this._segmentsR,R=2*Math.PI/this._segmentsT,I=0,N=0;for(o=0;o<=this._segmentsT;++o)for(I=3*N,a=0;a<=this._segmentsR;++a)_=a*O,f=o*R,E=Math.cos(f),l=E*Math.cos(_),c=E*Math.sin(_),d=Math.sin(f),h=this._radius*Math.cos(_)+this._tubeRadius*l,p=this._radius*Math.sin(_)+this._tubeRadius*c,u=o==this._segmentsT?0:this._tubeRadius*d,this._yUp?(C=-d,S=c,w=0,D=E?l/E:h/this._radius,x=-u,v=p):(C=c,S=d,w=E?l/E:h/this._radius,D=0,x=p,v=u),a==this._segmentsR?(n[g]=h,n[g+1]=n[I+1],n[g+2]=n[I+2]):(n[g]=h,n[g+1]=x,n[g+2]=v),r[g]=l,r[g+1]=C,r[g+2]=S,s[g]=-(E?c/E:p/this._radius),s[g+1]=w,s[g+2]=D,g+=3,a>0&&o>0&&(P=N,A=N-1,T=A-this._segmentsR-1,M=P-this._segmentsR-1,i[m++]=P,i[m++]=A,i[m++]=T,i[m++]=P,i[m++]=T,i[m++]=M),N++;b.updateIndices(i),b.updatePositions(n),b.updateVertexNormals(r),b.updateVertexTangents(s)}},e.prototype._pBuildUVs=function(t,e){var i,n,r;if("triangleSubGeometry"==e){var s=t;r=s.uvs&&this._numVertices==s.numVertices?s.uvs:new Array(2*this._numVertices);var a=0;for(n=0;n<=this._segmentsT;++n)for(i=0;i<=this._segmentsR;++i)r[a++]=i/this._segmentsR*s.scaleU,r[a++]=n/this._segmentsT*s.scaleV;s.updateUVs(r)}},e}(t.PrimitivePrefabBase);t.PrimitiveTorusPrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r,s,a,o){"undefined"==typeof e&&(e=100),"undefined"==typeof i&&(i=100),"undefined"==typeof n&&(n=100),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=1),"undefined"==typeof a&&(a=1),"undefined"==typeof o&&(o=!0),t.call(this),this._width=e,this._height=i,this._depth=n,this._segmentsW=r,this._segmentsH=s,this._segmentsD=a,this._tile6=o}return __extends(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tile6",{get:function(){return this._tile6},set:function(t){this._tile6=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsD",{get:function(){return this._segmentsD},set:function(t){this._segmentsD=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),e.prototype._pBuildGeometry=function(t,e){var i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w,D=0;
if(_=this._width/2,f=this._height/2,g=this._depth/2,"triangleSubGeometry"==e){var C=t;for(w=2*((this._segmentsW+1)*(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1)),v=12*(this._segmentsW*this._segmentsH+this._segmentsW*this._segmentsD+this._segmentsH*this._segmentsD),w==C.numVertices&&null!=C.indices?(i=C.indices,n=C.positions,r=C.vertexNormals,s=C.vertexTangents):(i=new Array(v),n=new Array(3*w),r=new Array(3*w),s=new Array(3*w),this._pInvalidateUVs()),c=0,d=0,m=this._width/this._segmentsW,y=this._height/this._segmentsH,b=this._depth/this._segmentsD,u=0;u<=this._segmentsW;u++)for(x=-_+u*m,l=0;l<=this._segmentsH;l++)n[c]=x,n[c+1]=-f+l*y,n[c+2]=-g,r[c]=0,r[c+1]=0,r[c+2]=-1,s[c]=1,s[c+1]=0,s[c+2]=0,c+=3,n[c]=x,n[c+1]=-f+l*y,n[c+2]=g,r[c]=0,r[c+1]=0,r[c+2]=1,s[c]=-1,s[c+1]=0,s[c+2]=0,c+=3,u&&l&&(a=2*((u-1)*(this._segmentsH+1)+(l-1)),o=2*(u*(this._segmentsH+1)+(l-1)),h=a+2,p=o+2,i[d++]=a,i[d++]=h,i[d++]=p,i[d++]=a,i[d++]=p,i[d++]=o,i[d++]=o+1,i[d++]=p+1,i[d++]=h+1,i[d++]=o+1,i[d++]=h+1,i[d++]=a+1);for(D+=2*(this._segmentsW+1)*(this._segmentsH+1),u=0;u<=this._segmentsW;u++)for(x=-_+u*m,l=0;l<=this._segmentsD;l++)n[c]=x,n[c+1]=f,n[c+2]=-g+l*b,r[c]=0,r[c+1]=1,r[c+2]=0,s[c]=1,s[c+1]=0,s[c+2]=0,c+=3,n[c]=x,n[c+1]=-f,n[c+2]=-g+l*b,r[c]=0,r[c+1]=-1,r[c+2]=0,s[c]=1,s[c+1]=0,s[c+2]=0,c+=3,u&&l&&(a=D+2*((u-1)*(this._segmentsD+1)+(l-1)),o=D+2*(u*(this._segmentsD+1)+(l-1)),h=a+2,p=o+2,i[d++]=a,i[d++]=h,i[d++]=p,i[d++]=a,i[d++]=p,i[d++]=o,i[d++]=o+1,i[d++]=p+1,i[d++]=h+1,i[d++]=o+1,i[d++]=h+1,i[d++]=a+1);for(D+=2*(this._segmentsW+1)*(this._segmentsD+1),u=0;u<=this._segmentsD;u++)for(x=g-u*b,l=0;l<=this._segmentsH;l++)n[c]=-_,n[c+1]=-f+l*y,n[c+2]=x,r[c]=-1,r[c+1]=0,r[c+2]=0,s[c]=0,s[c+1]=0,s[c+2]=-1,c+=3,n[c]=_,n[c+1]=-f+l*y,n[c+2]=x,r[c]=1,r[c+1]=0,r[c+2]=0,s[c]=0,s[c+1]=0,s[c+2]=1,c+=3,u&&l&&(a=D+2*((u-1)*(this._segmentsH+1)+(l-1)),o=D+2*(u*(this._segmentsH+1)+(l-1)),h=a+2,p=o+2,i[d++]=a,i[d++]=h,i[d++]=p,i[d++]=a,i[d++]=p,i[d++]=o,i[d++]=o+1,i[d++]=p+1,i[d++]=h+1,i[d++]=o+1,i[d++]=h+1,i[d++]=a+1);C.updateIndices(i),C.updatePositions(n),C.updateVertexNormals(r),C.updateVertexTangents(s)}else if("lineSubGeometry"==e){var S,P,A,T=t,M=4*this._segmentsH+4*this._segmentsW+4*this._segmentsD;for(null!=T.indices&&M==T.numSegments?(S=T.startPositions,P=T.endPositions,A=T.thickness):(S=new Array(3*M),P=new Array(3*M),A=new Array(M)),c=0,d=0,u=0;u<this._segmentsH;++u)S[c]=-_,S[c+1]=u*this._height/this._segmentsH-f,S[c+2]=-g,P[c]=_,P[c+1]=u*this._height/this._segmentsH-f,P[c+2]=-g,A[d++]=1,c+=3,S[c]=-_,S[c+1]=f-u*this._height/this._segmentsH,S[c+2]=g,P[c]=_,P[c+1]=f-u*this._height/this._segmentsH,P[c+2]=g,A[d++]=1,c+=3;for(u=0;u<this._segmentsW;++u)S[c]=u*this._width/this._segmentsW-_,S[c+1]=-f,S[c+2]=-g,P[c]=u*this._width/this._segmentsW-_,P[c+1]=f,P[c+2]=-g,A[d++]=1,c+=3,S[c]=_-u*this._width/this._segmentsW,S[c+1]=-f,S[c+2]=g,P[c]=_-u*this._width/this._segmentsW,P[c+1]=f,P[c+2]=g,A[d++]=1,c+=3;for(u=0;u<this._segmentsH;++u)S[c]=-_,S[c+1]=u*this._height/this._segmentsH-f,S[c+2]=-g,P[c]=-_,P[c+1]=u*this._height/this._segmentsH-f,P[c+2]=g,A[d++]=1,c+=3,S[c]=_,S[c+1]=f-u*this._height/this._segmentsH,S[c+2]=-g,P[c]=_,P[c+1]=f-u*this._height/this._segmentsH,P[c+2]=g,A[d++]=1,c+=3;for(u=0;u<this._segmentsD;++u)S[c]=_,S[c+1]=-f,S[c+2]=u*this._depth/this._segmentsD-g,P[c]=_,P[c+1]=f,P[c+2]=u*this._depth/this._segmentsD-g,A[d++]=1,c+=3,S[c]=-_,S[c+1]=-f,S[c+2]=g-u*this._depth/this._segmentsD,P[c]=-_,P[c+1]=f,P[c+2]=g-u*this._depth/this._segmentsD,A[d++]=1,c+=3;for(u=0;u<this._segmentsD;++u)S[c]=-_,S[c+1]=-f,S[c+2]=g-u*this._depth/this._segmentsD,P[c]=_,P[c+1]=-f,P[c+2]=g-u*this._depth/this._segmentsD,A[d++]=1,c+=3,S[c]=-_,S[c+1]=f,S[c+2]=u*this._depth/this._segmentsD-g,P[c]=_,P[c+1]=f,P[c+2]=u*this._depth/this._segmentsD-g,A[d++]=1,c+=3;for(u=0;u<this._segmentsW;++u)S[c]=_-u*this._width/this._segmentsW,S[c+1]=-f,S[c+2]=-g,P[c]=_-u*this._width/this._segmentsW,P[c+1]=-f,P[c+2]=g,A[d++]=1,c+=3,S[c]=u*this._width/this._segmentsW-_,S[c+1]=f,S[c+2]=-g,P[c]=u*this._width/this._segmentsW-_,P[c+1]=f,P[c+2]=g,A[d++]=1,c+=3;T.updatePositions(S,P),T.updateThickness(A)}},e.prototype._pBuildUVs=function(t,e){var i,n,r,s,a,o,h,p,u,l,c,d,_,f,g;if("triangleSubGeometry"==e){g=2*((this._segmentsW+1)*(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1));var m=t;for(s=g==m.numVertices&&null!=m.uvs?m.uvs:new Array(2*g),this._tile6?(a=h=1/3,o=p=.5):(a=o=1,h=p=0),r=0,u=1*h,l=1*p,c=2*h,d=0*p,_=a/this._segmentsW,f=o/this._segmentsH,i=0;i<=this._segmentsW;i++)for(n=0;n<=this._segmentsH;n++)s[r++]=(u+i*_)*m.scaleU,s[r++]=(l+(o-n*f))*m.scaleV,s[r++]=(c+(a-i*_))*m.scaleU,s[r++]=(d+(o-n*f))*m.scaleV;for(u=1*h,l=0*p,c=0*h,d=0*p,_=a/this._segmentsW,f=o/this._segmentsD,i=0;i<=this._segmentsW;i++)for(n=0;n<=this._segmentsD;n++)s[r++]=(u+i*_)*m.scaleU,s[r++]=(l+(o-n*f))*m.scaleV,s[r++]=(c+i*_)*m.scaleU,s[r++]=(d+n*f)*m.scaleV;for(u=0*h,l=1*p,c=2*h,d=1*p,_=a/this._segmentsD,f=o/this._segmentsH,i=0;i<=this._segmentsD;i++)for(n=0;n<=this._segmentsH;n++)s[r++]=(u+i*_)*m.scaleU,s[r++]=(l+(o-n*f))*m.scaleV,s[r++]=(c+(a-i*_))*m.scaleU,s[r++]=(d+(o-n*f))*m.scaleV;m.updateUVs(s)}},e}(t.PrimitivePrefabBase);t.PrimitiveCubePrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r,s,a){"undefined"==typeof e&&(e=100),"undefined"==typeof i&&(i=100),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=!1),t.call(this),this._segmentsW=n,this._segmentsH=r,this._yUp=s,this._width=e,this._height=i,this._doubleSided=a}return __extends(e,t),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleSided",{get:function(){return this._doubleSided},set:function(t){this._doubleSided=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),e.prototype._pBuildGeometry=function(t,e){var i,n,r,s,a,o,h,p,u,l,c=this._segmentsW+1;if("triangleSubGeometry"==e){var d,_,f,g=t,o=(this._segmentsH+1)*c;for(this._doubleSided&&(o*=2),s=this._segmentsH*this._segmentsW*6,this._doubleSided&&(s*=2),null!=g.indices&&s==g.indices.length?i=g.indices:(i=new Array(s),this._pInvalidateUVs()),o==g.numVertices?(d=g.positions,_=g.vertexNormals,f=g.vertexTangents):(d=new Array(3*o),_=new Array(3*o),f=new Array(3*o),this._pInvalidateUVs()),p=0,h=0,l=0;l<=this._segmentsH;++l)for(u=0;u<=this._segmentsW;++u){if(n=(u/this._segmentsW-.5)*this._width,r=(l/this._segmentsH-.5)*this._height,d[h]=n,this._yUp?(d[h+1]=0,d[h+2]=r):(d[h+1]=r,d[h+2]=0),_[h]=0,this._yUp?(_[h+1]=1,_[h+2]=0):(_[h+1]=0,_[h+2]=-1),f[h]=1,f[h+1]=0,f[h+2]=0,h+=3,this._doubleSided){for(var m=h;h+3>m;++m)d[m]=d[m-3],_[m]=-_[m-3],f[m]=-f[m-3];h+=3}if(u!=this._segmentsW&&l!=this._segmentsH){a=u+l*c;var y=this._doubleSided?2:1;i[p++]=a*y,i[p++]=(a+c)*y,i[p++]=(a+c+1)*y,i[p++]=a*y,i[p++]=(a+c+1)*y,i[p++]=(a+1)*y,this._doubleSided&&(i[p++]=(a+c+1)*y+1,i[p++]=(a+c)*y+1,i[p++]=a*y+1,i[p++]=(a+1)*y+1,i[p++]=(a+c+1)*y+1,i[p++]=a*y+1)}}g.updateIndices(i),g.updatePositions(d),g.updateVertexNormals(_),g.updateVertexTangents(f)}else if("lineSubGeometry"==e){var b,x,v,w=t,D=this._segmentsH+1+c,C=this._width/2,S=this._height/2;for(null!=w.indices&&D==w.numSegments?(b=w.startPositions,x=w.endPositions,v=w.thickness):(b=new Array(3*D),x=new Array(3*D),v=new Array(D)),p=0,h=0,l=0;l<=this._segmentsH;++l)b[h]=-C,b[h+1]=0,b[h+2]=l*this._height-S,x[h]=C,x[h+1]=0,x[h+2]=l*this._height-S,v[p++]=1,h+=3;for(u=0;u<=this._segmentsW;++u)b[h]=u*this._width-C,b[h+1]=0,b[h+2]=-S,x[h]=u*this._width-C,x[h+1]=0,x[h+2]=S,v[p++]=1,h+=3;w.updatePositions(b,x),w.updateThickness(v)}},e.prototype._pBuildUVs=function(t,e){var i,n;if("triangleSubGeometry"==e){n=(this._segmentsH+1)*(this._segmentsW+1),this._doubleSided&&(n*=2);var r=t;r.uvs&&n==r.numVertices?i=r.uvs:(i=new Array(2*n),this._pInvalidateGeometry());for(var s=0,a=0;a<=this._segmentsH;++a)for(var o=0;o<=this._segmentsW;++o)i[s]=o/this._segmentsW*r.scaleU,i[s+1]=(1-a/this._segmentsH)*r.scaleV,s+=2,this._doubleSided&&(i[s]=o/this._segmentsW*r.scaleU,i[s+1]=(1-a/this._segmentsH)*r.scaleV,s+=2);r.updateUVs(i)}},e}(t.PrimitivePrefabBase);t.PrimitivePlanePrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r,s){"undefined"==typeof e&&(e=50),"undefined"==typeof i&&(i=100),"undefined"==typeof n&&(n=16),"undefined"==typeof r&&(r=15),"undefined"==typeof s&&(s=!0),t.call(this),this._numVertices=0,this._radius=e,this._height=i,this._segmentsW=n,this._segmentsH=r%2==0?r+1:r,this._yUp=s}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t%2==0?t+1:t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),e.prototype._pBuildGeometry=function(t,e){var i,n,r,s,a,o,h,p,u,l,c,d=0,_=0,f=0;if("triangleSubGeometry"==e){var g=t;for(this._numVertices=(this._segmentsH+1)*(this._segmentsW+1),f=(this._segmentsH-1)*this._segmentsW*6,this._numVertices==g.numVertices?(i=g.indices,n=g.positions,r=g.vertexNormals,s=g.vertexTangents):(i=new Array(f),n=new Array(3*this._numVertices),r=new Array(3*this._numVertices),s=new Array(3*this._numVertices),this._pInvalidateUVs()),o=0;o<=this._segmentsH;++o){var m=Math.PI*o/this._segmentsH,y=-this._radius*Math.cos(m),b=this._radius*Math.sin(m);for(h=_,a=0;a<=this._segmentsW;++a){var x=2*Math.PI*a/this._segmentsW,v=b*Math.cos(x),w=o>this._segmentsH/2?this._height/2:-this._height/2,D=b*Math.sin(x),C=1/Math.sqrt(v*v+D*D+y*y),S=Math.sqrt(D*D+v*v);if(this._yUp?(l=0,c=S>.007?v/S:0,p=-y,u=D):(l=S>.007?v/S:0,c=0,p=D,u=y),a==this._segmentsW?(n[_]=n[h],n[_+1]=n[h+1],n[_+2]=n[h+2],r[_]=.5*(r[h]+v*C),r[_+1]=.5*(r[h+1]+p*C),r[_+2]=.5*(r[h+2]+u*C),s[_]=.5*(s[h]+(S>.007?-D/S:1)),s[_+1]=.5*(s[h+1]+l),s[_+2]=.5*(s[h+2]+c)):(n[_]=v,n[_+1]=this._yUp?p-w:p,n[_+2]=this._yUp?u:u+w,r[_]=v*C,r[_+1]=p*C,r[_+2]=u*C,s[_]=S>.007?-D/S:1,s[_+1]=l,s[_+2]=c),a>0&&o>0){var P=(this._segmentsW+1)*o+a,A=(this._segmentsW+1)*o+a-1,T=(this._segmentsW+1)*(o-1)+a-1,M=(this._segmentsW+1)*(o-1)+a;o==this._segmentsH?(n[_]=n[h],n[_+1]=n[h+1],n[_+2]=n[h+2],i[d++]=P,i[d++]=T,i[d++]=M):1==o?(i[d++]=P,i[d++]=A,i[d++]=T):(i[d++]=P,i[d++]=A,i[d++]=T,i[d++]=P,i[d++]=T,i[d++]=M)}_+=3}}g.updateIndices(i),g.updatePositions(n),g.updateVertexNormals(r),g.updateVertexTangents(s)}},e.prototype._pBuildUVs=function(t,e){var i,n,r;if("triangleSubGeometry"==e){var s=t;r=s.uvs&&this._numVertices==s.numVertices?s.uvs:new Array(2*this._numVertices);var a=0;for(n=0;n<=this._segmentsH;++n)for(i=0;i<=this._segmentsW;++i)r[a++]=i/this._segmentsW*s.scaleU,r[a++]=n/this._segmentsH*s.scaleV;s.updateUVs(r)}},e}(t.PrimitivePrefabBase);t.PrimitiveCapsulePrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r,s,a,o,h,p){"undefined"==typeof e&&(e=50),"undefined"==typeof i&&(i=50),"undefined"==typeof n&&(n=100),"undefined"==typeof r&&(r=16),"undefined"==typeof s&&(s=1),"undefined"==typeof a&&(a=!0),"undefined"==typeof o&&(o=!0),"undefined"==typeof h&&(h=!0),"undefined"==typeof p&&(p=!0),t.call(this),this._numVertices=0,this._topRadius=e,this._pBottomRadius=i,this._height=n,this._pSegmentsW=r,this._pSegmentsH=s,this._topClosed=a,this._bottomClosed=o,this._surfaceClosed=h,this._yUp=p}return __extends(e,t),Object.defineProperty(e.prototype,"topRadius",{get:function(){return this._topRadius},set:function(t){this._topRadius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRadius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._pSegmentsW},set:function(t){this.setSegmentsW(t)},enumerable:!0,configurable:!0}),e.prototype.setSegmentsW=function(t){this._pSegmentsW=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._pSegmentsH},set:function(t){this.setSegmentsH(t)},enumerable:!0,configurable:!0}),e.prototype.setSegmentsH=function(t){this._pSegmentsH=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},Object.defineProperty(e.prototype,"topClosed",{get:function(){return this._topClosed},set:function(t){this._topClosed=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomClosed",{get:function(){return this._bottomClosed},set:function(t){this._bottomClosed=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),e.prototype._pBuildGeometry=function(t,e){var i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w=0,D=0,C=0;this._numVertices=0;var S=2*Math.PI/this._pSegmentsW;if("triangleSubGeometry"==e){var P=t;if(this._surfaceClosed&&(this._numVertices+=(this._pSegmentsH+1)*(this._pSegmentsW+1),w+=this._pSegmentsH*this._pSegmentsW*6),this._topClosed&&(this._numVertices+=2*(this._pSegmentsW+1),w+=3*this._pSegmentsW),this._bottomClosed&&(this._numVertices+=2*(this._pSegmentsW+1),w+=3*this._pSegmentsW),this._numVertices==P.numVertices?(i=P.indices,n=P.positions,r=P.vertexNormals,s=P.vertexTangents):(i=new Array(w),n=new Array(3*this._numVertices),r=new Array(3*this._numVertices),s=new Array(3*this._numVertices),this._pInvalidateUVs()),l=0,c=0,this._topClosed&&this._topRadius>0){for(u=-.5*this._height,a=0;a<=this._pSegmentsW;++a)this._yUp?(x=1,v=0,y=-u,b=0):(x=0,v=-1,y=0,b=u),n[l]=0,n[l+1]=y,n[l+2]=b,r[l]=0,r[l+1]=x,r[l+2]=v,s[l]=1,s[l+1]=0,s[l+2]=0,l+=3,_=a*S,h=this._topRadius*Math.cos(_),p=this._topRadius*Math.sin(_),this._yUp?(y=-u,b=p):(y=p,b=u),a==this._pSegmentsW?(n[l]=n[D+3],n[l+1]=n[D+4],n[l+2]=n[D+5]):(n[l]=h,n[l+1]=y,n[l+2]=b),r[l]=0,r[l+1]=x,r[l+2]=v,s[l]=1,s[l+1]=0,s[l+2]=0,l+=3,a>0&&(i[c++]=C,i[c++]=C+1,i[c++]=C+2,C+=2);C+=2}if(this._bottomClosed&&this._pBottomRadius>0){for(u=.5*this._height,D=3*C,a=0;a<=this._pSegmentsW;++a)this._yUp?(x=-1,v=0,y=-u,b=0):(x=0,v=1,y=0,b=u),n[l]=0,n[l+1]=y,n[l+2]=b,r[l]=0,r[l+1]=x,r[l+2]=v,s[l]=1,s[l+1]=0,s[l+2]=0,l+=3,_=a*S,h=this._pBottomRadius*Math.cos(_),p=this._pBottomRadius*Math.sin(_),this._yUp?(y=-u,b=p):(y=p,b=u),a==this._pSegmentsW?(n[l]=n[D+3],n[l+1]=n[D+4],n[l+2]=n[D+5]):(n[l]=h,n[l+1]=y,n[l+2]=b),r[l]=0,r[l+1]=x,r[l+2]=v,s[l]=1,s[l+1]=0,s[l+2]=0,l+=3,a>0&&(i[c++]=C,i[c++]=C+2,i[c++]=C+1,C+=2);C+=2}if(f=this._pBottomRadius-this._topRadius,g=f/this._height,m=0==g?1:this._height/f,this._surfaceClosed){var A,T,M,E,O,R,I,N;for(o=0;o<=this._pSegmentsH;++o)for(d=this._topRadius-o/this._pSegmentsH*(this._topRadius-this._pBottomRadius),u=-(this._height/2)+o/this._pSegmentsH*this._height,D=3*C,a=0;a<=this._pSegmentsW;++a)_=a*S,h=d*Math.cos(_),p=d*Math.sin(_),O=m*Math.cos(_),R=m*Math.sin(_),this._yUp?(x=0,v=-O,y=-u,b=p,I=g,N=R):(x=-O,v=0,y=p,b=u,I=R,N=g),a==this._pSegmentsW?(n[l]=n[D],n[l+1]=n[D+1],n[l+2]=n[D+2],r[l]=O,r[l+1]=g,r[l+2]=R,s[l]=R,s[l+1]=x,s[l+2]=v):(n[l]=h,n[l+1]=y,n[l+2]=b,r[l]=O,r[l+1]=I,r[l+2]=N,s[l]=-R,s[l+1]=x,s[l+2]=v),l+=3,a>0&&o>0&&(A=C,T=C-1,M=T-this._pSegmentsW-1,E=A-this._pSegmentsW-1,i[c++]=A,i[c++]=T,i[c++]=M,i[c++]=A,i[c++]=M,i[c++]=E),C++}P.updateIndices(i),P.updatePositions(n),P.updateVertexNormals(r),P.updateVertexTangents(s)}else if("lineSubGeometry"==e){var L,F,V,U=t,B=(this._pSegmentsH+1)*this._pSegmentsW+this._pSegmentsW;for(null!=U.indices&&B==U.numSegments?(L=U.startPositions,F=U.endPositions,V=U.thickness):(L=new Array(3*B),F=new Array(3*B),V=new Array(B)),l=0,c=0,o=0;o<=this._pSegmentsH;++o)for(d=this._topRadius-o/this._pSegmentsH*(this._topRadius-this._pBottomRadius),u=this._height*(o/this._pSegmentsH-.5),a=0;a<=this._pSegmentsW;++a)_=a*S,h=d*Math.cos(_),p=d*Math.sin(_),this._yUp?(y=-u,b=p):(y=p,b=u),a>0&&(F[l]=h,F[l+1]=y,F[l+2]=b,V[c++]=1,l+=3,L[l]=F[l-6*this._pSegmentsW],L[l+1]=F[l+1-6*this._pSegmentsW],L[l+2]=F[l+2-6*this._pSegmentsW],F[l]=h,F[l+1]=y,F[l+2]=b,V[c++]=1,l+=3),a<this._pSegmentsW&&(L[l]=h,L[l+1]=y,L[l+2]=b);U.updatePositions(L,F),U.updateThickness(V)}},e.prototype._pBuildUVs=function(t,e){var i,n,r,s,a,o;if("triangleSubGeometry"==e){var h=t;o=h.uvs&&this._numVertices==h.numVertices?h.uvs:new Array(2*this._numVertices);var p=2*Math.PI/this._pSegmentsW,u=0;if(this._topClosed)for(i=0;i<=this._pSegmentsW;++i)a=i*p,r=.5+.5*-Math.cos(a),s=.5+.5*Math.sin(a),o[u++]=.5*h.scaleU,o[u++]=.5*h.scaleV,o[u++]=r*h.scaleU,o[u++]=s*h.scaleV;if(this._bottomClosed)for(i=0;i<=this._pSegmentsW;++i)a=i*p,r=.5+.5*Math.cos(a),s=.5+.5*Math.sin(a),o[u++]=.5*h.scaleU,o[u++]=.5*h.scaleV,o[u++]=r*h.scaleU,o[u++]=s*h.scaleV;if(this._surfaceClosed)for(n=0;n<=this._pSegmentsH;++n)for(i=0;i<=this._pSegmentsW;++i)o[u++]=i/this._pSegmentsW*h.scaleU,o[u++]=n/this._pSegmentsH*h.scaleV;h.updateUVs(o)}},e}(t.PrimitivePrefabBase);t.PrimitiveCylinderPrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r,s,a){"undefined"==typeof e&&(e=50),"undefined"==typeof i&&(i=100),"undefined"==typeof n&&(n=16),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=!0),t.call(this,0,e,i,n,r,!1,s,!0,a)}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),e}(t.PrimitiveCylinderPrefab);t.PrimitiveConePrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof e&&(e=100),"undefined"==typeof i&&(i=16),"undefined"==typeof n&&(n=!0),t.call(this,e,0,0,i,1,!0,!1,!1,n)}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sides",{get:function(){return this._pSegmentsW},set:function(t){this.setSegmentsW(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisions",{get:function(){return this._pSegmentsH},set:function(t){this.setSegmentsH(t)},enumerable:!0,configurable:!0}),e}(t.PrimitiveCylinderPrefab);t.PrimitivePolygonPrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r){"undefined"==typeof e&&(e=50),"undefined"==typeof i&&(i=16),"undefined"==typeof n&&(n=12),"undefined"==typeof r&&(r=!0),t.call(this),this._radius=e,this._segmentsW=i,this._segmentsH=n,this._yUp=r}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t,this._pInvalidateGeometry(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidateGeometry()},enumerable:!0,configurable:!0}),e.prototype._pBuildGeometry=function(t,e){var i,n,r,s,a,o,h,p,u,l,c;if("triangleSubGeometry"==e){var d=t;c=(this._segmentsH+1)*(this._segmentsW+1),c==d.numVertices&&null!=d.indices?(i=d.indices,n=d.positions,r=d.vertexNormals,s=d.vertexTangents):(i=new Array((this._segmentsH-1)*this._segmentsW*6),n=new Array(3*c),r=new Array(3*c),s=new Array(3*c),this._pInvalidateUVs()),h=0,p=0;var _,f,g;for(o=0;o<=this._segmentsH;++o){_=h;var m=Math.PI*o/this._segmentsH,y=-this._radius*Math.cos(m),b=this._radius*Math.sin(m);for(a=0;a<=this._segmentsW;++a){var x=2*Math.PI*a/this._segmentsW,v=b*Math.cos(x),w=b*Math.sin(x),D=1/Math.sqrt(v*v+w*w+y*y),C=Math.sqrt(w*w+v*v);if(this._yUp?(f=0,g=C>.007?v/C:0,u=-y,l=w):(f=C>.007?v/C:0,g=0,u=w,l=y),a==this._segmentsW?(n[h]=n[_],n[h+1]=n[_+1],n[h+2]=n[_+2],r[h]=r[_]+v*D*.5,r[h+1]=r[_+1]+u*D*.5,r[h+2]=r[_+2]+l*D*.5,s[h]=C>.007?-w/C:1,s[h+1]=f,s[h+2]=g):(n[h]=v,n[h+1]=u,n[h+2]=l,r[h]=v*D,r[h+1]=u*D,r[h+2]=l*D,s[h]=C>.007?-w/C:1,s[h+1]=f,s[h+2]=g),a>0&&o>0){var S=(this._segmentsW+1)*o+a,P=(this._segmentsW+1)*o+a-1,A=(this._segmentsW+1)*(o-1)+a-1,T=(this._segmentsW+1)*(o-1)+a;o==this._segmentsH?(n[h]=n[_],n[h+1]=n[_+1],n[h+2]=n[_+2],i[p++]=S,i[p++]=A,i[p++]=T):1==o?(i[p++]=S,i[p++]=P,i[p++]=A):(i[p++]=S,i[p++]=P,i[p++]=A,i[p++]=S,i[p++]=A,i[p++]=T)}h+=3}}d.updateIndices(i),d.updatePositions(n),d.updateVertexNormals(r),d.updateVertexTangents(s)}else if("lineSubGeometry"==e){var M,E,O,R=t,I=(this._segmentsH-1)*this._segmentsW*2;for(null!=R.indices&&I==R.numSegments?(M=R.startPositions,E=R.endPositions,O=R.thickness):(M=new Array(3*I),E=new Array(3*I),O=new Array(I)),h=0,p=0,o=0;o<=this._segmentsH;++o){var m=Math.PI*o/this._segmentsH,y=-this._radius*Math.cos(m),b=this._radius*Math.sin(m);for(a=0;a<=this._segmentsW;++a){var x=2*Math.PI*a/this._segmentsW,v=b*Math.cos(x),w=b*Math.sin(x);this._yUp?(u=-y,l=w):(u=w,l=y),a>0&&o>0&&(o<this._segmentsH&&(E[h]=v,E[h+1]=u,E[h+2]=l,O[p++]=1,h+=3),M[h]=E[h-6*this._segmentsW],M[h+1]=E[h+1-6*this._segmentsW],M[h+2]=E[h+2-6*this._segmentsW],E[h]=v,E[h+1]=u,E[h+2]=l,O[p++]=1,h+=3),a<this._segmentsW&&o>0&&o<this._segmentsH&&(M[h]=v,M[h+1]=u,M[h+2]=l)}}R.updatePositions(M,E),R.updateThickness(O)}},e.prototype._pBuildUVs=function(t,e){var i,n,r,s=(this._segmentsH+1)*(this._segmentsW+1);if("triangleSubGeometry"==e){s=(this._segmentsH+1)*(this._segmentsW+1);var a=t;r=s==a.numVertices&&null!=a.uvs?a.uvs:new Array(2*s);var o=0;for(n=0;n<=this._segmentsH;++n)for(i=0;i<=this._segmentsW;++i)r[o++]=i/this._segmentsW*a.scaleU,r[o++]=n/this._segmentsH*a.scaleV;a.updateUVs(r)}},e}(t.PrimitivePrefabBase);t.PrimitiveSpherePrefab=e}(t.prefabs||(t.prefabs={})),t.prefabs}(away||(away={}));var away;!function(t){!function(e){var i=t.library.AssetType,n=t.library.NamedAssetBase,r=function(t){function e(){t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"stateClass",{get:function(){return this._pStateClass},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"assetType",{get:function(){return i.ANIMATION_NODE},enumerable:!0,configurable:!0}),e}(n);e.AnimationNodeBase=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(){}(t.animators||(t.animators={})),t.animators}(away||(away={})),away.Debug.THROW_ERRORS=!1,away.Debug.LOG_PI_ERRORS=!1;var away;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.events.EventDispatcher);t.AwayJSCore=e}(away||(away={}));var aglsl;!function(t){var e=function(){function t(){this.lodbias=0,this.dim=0,this.readmode=0,this.special=0,this.wrap=0,this.mipmap=0,this.filter=0}return t}();t.Sampler=e}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function e(){this.dest=new t.Destination,this.opcode=0,this.a=new t.Destination,this.b=new t.Destination}return e}();t.Token=e}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function t(){this.progid=0,this.version=0,this.type=""}return t}();t.Header=e}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function t(t,e,i,n,r,s,a,o,h,p,u){this.s=t,this.flags=e,this.dest=i,this.a=n,this.b=r,this.matrixwidth=s,this.matrixheight=a,this.ndwm=o,this.scalar=h,this.dm=p,this.lod=u}return t}();t.OpLUT=e}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function e(){this.regread=[[],[],[],[],[],[],[]],this.regwrite=[[],[],[],[],[],[],[]],this.hasindirect=!1,this.writedepth=!1,this.hasmatrix=!1,this.samplers=[],this.tokens=[],this.header=new t.Header}return e}();t.Description=e}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function t(){this.mask=0,this.regnum=0,this.regtype=0,this.dim=0}return t}();t.Destination=e}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function e(){}return e.agal2glsllut=[new t.OpLUT("%dest = %cast(%a);\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(%a + %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(%a - %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(%a * %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(%a / %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(1.0) / %a;\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(min(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(max(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(fract(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(sqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(inversesqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(pow(abs(%a),%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(log2(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(exp2(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(normalize(vec3( %a ) ));\n",0,!0,!0,!1,null,null,!0,null,null,null),new t.OpLUT("%dest = %cast(sin(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(cos(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(cross(vec3(%a),vec3(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new t.OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new t.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new t.OpLUT("%dest = %cast(abs(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(%a * -1.0);\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(clamp(%a,0.0,1.0));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",null,!0,!0,!0,3,3,!0,null,null,null),new t.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,4,!0,null,null,null),new t.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,3,!0,null,null,null),new t.OpLUT("%dest = %cast(dFdx(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(dFdx(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("if (float(%a)==float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new t.OpLUT("if (float(%a)!=float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new t.OpLUT("if (float(%a)>=float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new t.OpLUT("if (float(%a)<float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new t.OpLUT("} else {;\n",0,!1,!1,!1,null,null,null,null,null,null),new t.OpLUT("};\n",0,!1,!1,!1,null,null,null,null,null,null),new t.OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new t.OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new t.OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new t.OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\n",null,!0,!0,!0,null,null,null,null,!0,null),new t.OpLUT("if ( float(%a)<0.0 ) discard;\n",null,!1,!0,!1,null,null,null,!0,null,null),new t.OpLUT("%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\n",null,!0,!0,!0,null,null,!0,null,!0,!0),new t.OpLUT("%dest = %cast(greaterThanEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new t.OpLUT("%dest = %cast(lessThan(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new t.OpLUT("%dest = %cast(sign(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new t.OpLUT("%dest = %cast(equal(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new t.OpLUT("%dest = %cast(notEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null)],e}();t.Mapping=e}(aglsl||(aglsl={}));var aglsl;!function(t){!function(e){var i=function(){function e(e,i,n,r,s,a,o,h,p,u){this.a=new t.assembler.FS,this.b=new t.assembler.FS,this.flags=new t.assembler.Flags,this.dest=e,this.a.format=i,this.a.size=n,this.b.format=r,this.b.size=s,this.opcode=a,this.flags.simple=o,this.flags.horizontal=h,this.flags.fragonly=p,this.flags.matrix=u}return e}();e.Opcode=i;var n=function(){function t(){}return t}();e.FS=n;var r=function(){function t(){}return t}();e.Flags=r}(t.assembler||(t.assembler={})),t.assembler}(aglsl||(aglsl={}));var aglsl;!function(t){!function(e){var i=function(){function e(){}return Object.defineProperty(e,"map",{get:function(){return e._map||(e._map=new Array,e._map.mov=new t.assembler.Opcode("vector","vector",4,"none",0,0,!0,null,null,null),e._map.add=new t.assembler.Opcode("vector","vector",4,"vector",4,1,!0,null,null,null),e._map.sub=new t.assembler.Opcode("vector","vector",4,"vector",4,2,!0,null,null,null),e._map.mul=new t.assembler.Opcode("vector","vector",4,"vector",4,3,!0,null,null,null),e._map.div=new t.assembler.Opcode("vector","vector",4,"vector",4,4,!0,null,null,null),e._map.rcp=new t.assembler.Opcode("vector","vector",4,"none",0,5,!0,null,null,null),e._map.min=new t.assembler.Opcode("vector","vector",4,"vector",4,6,!0,null,null,null),e._map.max=new t.assembler.Opcode("vector","vector",4,"vector",4,7,!0,null,null,null),e._map.frc=new t.assembler.Opcode("vector","vector",4,"none",0,8,!0,null,null,null),e._map.sqt=new t.assembler.Opcode("vector","vector",4,"none",0,9,!0,null,null,null),e._map.rsq=new t.assembler.Opcode("vector","vector",4,"none",0,10,!0,null,null,null),e._map.pow=new t.assembler.Opcode("vector","vector",4,"vector",4,11,!0,null,null,null),e._map.log=new t.assembler.Opcode("vector","vector",4,"none",0,12,!0,null,null,null),e._map.exp=new t.assembler.Opcode("vector","vector",4,"none",0,13,!0,null,null,null),e._map.nrm=new t.assembler.Opcode("vector","vector",4,"none",0,14,!0,null,null,null),e._map.sin=new t.assembler.Opcode("vector","vector",4,"none",0,15,!0,null,null,null),e._map.cos=new t.assembler.Opcode("vector","vector",4,"none",0,16,!0,null,null,null),e._map.crs=new t.assembler.Opcode("vector","vector",4,"vector",4,17,!0,!0,null,null),e._map.dp3=new t.assembler.Opcode("vector","vector",4,"vector",4,18,!0,!0,null,null),e._map.dp4=new t.assembler.Opcode("vector","vector",4,"vector",4,19,!0,!0,null,null),e._map.abs=new t.assembler.Opcode("vector","vector",4,"none",0,20,!0,null,null,null),e._map.neg=new t.assembler.Opcode("vector","vector",4,"none",0,21,!0,null,null,null),e._map.sat=new t.assembler.Opcode("vector","vector",4,"none",0,22,!0,null,null,null),e._map.ted=new t.assembler.Opcode("vector","vector",4,"sampler",1,38,!0,null,!0,null),e._map.kil=new t.assembler.Opcode("none","scalar",1,"none",0,39,!0,null,!0,null),e._map.tex=new t.assembler.Opcode("vector","vector",4,"sampler",1,40,!0,null,!0,null),e._map.m33=new t.assembler.Opcode("vector","matrix",3,"vector",3,23,!0,null,null,!0),e._map.m44=new t.assembler.Opcode("vector","matrix",4,"vector",4,24,!0,null,null,!0),e._map.m43=new t.assembler.Opcode("vector","matrix",3,"vector",4,25,!0,null,null,!0),e._map.sge=new t.assembler.Opcode("vector","vector",4,"vector",4,41,!0,null,null,null),e._map.slt=new t.assembler.Opcode("vector","vector",4,"vector",4,42,!0,null,null,null),e._map.sgn=new t.assembler.Opcode("vector","vector",4,"vector",4,43,!0,null,null,null),e._map.seq=new t.assembler.Opcode("vector","vector",4,"vector",4,44,!0,null,null,null),e._map.sne=new t.assembler.Opcode("vector","vector",4,"vector",4,45,!0,null,null,null)),e._map
},enumerable:!0,configurable:!0}),e}();e.OpcodeMap=i}(t.assembler||(t.assembler={})),t.assembler}(aglsl||(aglsl={}));var aglsl;!function(t){!function(t){var e=function(){function t(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this.name="",this.version=0,this.name=t,this.version=e,this.data=new away.utils.ByteArray}return t}();t.Part=e}(t.assembler||(t.assembler={})),t.assembler}(aglsl||(aglsl={}));var aglsl;!function(t){!function(e){var i=function(){function t(t,e){this.code=t,this.desc=e}return t}();e.Reg=i;var n=function(){function e(){}return Object.defineProperty(e,"map",{get:function(){return e._map||(e._map=new Array,e._map.va=new t.assembler.Reg(0,"vertex attribute"),e._map.fc=new t.assembler.Reg(1,"fragment constant"),e._map.vc=new t.assembler.Reg(1,"vertex constant"),e._map.ft=new t.assembler.Reg(2,"fragment temporary"),e._map.vt=new t.assembler.Reg(2,"vertex temporary"),e._map.vo=new t.assembler.Reg(3,"vertex output"),e._map.op=new t.assembler.Reg(3,"vertex output"),e._map.fd=new t.assembler.Reg(3,"fragment depth output"),e._map.fo=new t.assembler.Reg(3,"fragment output"),e._map.oc=new t.assembler.Reg(3,"fragment output"),e._map.v=new t.assembler.Reg(4,"varying"),e._map.vi=new t.assembler.Reg(4,"varying output"),e._map.fi=new t.assembler.Reg(4,"varying input"),e._map.fs=new t.assembler.Reg(5,"sampler")),e._map},enumerable:!0,configurable:!0}),e}();e.RegMap=n}(t.assembler||(t.assembler={})),t.assembler}(aglsl||(aglsl={}));var aglsl;!function(t){!function(e){var i=function(){function t(t,e,i){this.shift=t,this.mask=e,this.value=i}return t}();e.Sampler=i;var n=function(){function e(){}return Object.defineProperty(e,"map",{get:function(){return e._map||(e._map=new Array,e._map.rgba=new t.assembler.Sampler(8,15,0),e._map.rg=new t.assembler.Sampler(8,15,5),e._map.r=new t.assembler.Sampler(8,15,4),e._map.compressed=new t.assembler.Sampler(8,15,1),e._map.compressed_alpha=new t.assembler.Sampler(8,15,2),e._map.dxt1=new t.assembler.Sampler(8,15,1),e._map.dxt5=new t.assembler.Sampler(8,15,2),e._map["2d"]=new t.assembler.Sampler(12,15,0),e._map.cube=new t.assembler.Sampler(12,15,1),e._map["3d"]=new t.assembler.Sampler(12,15,2),e._map.centroid=new t.assembler.Sampler(16,1,1),e._map.ignoresampler=new t.assembler.Sampler(16,4,4),e._map.clamp=new t.assembler.Sampler(20,15,0),e._map.repeat=new t.assembler.Sampler(20,15,1),e._map.wrap=new t.assembler.Sampler(20,15,1),e._map.nomip=new t.assembler.Sampler(24,15,0),e._map.mipnone=new t.assembler.Sampler(24,15,0),e._map.mipnearest=new t.assembler.Sampler(24,15,1),e._map.miplinear=new t.assembler.Sampler(24,15,2),e._map.nearest=new t.assembler.Sampler(28,15,0),e._map.linear=new t.assembler.Sampler(28,15,1)),e._map},enumerable:!0,configurable:!0}),e}();e.SamplerMap=n}(t.assembler||(t.assembler={})),t.assembler}(aglsl||(aglsl={}));var aglsl;!function(t){!function(e){var i=function(){function i(){this.r={},this.cur=new t.assembler.Part}return i.prototype.assemble=function(t,e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),i||(i=1),e&&this.addHeader(e,i);var n=t.replace(/[\f\n\r\v]+/g,"\n").split("\n");for(var r in n)this.processLine(n[r],r);return this.r},i.prototype.processLine=function(t,i){var n=t.search("//");if(-1!=n&&(t=t.slice(0,n)),t=t.replace(/^\s+|\s+$/g,""),t.length>0){var r=t.search(/<.*>/g),s=null;-1!=r&&(s=t.slice(r).match(/([\w\.\-\+]+)/gi),t=t.slice(0,r));var a=t.match(/([\w\.\+\[\]]+)/gi);if(!a||a.length<1)return void(t.length>=3&&console.log("Warning: bad line "+i+": "+t));switch(a[0]){case"part":this.addHeader(a[1],Number(a[2]));break;case"endpart":if(!this.cur)throw"Unexpected endpart";return this.cur.data.position=0,void(this.cur=null);default:if(!this.cur)return void console.log("Warning: bad line "+i+": "+t+" (Outside of any part definition)");if("comment"==this.cur.name)return;var o=e.OpcodeMap.map[a[0]];if(!o)throw"Bad opcode "+a[0]+" "+i+": "+t;this.emitOpcode(this.cur,o.opcode);var h=1;if(o.dest&&"none"!=o.dest){if(!this.emitDest(this.cur,a[h++],o.dest))throw"Bad destination register "+a[h-1]+" "+i+": "+t}else this.emitZeroDword(this.cur);if(o.a&&"none"!=o.a.format){if(!this.emitSource(this.cur,a[h++],o.a))throw"Bad source register "+a[h-1]+" "+i+": "+t}else this.emitZeroQword(this.cur);if(o.b&&"none"!=o.b.format){if("sampler"==o.b.format){if(!this.emitSampler(this.cur,a[h++],o.b,s))throw"Bad sampler register "+a[h-1]+" "+i+": "+t}else if(!this.emitSource(this.cur,a[h++],o.b))throw"Bad source register "+a[h-1]+" "+i+": "+t}else this.emitZeroQword(this.cur)}}},i.prototype.emitHeader=function(t){switch(t.data.writeUnsignedByte(160),t.data.writeUnsignedInt(t.version),t.version>=16&&t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(161),t.name){case"fragment":t.data.writeUnsignedByte(1);break;case"vertex":t.data.writeUnsignedByte(0);break;case"cpu":t.data.writeUnsignedByte(2);break;default:t.data.writeUnsignedByte(255)}},i.prototype.emitOpcode=function(t,e){t.data.writeUnsignedInt(e)},i.prototype.emitZeroDword=function(t){t.data.writeUnsignedInt(0)},i.prototype.emitZeroQword=function(t){t.data.writeUnsignedInt(0),t.data.writeUnsignedInt(0)},i.prototype.emitDest=function(t,i){var n=i.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!e.RegMap.map[n[1]])return!1;var r={num:n[2]?n[2]:0,code:e.RegMap.map[n[1]].code,mask:this.stringToMask(n[3])};return t.data.writeUnsignedShort(r.num),t.data.writeUnsignedByte(r.mask),t.data.writeUnsignedByte(r.code),!0},i.prototype.stringToMask=function(t){if(!t)return 15;var e=0;return-1!=t.indexOf("x")&&(e|=1),-1!=t.indexOf("y")&&(e|=2),-1!=t.indexOf("z")&&(e|=4),-1!=t.indexOf("w")&&(e|=8),e},i.prototype.stringToSwizzle=function(t){if(!t)return 228;var e={x:0,y:1,z:2,w:3},i=0;if("."!=t.charAt(0))throw"Missing . for swizzle";return t.length>1&&(i|=e[t.charAt(1)]),i|=t.length>2?e[t.charAt(2)]<<2:(3&i)<<2,i|=t.length>3?e[t.charAt(3)]<<4:(12&i)<<2,i|=t.length>4?e[t.charAt(4)]<<6:(48&i)<<2},i.prototype.emitSampler=function(t,i,n,r){var s=i.match(/fs(\d*)/i);if(!s||!s[1])return!1;t.data.writeUnsignedShort(parseInt(s[1])),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(0);for(var a=5,o=0,h=0;h<r.length;h++){var p=e.SamplerMap.map[r[h].toLowerCase()];p?(0!=(o>>p.shift&p.mask)&&console.log("Warning, duplicate sampler option"),o|=p.mask<<p.shift,a&=~(p.mask<<p.shift),a|=p.value<<p.shift):console.log("Warning, unknown sampler option: ",r[h])}return t.data.writeUnsignedInt(a),!0},i.prototype.emitSource=function(t,i){var n,r=i.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i);if(r){if(!e.RegMap.map[r[1]])return!1;var s={x:0,y:1,z:2,w:3},a={num:0|r[2],code:e.RegMap.map[r[1]].code,swizzle:this.stringToSwizzle(r[5]),select:s[r[3]],offset:0|r[4]};t.data.writeUnsignedShort(a.num),t.data.writeByte(a.offset),t.data.writeUnsignedByte(a.swizzle),t.data.writeUnsignedByte(1),t.data.writeUnsignedByte(a.code),t.data.writeUnsignedByte(a.select),t.data.writeUnsignedByte(128)}else{if(n=i.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i),!e.RegMap.map[n[1]])return!1;var a={num:0|n[2],code:e.RegMap.map[n[1]].code,swizzle:this.stringToSwizzle(n[3])};t.data.writeUnsignedShort(a.num),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(a.swizzle),t.data.writeUnsignedByte(a.code),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(0)}return!0},i.prototype.addHeader=function(e,i){if(i||(i=1),void 0==this.r[e])this.r[e]=new t.assembler.Part(e,i),this.emitHeader(this.r[e]);else if(this.r[e].version!=i)throw"Multiple versions for part "+e;this.cur=this.r[e]},i}();e.AGALMiniAssembler=i}(t.assembler||(t.assembler={})),t.assembler}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function e(){}return e.prototype.decribeAGALByteArray=function(e){var i=new t.Header;if(160!=e.readUnsignedByte())throw"Bad AGAL: Missing 0xa0 magic byte.";if(i.version=e.readUnsignedInt(),i.version>=16&&(e.readUnsignedByte(),i.version>>=1),161!=e.readUnsignedByte())throw"Bad AGAL: Missing 0xa1 magic byte.";switch(i.progid=e.readUnsignedByte(),i.progid){case 1:i.type="fragment";break;case 0:i.type="vertex";break;case 2:i.type="cpu";break;default:i.type=""}for(var n=new t.Description,r=[];e.position<e.length;){var s=new t.Token;s.opcode=e.readUnsignedInt();var a=t.Mapping.agal2glsllut[s.opcode];if(!a)throw"Opcode not valid or not implemented yet: "+s.opcode;a.matrixheight&&(n.hasmatrix=!0),a.dest?(s.dest.regnum=e.readUnsignedShort(),s.dest.mask=e.readUnsignedByte(),s.dest.regtype=e.readUnsignedByte(),n.regwrite[s.dest.regtype][s.dest.regnum]|=s.dest.mask):(s.dest=null,e.readUnsignedInt()),a.a?this.readReg(s.a,1,n,e):(s.a=null,e.readUnsignedInt(),e.readUnsignedInt()),a.b?this.readReg(s.b,0|a.matrixheight,n,e):(s.b=null,e.readUnsignedInt(),e.readUnsignedInt()),r.push(s)}return n.header=i,n.tokens=r,n},e.prototype.readReg=function(t,e,i,n){if(t.regnum=n.readUnsignedShort(),t.indexoffset=n.readByte(),t.swizzle=n.readUnsignedByte(),t.regtype=n.readUnsignedByte(),i.regread[t.regtype][t.regnum]=15,5==t.regtype?(t.lodbiad=t.indexoffset,t.indexoffset=void 0,t.swizzle=void 0,t.readmode=n.readUnsignedByte(),t.dim=t.readmode>>4,t.readmode&=15,t.special=n.readUnsignedByte(),t.wrap=t.special>>4,t.special&=15,t.mipmap=n.readUnsignedByte(),t.filter=t.mipmap>>4,t.mipmap&=15,i.samplers[t.regnum]=t):(t.indexregtype=n.readUnsignedByte(),t.indexselect=n.readUnsignedByte(),t.indirectflag=n.readUnsignedByte()),t.indirectflag&&(i.hasindirect=!0),!t.indirectflag&&e)for(var r=0;e>r;r++)i.regread[t.regtype][t.regnum+r]=i.regread[t.regtype][t.regnum]},e}();t.AGALTokenizer=e}(aglsl||(aglsl={}));var aglsl;!function(t){var e=function(){function e(){}return e.prototype.parse=function(e){var i="",n="";i+="precision highp float;\n";var r=e.header.type[0];if("vertex"==e.header.type&&(i+="uniform float yflip;\n"),e.hasindirect)i+="uniform vec4 "+r+"carrr["+away.stagegl.ContextStage3D.maxvertexconstants+"];\n";else for(var s=0;s<e.regread[1].length;s++)e.regread[1][s]&&(i+="uniform vec4 "+r+"c"+s+";\n");for(var s=0;s<e.regread[2].length||s<e.regwrite[2].length;s++)(e.regread[2][s]||e.regwrite[2][s])&&(i+="vec4 "+r+"t"+s+";\n");for(var s=0;s<e.regread[0].length;s++)e.regread[0][s]&&(i+="attribute vec4 va"+s+";\n");for(var s=0;s<e.regread[4].length||s<e.regwrite[4].length;s++)(e.regread[4][s]||e.regwrite[4][s])&&(i+="varying vec4 vi"+s+";\n");for(var a=["2D","Cube","3D",""],s=0;s<e.samplers.length;s++)e.samplers[s]&&(i+="uniform sampler"+a[3&e.samplers[s].dim]+" fs"+s+";\n");"vertex"==e.header.type&&(i+="vec4 outpos;\n"),e.writedepth&&(i+="vec4 tmp_FragDepth;\n"),n+="void main() {\n";for(var s=0;s<e.tokens.length;s++){var o=t.Mapping.agal2glsllut[e.tokens[s].opcode];if(!o)throw"Opcode not valid or not implemented yet: ";for(var h=o.matrixheight||1,p=0;h>p;p++){var u="  "+o.s;if(e.tokens[s].dest){if(o.matrixheight){if(1!=(e.tokens[s].dest.mask>>p&1))continue;var l=this.regtostring(e.tokens[s].dest.regtype,e.tokens[s].dest.regnum,e,r),c="float",d=["x","y","z","w"][p];l+="."+d}else{var c,d,l=this.regtostring(e.tokens[s].dest.regtype,e.tokens[s].dest.regnum,e,r);if(15!=e.tokens[s].dest.mask){var _=0;switch(d="",1&e.tokens[s].dest.mask&&(_++,d+="x"),2&e.tokens[s].dest.mask&&(_++,d+="y"),4&e.tokens[s].dest.mask&&(_++,d+="z"),8&e.tokens[s].dest.mask&&(_++,d+="w"),l+="."+d,_){case 1:c="float";break;case 2:c="vec2";break;case 3:c="vec3";break;default:throw"Unexpected destination mask"}}else c="vec4",d="xyzw"}u=u.replace("%dest",l),u=u.replace("%cast",c),u=u.replace("%dm",d)}var f=15;if(!o.ndwm&&o.dest&&e.tokens[s].dest&&(f=e.tokens[s].dest.mask),e.tokens[s].a&&(u=u.replace("%a",this.sourcetostring(e.tokens[s].a,0,f,o.scalar,e,r))),e.tokens[s].b&&(u=u.replace("%b",this.sourcetostring(e.tokens[s].b,p,f,o.scalar,e,r)),5==e.tokens[s].b.regtype)){var g=["2D","Cube","3D"][e.tokens[s].b.dim],m=["vec2","vec3","vec3"][e.tokens[s].b.dim];u=u.replace("%texdim",g),u=u.replace("%texsize",m);var y="";u=u.replace("%lod",y)}n+=u}}return"vertex"==e.header.type&&(n+="  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\n"),e.writedepth&&(n+="  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\n"),n+="}\n",i+n},e.prototype.regtostring=function(t,e,i,n){switch(t){case 0:return"va"+e;case 1:return i.hasindirect&&"vertex"==i.header.type?"vcarrr["+e+"]":n+"c"+e;case 2:return n+"t"+e;case 3:return"vertex"==i.header.type?"outpos":"gl_FragColor";case 4:return"vi"+e;case 5:return"fs"+e;case 6:return"tmp_FragDepth";default:throw"Unknown register type"}},e.prototype.sourcetostring=function(t,e,i,n,r,s){var a,o=["x","y","z","w"];if(t.indirectflag){a="vcarrr[int("+this.regtostring(t.indexregtype,t.regnum,r,s)+"."+o[t.indexselect]+")";var h=e+t.indexoffset;0>h&&(a+=h.toString()),h>0&&(a+="+"+h.toString()),a+="]"}else a=this.regtostring(t.regtype,t.regnum+e,r,s);return 5==t.regtype?a:n?a+"."+o[t.swizzle>>0&3]:228==t.swizzle&&15==i?a:(a+=".",1&i&&(a+=o[t.swizzle>>0&3]),2&i&&(a+=o[t.swizzle>>2&3]),4&i&&(a+=o[t.swizzle>>4&3]),8&i&&(a+=o[t.swizzle>>6&3]),a)},e}();t.AGLSLParser=e}(aglsl||(aglsl={}));var away;!function(t){!function(t){var e=function(){function t(t){this._dataDirty=!0,this.invalid=new Array(8),this.contexts=new Array(8),this.buffers=new Array(8),this.level=t}return t.prototype.updateData=function(e,i,n){if(this._dataDirty)if(this._dataDirty=!1,i.length<t.LIMIT_INDICES&&n<t.LIMIT_VERTS)this.indexMappings=null,this.originalIndices=null,this.setData(i),this.offset=i.length;else{var r,s,a,o,h,p=new Array;for(this.indexMappings=new Array(i.length),this.originalIndices=new Array,r=this.indexMappings.length;r--;)this.indexMappings[r]=-1;var u,l;for(a=0,s=i.length,r=e,h=0;s>r&&a+3<t.LIMIT_INDICES&&h+3<t.LIMIT_VERTS;){for(o=0;3>o;o++)u=i[r+o],this.indexMappings[u]>=0?l=this.indexMappings[u]:(l=h++,this.indexMappings[u]=l,this.originalIndices.push(u)),p[a+o]=l;a+=3,r+=3}this.setData(p),this.offset=r}},t.prototype.invalidateData=function(){this._dataDirty=!0},t.prototype.dispose=function(){for(var t=0;8>t;++t)this.contexts[t]&&(this.contexts[t].disposeIndexData(this),this.contexts[t]=null)},t.prototype.disposeBuffers=function(){for(var t=0;8>t;++t)this.buffers[t]&&(this.buffers[t].dispose(),this.buffers[t]=null)},t.prototype.invalidateBuffers=function(){for(var t=0;8>t;++t)this.invalid[t]=!0},t.prototype.setData=function(t){this.data&&this.data.length!=t.length?this.disposeBuffers():this.invalidateBuffers(),this.data=t},t.LIMIT_VERTS=65535,t.LIMIT_INDICES=16777215,t}();t.IndexData=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(){}return e.getItem=function(i,n,r){var s=e._pool[i.id]||(e._pool[i.id]=new Array),a=s[n]||(s[n]=new t.IndexData(n));return a.updateData(r,i.indices,i.numVertices),a},e.disposeItem=function(t,e){var i=this._pool[t];i[e].dispose(),i[e]=null},e.prototype.disposeData=function(t){for(var i=e._pool[t],n=i.length,r=0;n>r;r++)i[r].dispose(),i[r]=null;e._pool[t]=null},e._pool=new Object,e}();t.IndexDataPool=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e){this.context=t,this.textureProxy=e}return t.prototype.dispose=function(){this.texture.dispose(),this.texture=null},t.prototype.invalidate=function(){this.invalid=!0},t}();t.TextureData=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(t){this._pool=new Object,this._context=t}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=e._iAddTextureData(new t.TextureData(this._context,e)))},e.prototype.disposeItem=function(t){t._iRemoveTextureData(this._pool[t.id]),this._pool[t.id]=null},e}();t.TextureDataPool=e}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.base.SubGeometryBase,n=t.events.SubGeometryEvent,r=function(){function t(t,e){var i=this;this._dataDirty=!0,this.invalid=new Array(8),this.buffers=new Array(8),this.contexts=new Array(8),this._subGeometry=t,this._dataType=e,this._onVerticesUpdatedDelegate=function(t){return i._onVerticesUpdated(t)},this._subGeometry.addEventListener(n.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)}return t.prototype.updateData=function(t,e){if("undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this._dataDirty){this._dataDirty=!1,this.dataPerVertex=this._subGeometry.getStride(this._dataType);var i=this._subGeometry[this._dataType];if(null==e)this.setData(i);else{for(var n,r,s=new Array(t.length*this.dataPerVertex),a=0,o=0;a<t.length;){for(n=t[a],r=e[n]*this.dataPerVertex,n*=this.dataPerVertex,o=0;o<this.dataPerVertex;o++)s[r+o]=i[n+o];a++}this.setData(s)}}},t.prototype.dispose=function(){for(var t=0;8>t;++t)this.contexts[t]&&(this.contexts[t].disposeVertexData(this),this.contexts[t]=null)},t.prototype.disposeBuffers=function(){for(var t=0;8>t;++t)this.buffers[t]&&(this.buffers[t].dispose(),this.buffers[t]=null)},t.prototype.invalidateBuffers=function(){for(var t=0;8>t;++t)this.invalid[t]=!0},t.prototype.setData=function(t){this.data&&this.data.length!=t.length?this.disposeBuffers():this.invalidateBuffers(),this.data=t},t.prototype._onVerticesUpdated=function(t){var e=this._subGeometry.concatenateArrays?i.VERTEX_DATA:t.dataType;e==this._dataType&&(this._dataDirty=!0)},t}();e.VertexData=r}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.base.SubGeometryBase,n=function(){function t(){}return t.getItem=function(n,r,s){n.concatenateArrays&&(s=i.VERTEX_DATA);var a=t._pool[n.id]||(t._pool[n.id]=new Object),o=a[s]||(a[s]=new Array),h=o[r.level]||(o[r.level]=new e.VertexData(n,s));return h.updateData(r.originalIndices,r.indexMappings),h},t.disposeItem=function(e,i,n){var r=t._pool[e.id],s=r[n];s[i].dispose(),s[i]=null},t.prototype.disposeData=function(e){var i=t._pool[e.id];for(var n in i)for(var r=i[n],s=r.length,a=0;s>a;a++)r[a].dispose(),r[a]=null;t._pool[e.id]=null},t._pool=new Object,t}();e.VertexDataPool=n}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=t.pool.TextureDataPool,r=t.textures.RenderTexture,s=function(){function t(t){this._stageIndex=-1,this._antiAlias=0,this._renderTarget=null,this._renderSurfaceSelector=0,this._stageIndex=t,this._texturePool=new n(this)}return Object.defineProperty(t.prototype,"container",{get:function(){return this._pContainer},enumerable:!0,configurable:!0}),t.prototype.setRenderTarget=function(t,e,i){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=0),(this._renderTarget!==t||i!=this._renderSurfaceSelector||this._enableDepthAndStencil!=e)&&(this._renderTarget=t,this._renderSurfaceSelector=i,this._enableDepthAndStencil=e,t instanceof r?this.setRenderToTexture(this.getRenderTexture(t),e,this._antiAlias,i):(this.setRenderToBackBuffer(),this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil)))},t.prototype.getRenderTexture=function(t){var i=this._texturePool.getItem(t);return i.texture||(i.texture=this.createTexture(t.width,t.height,e.ContextGLTextureFormat.BGRA,!0)),i.texture},t.prototype.activateBuffer=function(t,e,i,n){e.contexts[this._stageIndex]||(e.contexts[this._stageIndex]=this),e.buffers[this._stageIndex]||(e.buffers[this._stageIndex]=this.createVertexBuffer(e.data.length/e.dataPerVertex,e.dataPerVertex),e.invalid[this._stageIndex]=!0),e.invalid[this._stageIndex]&&(e.buffers[this._stageIndex].uploadFromArray(e.data,0,e.data.length/e.dataPerVertex),e.invalid[this._stageIndex]=!1),this.setVertexBufferAt(t,e.buffers[this._stageIndex],i,n)},t.prototype.disposeVertexData=function(t){t.buffers[this._stageIndex].dispose(),t.buffers[this._stageIndex]=null},t.prototype.activateRenderTexture=function(t,e){this.setTextureAt(t,this.getRenderTexture(e))},t.prototype.activateTexture=function(t,i){var n=this._texturePool.getItem(i);if(n.texture||(n.texture=this.createTexture(i.width,i.height,e.ContextGLTextureFormat.BGRA,!0),n.invalid=!0),n.invalid)if(n.invalid=!1,i.generateMipmaps)for(var r=i._iGetMipmapData(),s=r.length,a=0;s>a;a++)n.texture.uploadFromData(r[a],a);else n.texture.uploadFromData(i._iGetTextureData(),0);this.setTextureAt(t,n.texture)},t.prototype.activateCubeTexture=function(t,i){var n=this._texturePool.getItem(i);if(n.texture||(n.texture=this.createCubeTexture(i.size,e.ContextGLTextureFormat.BGRA,!1),n.invalid=!0),n.invalid){n.invalid=!1;for(var r=0;6>r;++r)if(i.generateMipmaps)for(var s=i._iGetMipmapData(r),a=s.length,o=0;a>o;o++)n.texture.uploadFromData(s[o],r,o);else n.texture.uploadFromData(i._iGetTextureData(r),r,0)}this.setTextureAt(t,n.texture)},t.prototype.getIndexBuffer=function(t){return t.contexts[this._stageIndex]||(t.contexts[this._stageIndex]=this),t.buffers[this._stageIndex]||(t.buffers[this._stageIndex]=this.createIndexBuffer(t.data.length),t.invalid[this._stageIndex]=!0),t.invalid[this._stageIndex]&&(t.buffers[this._stageIndex].uploadFromArray(t.data,0,t.data.length),t.invalid[this._stageIndex]=!1),t.buffers[this._stageIndex]},t.prototype.disposeIndexData=function(t){t.buffers[this._stageIndex].dispose(),t.buffers[this._stageIndex]=null},t.prototype.clear=function(t,i,n,r,s,a,o){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=1),"undefined"==typeof a&&(a=0),"undefined"==typeof o&&(o=e.ContextGLClearMask.ALL)},t.prototype.configureBackBuffer=function(t,e,i,n){"undefined"==typeof n&&(n=!0),this._width=t,this._height=e},t.prototype.createIndexBuffer=function(){throw new i},t.prototype.createVertexBuffer=function(){throw new i},t.prototype.createTexture=function(t,e,n,r,s){throw"undefined"==typeof s&&(s=0),new i},t.prototype.createCubeTexture=function(t,e,n,r){throw"undefined"==typeof r&&(r=0),new i},t.prototype.dispose=function(){},t.prototype.present=function(){},t.prototype.setRenderToTexture=function(t,e,i,n){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0)},t.prototype.setRenderToBackBuffer=function(){},t.prototype.setScissorRectangle=function(){},t.prototype.setTextureAt=function(){},t.prototype.setVertexBufferAt=function(t,e,i,n){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=null)},t}();e.ContextGLBase=s}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.COLOR=1,t.DEPTH=2,t.STENCIL=4,t.ALL=t.COLOR|t.DEPTH|t.STENCIL,t}();t.ContextGLClearMask=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.BGRA="bgra",t.BGRA_PACKED="bgraPacked4444",t.BGR_PACKED="bgrPacked565",t.COMPRESSED="compressed",t.COMPRESSED_ALPHA="compressedAlpha",t}();t.ContextGLTextureFormat=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.BACK="back",t.FRONT="front",t.FRONT_AND_BACK="frontAndBack",t.NONE="none",t}();t.ContextGLTriangleFace=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.BYTES_4="bytes4",t.FLOAT_1="float1",t.FLOAT_2="float2",t.FLOAT_3="float3",t.FLOAT_4="float4",t}();t.ContextGLVertexBufferFormat=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.FRAGMENT="fragment",t.VERTEX="vertex",t}();t.ContextGLProgramType=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.DESTINATION_ALPHA="destinationAlpha",t.DESTINATION_COLOR="destinationColor",t.ONE="one",t.ONE_MINUS_DESTINATION_ALPHA="oneMinusDestinationAlpha",t.ONE_MINUS_DESTINATION_COLOR="oneMinusDestinationColor",t.ONE_MINUS_SOURCE_ALPHA="oneMinusSourceAlpha",t.ONE_MINUS_SOURCE_COLOR="oneMinusSourceColor",t.SOURCE_ALPHA="sourceAlpha",t.SOURCE_COLOR="sourceColor",t.ZERO="zero",t}();t.ContextGLBlendFactor=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ALWAYS="always",t.EQUAL="equal",t.GREATER="greater",t.GREATER_EQUAL="greaterEqual",t.LESS="less",t.LESS_EQUAL="lessEqual",t.NEVER="never",t.NOT_EQUAL="notEqual",t}();t.ContextGLCompareMode=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.MIPLINEAR="miplinear",t.MIPNEAREST="mipnearest",t.MIPNONE="mipnone",t}();t.ContextGLMipFilter=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.BASELINE="baseline",t.BASELINE_CONSTRAINED="baselineConstrained",t.BASELINE_EXTENDED="baselineExtended",t}();t.ContextGLProfile=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.DECREMENT_SATURATE="decrementSaturate",t.DECREMENT_WRAP="decrementWrap",t.INCREMENT_SATURATE="incrementSaturate",t.INCREMENT_WRAP="incrementWrap",t.INVERT="invert",t.KEEP="keep",t.SET="set",t.ZERO="zero",t}();t.ContextGLStencilAction=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.LINEAR="linear",t.NEAREST="nearest",t}();t.ContextGLTextureFilter=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.CLAMP="clamp",t.REPEAT="repeat",t}();t.ContextGLWrapMode=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},away;!function(t){!function(e){var i=function(i){function n(t,e,r){function s(t){t.success&&(u._pContainer=t.ref,u._iCallback=r)}i.call(this,e),this._cmdStream="",this._resources=new Array;var a="11.0.0",o={id:t.id},h={quality:"high",bgcolor:"#ffffff",allowscriptaccess:"sameDomain",allowfullscreen:"true",wmode:"direct"};this._errorCheckingEnabled=!1,this._iDriverInfo="Unknown";var p={salign:"tl",id:t.id,name:t.name};this._oldCanvas=t.cloneNode(),this._oldParent=t.parentNode;var u=this;n.contexts[t.id]=this,swfobject.embedSWF("../libs/molehill_js_flashbridge.swf",t.id,String(t.width),String(t.height),a,"",o,h,p,s)}return __extends(n,i),Object.defineProperty(n.prototype,"container",{get:function(){return this._pContainer},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"driverInfo",{get:function(){return this._iDriverInfo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errorCheckingEnabled",{get:function(){return this._errorCheckingEnabled},set:function(e){this._errorCheckingEnabled!=e&&(this._errorCheckingEnabled=e,this.addStream(String.fromCharCode(t.stagegl.OpCodes.enableErrorChecking,e?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue)),this.execute())},enumerable:!0,configurable:!0}),n.prototype._iAddResource=function(t){this._resources.push(t)},n.prototype._iRemoveResource=function(t){this._resources.splice(this._resources.indexOf(t))},n.prototype.createTexture=function(t,i,n,r,s){return"undefined"==typeof s&&(s=0),new e.TextureFlash(this,t,i,n,r)},n.prototype.createCubeTexture=function(t,i,n,r){return"undefined"==typeof r&&(r=0),new e.CubeTextureFlash(this,t,i,n)},n.prototype.setTextureAt=function(e,i){this.addStream(i?String.fromCharCode(t.stagegl.OpCodes.setTextureAt)+e+","+i.id+",":String.fromCharCode(t.stagegl.OpCodes.clearTextureAt)+e.toString()+","),n.debug&&this.execute()},n.prototype.setSamplerStateAt=function(){},n.prototype.setStencilActions=function(e,i,r,s,a){"undefined"==typeof e&&(e="frontAndBack"),"undefined"==typeof i&&(i="always"),"undefined"==typeof r&&(r="keep"),"undefined"==typeof s&&(s="keep"),"undefined"==typeof a&&(a="keep"),this.addStream(String.fromCharCode(t.stagegl.OpCodes.setStencilActions)+e+"$"+i+"$"+r+"$"+s+"$"+a+"$"),n.debug&&this.execute()},n.prototype.setStencilReferenceValue=function(e,i,r){"undefined"==typeof i&&(i=255),"undefined"==typeof r&&(r=255),this.addStream(String.fromCharCode(t.stagegl.OpCodes.setStencilReferenceValue,e+t.stagegl.OpCodes.intMask,i+t.stagegl.OpCodes.intMask,r+t.stagegl.OpCodes.intMask)),n.debug&&this.execute()},n.prototype.setCulling=function(e,i){"undefined"==typeof i&&(i="leftHanded"),this.addStream(String.fromCharCode(t.stagegl.OpCodes.setCulling)+e+"$"),n.debug&&this.execute()},n.prototype.drawTriangles=function(e,i,r){"undefined"==typeof i&&(i=0),"undefined"==typeof r&&(r=-1),i=i||0,(!r||0>r)&&(r=e.numIndices/3),this.addStream(String.fromCharCode(t.stagegl.OpCodes.drawTriangles,e.id+t.stagegl.OpCodes.intMask)+i+","+r+","),n.debug&&this.execute()},n.prototype.setProgramConstantsFromMatrix=function(t,e,i,n){"undefined"==typeof n&&(n=!1);var r=i.rawData;n?(this.setProgramConstantsFromArray(t,e,[r[0],r[4],r[8],r[12]],1),this.setProgramConstantsFromArray(t,e+1,[r[1],r[5],r[9],r[13]],1),this.setProgramConstantsFromArray(t,e+2,[r[2],r[6],r[10],r[14]],1),this.setProgramConstantsFromArray(t,e+3,[r[3],r[7],r[11],r[15]],1)):(this.setProgramConstantsFromArray(t,e,[r[0],r[1],r[2],r[3]],1),this.setProgramConstantsFromArray(t,e+1,[r[4],r[5],r[6],r[7]],1),this.setProgramConstantsFromArray(t,e+2,[r[8],r[9],r[10],r[11]],1),this.setProgramConstantsFromArray(t,e+3,[r[12],r[13],r[14],r[15]],1))},n.prototype.setProgramConstantsFromArray=function(i,r,s,a){"undefined"==typeof a&&(a=-1);for(var o,h=i==e.ContextGLProgramType.VERTEX?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue,p=0;a>p;p++)o=4*p,this.addStream(String.fromCharCode(t.stagegl.OpCodes.setProgramConstant,h,r+p+t.stagegl.OpCodes.intMask)+s[o]+","+s[o+1]+","+s[o+2]+","+s[o+3]+","),n.debug&&this.execute()},n.prototype.setProgram=function(e){this.addStream(String.fromCharCode(t.stagegl.OpCodes.setProgram,e.id+t.stagegl.OpCodes.intMask)),n.debug&&this.execute()},n.prototype.present=function(){this.addStream(String.fromCharCode(t.stagegl.OpCodes.present)),this.execute()},n.prototype.clear=function(i,r,s,a,o,h,p){"undefined"==typeof i&&(i=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=1),"undefined"==typeof o&&(o=1),"undefined"==typeof h&&(h=0),"undefined"==typeof p&&(p=e.ContextGLClearMask.ALL),this.addStream(String.fromCharCode(t.stagegl.OpCodes.clear)+i+","+r+","+s+","+a+","+o+","+h+","+p+","),n.debug&&this.execute()},n.prototype.createProgram=function(){return new e.ProgramFlash(this)},n.prototype.createVertexBuffer=function(t,i){return new e.VertexBufferFlash(this,t,i)},n.prototype.createIndexBuffer=function(t){return new e.IndexBufferFlash(this,t)},n.prototype.configureBackBuffer=function(e,n,r,s){"undefined"==typeof s&&(s=!0),i.prototype.configureBackBuffer.call(this,e,n,r,s),this.addStream(String.fromCharCode(t.stagegl.OpCodes.configureBackBuffer)+e+","+n+",")},n.prototype.drawToBitmapData=function(){},n.prototype.setVertexBufferAt=function(e,i,r,s){"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=null),this.addStream(i?String.fromCharCode(t.stagegl.OpCodes.setVertexBufferAt,e+t.stagegl.OpCodes.intMask)+i.id+","+r+","+s+"$":String.fromCharCode(t.stagegl.OpCodes.clearVertexBufferAt,e+t.stagegl.OpCodes.intMask)),n.debug&&this.execute()},n.prototype.setColorMask=function(e,i,r,s){this.addStream(String.fromCharCode(t.stagegl.OpCodes.setColorMask,e?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue,i?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue,r?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue,s?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue)),n.debug&&this.execute()},n.prototype.setBlendFactors=function(e,i){this.addStream(String.fromCharCode(t.stagegl.OpCodes.setBlendFactors)+e+"$"+i+"$"),n.debug&&this.execute()},n.prototype.setRenderToTexture=function(e,i,r,s){"undefined"==typeof i&&(i=!1),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),this.addStream(null===e||void 0===e?String.fromCharCode(t.stagegl.OpCodes.clearRenderToTexture):String.fromCharCode(t.stagegl.OpCodes.setRenderToTexture,i?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue)+e.id+","+(r||0)+","),n.debug&&this.execute()},n.prototype.setRenderToBackBuffer=function(){this.addStream(String.fromCharCode(t.stagegl.OpCodes.clearRenderToTexture)),n.debug&&this.execute()},n.prototype.setScissorRectangle=function(e){this.addStream(e?String.fromCharCode(t.stagegl.OpCodes.setScissorRect)+e.x+","+e.y+","+e.width+","+e.height+",":String.fromCharCode(t.stagegl.OpCodes.clearScissorRect)),n.debug&&this.execute()},n.prototype.setDepthTest=function(e,i){this.addStream(String.fromCharCode(t.stagegl.OpCodes.setDepthTest,e?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue)+i+"$"),n.debug&&this.execute()
},n.prototype.dispose=function(){if(null!=this._pContainer){for(console.log("Context3D dispose, releasing "+this._resources.length+" resources.");this._resources.length;)this._resources[0].dispose();this._pContainer&&(this.addStream(String.fromCharCode(t.stagegl.OpCodes.disposeContext)),this.execute(),swfobject.removeSWF(this._oldCanvas.id),this._oldCanvas&&this._oldParent&&(this._oldParent.appendChild(this._oldCanvas),this._oldParent=null),this._pContainer=null),this._oldCanvas=null}},n.prototype.addStream=function(t){this._cmdStream+=t},n.prototype.execute=function(){n.logStream&&console.log(this._cmdStream);var t=this._pContainer.CallFunction('<invoke name="execStage3dOpStream" returntype="javascript"><arguments><string>'+this._cmdStream+"</string></arguments></invoke>");if(Number(t)<=-3)throw"Exec stream failed";return this._cmdStream="",Number(t)},n.contexts=new Object,n.maxvertexconstants=128,n.maxfragconstants=28,n.maxtemp=8,n.maxstreams=8,n.maxtextures=8,n.defaultsampler=new aglsl.Sampler,n.debug=!1,n.logStream=!1,n}(e.ContextGLBase);e.ContextStage3D=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(t,r){i.call(this,r),this._blendFactorDictionary=new Object,this._depthTestDictionary=new Object,this._textureIndexDictionary=new Array(8),this._textureTypeDictionary=new Object,this._wrapDictionary=new Object,this._filterDictionary=new Object,this._mipmapFilterDictionary=new Object,this._uniformLocationNameDictionary=new Object,this._vertexBufferDimensionDictionary=new Object,this._indexBufferList=new Array,this._vertexBufferList=new Array,this._textureList=new Array,this._programList=new Array,this._samplerStates=new Array(8),this._pContainer=t;try{this._gl=t.getContext("experimental-webgl",{premultipliedAlpha:!1,alpha:!1}),this._gl||(this._gl=t.getContext("webgl",{premultipliedAlpha:!1,alpha:!1}))}catch(s){}this._gl?(this._blendFactorDictionary[e.ContextGLBlendFactor.ONE]=this._gl.ONE,this._blendFactorDictionary[e.ContextGLBlendFactor.DESTINATION_ALPHA]=this._gl.DST_ALPHA,this._blendFactorDictionary[e.ContextGLBlendFactor.DESTINATION_COLOR]=this._gl.DST_COLOR,this._blendFactorDictionary[e.ContextGLBlendFactor.ONE]=this._gl.ONE,this._blendFactorDictionary[e.ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=this._gl.ONE_MINUS_DST_ALPHA,this._blendFactorDictionary[e.ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=this._gl.ONE_MINUS_DST_COLOR,this._blendFactorDictionary[e.ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=this._gl.ONE_MINUS_SRC_ALPHA,this._blendFactorDictionary[e.ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=this._gl.ONE_MINUS_SRC_COLOR,this._blendFactorDictionary[e.ContextGLBlendFactor.SOURCE_ALPHA]=this._gl.SRC_ALPHA,this._blendFactorDictionary[e.ContextGLBlendFactor.SOURCE_COLOR]=this._gl.SRC_COLOR,this._blendFactorDictionary[e.ContextGLBlendFactor.ZERO]=this._gl.ZERO,this._depthTestDictionary[e.ContextGLCompareMode.ALWAYS]=this._gl.ALWAYS,this._depthTestDictionary[e.ContextGLCompareMode.EQUAL]=this._gl.EQUAL,this._depthTestDictionary[e.ContextGLCompareMode.GREATER]=this._gl.GREATER,this._depthTestDictionary[e.ContextGLCompareMode.GREATER_EQUAL]=this._gl.GEQUAL,this._depthTestDictionary[e.ContextGLCompareMode.LESS]=this._gl.LESS,this._depthTestDictionary[e.ContextGLCompareMode.LESS_EQUAL]=this._gl.LEQUAL,this._depthTestDictionary[e.ContextGLCompareMode.NEVER]=this._gl.NEVER,this._depthTestDictionary[e.ContextGLCompareMode.NOT_EQUAL]=this._gl.NOTEQUAL,this._textureIndexDictionary[0]=this._gl.TEXTURE0,this._textureIndexDictionary[1]=this._gl.TEXTURE1,this._textureIndexDictionary[2]=this._gl.TEXTURE2,this._textureIndexDictionary[3]=this._gl.TEXTURE3,this._textureIndexDictionary[4]=this._gl.TEXTURE4,this._textureIndexDictionary[5]=this._gl.TEXTURE5,this._textureIndexDictionary[6]=this._gl.TEXTURE6,this._textureIndexDictionary[7]=this._gl.TEXTURE7,this._textureTypeDictionary.texture2d=this._gl.TEXTURE_2D,this._textureTypeDictionary.textureCube=this._gl.TEXTURE_CUBE_MAP,this._wrapDictionary[e.ContextGLWrapMode.REPEAT]=this._gl.REPEAT,this._wrapDictionary[e.ContextGLWrapMode.CLAMP]=this._gl.CLAMP_TO_EDGE,this._filterDictionary[e.ContextGLTextureFilter.LINEAR]=this._gl.LINEAR,this._filterDictionary[e.ContextGLTextureFilter.NEAREST]=this._gl.NEAREST,this._mipmapFilterDictionary[e.ContextGLTextureFilter.LINEAR]=new Object,this._mipmapFilterDictionary[e.ContextGLTextureFilter.LINEAR][e.ContextGLMipFilter.MIPNEAREST]=this._gl.LINEAR_MIPMAP_NEAREST,this._mipmapFilterDictionary[e.ContextGLTextureFilter.LINEAR][e.ContextGLMipFilter.MIPLINEAR]=this._gl.LINEAR_MIPMAP_LINEAR,this._mipmapFilterDictionary[e.ContextGLTextureFilter.LINEAR][e.ContextGLMipFilter.MIPNONE]=this._gl.LINEAR,this._mipmapFilterDictionary[e.ContextGLTextureFilter.NEAREST]=new Object,this._mipmapFilterDictionary[e.ContextGLTextureFilter.NEAREST][e.ContextGLMipFilter.MIPNEAREST]=this._gl.NEAREST_MIPMAP_NEAREST,this._mipmapFilterDictionary[e.ContextGLTextureFilter.NEAREST][e.ContextGLMipFilter.MIPLINEAR]=this._gl.NEAREST_MIPMAP_LINEAR,this._mipmapFilterDictionary[e.ContextGLTextureFilter.NEAREST][e.ContextGLMipFilter.MIPNONE]=this._gl.NEAREST,this._uniformLocationNameDictionary[e.ContextGLProgramType.VERTEX]="vc",this._uniformLocationNameDictionary[e.ContextGLProgramType.FRAGMENT]="fc",this._vertexBufferDimensionDictionary[e.ContextGLVertexBufferFormat.FLOAT_1]=1,this._vertexBufferDimensionDictionary[e.ContextGLVertexBufferFormat.FLOAT_2]=2,this._vertexBufferDimensionDictionary[e.ContextGLVertexBufferFormat.FLOAT_3]=3,this._vertexBufferDimensionDictionary[e.ContextGLVertexBufferFormat.FLOAT_4]=4,this._vertexBufferDimensionDictionary[e.ContextGLVertexBufferFormat.BYTES_4]=4):alert("WebGL is not available.");for(var a=0;a<n.MAX_SAMPLERS;++a)this._samplerStates[a]=new e.SamplerState,this._samplerStates[a].wrap=this._gl.REPEAT,this._samplerStates[a].filter=this._gl.LINEAR,this._samplerStates[a].mipfilter=this._gl.LINEAR}return __extends(n,i),Object.defineProperty(n.prototype,"container",{get:function(){return this._pContainer},enumerable:!0,configurable:!0}),n.prototype.gl=function(){return this._gl},n.prototype.clear=function(t,i,n,r,s,a,o){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=1),"undefined"==typeof a&&(a=0),"undefined"==typeof o&&(o=e.ContextGLClearMask.ALL),this._drawing||(this.updateBlendStatus(),this._drawing=!0);var h=0;o&e.ContextGLClearMask.COLOR&&(h|=this._gl.COLOR_BUFFER_BIT),o&e.ContextGLClearMask.STENCIL&&(h|=this._gl.STENCIL_BUFFER_BIT),o&e.ContextGLClearMask.DEPTH&&(h|=this._gl.DEPTH_BUFFER_BIT),this._gl.clearColor(t,i,n,r),this._gl.clearDepth(s),this._gl.clearStencil(a),this._gl.clear(h)},n.prototype.configureBackBuffer=function(t,e,n,r){"undefined"==typeof r&&(r=!0),i.prototype.configureBackBuffer.call(this,t,e,n,r),r&&(this._gl.enable(this._gl.STENCIL_TEST),this._gl.enable(this._gl.DEPTH_TEST)),this._gl.viewport.width=t,this._gl.viewport.height=e,this._gl.viewport(0,0,t,e)},n.prototype.createCubeTexture=function(t,i,n,r){"undefined"==typeof r&&(r=0);var s=new e.CubeTextureWebGL(this._gl,t);return this._textureList.push(s),s},n.prototype.createIndexBuffer=function(t){var i=new e.IndexBufferWebGL(this._gl,t);return this._indexBufferList.push(i),i},n.prototype.createProgram=function(){var t=new e.ProgramWebGL(this._gl);return this._programList.push(t),t},n.prototype.createTexture=function(t,i,n,r,s){"undefined"==typeof s&&(s=0);var a=new e.TextureWebGL(this._gl,t,i);return this._textureList.push(a),a},n.prototype.createVertexBuffer=function(t,i){var n=new e.VertexBufferWebGL(this._gl,t,i);return this._vertexBufferList.push(n),n},n.prototype.dispose=function(){var t;for(t=0;t<this._indexBufferList.length;++t)this._indexBufferList[t].dispose();for(this._indexBufferList=null,t=0;t<this._vertexBufferList.length;++t)this._vertexBufferList[t].dispose();for(this._vertexBufferList=null,t=0;t<this._textureList.length;++t)this._textureList[t].dispose();for(this._textureList=null,t=0;t<this._programList.length;++t)this._programList[t].dispose();for(t=0;t<this._samplerStates.length;++t)this._samplerStates[t]=null;this._programList=null},n.prototype.drawToBitmapData=function(e){var i=new ArrayBuffer(e.width*e.height*4);this._gl.readPixels(0,0,e.width,e.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,new Uint8Array(i));var n=new t.utils.ByteArray;n.setArrayBuffer(i),e.setPixels(new t.geom.Rectangle(0,0,e.width,e.height),n)},n.prototype.drawTriangles=function(t,e,i){if("undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=-1),!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.glBuffer),this._gl.drawElements(this._gl.TRIANGLES,-1==i?t.numIndices:3*i,this._gl.UNSIGNED_SHORT,e)},n.prototype.present=function(){this._drawing=!1},n.prototype.setBlendFactors=function(t,e){this._blendEnabled=!0,this._blendSourceFactor=this._blendFactorDictionary[t],this._blendDestinationFactor=this._blendFactorDictionary[e],this.updateBlendStatus()},n.prototype.setColorMask=function(t,e,i,n){this._gl.colorMask(t,e,i,n)},n.prototype.setCulling=function(t,i){if("undefined"==typeof i&&(i="leftHanded"),t==e.ContextGLTriangleFace.NONE)this._gl.disable(this._gl.CULL_FACE);else switch(this._gl.enable(this._gl.CULL_FACE),t){case e.ContextGLTriangleFace.BACK:this._gl.cullFace("leftHanded"==i?this._gl.FRONT:this._gl.BACK);break;case e.ContextGLTriangleFace.FRONT:this._gl.cullFace("leftHanded"==i?this._gl.BACK:this._gl.FRONT);break;case e.ContextGLTriangleFace.FRONT_AND_BACK:this._gl.cullFace(this._gl.FRONT_AND_BACK);break;default:throw"Unknown ContextGLTriangleFace type."}},n.prototype.setDepthTest=function(t,e){this._gl.depthFunc(this._depthTestDictionary[e]),this._gl.depthMask(t)},n.prototype.setProgram=function(t){this._currentProgram=t,t.focusProgram()},n.prototype.setProgramConstantsFromMatrix=function(t,e,i,n){"undefined"==typeof n&&(n=!1);var r=i.rawData;n?(this.setProgramConstantsFromArray(t,e,[r[0],r[4],r[8],r[12]],1),this.setProgramConstantsFromArray(t,e+1,[r[1],r[5],r[9],r[13]],1),this.setProgramConstantsFromArray(t,e+2,[r[2],r[6],r[10],r[14]],1),this.setProgramConstantsFromArray(t,e+3,[r[3],r[7],r[11],r[15]],1)):(this.setProgramConstantsFromArray(t,e,[r[0],r[1],r[2],r[3]],1),this.setProgramConstantsFromArray(t,e+1,[r[4],r[5],r[6],r[7]],1),this.setProgramConstantsFromArray(t,e+2,[r[8],r[9],r[10],r[11]],1),this.setProgramConstantsFromArray(t,e+3,[r[12],r[13],r[14],r[15]],1))},n.prototype.setProgramConstantsFromArray=function(t,e,i,n){"undefined"==typeof n&&(n=-1);for(var r,s=this._uniformLocationNameDictionary[t],a=0;n>a;a++)r=4*a,this._gl.uniform4f(this._gl.getUniformLocation(this._currentProgram.glProgram,s+(e+a)),i[r],i[r+1],i[r+2],i[r+3])},n.prototype.setScissorRectangle=function(t){return t?(this._gl.enable(this._gl.SCISSOR_TEST),void this._gl.scissor(t.x,t.y,t.width,t.height)):void this._gl.disable(this._gl.SCISSOR_TEST)},n.prototype.setTextureAt=function(t,e){var i=this._samplerStates[t];if(this._activeTexture!=t&&(e||i.type)&&(this._activeTexture=t,this._gl.activeTexture(this._textureIndexDictionary[t])),!e)return void(i.type&&(this._gl.bindTexture(i.type,null),i.type=null));var n=this._textureTypeDictionary[e.textureType];i.type=n,this._gl.bindTexture(n,e.glTexture),this._gl.uniform1i(this._gl.getUniformLocation(this._currentProgram.glProgram,"fs"+t),t),this._gl.texParameteri(n,this._gl.TEXTURE_WRAP_S,i.wrap),this._gl.texParameteri(n,this._gl.TEXTURE_WRAP_T,i.wrap),this._gl.texParameteri(n,this._gl.TEXTURE_MAG_FILTER,i.filter),this._gl.texParameteri(n,this._gl.TEXTURE_MIN_FILTER,i.mipfilter)},n.prototype.setSamplerStateAt=function(t,e,i,r){if(!(t>=0&&t<n.MAX_SAMPLERS))throw"Sampler is out of bounds.";this._samplerStates[t].wrap=this._wrapDictionary[e],this._samplerStates[t].filter=this._filterDictionary[i],this._samplerStates[t].mipfilter=this._mipmapFilterDictionary[i][r]},n.prototype.setVertexBufferAt=function(t,e,i,n){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=null);var r=this._currentProgram?this._gl.getAttribLocation(this._currentProgram.glProgram,"va"+t):-1;return e?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.glBuffer),this._gl.enableVertexAttribArray(r),void this._gl.vertexAttribPointer(r,this._vertexBufferDimensionDictionary[n],this._gl.FLOAT,!1,4*e.data32PerVertex,4*i)):void(r>-1&&this._gl.disableVertexAttribArray(r))},n.prototype.setRenderToTexture=function(t,e,i,n){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0);var r=t,s=r.frameBuffer;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,s),e&&(this._gl.enable(this._gl.STENCIL_TEST),this._gl.enable(this._gl.DEPTH_TEST)),this._gl.viewport(0,0,r.width,r.height)},n.prototype.setRenderToBackBuffer=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},n.prototype.updateBlendStatus=function(){this._blendEnabled?(this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._blendSourceFactor,this._blendDestinationFactor)):this._gl.disable(this._gl.BLEND)},n.MAX_SAMPLERS=8,n.modulo=0,n}(e.ContextGLBase);e.ContextWebGL=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"id",{get:function(){return this._pId},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t}();t.ResourceBaseFlash=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(t){this.textureType="",this._gl=t}return e.prototype.dispose=function(){throw"Abstract method must be overridden."},Object.defineProperty(e.prototype,"glTexture",{get:function(){throw new t.errors.AbstractMethodError},enumerable:!0,configurable:!0}),e}();e.TextureBaseWebGL=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=t.utils.ByteArrayBase,n=function(e){function n(i,n,r,s,a){"undefined"==typeof a&&(a=!1),e.call(this),this._context=i,this._size=n,this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.initCubeTexture,s?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue)+n+","+a+","+r+"$"),this._pId=this._context.execute(),this._context._iAddResource(this)}return __extends(n,e),Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.disposeCubeTexture)+this._pId.toString()+","),this._context.execute(),this._context._iRemoveResource(this),this._context=null},n.prototype.uploadFromData=function(e,n,r){if("undefined"==typeof r&&(r=0),e instanceof t.base.BitmapData)e=e.imageData.data;else if(e instanceof HTMLImageElement){var s=document.createElement("canvas"),a=e.width,o=e.height;s.width=a,s.height=o;var h=s.getContext("2d");h.drawImage(e,0,0),e=h.getImageData(0,0,a,o).data}var p=0,u=i.internalGetBase64String(e.length,function(){return e[p++]},null);this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.uploadBytesCubeTexture)+this._pId+","+r+","+n+","+(this.size>>r)+","+u+"%"),this._context.execute()},n.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){"undefined"==typeof i&&(i=!1)},n}(e.ResourceBaseFlash);e.CubeTextureFlash=n}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i){e.call(this,t),this._textureSelectorDictionary=new Array(6),this.textureType="textureCube",this._size=i,this._texture=this._gl.createTexture(),this._textureSelectorDictionary[0]=t.TEXTURE_CUBE_MAP_POSITIVE_X,this._textureSelectorDictionary[1]=t.TEXTURE_CUBE_MAP_NEGATIVE_X,this._textureSelectorDictionary[2]=t.TEXTURE_CUBE_MAP_POSITIVE_Y,this._textureSelectorDictionary[3]=t.TEXTURE_CUBE_MAP_NEGATIVE_Y,this._textureSelectorDictionary[4]=t.TEXTURE_CUBE_MAP_POSITIVE_Z,this._textureSelectorDictionary[5]=t.TEXTURE_CUBE_MAP_NEGATIVE_Z}return __extends(i,e),i.prototype.dispose=function(){this._gl.deleteTexture(this._texture)},i.prototype.uploadFromData=function(e,i,n){"undefined"==typeof n&&(n=0),e instanceof t.base.BitmapData&&(e=e.imageData),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._texture),this._gl.texImage2D(this._textureSelectorDictionary[i],n,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)},i.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){"undefined"==typeof i&&(i=!1)},Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glTexture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),i}(e.TextureBaseWebGL);e.CubeTextureWebGL=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(){}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(i,n){e.call(this),this._context=i,this._numIndices=n,this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.initIndexBuffer,n+t.stagegl.OpCodes.intMask)),this._pId=this._context.execute(),this._context._iAddResource(this)}return __extends(i,e),i.prototype.uploadFromArray=function(e,i,n){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.uploadArrayIndexBuffer,this._pId+t.stagegl.OpCodes.intMask)+e.join()+"#"+i+","+n+","),this._context.execute()},i.prototype.dispose=function(){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.disposeIndexBuffer,this._pId+t.stagegl.OpCodes.intMask)),this._context.execute(),this._context._iRemoveResource(this),this._context=null},Object.defineProperty(i.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),i}(e.ResourceBaseFlash);e.IndexBufferFlash=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e){this._gl=t,this._buffer=this._gl.createBuffer(),this._numIndices=e}return t.prototype.uploadFromArray=function(t){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this._gl.STATIC_DRAW)},t.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)},Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}();t.IndexBufferWebGL=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(){}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.trueValue=32,t.falseValue=33,t.intMask=63,t.drawTriangles=41,t.setProgramConstant=42,t.setProgram=43,t.present=44,t.clear=45,t.initProgram=46,t.initVertexBuffer=47,t.initIndexBuffer=48,t.configureBackBuffer=49,t.uploadArrayIndexBuffer=50,t.uploadArrayVertexBuffer=51,t.uploadAGALBytesProgram=52,t.setVertexBufferAt=53,t.uploadBytesIndexBuffer=54,t.uploadBytesVertexBuffer=55,t.setColorMask=56,t.setDepthTest=57,t.disposeProgram=58,t.disposeContext=59,t.disposeVertexBuffer=61,t.disposeIndexBuffer=63,t.initTexture=64,t.setTextureAt=65,t.uploadBytesTexture=66,t.disposeTexture=67,t.setCulling=68,t.setScissorRect=69,t.clearScissorRect=70,t.setBlendFactors=71,t.setRenderToTexture=72,t.clearTextureAt=73,t.clearVertexBufferAt=74,t.setStencilActions=75,t.setStencilReferenceValue=76,t.initCubeTexture=77,t.disposeCubeTexture=78,t.uploadBytesCubeTexture=79,t.clearRenderToTexture=80,t.enableErrorChecking=81,t}();t.OpCodes=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(e){i.call(this),this._context=e,this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.initProgram)),this._pId=this._context.execute(),this._context._iAddResource(this)}return __extends(n,i),n.prototype.upload=function(i,n){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.uploadAGALBytesProgram,this._pId+t.stagegl.OpCodes.intMask)+i.readBase64String(i.length)+"%"+n.readBase64String(n.length)+"%"),e.ContextStage3D.debug&&this._context.execute()},n.prototype.dispose=function(){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.disposeProgram,this._pId+t.stagegl.OpCodes.intMask)),this._context.execute(),this._context._iRemoveResource(this),this._context=null},n}(e.ResourceBaseFlash);e.ProgramFlash=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){this._gl=t,this._program=this._gl.createProgram()}return t.prototype.upload=function(e,i){var n=t._aglslParser.parse(t._tokenizer.decribeAGALByteArray(e)),r=t._aglslParser.parse(t._tokenizer.decribeAGALByteArray(i));return this._vertexShader=this._gl.createShader(this._gl.VERTEX_SHADER),this._fragmentShader=this._gl.createShader(this._gl.FRAGMENT_SHADER),this._gl.shaderSource(this._vertexShader,n),this._gl.compileShader(this._vertexShader),this._gl.getShaderParameter(this._vertexShader,this._gl.COMPILE_STATUS)?(this._gl.shaderSource(this._fragmentShader,r),this._gl.compileShader(this._fragmentShader),this._gl.getShaderParameter(this._fragmentShader,this._gl.COMPILE_STATUS)?(this._gl.attachShader(this._program,this._vertexShader),this._gl.attachShader(this._program,this._fragmentShader),this._gl.linkProgram(this._program),void(this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||alert("Could not link the program."))):(alert(this._gl.getShaderInfoLog(this._fragmentShader)),null)):(alert(this._gl.getShaderInfoLog(this._vertexShader)),null)},t.prototype.dispose=function(){this._gl.deleteProgram(this._program)},t.prototype.focusProgram=function(){this._gl.useProgram(this._program)},Object.defineProperty(t.prototype,"glProgram",{get:function(){return this._program},enumerable:!0,configurable:!0}),t._tokenizer=new aglsl.AGALTokenizer,t._aglslParser=new aglsl.AGLSLParser,t}();t.ProgramWebGL=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t}();t.SamplerState=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=t.utils.ByteArrayBase,n=function(e){function n(i,n,r,s,a,o){"undefined"==typeof o&&(o=!1),e.call(this),this._context=i,this._width=n,this._height=r,this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.initTexture,a?t.stagegl.OpCodes.trueValue:t.stagegl.OpCodes.falseValue)+n+","+r+","+o+","+s+"$"),this._pId=this._context.execute(),this._context._iAddResource(this)}return __extends(n,e),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.disposeTexture)+this._pId.toString()+","),this._context.execute(),this._context._iRemoveResource(this),this._context=null},n.prototype.uploadFromData=function(e,n){if("undefined"==typeof n&&(n=0),e instanceof t.base.BitmapData)e=e.imageData.data;else if(e instanceof HTMLImageElement){var r=document.createElement("canvas"),s=e.width,a=e.height;r.width=s,r.height=a;var o=r.getContext("2d");o.drawImage(e,0,0),e=o.getImageData(0,0,s,a).data}var h=0,p=i.internalGetBase64String(e.length,function(){return e[h++]},null);this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.uploadBytesTexture)+this._pId+","+n+","+(this._width>>n)+","+(this._height>>n)+","+p+"%"),this._context.execute()},n}(e.ResourceBaseFlash);e.TextureFlash=n}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i,n){e.call(this,t),this.textureType="texture2d",this._width=i,this._height=n,this._glTexture=this._gl.createTexture()}return __extends(i,e),i.prototype.dispose=function(){this._gl.deleteTexture(this._glTexture)},Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameBuffer",{get:function(){if(!this._frameBuffer){this._frameBuffer=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._frameBuffer),this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._width,this._height,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null);var t=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,t),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._width,this._height),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._glTexture,0),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,t),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return this._frameBuffer},enumerable:!0,configurable:!0}),i.prototype.uploadFromData=function(e,i){"undefined"==typeof i&&(i=0),e instanceof t.base.BitmapData&&(e=e.imageData),this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,i,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},i.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){"undefined"==typeof i&&(i=!1),this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")},Object.defineProperty(i.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:!0,configurable:!0}),i.prototype.generateMipmaps=function(){},i}(e.TextureBaseWebGL);e.TextureWebGL=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(i,n,r){e.call(this),this._context=i,this._numVertices=n,this._data32PerVertex=r,this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.initVertexBuffer,r+t.stagegl.OpCodes.intMask)+n.toString()+","),this._pId=this._context.execute(),this._context._iAddResource(this)}return __extends(i,e),i.prototype.uploadFromArray=function(e,i,n){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.uploadArrayVertexBuffer,this._pId+t.stagegl.OpCodes.intMask)+e.join()+"#"+[i,n].join()+","),this._context.execute()},Object.defineProperty(i.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"data32PerVertex",{get:function(){return this._data32PerVertex},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this._context.addStream(String.fromCharCode(t.stagegl.OpCodes.disposeVertexBuffer,this._pId+t.stagegl.OpCodes.intMask)),this._context.execute(),this._context._iRemoveResource(this),this._context=null},i}(e.ResourceBaseFlash);e.VertexBufferFlash=i}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i){this._gl=t,this._buffer=this._gl.createBuffer(),this._numVertices=e,this._data32PerVertex=i}return t.prototype.uploadFromArray=function(t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(t),this._gl.STATIC_DRAW)},Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data32PerVertex",{get:function(){return this._data32PerVertex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)},t}();t.VertexBufferWebGL=e}(t.stagegl||(t.stagegl={})),t.stagegl}(away||(away={}));var away;!function(t){!function(e){var i=t.events.StageEvent,n=function(){function t(t,e){if(!e)throw new Error("This class is a multiton and cannot be instantiated manually. Use StageManager.getInstance instead.");this._stage=t,this._program3Ds=new Object,this._ids=new Object,this._usages=new Object,this._keys=new Object}return t.getInstance=function(e){var n=e.stageIndex;return null==t._instances&&(t._instances=new Array(8)),t._instances[n]||(t._instances[n]=new t(e,new AGALProgramCacheSingletonEnforcer),e.addEventListener(i.CONTEXT_DISPOSED,t.onContextGLDisposed),e.addEventListener(i.CONTEXT_CREATED,t.onContextGLDisposed),e.addEventListener(i.CONTEXT_RECREATED,t.onContextGLDisposed)),t._instances[n]},t.getInstanceFromIndex=function(e){if(!t._instances[e])throw new Error("Instance not created yet!");return t._instances[e]},t.onContextGLDisposed=function(e){var n=e.target,r=n.stageIndex;t._instances[r].dispose(),t._instances[r]=null,n.removeEventListener(i.CONTEXT_DISPOSED,t.onContextGLDisposed),n.removeEventListener(i.CONTEXT_CREATED,t.onContextGLDisposed),n.removeEventListener(i.CONTEXT_RECREATED,t.onContextGLDisposed)},t.prototype.dispose=function(){for(var t in this._program3Ds)this.destroyProgram(t);this._keys=null,this._program3Ds=null,this._usages=null},t.prototype.setProgram=function(e,i,n,r){var s,a=this._stage.stageIndex,o=this.getKey(n,r);if(null==this._program3Ds[o]){this._keys[t._currentId]=o,this._usages[t._currentId]=0,this._ids[o]=t._currentId,++t._currentId,s=this._stage.context.createProgram();var h=(new aglsl.assembler.AGALMiniAssembler).assemble("part vertex 1\n"+n+"endpart").vertex.data,p=(new aglsl.assembler.AGALMiniAssembler).assemble("part fragment 1\n"+r+"endpart").fragment.data;s.upload(h,p),this._program3Ds[o]=s}var u=e[a],l=this._ids[o];u!=l&&(u>=0&&this.freeProgram(u),this._usages[l]++),e[a]=l,i[a]=this._program3Ds[o]},t.prototype.freeProgram=function(t){this._usages[t]--,0==this._usages[t]&&this.destroyProgram(this._keys[t])},t.prototype.destroyProgram=function(t){this._program3Ds[t].dispose(),this._program3Ds[t]=null,delete this._program3Ds[t],this._ids[t]=-1},t.prototype.getKey=function(t,e){return t+"---"+e},t._currentId=0,t}();e.AGALProgramCache=n}(t.managers||(t.managers={})),t.managers}(away||(away={}));var AGALProgramCacheSingletonEnforcer=function(){function t(){}return t}(),away;!function(t){!function(e){var i=function(e){function i(i,n){if(e.call(this),this._viewWidth=-1,this._viewHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._buffersInvalid=!0,!i)throw new Error("No cheating the multiton!");this._renderToTextureRect=new t.geom.Rectangle,this._stage=n}return __extends(i,e),i.getInstance=function(t){if(!t)throw new Error("stage key cannot be null!");null==i._instances&&(i._instances=new Array);var e=i.getRTTBufferManagerFromStage(t);if(null==e){e=new i(new SingletonEnforcer,t);var r=new n;r.stage3d=t,r.rttbfm=e,i._instances.push(r)}return e},i.getRTTBufferManagerFromStage=function(t){for(var e,n=i._instances.length,r=0;n>r;r++)if(e=i._instances[r],e.stage3d===t)return e.rttbfm;return null},i.deleteRTTBufferManager=function(t){for(var e,n=i._instances.length,r=0;n>r;r++)if(e=i._instances[r],e.stage3d===t)return void i._instances.splice(r,1)},Object.defineProperty(i.prototype,"textureRatioX",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureRatioY",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(e){e!=this._viewWidth&&(this._viewWidth=e,this._buffersInvalid=!0,this._textureWidth=t.utils.TextureUtils.getBestPowerOf2(this._viewWidth),this._textureWidth>this._viewWidth?(this._renderToTextureRect.x=Math.floor(.5*(this._textureWidth-this._viewWidth)),this._renderToTextureRect.width=this._viewWidth):(this._renderToTextureRect.x=0,this._renderToTextureRect.width=this._textureWidth),this.dispatchEvent(new t.events.Event(t.events.Event.RESIZE)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(e){e!=this._viewHeight&&(this._viewHeight=e,this._buffersInvalid=!0,this._textureHeight=t.utils.TextureUtils.getBestPowerOf2(this._viewHeight),this._textureHeight>this._viewHeight?(this._renderToTextureRect.y=Math.floor(.5*(this._textureHeight-this._viewHeight)),this._renderToTextureRect.height=this._viewHeight):(this._renderToTextureRect.y=0,this._renderToTextureRect.height=this._textureHeight),this.dispatchEvent(new t.events.Event(t.events.Event.RESIZE)))
},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderToTextureVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderToScreenVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToScreenVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderToTextureRect",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureRect},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){i.deleteRTTBufferManager(this._stage),this._indexBuffer&&(this._indexBuffer.dispose(),this._renderToScreenVertexBuffer.dispose(),this._renderToTextureVertexBuffer.dispose(),this._renderToScreenVertexBuffer=null,this._renderToTextureVertexBuffer=null,this._indexBuffer=null)},i.prototype.updateRTTBuffers=function(){var t,e,i,n,r=this._stage.context;null==this._renderToTextureVertexBuffer&&(this._renderToTextureVertexBuffer=r.createVertexBuffer(4,5)),null==this._renderToScreenVertexBuffer&&(this._renderToScreenVertexBuffer=r.createVertexBuffer(4,5)),this._indexBuffer||(this._indexBuffer=r.createIndexBuffer(6),this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6)),this._textureRatioX=i=Math.min(this._viewWidth/this._textureWidth,1),this._textureRatioY=n=Math.min(this._viewHeight/this._textureHeight,1);var s=.5*(1-i),a=.5*(i+1),o=.5*(n+1),h=.5*(1-n);t=[-i,-n,s,o,0,i,-n,a,o,1,i,n,a,h,2,-i,n,s,h,3],e=[-1,-1,s,o,0,1,-1,a,o,1,1,1,a,h,2,-1,1,s,h,3],this._renderToTextureVertexBuffer.uploadFromArray(t,0,4),this._renderToScreenVertexBuffer.uploadFromArray(e,0,4),this._buffersInvalid=!1},i}(t.events.EventDispatcher);e.RTTBufferManager=i;var n=function(){function t(){}return t}()}(t.managers||(t.managers={})),t.managers}(away||(away={}));var SingletonEnforcer=function(){function t(){}return t}();away.Debug.THROW_ERRORS=!1,away.Debug.LOG_PI_ERRORS=!1;var away;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.events.EventDispatcher);t.StageGLContext=e}(away||(away={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e}(t.Error);t.AnimationSetError=e}(t.errors||(t.errors={})),t.errors}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r){t.call(this,e),this._animator=i,this._animationState=n,this._animationNode=r}return __extends(e,t),Object.defineProperty(e.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationState",{get:function(){return this._animationState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._animator,this._animationState,this._animationNode)},e.PLAYBACK_COMPLETE="playbackComplete",e.TRANSITION_COMPLETE="transitionComplete",e}(t.Event);t.AnimationStateEvent=e}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){t.call(this,e),this._animator=i}return __extends(e,t),Object.defineProperty(e.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._animator)},e.START="start",e.STOP="stop",e.CYCLE_COMPLETE="cycle_complete",e}(t.Event);t.AnimatorEvent=e}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.SHADER_INVALIDATED="ShaderInvalidated",e}(t.events.Event);e.ShadingMethodEvent=i}(t.events||(t.events={})),t.events}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.Geometry);t.ParticleGeometry=e}(t.base||(t.base={})),t.base}(away||(away={}));var away;!function(t){!function(e){var i=t.events.SubGeometryEvent,n=function(){function e(t,e,i,n,r){"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0);var s=this;this._geometryDirty=!0,this._indexDataDirty=!0,this._vertexData=new Object,this._pVertexDataDirty=new Object,this._vertexOffset=new Object,this._onIndicesUpdatedDelegate=function(t){return s._onIndicesUpdated(t)},this._onVerticesUpdatedDelegate=function(t){return s._onVerticesUpdated(t)},this._pool=t,this._level=n,this._indexOffset=r,this.sourceEntity=e,this.materialOwner=i}return Object.defineProperty(e.prototype,"overflow",{get:function(){return this._indexDataDirty&&this._updateIndexData(),this._overflow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTriangles",{get:function(){return this._numTriangles},enumerable:!0,configurable:!0}),e.prototype.getIndexData=function(){return this._indexDataDirty&&this._updateIndexData(),this._indexData},e.prototype.getVertexData=function(e){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[e]&&this._updateVertexData(e),this._vertexData[this._concatenateArrays?t.base.TriangleSubGeometry.VERTEX_DATA:e]},e.prototype.getVertexOffset=function(t){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[t]&&this._updateVertexData(t),this._vertexOffset[t]},e.prototype.dispose=function(){this._pool.disposeItem(this.materialOwner),this._indexData.dispose(),this._indexData=null;for(var t in this._vertexData)this._vertexData[t].dispose(),this._vertexData[t]=null;this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype.invalidateGeometry=function(){this._geometryDirty=!0,0==this._level&&(this._indexDataDirty=!0),this._overflow&&this._overflow.invalidateGeometry()},e.prototype.invalidateIndexData=function(){this._indexDataDirty=!0},e.prototype.invalidateVertexData=function(t){this._pVertexDataDirty[t]=!0},e.prototype._pGetSubGeometry=function(){throw new t.errors.AbstractMethodError},e.prototype._iFillIndexData=function(e){this._geometryDirty&&this._updateGeometry(),this._indexData=t.pool.IndexDataPool.getItem(this._subGeometry,this._level,e),this._numTriangles=this._indexData.data.length/3,e=this._indexData.offset,e<this._subGeometry.indices.length?(this._overflow||(this._overflow=this._pGetOverflowRenderable(this._pool,this.materialOwner,e,this._level+1)),this._overflow._iFillIndexData(e)):this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype._pGetOverflowRenderable=function(){throw new t.errors.AbstractMethodError},e.prototype._updateGeometry=function(){this._subGeometry&&(0==this._level&&this._subGeometry.removeEventListener(i.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.removeEventListener(i.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._subGeometry=this._pGetSubGeometry(),this._concatenateArrays=this._subGeometry.concatenateArrays,this._subGeometry&&(0==this._level&&this._subGeometry.addEventListener(i.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.addEventListener(i.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._geometryDirty=!1},e.prototype._updateIndexData=function(){this._iFillIndexData(this._indexOffset),this._indexDataDirty=!1},e.prototype._updateVertexData=function(e){this._vertexOffset[e]=this._subGeometry.getOffset(e),this._subGeometry.concatenateArrays&&(e=t.base.SubGeometryBase.VERTEX_DATA),this._vertexData[e]=t.pool.VertexDataPool.getItem(this._subGeometry,this.getIndexData(),e),this._pVertexDataDirty[e]=!1},e.prototype._onIndicesUpdated=function(){this.invalidateIndexData()},e.prototype._onVerticesUpdated=function(t){this._concatenateArrays=t.target.concatenateArrays,this.invalidateVertexData(t.dataType)},e}();e.RenderableBase=n}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=function(t){function e(e,i){t.call(this,e,i,i),this._billboard=i}return __extends(e,t),e.prototype._pGetSubGeometry=function(){var t=this._billboard.material,n=e._materialGeometry[t.id];return n?n.updatePositions(Array(0,t.height,0,t.width,t.height,0,t.width,0,0,0,0,0)):(n=e._materialGeometry[t.id]=new i(!0),n.autoDeriveNormals=!1,n.autoDeriveTangents=!1,n.updateIndices(Array(0,1,2,0,2,3)),n.updatePositions(Array(0,t.height,0,t.width,t.height,0,t.width,0,0,0,0,0)),n.updateVertexNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0)),n.updateVertexTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n.updateUVs(Array(0,0,1,0,1,1,0,1))),this._pVertexDataDirty[i.POSITION_DATA]=!0,this._pVertexDataDirty[i.NORMAL_DATA]=!0,this._pVertexDataDirty[i.TANGENT_DATA]=!0,this._pVertexDataDirty[i.UV_DATA]=!0,n},e._materialGeometry=new Object,e.id="billboard",e}(e.RenderableBase);e.BillboardRenderable=n}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.base.LineSubGeometry,n=function(t){function e(e,i,n,r){"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),t.call(this,e,i.parentMesh,i,n,r),this.subMesh=i}return __extends(e,t),e.prototype._pGetSubGeometry=function(){var t=this.subMesh.subGeometry;return this._pVertexDataDirty[i.START_POSITION_DATA]=!0,this._pVertexDataDirty[i.END_POSITION_DATA]=!0,t.thickness&&(this._pVertexDataDirty[i.THICKNESS_DATA]=!0),t.startColors&&(this._pVertexDataDirty[i.COLOR_DATA]=!0),t},e.prototype._pGetOverflowRenderable=function(t,i,n,r){return new e(t,i,n,r)},e.id="linesubmesh",e}(e.RenderableBase);e.LineSubMeshRenderable=n}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=function(t){function e(e,i){t.call(this,e,i,i)}return __extends(e,t),e.prototype._pGetSubGeometry=function(){var t=e._geometry;return t||(t=e._geometry=new i(!0),t.autoDeriveNormals=!1,t.autoDeriveTangents=!1,t.updateIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2)),t.updatePositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1))),this._pVertexDataDirty[i.POSITION_DATA]=!0,t},e.id="skybox",e}(e.RenderableBase);e.SkyboxRenderable=n}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=function(e){function n(t,i,n,r){"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),e.call(this,t,i.parentMesh,i,n,r),this.subMesh=i}return __extends(n,e),n.prototype._pGetSubGeometry=function(){var e;switch(e=this.subMesh.animator?this.subMesh.animator.getRenderableSubGeometry(this,this.subMesh.subGeometry):this.subMesh.subGeometry,this._pVertexDataDirty[i.POSITION_DATA]=!0,e.vertexNormals&&(this._pVertexDataDirty[i.NORMAL_DATA]=!0),e.vertexTangents&&(this._pVertexDataDirty[i.TANGENT_DATA]=!0),e.uvs&&(this._pVertexDataDirty[i.UV_DATA]=!0),e.secondaryUVs&&(this._pVertexDataDirty[i.SECONDARY_UV_DATA]=!0),e.jointIndices&&(this._pVertexDataDirty[i.JOINT_INDEX_DATA]=!0),e.jointWeights&&(this._pVertexDataDirty[i.JOINT_WEIGHT_DATA]=!0),e.jointsPerVertex){case 1:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=t.stagegl.ContextGLVertexBufferFormat.FLOAT_1;break;case 2:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=t.stagegl.ContextGLVertexBufferFormat.FLOAT_2;break;case 3:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=t.stagegl.ContextGLVertexBufferFormat.FLOAT_3;break;case 4:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=t.stagegl.ContextGLVertexBufferFormat.FLOAT_4}return e},n.prototype._pGetOverflowRenderable=function(t,e,i,r){return new n(t,e,i,r)},n.id="trianglesubmesh",n}(e.RenderableBase);e.TriangleSubMeshRenderable=n}(t.pool||(t.pool={})),t.pool}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(){this._billboardRenderablePool=t.pool.RenderablePool.getPool(t.pool.BillboardRenderable),this._subMeshRenderablePool=t.pool.RenderablePool.getPool(t.pool.TriangleSubMeshRenderable)}return e.prototype._pPetCollisionNormal=function(e,i,n){var r=new t.geom.Vector3D,s=3*e[n],a=3*e[n+1],o=3*e[n+2],h=new t.geom.Vector3D(i[s],i[s+1],i[s+2]),p=new t.geom.Vector3D(i[a],i[a+1],i[a+2]),u=new t.geom.Vector3D(i[o],i[o+1],i[o+2]),l=p.subtract(h),c=u.subtract(h);return r=l.crossProduct(c),r.normalize(),r},e.prototype._pGetCollisionUV=function(e,i,n,r,s,a,o,h){var p=new t.geom.Point,u=e[n]*h+o,l=new t.geom.Vector3D(i[u],i[u+1]);u=e[n+1]*h+o;var c=new t.geom.Vector3D(i[u],i[u+1]);u=e[n+2]*h+o;var d=new t.geom.Vector3D(i[u],i[u+1]);return p.x=a*l.x+r*c.x+s*d.x,p.y=a*l.y+r*c.y+s*d.y,p},e.prototype._pTestRenderableCollision=function(){throw new t.errors.AbstractMethodError},e.prototype.setLocalRay=function(t,e){this.rayPosition=t,this.rayDirection=e},e.prototype.testBillboardCollision=function(t,e,i){return this.setLocalRay(e.localRayPosition,e.localRayDirection),e.materialOwner=null,this._pTestRenderableCollision(this._billboardRenderablePool.getItem(t),e,i)?(i=e.rayEntryDistance,e.materialOwner=t,!0):!1},e.prototype.testMeshCollision=function(t,e,i,n){this.setLocalRay(e.localRayPosition,e.localRayDirection),e.materialOwner=null;for(var r,s=t.subMeshes.length,a=0;s>a;++a)if(r=t.subMeshes[a],this._pTestRenderableCollision(this._subMeshRenderablePool.getItem(r),e,i)&&(i=e.rayEntryDistance,e.materialOwner=r,!n))return!0;return null!=e.materialOwner},e}();e.PickingColliderBase=i}(t.pick||(t.pick={})),t.pick}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=function(e){function n(t){"undefined"==typeof t&&(t=!1),e.call(this),this._findClosestCollision=t}return __extends(n,e),n.prototype._pTestRenderableCollision=function(e,n,r){for(var s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w,D,C,S,P,A,T,M,E,O,R,I,N,L,F,V,U,B,j,z,k,G,H,X,W=e.getIndexData().data,Y=-1,Z=e.materialOwner.material.bothSides,q=e.getVertexData(i.POSITION_DATA).data,K=e.getVertexData(i.POSITION_DATA).dataPerVertex,J=e.getVertexOffset(i.POSITION_DATA),Q=e.getVertexData(i.UV_DATA).data,$=e.getVertexData(i.UV_DATA).dataPerVertex,te=e.getVertexOffset(i.UV_DATA),ee=W.length,ie=0;ee>ie;ie+=3)if(a=J+W[ie]*K,o=J+W[ie+1]*K,h=J+W[ie+2]*K,w=q[a],D=q[a+1],C=q[a+2],S=q[o],P=q[o+1],A=q[o+2],T=q[h],M=q[h+1],E=q[h+2],O=S-w,R=P-D,I=A-C,N=T-w,L=M-D,F=E-C,c=R*F-I*L,d=I*N-O*F,_=O*L-R*N,V=1/Math.sqrt(c*c+d*d+_*_),c*=V,d*=V,_*=V,U=c*this.rayDirection.x+d*+this.rayDirection.y+_*this.rayDirection.z,!Z&&0>U||Z&&0!=U){if(B=-(c*w+d*D+_*C),j=-(c*this.rayPosition.x+d*this.rayPosition.y+_*this.rayPosition.z+B),s=j/U,f=this.rayPosition.x+s*this.rayDirection.x,g=this.rayPosition.y+s*this.rayDirection.y,m=this.rayPosition.z+s*this.rayDirection.z,z=O*N+R*L+I*F,k=O*O+R*R+I*I,G=N*N+L*L+F*F,p=f-w,u=g-D,l=m-C,H=p*O+u*R+l*I,X=p*N+u*L+l*F,y=1/(k*G-z*z),x=y*(G*H-z*X),v=y*(-z*H+k*X),0>x)continue;if(0>v)continue;if(b=1-x-v,!(0>b)&&s>0&&r>s&&(r=s,Y=ie/3,n.rayEntryDistance=s,n.localPosition=new t.geom.Vector3D(f,g,m),n.localNormal=new t.geom.Vector3D(c,d,_),n.uv=this._pGetCollisionUV(W,Q,ie,x,v,b,te,$),n.index=ie,!this._findClosestCollision))return!0}return Y>=0?!0:!1},n}(e.PickingColliderBase);e.JSPickingCollider=n}(t.pick||(t.pick={})),t.pick}(away||(away={}));var away;!function(t){!function(e){var i=t.base.BitmapData,n=t.base.TriangleSubGeometry,r=t.geom.Matrix3DUtils,s=t.geom.Point,a=t.geom.Rectangle,o=t.geom.Vector3D,h=t.stagegl.ContextGLBlendFactor,p=t.stagegl.ContextGLClearMask,u=t.stagegl.ContextGLCompareMode,l=t.stagegl.ContextGLProgramType,c=t.stagegl.ContextGLTriangleFace,d=function(){function e(t){"undefined"==typeof t&&(t=!1),this._onlyMouseEnabled=!0,this._interactives=new Array,this._localHitPosition=new o,this._hitUV=new s,this._localHitNormal=new o,this._rayPos=new o,this._rayDir=new o,this._shaderPickingDetails=t,this._id=new Array(4),this._viewportData=new Array(4),this._boundOffsetScale=new Array(8),this._boundOffsetScale[3]=0,this._boundOffsetScale[7]=1}return Object.defineProperty(e.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},set:function(t){this._onlyMouseEnabled=t},enumerable:!0,configurable:!0}),e.prototype.getViewCollision=function(t,e,n){var r=n.iEntityCollector;if(this._stage=n.renderer.stage,!this._stage)return null;if(this._context=this._stage.context,this._viewportData[0]=n.width,this._viewportData[1]=n.height,this._viewportData[2]=-(this._projX=2*t/n.width-1),this._viewportData[3]=this._projY=2*e/n.height-1,this._potentialFound=!1,this._blendedRenderableHead=null,this._opaqueRenderableHead=null,this.pDraw(r,null),this._context.setVertexBufferAt(0,null),!this._context||!this._potentialFound)return null;if(this._bitmapData||(this._bitmapData=new i(1,1,!1,0)),this._context.drawToBitmapData(this._bitmapData),this._hitColor=this._bitmapData.getPixel(0,0),!this._hitColor)return this._context.present(),null;if(this._hitRenderable=this._interactives[this._hitColor-1],this._hitEntity=this._hitRenderable.sourceEntity,this._onlyMouseEnabled&&!this._hitEntity._iIsMouseEnabled())return null;var s=this._hitEntity._iPickingCollisionVO;return this._shaderPickingDetails?(this.getHitDetails(n.camera),s.localPosition=this._localHitPosition,s.localNormal=this._localHitNormal,s.uv=this._hitUV,s.index=this._faceIndex):(s.localPosition=null,s.localNormal=null,s.uv=null,s.index=0),s},e.prototype.getSceneCollision=function(){return null},e.prototype.pDraw=function(t){t.camera,this._context.clear(0,0,0,1),this._stage.scissorRect=e.MOUSE_SCISSOR_RECT,this._interactives.length=this._interactiveId=0,this._objectProgram||this.initObjectProgram(),this._context.setBlendFactors(h.ONE,h.ZERO),this._context.setDepthTest(!0,u.LESS),this._context.setProgram(this._objectProgram),this._context.setProgramConstantsFromArray(l.VERTEX,4,this._viewportData,1)},e.prototype.drawRenderables=function(t,e){for(var i=r.CALCULATION_MATRIX,s=e.viewProjection;t;)t.sourceEntity.scene&&t.sourceEntity._iIsMouseEnabled()?(this._potentialFound=!0,this._context.setCulling(t.materialOwner.material.bothSides?c.NONE:c.BACK,e.projection.coordinateSystem),this._interactives[this._interactiveId++]=t,this._id[1]=(this._interactiveId>>8)/255,this._id[2]=(255&this._interactiveId)/255,i.copyFrom(t.sourceEntity.getRenderSceneTransform(e)),i.append(s),this._context.setProgramConstantsFromMatrix(l.VERTEX,0,i,!0),this._context.setProgramConstantsFromArray(l.FRAGMENT,0,this._id,1),this._context.activateBuffer(0,t.getVertexData(n.POSITION_DATA),t.getVertexOffset(n.POSITION_DATA),n.POSITION_FORMAT),this._context.drawTriangles(this._context.getIndexBuffer(t.getIndexData()),0,t.numTriangles),t=t.next):t=t.next},e.prototype.updateRay=function(t){this._rayPos=t.scenePosition,this._rayDir=t.getRay(this._projX,this._projY,1),this._rayDir.normalize()},e.prototype.initObjectProgram=function(){var e,i;this._objectProgram=this._context.createProgram(),e="m44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",i="mov oc, fc0",t.Debug.throwPIR("ShaderPicker","initTriangleProgram","Dependency: initObjectProgram")},e.prototype.initTriangleProgram=function(){var t,e;this._triangleProgram=this._context.createProgram(),t="add vt0, va0, vc5 			\nmul vt0, vt0, vc6 			\nmov v0, vt0				\nm44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",e="mov oc, v0";var i=(new aglsl.assembler.AGALMiniAssembler).assemble("part vertex 1\n"+t+"endpart").vertex.data,n=(new aglsl.assembler.AGALMiniAssembler).assemble("part fragment 1\n"+e+"endpart").fragment.data;this._triangleProgram.upload(i,n)},e.prototype.getHitDetails=function(t){this.getApproximatePosition(t),this.getPreciseDetails(t)},e.prototype.getApproximatePosition=function(t){var i,s,a,o,h,u,c,d=this._hitRenderable.sourceEntity.bounds.aabb,_=r.CALCULATION_MATRIX;_.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(t)),_.append(t.viewProjection),this._triangleProgram||this.initTriangleProgram(),this._boundOffsetScale[4]=1/(s=d.width),this._boundOffsetScale[5]=1/(a=d.height),this._boundOffsetScale[6]=1/(o=d.depth),this._boundOffsetScale[0]=h=-d.x,this._boundOffsetScale[1]=u=-d.y,this._boundOffsetScale[2]=c=-d.z,this._context.setProgram(this._triangleProgram),this._context.clear(0,0,0,0,1,0,p.DEPTH),this._context.setScissorRectangle(e.MOUSE_SCISSOR_RECT),this._context.setProgramConstantsFromMatrix(l.VERTEX,0,_,!0),this._context.setProgramConstantsFromArray(l.VERTEX,5,this._boundOffsetScale,2),this._context.activateBuffer(0,this._hitRenderable.getVertexData(n.POSITION_DATA),this._hitRenderable.getVertexOffset(n.POSITION_DATA),n.POSITION_FORMAT),this._context.drawTriangles(this._context.getIndexBuffer(this._hitRenderable.getIndexData()),0,this._hitRenderable.numTriangles),this._context.drawToBitmapData(this._bitmapData),i=this._bitmapData.getPixel(0,0),this._localHitPosition.x=(255&i>>16)*s/255-h,this._localHitPosition.y=(255&i>>8)*a/255-u,this._localHitPosition.z=(255&i)*o/255-c},e.prototype.getPreciseDetails=function(t){var e,i,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w,D,C,S,P,A,T,M,E,O,R,I,N,L,F,V,U,B,j,z,k,G,H,X,W,Y,Z,q,K=ne.length,J=0,Q=1,$=2,te=this._localHitPosition.x,ee=this._localHitPosition.y,ie=this._localHitPosition.z,ne=this._hitRenderable.getIndexData().data,re=this._hitRenderable.getVertexData(n.POSITION_DATA).data,se=this._hitRenderable.getVertexData(n.POSITION_DATA).dataPerVertex,ae=this._hitRenderable.getVertexOffset(n.POSITION_DATA),oe=this._hitRenderable.getVertexData(n.UV_DATA).data,he=this._hitRenderable.getVertexData(n.UV_DATA).dataPerVertex,pe=this._hitRenderable.getVertexOffset(n.UV_DATA);this._hitRenderable.getVertexData(n.NORMAL_DATA).data;var ue=this._hitRenderable.getVertexData(n.NORMAL_DATA).dataPerVertex,le=this._hitRenderable.getVertexOffset(n.NORMAL_DATA);for(this.updateRay(t);K>J;){if(l=ae+ne[J]*se,c=ae+ne[Q]*se,d=ae+ne[$]*se,e=re[l],i=re[l+1],r=re[l+2],s=re[c],a=re[c+1],o=re[c+2],h=re[d],p=re[d+1],u=re[d+2],!(e>te&&s>te&&h>te||i>ee&&a>ee&&p>ee||r>ie&&o>ie&&u>ie||te>e&&te>s&&te>h||ee>i&&ee>a&&ee>p||ie>r&&ie>o&&ie>u)&&(_=h-e,f=p-i,g=u-r,m=s-e,y=a-i,b=o-r,x=te-e,v=ee-i,w=ie-r,E=_*_+f*f+g*g,O=_*m+f*y+g*b,R=_*x+f*v+g*w,I=m*m+y*y+b*b,N=m*x+y*v+b*w,V=1/(E*I-O*O),L=(I*R-O*N)*V,F=(E*N-O*R)*V,L>=0&&F>=0&&1>=L+F))return D=le+ne[J]*ue,C=le+ne[Q]*ue,S=le+ne[$]*ue,P=ne[D]+ne[C]+ne[S],A=ne[D+1]+ne[C+1]+ne[S+1],T=ne[D+2]+ne[C+2]+ne[S+2],M=Math.sqrt(P*P+A*A+T*T),P/=M,A/=M,T/=M,this.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform,P,A,T,e,i,r),x=this._localHitPosition.x-e,v=this._localHitPosition.y-i,w=this._localHitPosition.z-r,G=s-e,H=a-i,X=o-r,W=h-e,Y=p-i,Z=u-r,this._localHitNormal.x=H*Z-X*Y,this._localHitNormal.y=X*W-G*Z,this._localHitNormal.z=G*Y-H*W,q=1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x+this._localHitNormal.y*this._localHitNormal.y+this._localHitNormal.z*this._localHitNormal.z),this._localHitNormal.x*=q,this._localHitNormal.y*=q,this._localHitNormal.z*=q,R=_*x+f*v+g*w,N=m*x+y*v+b*w,L=(I*R-O*N)*V,F=(E*N-O*R)*V,j=pe+ne[J]*he,z=pe+ne[Q]*he,k=pe+ne[$]*he,U=oe[j],B=oe[j+1],this._hitUV.x=U+F*(oe[z]-U)+L*(oe[k]-U),this._hitUV.y=B+F*(oe[z+1]-B)+L*(oe[k+1]-B),void(this._faceIndex=J);J+=3,Q+=3,$+=3}},e.prototype.getPrecisePosition=function(t,e,i,n,s,a,o){var h,p,u,l,c,d,_,f=r.RAW_DATA_CONTAINER,g=this._rayPos.x,m=this._rayPos.y,y=this._rayPos.z;l=this._rayDir.x,c=this._rayDir.y,d=this._rayDir.z,t.copyRawDataTo(f),h=f[0]*l+f[4]*c+f[8]*d,p=f[1]*l+f[5]*c+f[9]*d,u=f[2]*l+f[6]*c+f[10]*d,l=f[0]*g+f[4]*m+f[8]*y+f[12],c=f[1]*g+f[5]*m+f[9]*y+f[13],d=f[2]*g+f[6]*m+f[10]*y+f[14],_=((s-l)*e+(a-c)*i+(o-d)*n)/(h*e+p*i+u*n),this._localHitPosition.x=l+h*_,this._localHitPosition.y=c+p*_,this._localHitPosition.z=d+u*_},e.prototype.dispose=function(){this._bitmapData.dispose(),this._triangleProgram&&this._triangleProgram.dispose(),this._objectProgram&&this._objectProgram.dispose(),this._triangleProgram=null,this._objectProgram=null,this._bitmapData=null,this._hitRenderable=null,this._hitEntity=null},e.MOUSE_SCISSOR_RECT=new a(0,0,1,1),e}();e.ShaderPicker=d}(t.pick||(t.pick={})),t.pick}(away||(away={}));var away;!function(t){!function(e){var i=function(){function i(){}return i.getDefaultMaterial=function(e){return"undefined"==typeof e&&(e=null),null!=e&&e.assetType==t.library.AssetType.LINE_SUB_MESH?(i._defaultLineMaterial||i.createDefaultLineMaterial(),i._defaultLineMaterial):(i._defaultTriangleMaterial||i.createDefaultTriangleMaterial(),i._defaultTriangleMaterial)},i.getDefaultTexture=function(t){return"undefined"==typeof t&&(t=null),i._defaultTexture||i.createDefaultTexture(),i._defaultTexture},i.createDefaultTexture=function(){i._defaultBitmapData=i.createCheckeredBitmapData(),i._defaultTexture=new t.textures.BitmapTexture(i._defaultBitmapData,!0),i._defaultTexture.name="defaultTexture"},i.createCheckeredBitmapData=function(){var e,i,n=new t.base.BitmapData(8,8,!1,0);for(e=0;8>e;e++)for(i=0;8>i;i++)1&i^1&e&&n.setPixel(e,i,16777215);return n},i.createDefaultTriangleMaterial=function(){i._defaultTexture||i.createDefaultTexture(),i._defaultTriangleMaterial=new e.TriangleMaterial(i._defaultTexture),i._defaultTriangleMaterial.mipmap=!1,i._defaultTriangleMaterial.smooth=!1,i._defaultTriangleMaterial.name="defaultTriangleMaterial"},i.createDefaultLineMaterial=function(){i._defaultLineMaterial=new e.LineMaterial,i._defaultLineMaterial.name="defaultSegmentMaterial"},i}();e.DefaultMaterialManager=i}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.events.RendererEvent,n=t.events.StageEvent,r=t.geom.Matrix3D,s=t.geom.Point,a=t.geom.Rectangle,o=t.materials.DefaultMaterialManager,h=t.pool.BillboardRenderable,p=t.pool.LineSubMeshRenderable,u=t.pool.RenderablePool,l=t.pool.TriangleSubMeshRenderable,c=t.sort.RenderableMergeSort,d=t.stagegl.ContextGLCompareMode,_=t.traverse.EntityCollector,f=function(e){function f(){var t=this;e.call(this),this._viewPort=new a,this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this._depthPrepass=!1,this._backgroundR=0,this._backgroundG=0,this._backgroundB=0,this._backgroundAlpha=1,this._shareContext=!1,this.textureRatioX=1,this.textureRatioY=1,this._pRttViewProjectionMatrix=new r,this._localPos=new s,this._globalPos=new s,this._pScissorRect=new a,this._pNumTriangles=0,this._onViewportUpdatedDelegate=function(e){return t.onViewportUpdated(e)},this._billboardRenderablePool=u.getPool(h),this._triangleSubMeshRenderablePool=u.getPool(l),this._lineSubMeshRenderablePool=u.getPool(p),this._onContextUpdateDelegate=function(e){return t.onContextUpdate(e)},this.renderableSorter=new c}return __extends(f,e),Object.defineProperty(f.prototype,"numTriangles",{get:function(){return this._pNumTriangles},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"scissorRect",{get:function(){return this._pScissorRect},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"x",{get:function(){return this._localPos.x},set:function(t){this.x!=t&&(this._globalPos.x=this._localPos.x=t,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"y",{get:function(){return this._localPos.y},set:function(t){this.y!=t&&(this._globalPos.y=this._localPos.y=t,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"width",{get:function(){return this._width},set:function(t){this._width!=t&&(this._width=t,this._pScissorRect.width=t,this._pRttBufferManager&&(this._pRttBufferManager.viewWidth=t),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"height",{get:function(){return this._height},set:function(t){this._height!=t&&(this._height=t,this._pScissorRect.height=t,this._pRttBufferManager&&(this._pRttBufferManager.viewHeight=t),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),f.prototype._iCreateEntityCollector=function(){return new _},Object.defineProperty(f.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(t){this._backgroundR!=t&&(this._backgroundR=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(t){this._backgroundG!=t&&(this._backgroundG=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(t){this._backgroundB!=t&&(this._backgroundB=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"stage",{get:function(){return this._pStage},set:function(t){t!=this._pStage&&this.iSetStage(t)},enumerable:!0,configurable:!0}),f.prototype.iSetStage=function(t){this._pStage&&(this._pStage.removeEventListener(n.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(n.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(n.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate)),t?(this._pStage=t,this._pStage.addEventListener(n.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(n.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(n.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage.context&&(this._pContext=this._pStage.context)):(this._pStage=null,this._pContext=null),this._pBackBufferInvalid=!0,this.updateGlobalPos()},Object.defineProperty(f.prototype,"shareContext",{get:function(){return this._shareContext},set:function(t){this._shareContext!=t&&(this._shareContext=t,this.updateGlobalPos())},enumerable:!0,configurable:!0}),f.prototype.dispose=function(){this._pRttBufferManager&&this._pRttBufferManager.dispose(),this._pRttBufferManager=null,this._pStage.removeEventListener(n.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(n.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(n.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage=null},f.prototype.render=function(){this._viewportDirty=!1,this._scissorDirty=!1},f.prototype._iRender=function(t,e,i,n){if("undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=0),this._pStage&&this._pContext&&t.entityHead){this._pRttViewProjectionMatrix.copyFrom(t.camera.viewProjection),this._pRttViewProjectionMatrix.appendScale(this.textureRatioX,this.textureRatioY,1),this.pExecuteRender(t,e,i,n);for(var r=0;8>r;++r)this._pContext.setVertexBufferAt(r,null),this._pContext.setTextureAt(r,null)}},f.prototype._iRenderCascades=function(){},f.prototype.pCollectRenderables=function(t){this._pBlendedRenderableHead=null,this._pOpaqueRenderableHead=null,this._pNumTriangles=0;var e=t.entityHead;for(this._pCamera=t.camera,this._iEntryPoint=this._pCamera.scenePosition,this._pCameraForward=this._pCamera.transform.forwardVector;e;)e.entity._iCollectRenderables(this),e=e.next;this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead),this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)},f.prototype.pExecuteRender=function(t,e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=0),this._pContext.setRenderTarget(e,!0,n),!e&&this._shareContext||this._depthPrepass||this._pContext.clear(this._backgroundR,this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0),this._pContext.setDepthTest(!1,d.ALWAYS),this._pStage.scissorRect=i,this.pDraw(t,e),this._shareContext||this._snapshotRequired&&this._snapshotBitmapData&&(this._pContext.drawToBitmapData(this._snapshotBitmapData),this._snapshotRequired=!1),this._pStage.scissorRect=null},f.prototype.queueSnapshot=function(t){this._snapshotRequired=!0,this._snapshotBitmapData=t},f.prototype.pDraw=function(){throw new t.errors.AbstractMethodError},f.prototype.onContextUpdate=function(){this._pContext=this._pStage.context},Object.defineProperty(f.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(t){this._backgroundAlpha!=t&&(this._backgroundAlpha=t,this._pBackBufferInvalid=!0)
},enumerable:!0,configurable:!0}),f.prototype.notifyScissorUpdate=function(){this._scissorDirty||(this._scissorDirty=!0,this._scissorUpdated||(this._scissorUpdated=new i(i.SCISSOR_UPDATED)),this.dispatchEvent(this._scissorUpdated))},f.prototype.notifyViewportUpdate=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewPortUpdated||(this._viewPortUpdated=new i(i.VIEWPORT_UPDATED)),this.dispatchEvent(this._viewPortUpdated))},f.prototype.onViewportUpdated=function(){this._viewPort=this._pStage.viewPort,this._shareContext&&(this._pScissorRect.x=this._globalPos.x-this._pStage.x,this._pScissorRect.y=this._globalPos.y-this._pStage.y,this.notifyScissorUpdate()),this.notifyViewportUpdate()},f.prototype.updateGlobalPos=function(){this._shareContext?(this._pScissorRect.x=this._globalPos.x-this._viewPort.x,this._pScissorRect.y=this._globalPos.y-this._viewPort.y):(this._pScissorRect.x=0,this._pScissorRect.y=0,this._viewPort.x=this._globalPos.x,this._viewPort.y=this._globalPos.y),this.notifyScissorUpdate()},f.prototype.applyBillboard=function(t){this._applyRenderable(this._billboardRenderablePool.getItem(t))},f.prototype.applyTriangleSubMesh=function(t){this._applyRenderable(this._triangleSubMeshRenderablePool.getItem(t))},f.prototype.applyLineSubMesh=function(t){this._applyRenderable(this._lineSubMeshRenderablePool.getItem(t))},f.prototype._applyRenderable=function(t){var e=t.materialOwner.material,i=t.sourceEntity,n=i.scenePosition;e||(e=o.getDefaultMaterial(t.materialOwner)),e.iUpdateMaterial(),t.material=e,t.materialId=e._iMaterialId,t.renderOrderId=e._iRenderOrderId,t.cascaded=!1,n=this._iEntryPoint.subtract(n),t.zIndex=i.zOffset+n.dotProduct(this._pCameraForward),t.renderSceneTransform=t.sourceEntity.getRenderSceneTransform(this._pCamera),e.requiresBlending?(t.next=this._pBlendedRenderableHead,this._pBlendedRenderableHead=t):(t.next=this._pOpaqueRenderableHead,this._pOpaqueRenderableHead=t),this._pNumTriangles+=t.numTriangles,t.overflow&&this._applyRenderable(t.overflow)},f}(t.events.EventDispatcher);e.RendererBase=f}(t.render||(t.render={})),t.render}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLBlendFactor,n=t.stagegl.ContextGLCompareMode,r=function(t){function e(e,i){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=!1),t.call(this),this._renderBlended=e,this._distanceBased=i,this._iBackgroundR=1,this._iBackgroundG=1,this._iBackgroundB=1}return __extends(e,t),Object.defineProperty(e.prototype,"disableColor",{get:function(){return this._disableColor},set:function(t){this._disableColor=t},enumerable:!0,configurable:!0}),e.prototype._iRenderCascades=function(t,e,r,s,a){this.pCollectRenderables(t),this._pContext.setRenderTarget(e,!0,0),this._pContext.clear(1,1,1,1,1,0),this._pContext.setBlendFactors(i.ONE,i.ZERO),this._pContext.setDepthTest(!0,n.LESS);for(var o=this._pOpaqueRenderableHead,h=!0,p=r-1;p>=0;--p)this._pStage.scissorRect=s[p],this.drawCascadeRenderables(o,a[p],h?null:a[p].frustumPlanes),h=!1;this._activeMaterial&&this._activeMaterial.iDeactivateForDepth(this._pStage),this._activeMaterial=null,this._pContext.setDepthTest(!1,n.LESS_EQUAL),this._pStage.scissorRect=null},e.prototype.drawCascadeRenderables=function(t,e,i){for(var n;t;)if(t.cascaded)t=t.next;else{var r=t.sourceEntity;!i||r.worldBounds.isInFrustum(i,4)?(n=t.materialOwner.material,this._activeMaterial!=n&&(this._activeMaterial&&this._activeMaterial.iDeactivateForDepth(this._pStage),this._activeMaterial=n,this._activeMaterial.iActivateForDepth(this._pStage,e,!1)),this._activeMaterial.iRenderDepth(t,this._pStage,e,e.viewProjection)):t.cascaded=!0,t=t.next}},e.prototype.pDraw=function(t){this.pCollectRenderables(t),this._pContext.setBlendFactors(i.ONE,i.ZERO),this._pContext.setDepthTest(!0,n.LESS),this.drawRenderables(this._pOpaqueRenderableHead,t),this._disableColor&&this._pContext.setColorMask(!1,!1,!1,!1),this._renderBlended&&this.drawRenderables(this._pBlendedRenderableHead,t),this._activeMaterial&&this._activeMaterial.iDeactivateForDepth(this._pStage),this._disableColor&&this._pContext.setColorMask(!0,!0,!0,!0),this._activeMaterial=null},e.prototype.drawRenderables=function(t,e){for(var i,n=e.camera;t;){if(this._activeMaterial=t.materialOwner.material,this._disableColor&&this._activeMaterial.iHasDepthAlphaThreshold()){i=t;do i=i.next;while(i&&i.materialOwner.material==this._activeMaterial)}else{this._activeMaterial.iActivateForDepth(this._pStage,n,this._distanceBased),i=t;do this._activeMaterial.iRenderDepth(i,this._pStage,n,this._pRttViewProjectionMatrix),i=i.next;while(i&&i.materialOwner.material==this._activeMaterial);this._activeMaterial.iDeactivateForDepth(this._pStage)}t=i}},e}(e.RendererBase);e.DepthRenderer=r}(t.render||(t.render={})),t.render}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Matrix3D,n=t.geom.Vector3D,r=t.managers.RTTBufferManager,s=t.managers.StageManager,a=t.pool.RenderablePool,o=t.pool.SkyboxRenderable,h=t.stagegl.ContextGLBlendFactor,p=t.stagegl.ContextGLCompareMode,u=t.stagegl.ContextGLClearMask,l=t.textures.RenderTexture,c=function(t){function c(n,h,p){"undefined"==typeof n&&(n=!1),"undefined"==typeof h&&(h="baseline"),"undefined"==typeof p&&(p="auto"),t.call(this),this._skyboxProjection=new i,this._skyboxRenderablePool=a.getPool(o),this._pDepthRenderer=new e.DepthRenderer,this._pDistanceRenderer=new e.DepthRenderer(!1,!0),null==this._pStage&&(this.stage=s.getInstance().getFreeStage(n,h,p)),this._pRttBufferManager=r.getInstance(this._pStage),0==this._width?this.width=window.innerWidth:this._pRttBufferManager.viewWidth=this._width,0==this._height?this.height=window.innerHeight:this._pRttBufferManager.viewHeight=this._height}return __extends(c,t),Object.defineProperty(c.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(t){this._antiAlias!=t&&(this._antiAlias=t,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(t){this._depthPrepass=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(t){t&&0==t.length&&(t=null),this._pFilter3DRenderer&&!t?(this._pFilter3DRenderer.dispose(),this._pFilter3DRenderer=null):!this._pFilter3DRenderer&&t&&(this._pFilter3DRenderer=new e.Filter3DRenderer(this._pStage),this._pFilter3DRenderer.filters=t),this._pFilter3DRenderer?(this._pFilter3DRenderer.filters=t,this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender):(this._pRequireDepthRender=!1,this._pDepthRender&&(this._pDepthRender.dispose(),this._pDepthRender=null))},enumerable:!0,configurable:!0}),c.prototype.render=function(e){return t.prototype.render.call(this,e),this._pStage.recoverFromDisposal()?(this._pBackBufferInvalid&&this.pUpdateBackBuffer(),this._shareContext&&this._pContext&&this._pContext.clear(0,0,0,1,1,0,u.DEPTH),this._pFilter3DRenderer?(this.textureRatioX=this._pRttBufferManager.textureRatioX,this.textureRatioY=this._pRttBufferManager.textureRatioY):(this.textureRatioX=1,this.textureRatioY=1),this._pRequireDepthRender&&this.pRenderSceneDepthToTexture(e),this._depthPrepass&&this.pRenderDepthPrepass(e),this._pFilter3DRenderer&&this._pContext||(this._shareContext?this._iRender(e,null,this._pScissorRect):this._iRender(e)),t.prototype.render.call(this,e),!this._shareContext&&this._pContext&&this._pContext.present(),void(this._pStage.bufferClear=!1)):void(this._pBackBufferInvalid=!0)},c.prototype.pExecuteRender=function(e,i,n,r){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=0),this.updateLights(e),i&&(this.pCollectRenderables(e),this.drawRenderables(this._pOpaqueRenderableHead,e,c.RTT_PASSES),this.drawRenderables(this._pBlendedRenderableHead,e,c.RTT_PASSES)),t.prototype.pExecuteRender.call(this,e,i,n,r)},c.prototype.updateLights=function(t){var e,i,n,r,s=t.directionalLights,a=t.pointLights;for(e=s.length,i=0;e>i;++i)n=s[i],r=n.shadowMapper,n.castsShadows&&(r.autoUpdateShadows||r._iShadowsInvalid)&&r.iRenderDepthMap(this._pStage,t,this._pDepthRenderer);for(e=a.length,i=0;e>i;++i)n=a[i],r=n.shadowMapper,n.castsShadows&&(r.autoUpdateShadows||r._iShadowsInvalid)&&r.iRenderDepthMap(this._pStage,t,this._pDistanceRenderer)},c.prototype.pDraw=function(t,e){e||this.pCollectRenderables(t),this._pContext.setBlendFactors(h.ONE,h.ZERO),t.skyBox&&(this._activeMaterial&&this._activeMaterial.iDeactivate(this._pStage),this._activeMaterial=null,this._pContext.setDepthTest(!1,p.ALWAYS),this.drawSkybox(t)),this._pContext.setDepthTest(!0,p.LESS_EQUAL);var i=e?c.SCREEN_PASSES:c.ALL_PASSES;this.drawRenderables(this._pOpaqueRenderableHead,t,i),this.drawRenderables(this._pBlendedRenderableHead,t,i),this._pContext.setDepthTest(!1,p.LESS_EQUAL),this._activeMaterial&&this._activeMaterial.iDeactivate(this._pStage),this._activeMaterial=null},c.prototype.drawSkybox=function(t){var e=this._skyboxRenderablePool.getItem(t.skyBox),i=t.skyBox.material,n=t.camera;this.updateSkyboxProjection(n),i.iActivatePass(0,this._pStage,n),i.iRenderPass(0,e,this._pStage,t,this._skyboxProjection),i.iDeactivatePass(0,this._pStage)},c.prototype.updateSkyboxProjection=function(t){var e=new n;this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix),this._skyboxProjection.copyRowTo(2,e);var i=t.scenePosition,r=e.x,s=e.y,a=e.z,o=-(e.x*i.x+e.y*i.y+e.z*i.z+Math.sqrt(r*r+s*s+a*a)),h=r>=0?1:-1,p=s>=0?1:-1,u=new n(h,p,1,1),l=this._skyboxProjection.clone();l.invert();var c=l.transformVector(u);this._skyboxProjection.copyRowTo(3,u);var d=(c.x*u.x+c.y*u.y+c.z*u.z+c.w*u.w)/(r*c.x+s*c.y+a*c.z+o*c.w);this._skyboxProjection.copyRowFrom(2,new n(r*d,s*d,a*d,o*d))},c.prototype.drawRenderables=function(t,e,i){for(var n,r,s,a=e.camera;t;){this._activeMaterial=t.material,n=this._activeMaterial._iNumPasses,r=this._activeMaterial._iBaseScreenPassIndex;do{s=t;var o=this._activeMaterial.iPassRendersToTexture(r)?1:2;if(0!=(o&i)){this._activeMaterial.iActivatePass(r,this._pStage,a);do this._activeMaterial.iRenderPass(r,s,this._pStage,e,this._pRttViewProjectionMatrix),s=s.next;while(s&&s.material==this._activeMaterial);this._activeMaterial.iDeactivatePass(r,this._pStage)}else do s=s.next;while(s&&s.material==this._activeMaterial)}while(++r<n);t=s}},c.prototype.dispose=function(){this._shareContext||this._pStage.dispose(),this._pDepthRenderer.dispose(),this._pDistanceRenderer.dispose(),this._pDepthRenderer=null,this._pDistanceRenderer=null,this._pDepthRender=null,t.prototype.dispose.call(this)},c.prototype.pRenderDepthPrepass=function(t){this._pDepthRenderer.disableColor=!0,this._pFilter3DRenderer||(this._pDepthRenderer.textureRatioX=1,this._pDepthRenderer.textureRatioY=1,this._pDepthRenderer._iRender(t)),this._pDepthRenderer.disableColor=!1},c.prototype.pRenderSceneDepthToTexture=function(t){(this._pDepthTextureInvalid||!this._pDepthRender)&&this.initDepthTexture(this._pStage.context),this._pDepthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX,this._pDepthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY,this._pDepthRenderer._iRender(t,this._pDepthRender)},c.prototype.pUpdateBackBuffer=function(){this._pStage.context&&!this._shareContext&&this._width&&this._height&&(this._pStage.configureBackBuffer(this._width,this._height,this._antiAlias,!0),this._pBackBufferInvalid=!1)},c.prototype.iSetStage=function(e){t.prototype.iSetStage.call(this,e),this._pDistanceRenderer.iSetStage(e),this._pDepthRenderer.iSetStage(e)},c.prototype.initDepthTexture=function(){this._pDepthTextureInvalid=!1,this._pDepthRender&&this._pDepthRender.dispose(),this._pDepthRender=new l(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight)},c.RTT_PASSES=1,c.SCREEN_PASSES=2,c.ALL_PASSES=3,c}(e.RendererBase);e.DefaultRenderer=c}(t.render||(t.render={})),t.render}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(e){this._filterSizesInvalid=!0,this._onRTTResizeDelegate=t.utils.Delegate.create(this,this.onRTTResize),this._stage=e,this._rttManager=t.managers.RTTBufferManager.getInstance(e),this._rttManager.addEventListener(t.events.Event.RESIZE,this._onRTTResizeDelegate)}return e.prototype.onRTTResize=function(){this._filterSizesInvalid=!0},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(t){return this._filterTasksInvalid&&this.updateFilterTasks(t),this._mainInputTexture},Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(t){if(this._filters=t,this._filterTasksInvalid=!0,this._requireDepthRender=!1,this._filters){for(var e=0;e<this._filters.length;++e){var i=this._filters[e],n=null==i.requireDepthRender?!1:i.requireDepthRender;this._requireDepthRender=this._requireDepthRender||n}this._filterSizesInvalid=!0}},enumerable:!0,configurable:!0}),e.prototype.updateFilterTasks=function(t){var e;if(this._filterSizesInvalid&&this.updateFilterSizes(),!this._filters)return void(this._tasks=null);this._tasks=new Array,e=this._filters.length-1;for(var i,n=0;e>=n;++n)i=this._filters[n],i.setRenderTargets(n==e?null:this._filters[n+1].getMainInputTexture(t),t),this._tasks=this._tasks.concat(i.tasks);this._mainInputTexture=this._filters[0].getMainInputTexture(t)},e.prototype.render=function(e,i,n){var r,s,a,o=e.context,h=this._rttManager.indexBuffer,p=this._rttManager.renderToTextureVertexBuffer;if(this._filters){for(this._filterSizesInvalid&&this.updateFilterSizes(),this._filterTasksInvalid&&this.updateFilterTasks(e),r=this._filters.length,s=0;r>s;++s)this._filters[s].update(e,i);for(r=this._tasks.length,r>1&&(o.setVertexBufferAt(0,p,0,t.stagegl.ContextGLVertexBufferFormat.FLOAT_2),o.setVertexBufferAt(1,p,2,t.stagegl.ContextGLVertexBufferFormat.FLOAT_2)),s=0;r>s;++s)a=this._tasks[s],a.target||(e.scissorRect=null,p=this._rttManager.renderToScreenVertexBuffer,o.setVertexBufferAt(0,p,0,t.stagegl.ContextGLVertexBufferFormat.FLOAT_2),o.setVertexBufferAt(1,p,2,t.stagegl.ContextGLVertexBufferFormat.FLOAT_2)),o.setTextureAt(0,a.getMainInputTexture(e)),o.setProgram(a.getProgram(e)),o.clear(0,0,0,0),a.activate(e,i,n),o.setBlendFactors(t.stagegl.ContextGLBlendFactor.ONE,t.stagegl.ContextGLBlendFactor.ZERO),o.drawTriangles(h,0,2),a.deactivate(e);o.setTextureAt(0,null),o.setVertexBufferAt(0,null),o.setVertexBufferAt(1,null)}},e.prototype.updateFilterSizes=function(){for(var t=0;t<this._filters.length;++t)this._filters[t].textureWidth=this._rttManager.textureWidth,this._filters[t].textureHeight=this._rttManager.textureHeight;this._filterSizesInvalid=!0},e.prototype.dispose=function(){this._rttManager.removeEventListener(t.events.Event.RESIZE,this._onRTTResizeDelegate),this._rttManager=null,this._stage=null},e}();e.Filter3DRenderer=i}(t.render||(t.render={})),t.render}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(t){"undefined"==typeof t&&(t=!1),this._scaledTextureWidth=-1,this._scaledTextureHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._textureDimensionsInvalid=!0,this._program3DInvalid=!0,this._textureScale=0,this._requireDepthRender=t}return Object.defineProperty(e.prototype,"textureScale",{get:function(){return this._textureScale},set:function(t){this._textureScale!=t&&(this._textureScale=t,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(t){this._textureWidth!=t&&(this._textureWidth=t,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(t){this._textureHeight!=t&&(this._textureHeight=t,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(t){return this._textureDimensionsInvalid&&this.pUpdateTextures(t),this._mainInputTexture},e.prototype.dispose=function(){this._mainInputTexture&&this._mainInputTexture.dispose(),this._program3D&&this._program3D.dispose()},e.prototype.pInvalidateProgram=function(){this._program3DInvalid=!0},e.prototype.pUpdateProgram=function(t){this._program3D&&this._program3D.dispose(),this._program3D=t.context.createProgram();var e=(new aglsl.assembler.AGALMiniAssembler).assemble("part vertex 1\n"+this.pGetVertexCode()+"endpart").vertex.data,i=(new aglsl.assembler.AGALMiniAssembler).assemble("part fragment 1\n"+this.pGetFragmentCode()+"endpart").fragment.data;this._program3D.upload(e,i),this._program3DInvalid=!1},e.prototype.pGetVertexCode=function(){return"mov op, va0\nmov v0, va1\n"},e.prototype.pGetFragmentCode=function(){throw new t.errors.AbstractMethodError},e.prototype.pUpdateTextures=function(e){this._mainInputTexture&&this._mainInputTexture.dispose(),this._mainInputTexture=e.context.createTexture(this._scaledTextureWidth,this._scaledTextureHeight,t.stagegl.ContextGLTextureFormat.BGRA,!0),this._textureDimensionsInvalid=!1},e.prototype.getProgram=function(t){return this._program3DInvalid&&this.pUpdateProgram(t),this._program3D},e.prototype.activate=function(){},e.prototype.deactivate=function(){},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e}();e.Filter3DTaskBase=i}(t.filters||(t.filters={})),t.filters}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){this._tasks=new Array}return Object.defineProperty(t.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),t.prototype.pAddTask=function(t){this._tasks.push(t),null==this._requireDepthRender&&(this._requireDepthRender=t.requireDepthRender)},Object.defineProperty(t.prototype,"tasks",{get:function(){return this._tasks},enumerable:!0,configurable:!0}),t.prototype.getMainInputTexture=function(t){return this._tasks[0].getMainInputTexture(t)},Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(t){this._textureWidth=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(t){this._textureHeight=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureHeight=t},enumerable:!0,configurable:!0}),t.prototype.setRenderTargets=function(t){this._tasks[this._tasks.length-1].target=t},t.prototype.dispose=function(){for(var t=0;t<this._tasks.length;++t)this._tasks[t].dispose()},t.prototype.update=function(){},t}();t.Filter3DBase=e}(t.filters||(t.filters={})),t.filters}(away||(away={}));var away;!function(t){!function(e){var i=t.base.BlendMode,n=t.errors.AbstractMethodError,r=t.errors.ArgumentError,s=t.events.Event,a=t.managers.AGALProgramCache,o=t.stagegl.ContextGLBlendFactor,h=t.stagegl.ContextGLCompareMode,p=t.stagegl.ContextGLTriangleFace,u=function(e){function u(){var t=this;e.call(this),this._iPrograms=new Array(8),this._iProgramids=new Array(-1,-1,-1,-1,-1,-1,-1,-1),this._contextGLs=new Array(8),this._pSmooth=!0,this._pRepeat=!1,this._pMipmap=!0,this._depthCompareMode=h.LESS_EQUAL,this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1,this._pAnimatableAttributes=new Array("va0"),this._pAnimationTargetRegisters=new Array("vt0"),this._pShadedTarget="ft0",this._defaultCulling=p.BACK,this._pAlphaPremultiplied=!1,this._writeDepth=!0,this._onLightsChangeDelegate=function(e){return t.onLightsChange(e)},this._pNumUsedStreams=1,this._pNumUsedVertexConstants=5,this._iUniqueId=u.MATERIALPASS_ID_COUNT++}return __extends(u,e),Object.defineProperty(u.prototype,"material",{get:function(){return this._material},set:function(t){this._material=t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"writeDepth",{get:function(){return this._writeDepth},set:function(t){this._writeDepth=t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"mipmap",{get:function(){return this._pMipmap},set:function(t){this._pMipmap!=t&&(this._pMipmap=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"smooth",{get:function(){return this._pSmooth},set:function(t){this._pSmooth!=t&&(this._pSmooth=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"repeat",{get:function(){return this._pRepeat},set:function(t){this._pRepeat!=t&&(this._pRepeat=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"bothSides",{get:function(){return this._pBothSides},set:function(t){this._pBothSides=t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(t){this._depthCompareMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"animationSet",{get:function(){return this._animationSet},set:function(t){this._animationSet!=t&&(this._animationSet=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"renderToTexture",{get:function(){return this._renderToTexture},enumerable:!0,configurable:!0}),u.prototype.dispose=function(){this._pLightPicker&&this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate);for(var e=0;8>e;++e)this._iPrograms[e]&&(t.managers.AGALProgramCache.getInstanceFromIndex(e).freeProgram(this._iProgramids[e]),this._iPrograms[e]=null)},Object.defineProperty(u.prototype,"numUsedStreams",{get:function(){return this._pNumUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"numUsedVertexConstants",{get:function(){return this._pNumUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"numUsedVaryings",{get:function(){return this._pNumUsedVaryings},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"numUsedFragmentConstants",{get:function(){return this._pNumUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"needFragmentAnimation",{get:function(){return this._pNeedFragmentAnimation},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"needUVAnimation",{get:function(){return this._pNeedUVAnimation},enumerable:!0,configurable:!0}),u.prototype.iUpdateAnimationState=function(t,e,i){t.materialOwner.animator.setRenderState(e,t,this._pNumUsedVertexConstants,this._pNumUsedStreams,i)},u.prototype.iRender=function(){throw new n},u.prototype.iGetVertexCode=function(){throw new n},u.prototype.iGetFragmentCode=function(){throw new n},u.prototype.setBlendMode=function(t){switch(t){case i.NORMAL:this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1;break;case i.LAYER:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE_MINUS_SOURCE_ALPHA,this._pEnableBlending=!0;break;case i.MULTIPLY:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_COLOR,this._pEnableBlending=!0;break;case i.ADD:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE,this._pEnableBlending=!0;break;case i.ALPHA:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_ALPHA,this._pEnableBlending=!0;break;default:throw new r("Unsupported blend mode!")}},u.prototype.iActivate=function(t,e){var i=t.stageIndex,n=t.context;n.setDepthTest(this._writeDepth&&!this._pEnableBlending,this._depthCompareMode),this._pEnableBlending&&n.setBlendFactors(this._blendFactorSource,this._blendFactorDest),this._contextGLs[i]==n&&this._iPrograms[i]||(this._contextGLs[i]=n,this.iUpdateProgram(t),this.dispatchEvent(new s(s.CHANGE)));var r,a=u._previousUsedStreams[i];for(r=this._pNumUsedStreams;a>r;++r)n.setVertexBufferAt(r,null);for(a=u._previousUsedTexs[i],r=this._pNumUsedTextures;a>r;++r)n.setTextureAt(r,null);this._animationSet&&!this._animationSet.usesCPU&&this._animationSet.activate(t,this),n.setProgram(this._iPrograms[i]),n.setCulling(this._pBothSides?p.NONE:this._defaultCulling,e.projection.coordinateSystem),this._renderToTexture&&(this._oldTarget=t.renderTarget,this._oldSurface=t.renderSurfaceSelector,this._oldDepthStencil=t.enableDepthAndStencil,this._oldRect=t.scissorRect)},u.prototype.iDeactivate=function(t){var e=t.stageIndex;u._previousUsedStreams[e]=this._pNumUsedStreams,u._previousUsedTexs[e]=this._pNumUsedTextures,this._animationSet&&!this._animationSet.usesCPU&&this._animationSet.deactivate(t,this),this._renderToTexture&&(t.context.setRenderTarget(this._oldTarget,this._oldDepthStencil,this._oldSurface),t.scissorRect=this._oldRect),t.context.setDepthTest(!0,h.LESS_EQUAL)},u.prototype.iInvalidateShaderProgram=function(t){"undefined"==typeof t&&(t=!0);for(var e=0;8>e;++e)this._iPrograms[e]=null;this._material&&t&&this._material.iInvalidatePasses(this)},u.prototype.iUpdateProgram=function(e){var i="",n="",r="",s=this.iGetVertexCode();if(this._animationSet&&!this._animationSet.usesCPU)i=this._animationSet.getAGALVertexCode(this,this._pAnimatableAttributes,this._pAnimationTargetRegisters,e.profile),this._pNeedFragmentAnimation&&(r=this._animationSet.getAGALFragmentCode(this,this._pShadedTarget,e.profile)),this._pNeedUVAnimation&&(n=this._animationSet.getAGALUVCode(this,this._pUVSource,this._pUVTarget)),this._animationSet.doneAGALCode(this);else{for(var o=this._pAnimatableAttributes.length,h=0;o>h;++h)i+="mov "+this._pAnimationTargetRegisters[h]+", "+this._pAnimatableAttributes[h]+"\n";this._pNeedUVAnimation&&(n="mov "+this._pUVTarget+","+this._pUVSource+"\n")}s=i+n+s;var p=this.iGetFragmentCode(r);t.Debug.ENABLE_LOG&&(t.Debug.log("Compiling AGAL Code:"),t.Debug.log("--------------------"),t.Debug.log(s),t.Debug.log("--------------------"),t.Debug.log(p)),a.getInstance(e).setProgram(this._iProgramids,this._iPrograms,s,p)},Object.defineProperty(u.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(t){this._pLightPicker&&this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate),this._pLightPicker=t,this._pLightPicker&&this._pLightPicker.addEventListener(s.CHANGE,this._onLightsChangeDelegate),this.pUpdateLights()},enumerable:!0,configurable:!0}),u.prototype.onLightsChange=function(){this.pUpdateLights()},u.prototype.pUpdateLights=function(){},Object.defineProperty(u.prototype,"alphaPremultiplied",{get:function(){return this._pAlphaPremultiplied},set:function(t){this._pAlphaPremultiplied!=t&&(this._pAlphaPremultiplied=t,this.iInvalidateShaderProgram(!1))},enumerable:!0,configurable:!0}),u.MATERIALPASS_ID_COUNT=0,u._previousUsedStreams=new Array(0,0,0,0,0,0,0,0),u._previousUsedTexs=new Array(0,0,0,0,0,0,0,0),u}(t.events.EventDispatcher);e.MaterialPassBase=u}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.errors.AbstractMethodError,r=t.events.ShadingMethodEvent,s=t.geom.Matrix3DUtils,a=function(a){function o(t){var e=this;a.call(this),this._pSpecularLightSources=1,this._pDiffuseLightSources=3,this._pVertexConstantData=new Array,this._pFragmentConstantData=new Array,this._preserveAlpha=!0,this._animateUVs=!1,this._pNumPointLights=0,this._pNumDirectionalLights=0,this._pNumLightProbes=0,this._enableLightFallOff=!0,this._forceSeparateMVP=!1,this.material=t,this._onShaderInvalidatedDelegate=function(t){return e.onShaderInvalidated(t)},this.init()}return __extends(o,a),Object.defineProperty(o.prototype,"enableLightFallOff",{get:function(){return this._enableLightFallOff},set:function(t){t!=this._enableLightFallOff&&this.iInvalidateShaderProgram(!0),this._enableLightFallOff=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(t){this._forceSeparateMVP=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"iNumPointLights",{get:function(){return this._pNumPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"iNumDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"iNumLightProbes",{get:function(){return this._pNumLightProbes},enumerable:!0,configurable:!0}),o.prototype.iUpdateProgram=function(t){this.reset(t.profile),a.prototype.iUpdateProgram.call(this,t)},o.prototype.reset=function(t){this.iInitCompiler(t),this.pUpdateShaderProperties(),this.initConstantData(),this.pCleanUp()},o.prototype.updateUsedOffsets=function(){this._pNumUsedVertexConstants=this._pCompiler.numUsedVertexConstants,this._pNumUsedFragmentConstants=this._pCompiler.numUsedFragmentConstants,this._pNumUsedStreams=this._pCompiler.numUsedStreams,this._pNumUsedTextures=this._pCompiler.numUsedTextures,this._pNumUsedVaryings=this._pCompiler.numUsedVaryings,this._pNumUsedFragmentConstants=this._pCompiler.numUsedFragmentConstants},o.prototype.initConstantData=function(){this._pVertexConstantData.length=4*this._pNumUsedVertexConstants,this._pFragmentConstantData.length=4*this._pNumUsedFragmentConstants,this.pInitCommonsData(),this._uvTransformIndex>=0&&this.pInitUVTransformData(),this._pCameraPositionIndex>=0&&(this._pVertexConstantData[this._pCameraPositionIndex+3]=1),this.pUpdateMethodConstants()},o.prototype.iInitCompiler=function(t){this._pCompiler=this.pCreateCompiler(t),this._pCompiler.forceSeperateMVP=this._forceSeparateMVP,this._pCompiler.numPointLights=this._pNumPointLights,this._pCompiler.numDirectionalLights=this._pNumDirectionalLights,this._pCompiler.numLightProbes=this._pNumLightProbes,this._pCompiler.methodSetup=this._pMethodSetup,this._pCompiler.diffuseLightSources=this._pDiffuseLightSources,this._pCompiler.specularLightSources=this._pSpecularLightSources,this._pCompiler.setTextureSampling(this._pSmooth,this._pRepeat,this._pMipmap),this._pCompiler.setConstantDataBuffers(this._pVertexConstantData,this._pFragmentConstantData),this._pCompiler.animateUVs=this._animateUVs,this._pCompiler.alphaPremultiplied=this._pAlphaPremultiplied&&this._pEnableBlending,this._pCompiler.preserveAlpha=this._preserveAlpha&&this._pEnableBlending,this._pCompiler.enableLightFallOff=this._enableLightFallOff,this._pCompiler.compile()},o.prototype.pCreateCompiler=function(){throw new n},o.prototype.pUpdateShaderProperties=function(){this._pAnimatableAttributes=this._pCompiler.animatableAttributes,this._pAnimationTargetRegisters=this._pCompiler.animationTargetRegisters,this._vertexCode=this._pCompiler.vertexCode,this._fragmentLightCode=this._pCompiler.fragmentLightCode,this._framentPostLightCode=this._pCompiler.fragmentPostLightCode,this._pShadedTarget=this._pCompiler.shadedTarget,this._usingSpecularMethod=this._pCompiler.usingSpecularMethod,this._usesNormals=this._pCompiler.usesNormals,this._pNeedUVAnimation=this._pCompiler.needUVAnimation,this._pUVSource=this._pCompiler.UVSource,this._pUVTarget=this._pCompiler.UVTarget,this.pUpdateRegisterIndices(),this.updateUsedOffsets()},o.prototype.pUpdateRegisterIndices=function(){this._uvBufferIndex=this._pCompiler.uvBufferIndex,this._uvTransformIndex=this._pCompiler.uvTransformIndex,this._secondaryUVBufferIndex=this._pCompiler.secondaryUVBufferIndex,this._normalBufferIndex=this._pCompiler.normalBufferIndex,this._tangentBufferIndex=this._pCompiler.tangentBufferIndex,this._pLightFragmentConstantIndex=this._pCompiler.lightFragmentConstantIndex,this._pCameraPositionIndex=this._pCompiler.cameraPositionIndex,this._commonsDataIndex=this._pCompiler.commonsDataIndex,this._sceneMatrixIndex=this._pCompiler.sceneMatrixIndex,this._sceneNormalMatrixIndex=this._pCompiler.sceneNormalMatrixIndex,this._pProbeWeightsIndex=this._pCompiler.probeWeightsIndex,this._pLightProbeDiffuseIndices=this._pCompiler.lightProbeDiffuseIndices,this._pLightProbeSpecularIndices=this._pCompiler.lightProbeSpecularIndices},Object.defineProperty(o.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(t){this._preserveAlpha!=t&&(this._preserveAlpha=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"animateUVs",{get:function(){return this._animateUVs},set:function(t){this._animateUVs=t,(t&&!this._animateUVs||!t&&this._animateUVs)&&this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"normalMap",{get:function(){return this._pMethodSetup._iNormalMethod.normalMap
},set:function(t){this._pMethodSetup._iNormalMethod.normalMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"normalMethod",{get:function(){return this._pMethodSetup.normalMethod},set:function(t){this._pMethodSetup.normalMethod=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ambientMethod",{get:function(){return this._pMethodSetup.ambientMethod},set:function(t){this._pMethodSetup.ambientMethod=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shadowMethod",{get:function(){return this._pMethodSetup.shadowMethod},set:function(t){this._pMethodSetup.shadowMethod=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"diffuseMethod",{get:function(){return this._pMethodSetup.diffuseMethod},set:function(t){this._pMethodSetup.diffuseMethod=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"specularMethod",{get:function(){return this._pMethodSetup.specularMethod},set:function(t){this._pMethodSetup.specularMethod=t},enumerable:!0,configurable:!0}),o.prototype.init=function(){this._pMethodSetup=new e.ShaderMethodSetup,this._pMethodSetup.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)},o.prototype.dispose=function(){a.prototype.dispose.call(this),this._pMethodSetup.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._pMethodSetup.dispose(),this._pMethodSetup=null},o.prototype.iInvalidateShaderProgram=function(t){"undefined"==typeof t&&(t=!0);var e=this._iPasses;if(this._iPasses=new Array,this._pMethodSetup&&this.pAddPassesFromMethods(),!e||this._iPasses.length!=e.length)return void(this._iPassesDirty=!0);for(var i=0;i<this._iPasses.length;++i)if(this._iPasses[i]!=e[i])return void(this._iPassesDirty=!0);a.prototype.iInvalidateShaderProgram.call(this,t)},o.prototype.pAddPassesFromMethods=function(){this._pMethodSetup._iNormalMethod&&this._pMethodSetup._iNormalMethod.iHasOutput&&this.pAddPasses(this._pMethodSetup._iNormalMethod.passes),this._pMethodSetup._iAmbientMethod&&this.pAddPasses(this._pMethodSetup._iAmbientMethod.passes),this._pMethodSetup._iShadowMethod&&this.pAddPasses(this._pMethodSetup._iShadowMethod.passes),this._pMethodSetup._iDiffuseMethod&&this.pAddPasses(this._pMethodSetup._iDiffuseMethod.passes),this._pMethodSetup._iSpecularMethod&&this.pAddPasses(this._pMethodSetup._iSpecularMethod.passes)},o.prototype.pAddPasses=function(t){if(t)for(var e=t.length,i=0;e>i;++i)t[i].material=this.material,t[i].lightPicker=this._pLightPicker,this._iPasses.push(t[i])},o.prototype.pInitUVTransformData=function(){this._pVertexConstantData[this._uvTransformIndex]=1,this._pVertexConstantData[this._uvTransformIndex+1]=0,this._pVertexConstantData[this._uvTransformIndex+2]=0,this._pVertexConstantData[this._uvTransformIndex+3]=0,this._pVertexConstantData[this._uvTransformIndex+4]=0,this._pVertexConstantData[this._uvTransformIndex+5]=1,this._pVertexConstantData[this._uvTransformIndex+6]=0,this._pVertexConstantData[this._uvTransformIndex+7]=0},o.prototype.pInitCommonsData=function(){this._pFragmentConstantData[this._commonsDataIndex]=.5,this._pFragmentConstantData[this._commonsDataIndex+1]=0,this._pFragmentConstantData[this._commonsDataIndex+2]=1/255,this._pFragmentConstantData[this._commonsDataIndex+3]=1},o.prototype.pCleanUp=function(){this._pCompiler.dispose(),this._pCompiler=null},o.prototype.pUpdateMethodConstants=function(){this._pMethodSetup._iNormalMethod&&this._pMethodSetup._iNormalMethod.iInitConstants(this._pMethodSetup._iNormalMethodVO),this._pMethodSetup._iDiffuseMethod&&this._pMethodSetup._iDiffuseMethod.iInitConstants(this._pMethodSetup._iDiffuseMethodVO),this._pMethodSetup._iAmbientMethod&&this._pMethodSetup._iAmbientMethod.iInitConstants(this._pMethodSetup._iAmbientMethodVO),this._usingSpecularMethod&&this._pMethodSetup._iSpecularMethod.iInitConstants(this._pMethodSetup._iSpecularMethodVO),this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iInitConstants(this._pMethodSetup._iShadowMethodVO)},o.prototype.pUpdateLightConstants=function(){},o.prototype.pUpdateProbes=function(){},o.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},o.prototype.iGetVertexCode=function(){return this._vertexCode},o.prototype.iGetFragmentCode=function(t){return this._fragmentLightCode+t+this._framentPostLightCode},o.prototype.iActivate=function(t,e){a.prototype.iActivate.call(this,t,e),this._usesNormals&&this._pMethodSetup._iNormalMethod.iActivate(this._pMethodSetup._iNormalMethodVO,t),this._pMethodSetup._iAmbientMethod.iActivate(this._pMethodSetup._iAmbientMethodVO,t),this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iActivate(this._pMethodSetup._iShadowMethodVO,t),this._pMethodSetup._iDiffuseMethod.iActivate(this._pMethodSetup._iDiffuseMethodVO,t),this._usingSpecularMethod&&this._pMethodSetup._iSpecularMethod.iActivate(this._pMethodSetup._iSpecularMethodVO,t)},o.prototype.iRender=function(e,n,r,a){var o,h=n.context;if(this._uvBufferIndex>=0&&h.activateBuffer(this._uvBufferIndex,e.getVertexData(i.UV_DATA),e.getVertexOffset(i.UV_DATA),i.UV_FORMAT),this._secondaryUVBufferIndex>=0&&h.activateBuffer(this._secondaryUVBufferIndex,e.getVertexData(i.SECONDARY_UV_DATA),e.getVertexOffset(i.SECONDARY_UV_DATA),i.SECONDARY_UV_FORMAT),this._normalBufferIndex>=0&&h.activateBuffer(this._normalBufferIndex,e.getVertexData(i.NORMAL_DATA),e.getVertexOffset(i.NORMAL_DATA),i.NORMAL_FORMAT),this._tangentBufferIndex>=0&&h.activateBuffer(this._tangentBufferIndex,e.getVertexData(i.TANGENT_DATA),e.getVertexOffset(i.TANGENT_DATA),i.TANGENT_FORMAT),this._animateUVs){var p=e.materialOwner.uvTransform.matrix;p?(this._pVertexConstantData[this._uvTransformIndex]=p.a,this._pVertexConstantData[this._uvTransformIndex+1]=p.b,this._pVertexConstantData[this._uvTransformIndex+3]=p.tx,this._pVertexConstantData[this._uvTransformIndex+4]=p.c,this._pVertexConstantData[this._uvTransformIndex+5]=p.d,this._pVertexConstantData[this._uvTransformIndex+7]=p.ty):(this._pVertexConstantData[this._uvTransformIndex]=1,this._pVertexConstantData[this._uvTransformIndex+1]=0,this._pVertexConstantData[this._uvTransformIndex+3]=0,this._pVertexConstantData[this._uvTransformIndex+4]=0,this._pVertexConstantData[this._uvTransformIndex+5]=1,this._pVertexConstantData[this._uvTransformIndex+7]=0)}if(this._pAmbientLightR=this._pAmbientLightG=this._pAmbientLightB=0,this.pUsesLights()&&this.pUpdateLightConstants(),this.pUsesProbes()&&this.pUpdateProbes(n),this._sceneMatrixIndex>=0)e.sourceEntity.getRenderSceneTransform(r).copyRawDataTo(this._pVertexConstantData,this._sceneMatrixIndex,!0),a.copyRawDataTo(this._pVertexConstantData,0,!0);else{var u=s.CALCULATION_MATRIX;u.copyFrom(e.sourceEntity.getRenderSceneTransform(r)),u.append(a),u.copyRawDataTo(this._pVertexConstantData,0,!0)}this._sceneNormalMatrixIndex>=0&&e.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pVertexConstantData,this._sceneNormalMatrixIndex,!1),this._usesNormals&&this._pMethodSetup._iNormalMethod.iSetRenderState(this._pMethodSetup._iNormalMethodVO,e,n,r);var l=this._pMethodSetup._iAmbientMethod;l._iLightAmbientR=this._pAmbientLightR,l._iLightAmbientG=this._pAmbientLightG,l._iLightAmbientB=this._pAmbientLightB,l.iSetRenderState(this._pMethodSetup._iAmbientMethodVO,e,n,r),this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iSetRenderState(this._pMethodSetup._iShadowMethodVO,e,n,r),this._pMethodSetup._iDiffuseMethod.iSetRenderState(this._pMethodSetup._iDiffuseMethodVO,e,n,r),this._usingSpecularMethod&&this._pMethodSetup._iSpecularMethod.iSetRenderState(this._pMethodSetup._iSpecularMethodVO,e,n,r),this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iSetRenderState(this._pMethodSetup._iColorTransformMethodVO,e,n,r);var c=this._pMethodSetup._iMethods,d=c.length;for(o=0;d>o;++o){var _=c[o];_.method.iSetRenderState(_.data,e,n,r)}h.setProgramConstantsFromArray(t.stagegl.ContextGLProgramType.VERTEX,0,this._pVertexConstantData,this._pNumUsedVertexConstants),h.setProgramConstantsFromArray(t.stagegl.ContextGLProgramType.FRAGMENT,0,this._pFragmentConstantData,this._pNumUsedFragmentConstants),h.activateBuffer(0,e.getVertexData(i.POSITION_DATA),e.getVertexOffset(i.POSITION_DATA),i.POSITION_FORMAT),h.drawTriangles(h.getIndexBuffer(e.getIndexData()),0,e.numTriangles)},o.prototype.pUsesProbes=function(){return this._pNumLightProbes>0&&0!=((this._pDiffuseLightSources|this._pSpecularLightSources)&e.LightSources.PROBES)},o.prototype.pUsesLights=function(){return(this._pNumPointLights>0||this._pNumDirectionalLights>0)&&0!=((this._pDiffuseLightSources|this._pSpecularLightSources)&e.LightSources.LIGHTS)},o.prototype.iDeactivate=function(t){a.prototype.iDeactivate.call(this,t),this._usesNormals&&this._pMethodSetup._iNormalMethod.iDeactivate(this._pMethodSetup._iNormalMethodVO,t),this._pMethodSetup._iAmbientMethod.iDeactivate(this._pMethodSetup._iAmbientMethodVO,t),this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iDeactivate(this._pMethodSetup._iShadowMethodVO,t),this._pMethodSetup._iDiffuseMethod.iDeactivate(this._pMethodSetup._iDiffuseMethodVO,t),this._usingSpecularMethod&&this._pMethodSetup._iSpecularMethod.iDeactivate(this._pMethodSetup._iSpecularMethodVO,t)},Object.defineProperty(o.prototype,"specularLightSources",{get:function(){return this._pSpecularLightSources},set:function(t){this._pSpecularLightSources=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"diffuseLightSources",{get:function(){return this._pDiffuseLightSources},set:function(t){this._pDiffuseLightSources=t},enumerable:!0,configurable:!0}),o}(e.MaterialPassBase);e.CompiledPass=a}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(t){e.call(this,t),this._includeCasters=!0,this._pNeedFragmentAnimation=!0}return __extends(i,e),i.prototype.pCreateCompiler=function(e){return new t.SuperShaderCompiler(e)},Object.defineProperty(i.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(t){this._includeCasters!=t&&(this._includeCasters=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorTransform",{get:function(){return this._pMethodSetup._iColorTransformMethod?this._pMethodSetup._iColorTransformMethod.colorTransform:null},set:function(e){e?(null==this.colorTransformMethod&&(this.colorTransformMethod=new t.EffectColorTransformMethod),this._pMethodSetup._iColorTransformMethod.colorTransform=e):e||(this._pMethodSetup._iColorTransformMethod&&(this.colorTransformMethod=null),this.colorTransformMethod=this._pMethodSetup._iColorTransformMethod=null)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorTransformMethod",{get:function(){return this._pMethodSetup._iColorTransformMethod},set:function(t){this._pMethodSetup.iColorTransformMethod=t},enumerable:!0,configurable:!0}),i.prototype.addMethod=function(t){this._pMethodSetup.addMethod(t)},Object.defineProperty(i.prototype,"numMethods",{get:function(){return this._pMethodSetup.numMethods},enumerable:!0,configurable:!0}),i.prototype.hasMethod=function(t){return this._pMethodSetup.hasMethod(t)},i.prototype.getMethodAt=function(t){return this._pMethodSetup.getMethodAt(t)},i.prototype.addMethodAt=function(t,e){this._pMethodSetup.addMethodAt(t,e)},i.prototype.removeMethod=function(t){this._pMethodSetup.removeMethod(t)},i.prototype.pUpdateLights=function(){this._pLightPicker&&!this._ignoreLights?(this._pNumPointLights=this._pLightPicker.numPointLights,this._pNumDirectionalLights=this._pLightPicker.numDirectionalLights,this._pNumLightProbes=this._pLightPicker.numLightProbes,this._includeCasters&&(this._pNumPointLights+=this._pLightPicker.numCastingPointLights,this._pNumDirectionalLights+=this._pLightPicker.numCastingDirectionalLights)):(this._pNumPointLights=0,this._pNumDirectionalLights=0,this._pNumLightProbes=0),this.iInvalidateShaderProgram()},i.prototype.iActivate=function(t,i){e.prototype.iActivate.call(this,t,i),this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iActivate(this._pMethodSetup._iColorTransformMethodVO,t);for(var n=this._pMethodSetup._iMethods,r=n.length,s=0;r>s;++s){var a=n[s];a.method.iActivate(a.data,t)}if(this._pCameraPositionIndex>=0){var o=i.scenePosition;this._pVertexConstantData[this._pCameraPositionIndex]=o.x,this._pVertexConstantData[this._pCameraPositionIndex+1]=o.y,this._pVertexConstantData[this._pCameraPositionIndex+2]=o.z}},i.prototype.iDeactivate=function(t){e.prototype.iDeactivate.call(this,t),this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iDeactivate(this._pMethodSetup._iColorTransformMethodVO,t);for(var i,n=this._pMethodSetup._iMethods,r=n.length,s=0;r>s;++s)i=n[s],i.method.iDeactivate(i.data,t)},i.prototype.pAddPassesFromMethods=function(){e.prototype.pAddPassesFromMethods.call(this),this._pMethodSetup._iColorTransformMethod&&this.pAddPasses(this._pMethodSetup._iColorTransformMethod.passes);for(var t=this._pMethodSetup._iMethods,i=0;i<t.length;++i)this.pAddPasses(t[i].method.passes)},i.prototype.usesProbesForSpecular=function(){return this._pNumLightProbes>0&&0!=(this._pSpecularLightSources&t.LightSources.PROBES)},i.prototype.usesProbesForDiffuse=function(){return this._pNumLightProbes>0&&0!=(this._pDiffuseLightSources&t.LightSources.PROBES)},i.prototype.pUpdateMethodConstants=function(){e.prototype.pUpdateMethodConstants.call(this),this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iInitConstants(this._pMethodSetup._iColorTransformMethodVO);for(var t=this._pMethodSetup._iMethods,i=t.length,n=0;i>n;++n)t[n].method.iInitConstants(t[n].data)},i.prototype.pUpdateLightConstants=function(){var t,e,i,n,r,s,a=0,o=this._includeCasters?2:1;n=this._pLightFragmentConstantIndex;for(var h=0;o>h;++h){var p=h?this._pLightPicker.castingDirectionalLights:this._pLightPicker.directionalLights;for(r=p.length,a+=r,i=0;r>i;++i)t=p[i],s=t.sceneDirection,this._pAmbientLightR+=t._iAmbientR,this._pAmbientLightG+=t._iAmbientG,this._pAmbientLightB+=t._iAmbientB,this._pFragmentConstantData[n++]=-s.x,this._pFragmentConstantData[n++]=-s.y,this._pFragmentConstantData[n++]=-s.z,this._pFragmentConstantData[n++]=1,this._pFragmentConstantData[n++]=t._iDiffuseR,this._pFragmentConstantData[n++]=t._iDiffuseG,this._pFragmentConstantData[n++]=t._iDiffuseB,this._pFragmentConstantData[n++]=1,this._pFragmentConstantData[n++]=t._iSpecularR,this._pFragmentConstantData[n++]=t._iSpecularG,this._pFragmentConstantData[n++]=t._iSpecularB,this._pFragmentConstantData[n++]=1}if(this._pNumDirectionalLights>a)for(i=n+12*(this._pNumDirectionalLights-a);i>n;)this._pFragmentConstantData[n++]=0;for(a=0,h=0;o>h;++h){var u=h?this._pLightPicker.castingPointLights:this._pLightPicker.pointLights;for(r=u.length,i=0;r>i;++i)e=u[i],s=e.scenePosition,this._pAmbientLightR+=e._iAmbientR,this._pAmbientLightG+=e._iAmbientG,this._pAmbientLightB+=e._iAmbientB,this._pFragmentConstantData[n++]=s.x,this._pFragmentConstantData[n++]=s.y,this._pFragmentConstantData[n++]=s.z,this._pFragmentConstantData[n++]=1,this._pFragmentConstantData[n++]=e._iDiffuseR,this._pFragmentConstantData[n++]=e._iDiffuseG,this._pFragmentConstantData[n++]=e._iDiffuseB,this._pFragmentConstantData[n++]=e._pRadius*e._pRadius,this._pFragmentConstantData[n++]=e._iSpecularR,this._pFragmentConstantData[n++]=e._iSpecularG,this._pFragmentConstantData[n++]=e._iSpecularB,this._pFragmentConstantData[n++]=e._pFallOffFactor}if(this._pNumPointLights>a)for(i=n+12*(a-this._pNumPointLights);i>n;++n)this._pFragmentConstantData[n]=0},i.prototype.pUpdateProbes=function(t){var e,i=this._pLightPicker.lightProbes,n=this._pLightPicker.lightProbeWeights,r=i.length,s=this.usesProbesForDiffuse(),a=this._pMethodSetup._iSpecularMethod&&this.usesProbesForSpecular();if(s||a){for(var o=0;r>o;++o)e=i[o],s&&t.context.activateCubeTexture(this._pLightProbeSpecularIndices[o],e.diffuseMap),a&&t.context.activateCubeTexture(this._pLightProbeSpecularIndices[o],e.specularMap);this._pFragmentConstantData[this._pProbeWeightsIndex]=n[0],this._pFragmentConstantData[this._pProbeWeightsIndex+1]=n[1],this._pFragmentConstantData[this._pProbeWeightsIndex+2]=n[2],this._pFragmentConstantData[this._pProbeWeightsIndex+3]=n[3]}},Object.defineProperty(i.prototype,"iIgnoreLights",{get:function(){return this._ignoreLights},set:function(t){this._ignoreLights=t},enumerable:!0,configurable:!0}),i}(t.CompiledPass);t.SuperShaderPass=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.geom.Matrix3DUtils,r=t.stagegl.ContextGLProgramType,s=t.stagegl.ContextGLTextureFormat,a=function(t){function e(e){t.call(this),this._alphaThreshold=0,this.material=e,this._data=new Array(1,255,65025,16581375,1/255,1/255,1/255,0,0,0,0,0)}return __extends(e,t),Object.defineProperty(e.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(t){0>t?t=0:t>1&&(t=1),t!=this._alphaThreshold&&((0==t||0==this._alphaThreshold)&&this.iInvalidateShaderProgram(),this._alphaThreshold=t,this._data[8]=this._alphaThreshold)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaMask",{get:function(){return this._alphaMask},set:function(t){this._alphaMask=t},enumerable:!0,configurable:!0}),e.prototype.iGetVertexCode=function(){var t="";return t="m44 vt1, vt0, vc0\nmov op, vt1\n",this._alphaThreshold>0?(this._pNumUsedTextures=1,this._pNumUsedStreams=2,t+="mov v0, vt1\nmov v1, va1\n"):(this._pNumUsedTextures=0,this._pNumUsedStreams=1,t+="mov v0, vt1\n"),t},e.prototype.iGetFragmentCode=function(){var t,e=this._pRepeat?"wrap":"clamp";t=this._pSmooth?this._pMipmap?"linear,miplinear":"linear":this._pMipmap?"nearest,mipnearest":"nearest";var i="div ft2, v0, v0.w\nmul ft0, fc0, ft2.z\nfrc ft0, ft0\nmul ft1, ft0.yzww, fc1\n";if(this._alphaThreshold>0){var n;switch(this._alphaMask.format){case s.COMPRESSED:n="dxt1,";break;case"compressedAlpha":n="dxt5,";break;default:n=""}i+="tex ft3, v1, fs0 <2d,"+t+","+n+e+">\nsub ft3.w, ft3.w, fc2.x\nkil ft3.w\n"}return i+="sub oc, ft0, ft1		\n"},e.prototype.iRender=function(t,e,s,a){var o=e.context;this._alphaThreshold>0&&o.activateBuffer(1,t.getVertexData(i.UV_DATA),t.getVertexOffset(i.UV_DATA),i.UV_FORMAT);var h=n.CALCULATION_MATRIX;h.copyFrom(t.sourceEntity.getRenderSceneTransform(s)),h.append(a),o.setProgramConstantsFromMatrix(r.VERTEX,0,h,!0),o.activateBuffer(0,t.getVertexData(i.POSITION_DATA),t.getVertexOffset(i.POSITION_DATA),i.POSITION_FORMAT),o.drawTriangles(o.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},e.prototype.iActivate=function(e,i){var n=e.context;t.prototype.iActivate.call(this,e,i),this._alphaThreshold>0?(n.activateTexture(0,this._alphaMask),n.setProgramConstantsFromArray(r.FRAGMENT,0,this._data,3)):n.setProgramConstantsFromArray(r.FRAGMENT,0,this._data,2)},e}(e.MaterialPassBase);e.DepthMapPass=a}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.geom.Matrix3DUtils,r=t.stagegl.ContextGLProgramType,s=t.stagegl.ContextGLTextureFormat,a=function(t){function e(e){t.call(this),this.material=e,this._fragmentData=new Array(1,255,65025,16581375,1/255,1/255,1/255,0,0,0,0,0),this._vertexData=new Array(4),this._vertexData[3]=1,this._pNumUsedVertexConstants=9}return __extends(e,t),Object.defineProperty(e.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(t){0>t?t=0:t>1&&(t=1),t!=this._alphaThreshold&&((0==t||0==this._alphaThreshold)&&this.iInvalidateShaderProgram(),this._alphaThreshold=t,this._fragmentData[8]=this._alphaThreshold)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaMask",{get:function(){return this._alphaMask},set:function(t){this._alphaMask=t},enumerable:!0,configurable:!0}),e.prototype.iGetVertexCode=function(){var t;return t="m44 op, vt0, vc0\nm44 vt1, vt0, vc5\nsub v0, vt1, vc9\n",this._alphaThreshold>0?(t+="mov v1, va1\n",this._pNumUsedTextures=1,this._pNumUsedStreams=2):(this._pNumUsedTextures=0,this._pNumUsedStreams=1),t},e.prototype.iGetFragmentCode=function(){var t,e,i=this._pRepeat?"wrap":"clamp";if(e=this._pSmooth?this._pMipmap?"linear,miplinear":"linear":this._pMipmap?"nearest,mipnearest":"nearest",t="dp3 ft2.z, v0.xyz, v0.xyz\nmul ft0, fc0, ft2.z	\nfrc ft0, ft0\nmul ft1, ft0.yzww, fc1\n",this._alphaThreshold>0){var n;switch(this._alphaMask.format){case s.COMPRESSED:n="dxt1,";break;case"compressedAlpha":n="dxt5,";break;default:n=""}t+="tex ft3, v1, fs0 <2d,"+e+","+n+i+">\nsub ft3.w, ft3.w, fc2.x\nkil ft3.w\n"}return t+="sub oc, ft0, ft1		\n"},e.prototype.iRender=function(t,e,s,a){var o=e.context,h=s.scenePosition;this._vertexData[0]=h.x,this._vertexData[1]=h.y,this._vertexData[2]=h.z,this._vertexData[3]=1;var p=t.sourceEntity.getRenderSceneTransform(s);o.setProgramConstantsFromMatrix(r.VERTEX,5,p,!0),o.setProgramConstantsFromArray(r.VERTEX,9,this._vertexData,1),this._alphaThreshold>0&&o.activateBuffer(1,t.getVertexData(i.SECONDARY_UV_DATA),t.getVertexOffset(i.SECONDARY_UV_DATA),i.SECONDARY_UV_FORMAT);var u=n.CALCULATION_MATRIX;u.copyFrom(p),u.append(a),o.setProgramConstantsFromMatrix(r.VERTEX,0,u,!0),o.activateBuffer(0,t.getVertexData(i.POSITION_DATA),t.getVertexOffset(i.POSITION_DATA),i.POSITION_FORMAT),o.drawTriangles(o.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},e.prototype.iActivate=function(e,i){var n=e.context;t.prototype.iActivate.call(this,e,i);var s=i.projection.far;s=1/(2*s*s),this._fragmentData[0]=1*s,this._fragmentData[1]=255*s,this._fragmentData[2]=65025*s,this._fragmentData[3]=16581375*s,this._alphaThreshold>0?(n.activateTexture(0,this._alphaMask),n.setProgramConstantsFromArray(r.FRAGMENT,0,this._fragmentData,3)):n.setProgramConstantsFromArray(r.FRAGMENT,0,this._fragmentData,2)},e}(e.MaterialPassBase);e.DistanceMapPass=a}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(t){e.call(this,t),this._includeCasters=!0,this._inverseSceneMatrix=new Array,this._maxLights=3}return __extends(i,e),Object.defineProperty(i.prototype,"directionalLightsOffset",{get:function(){return this._directionalLightsOffset},set:function(t){this._directionalLightsOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pointLightsOffset",{get:function(){return this._pointLightsOffset},set:function(t){this._pointLightsOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lightProbesOffset",{get:function(){return this._lightProbesOffset},set:function(t){this._lightProbesOffset=t},enumerable:!0,configurable:!0}),i.prototype.pCreateCompiler=function(e){return this._maxLights="baselineConstrained"==e?1:3,new t.LightingShaderCompiler(e)},Object.defineProperty(i.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(t){this._includeCasters!=t&&(this._includeCasters=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),i.prototype.pUpdateLights=function(){e.prototype.pUpdateLights.call(this);var t=this._pNumDirectionalLights,i=this._pNumPointLights,n=this._pNumLightProbes;this._pLightPicker?(this._pNumDirectionalLights=this.calculateNumDirectionalLights(this._pLightPicker.numDirectionalLights),this._pNumPointLights=this.calculateNumPointLights(this._pLightPicker.numPointLights),this._pNumLightProbes=this.calculateNumProbes(this._pLightPicker.numLightProbes),this._includeCasters&&(this._pNumDirectionalLights+=this._pLightPicker.numCastingDirectionalLights,this._pNumPointLights+=this._pLightPicker.numCastingPointLights)):(this._pNumDirectionalLights=0,this._pNumPointLights=0,this._pNumLightProbes=0),(t!=this._pNumDirectionalLights||i!=this._pNumPointLights||n!=this._pNumLightProbes)&&this.iInvalidateShaderProgram()},i.prototype.calculateNumDirectionalLights=function(t){return Math.min(t-this._directionalLightsOffset,this._maxLights)},i.prototype.calculateNumPointLights=function(t){var e=this._maxLights-this._pNumDirectionalLights;return Math.min(t-this._pointLightsOffset,e)},i.prototype.calculateNumProbes=function(e){var i=0;return 0!=(this._pSpecularLightSources&t.LightSources.PROBES)&&++i,0!=(this._pDiffuseLightSources&t.LightSources.PROBES)&&++i,Math.min(e-this._lightProbesOffset,0|4/i)},i.prototype.pUpdateShaderProperties=function(){e.prototype.pUpdateShaderProperties.call(this),this._tangentSpace=this._pCompiler.tangentSpace},i.prototype.pUpdateRegisterIndices=function(){e.prototype.pUpdateRegisterIndices.call(this),this._lightVertexConstantIndex=this._pCompiler.lightVertexConstantIndex},i.prototype.iRender=function(t,i,n,r){if(t.sourceEntity.inverseSceneTransform.copyRawDataTo(this._inverseSceneMatrix),this._tangentSpace&&this._pCameraPositionIndex>=0){var s=n.scenePosition,a=s.x,o=s.y,h=s.z;this._pVertexConstantData[this._pCameraPositionIndex]=this._inverseSceneMatrix[0]*a+this._inverseSceneMatrix[4]*o+this._inverseSceneMatrix[8]*h+this._inverseSceneMatrix[12],this._pVertexConstantData[this._pCameraPositionIndex+1]=this._inverseSceneMatrix[1]*a+this._inverseSceneMatrix[5]*o+this._inverseSceneMatrix[9]*h+this._inverseSceneMatrix[13],this._pVertexConstantData[this._pCameraPositionIndex+2]=this._inverseSceneMatrix[2]*a+this._inverseSceneMatrix[6]*o+this._inverseSceneMatrix[10]*h+this._inverseSceneMatrix[14]}e.prototype.iRender.call(this,t,i,n,r)},i.prototype.iActivate=function(t,i){if(e.prototype.iActivate.call(this,t,i),!this._tangentSpace&&this._pCameraPositionIndex>=0){var n=i.scenePosition;this._pVertexConstantData[this._pCameraPositionIndex]=n.x,this._pVertexConstantData[this._pCameraPositionIndex+1]=n.y,this._pVertexConstantData[this._pCameraPositionIndex+2]=n.z}},i.prototype.usesProbesForSpecular=function(){return this._pNumLightProbes>0&&0!=(this._pSpecularLightSources&t.LightSources.PROBES)},i.prototype.usesProbesForDiffuse=function(){return this._pNumLightProbes>0&&0!=(this._pDiffuseLightSources&t.LightSources.PROBES)},i.prototype.pUpdateLightConstants=function(){var t,e,i,n,r,s,a=0,o=0,h=0,p=this._includeCasters?2:1;r=this._lightVertexConstantIndex,o=this._pLightFragmentConstantIndex;var u=0,l=this._pLightPicker.directionalLights;for(s=this._directionalLightsOffset,i=this._pLightPicker.directionalLights.length,s>i&&(u=1,s-=i);p>u;++u)for(u&&(l=this._pLightPicker.castingDirectionalLights),i=l.length,i>this._pNumDirectionalLights&&(i=this._pNumDirectionalLights),a=0;i>a;++a){if(t=l[s+a],n=t.sceneDirection,this._pAmbientLightR+=t._iAmbientR,this._pAmbientLightG+=t._iAmbientG,this._pAmbientLightB+=t._iAmbientB,this._tangentSpace){var c=-n.x,d=-n.y,_=-n.z;this._pVertexConstantData[r++]=this._inverseSceneMatrix[0]*c+this._inverseSceneMatrix[4]*d+this._inverseSceneMatrix[8]*_,this._pVertexConstantData[r++]=this._inverseSceneMatrix[1]*c+this._inverseSceneMatrix[5]*d+this._inverseSceneMatrix[9]*_,this._pVertexConstantData[r++]=this._inverseSceneMatrix[2]*c+this._inverseSceneMatrix[6]*d+this._inverseSceneMatrix[10]*_,this._pVertexConstantData[r++]=1}else this._pFragmentConstantData[o++]=-n.x,this._pFragmentConstantData[o++]=-n.y,this._pFragmentConstantData[o++]=-n.z,this._pFragmentConstantData[o++]=1;this._pFragmentConstantData[o++]=t._iDiffuseR,this._pFragmentConstantData[o++]=t._iDiffuseG,this._pFragmentConstantData[o++]=t._iDiffuseB,this._pFragmentConstantData[o++]=1,this._pFragmentConstantData[o++]=t._iSpecularR,this._pFragmentConstantData[o++]=t._iSpecularG,this._pFragmentConstantData[o++]=t._iSpecularB,this._pFragmentConstantData[o++]=1,++h==this._pNumDirectionalLights&&(a=i,u=p)}if(this._pNumDirectionalLights>h)for(a=o+12*(this._pNumDirectionalLights-h);a>o;)this._pFragmentConstantData[o++]=0;h=0;var f=this._pLightPicker.pointLights;for(s=this._pointLightsOffset,i=this._pLightPicker.pointLights.length,s>i?(u=1,s-=i):u=0;p>u;++u)for(u&&(f=this._pLightPicker.castingPointLights),i=f.length,a=0;i>a;++a){e=f[s+a],n=e.scenePosition,this._pAmbientLightR+=e._iAmbientR,this._pAmbientLightG+=e._iAmbientG,this._pAmbientLightB+=e._iAmbientB,this._tangentSpace?(c=n.x,d=n.y,_=n.z,this._pVertexConstantData[r++]=this._inverseSceneMatrix[0]*c+this._inverseSceneMatrix[4]*d+this._inverseSceneMatrix[8]*_+this._inverseSceneMatrix[12],this._pVertexConstantData[r++]=this._inverseSceneMatrix[1]*c+this._inverseSceneMatrix[5]*d+this._inverseSceneMatrix[9]*_+this._inverseSceneMatrix[13],this._pVertexConstantData[r++]=this._inverseSceneMatrix[2]*c+this._inverseSceneMatrix[6]*d+this._inverseSceneMatrix[10]*_+this._inverseSceneMatrix[14]):(this._pVertexConstantData[r++]=n.x,this._pVertexConstantData[r++]=n.y,this._pVertexConstantData[r++]=n.z),this._pVertexConstantData[r++]=1,this._pFragmentConstantData[o++]=e._iDiffuseR,this._pFragmentConstantData[o++]=e._iDiffuseG,this._pFragmentConstantData[o++]=e._iDiffuseB;var g=e._pRadius;this._pFragmentConstantData[o++]=g*g,this._pFragmentConstantData[o++]=e._iSpecularR,this._pFragmentConstantData[o++]=e._iSpecularG,this._pFragmentConstantData[o++]=e._iSpecularB,this._pFragmentConstantData[o++]=e._pFallOffFactor,++h==this._pNumPointLights&&(a=i,u=p)}if(this._pNumPointLights>h)for(a=o+12*(h-this._pNumPointLights);a>o;++o)this._pFragmentConstantData[o]=0},i.prototype.pUpdateProbes=function(t){var e,i=this._pLightPicker.lightProbes,n=this._pLightPicker.lightProbeWeights,r=i.length-this._lightProbesOffset,s=this.usesProbesForDiffuse(),a=this._pMethodSetup._iSpecularMethod&&this.usesProbesForSpecular();if(s||a){r>this._pNumLightProbes&&(r=this._pNumLightProbes);for(var o=0;r>o;++o)e=i[this._lightProbesOffset+o],s&&t.context.activateCubeTexture(this._pLightProbeDiffuseIndices[o],e.diffuseMap),a&&t.context.activateCubeTexture(this._pLightProbeSpecularIndices[o],e.specularMap);for(o=0;r>o;++o)this._pFragmentConstantData[this._pProbeWeightsIndex+o]=n[this._lightProbesOffset+o]}},i}(t.CompiledPass);t.LightingPass=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(t){e.call(this,t),this._inverseSceneMatrix=new Array}return __extends(i,e),i.prototype.pCreateCompiler=function(e){return new t.LightingShaderCompiler(e)},i.prototype.pUpdateLights=function(){e.prototype.pUpdateLights.call(this);var t=0,i=0;if(this._pLightPicker?(t=this._pLightPicker.numCastingPointLights>0?1:0,i=this._pLightPicker.numCastingDirectionalLights>0?1:0):(t=0,i=0),this._pNumLightProbes=0,t+i>1)throw new Error("Must have exactly one light!");(t!=this._pNumPointLights||i!=this._pNumDirectionalLights)&&(this._pNumPointLights=t,this._pNumDirectionalLights=i,this.iInvalidateShaderProgram())},i.prototype.pUpdateShaderProperties=function(){e.prototype.pUpdateShaderProperties.call(this),this._tangentSpace=this._pCompiler.tangentSpace},i.prototype.pUpdateRegisterIndices=function(){e.prototype.pUpdateRegisterIndices.call(this),this._lightVertexConstantIndex=this._pCompiler.lightVertexConstantIndex},i.prototype.iRender=function(t,i,n,r){if(t.sourceEntity.inverseSceneTransform.copyRawDataTo(this._inverseSceneMatrix),this._tangentSpace&&this._pCameraPositionIndex>=0){var s=n.scenePosition,a=s.x,o=s.y,h=s.z;this._pVertexConstantData[this._pCameraPositionIndex]=this._inverseSceneMatrix[0]*a+this._inverseSceneMatrix[4]*o+this._inverseSceneMatrix[8]*h+this._inverseSceneMatrix[12],this._pVertexConstantData[this._pCameraPositionIndex+1]=this._inverseSceneMatrix[1]*a+this._inverseSceneMatrix[5]*o+this._inverseSceneMatrix[9]*h+this._inverseSceneMatrix[13],this._pVertexConstantData[this._pCameraPositionIndex+2]=this._inverseSceneMatrix[2]*a+this._inverseSceneMatrix[6]*o+this._inverseSceneMatrix[10]*h+this._inverseSceneMatrix[14]}e.prototype.iRender.call(this,t,i,n,r)},i.prototype.iActivate=function(t,i){if(e.prototype.iActivate.call(this,t,i),!this._tangentSpace&&this._pCameraPositionIndex>=0){var n=i.scenePosition;this._pVertexConstantData[this._pCameraPositionIndex]=n.x,this._pVertexConstantData[this._pCameraPositionIndex+1]=n.y,this._pVertexConstantData[this._pCameraPositionIndex+2]=n.z}},i.prototype.pUpdateLightConstants=function(){var t,e,i,n=0,r=0;if(r=this._lightVertexConstantIndex,n=this._pLightFragmentConstantIndex,this._pNumDirectionalLights>0){if(t=this._pLightPicker.castingDirectionalLights[0],i=t.sceneDirection,this._pAmbientLightR+=t._iAmbientR,this._pAmbientLightG+=t._iAmbientG,this._pAmbientLightB+=t._iAmbientB,this._tangentSpace){var s=-i.x,a=-i.y,o=-i.z;this._pVertexConstantData[r++]=this._inverseSceneMatrix[0]*s+this._inverseSceneMatrix[4]*a+this._inverseSceneMatrix[8]*o,this._pVertexConstantData[r++]=this._inverseSceneMatrix[1]*s+this._inverseSceneMatrix[5]*a+this._inverseSceneMatrix[9]*o,this._pVertexConstantData[r++]=this._inverseSceneMatrix[2]*s+this._inverseSceneMatrix[6]*a+this._inverseSceneMatrix[10]*o,this._pVertexConstantData[r++]=1
}else this._pFragmentConstantData[n++]=-i.x,this._pFragmentConstantData[n++]=-i.y,this._pFragmentConstantData[n++]=-i.z,this._pFragmentConstantData[n++]=1;return this._pFragmentConstantData[n++]=t._iDiffuseR,this._pFragmentConstantData[n++]=t._iDiffuseG,this._pFragmentConstantData[n++]=t._iDiffuseB,this._pFragmentConstantData[n++]=1,this._pFragmentConstantData[n++]=t._iSpecularR,this._pFragmentConstantData[n++]=t._iSpecularG,this._pFragmentConstantData[n++]=t._iSpecularB,void(this._pFragmentConstantData[n++]=1)}this._pNumPointLights>0&&(e=this._pLightPicker.castingPointLights[0],i=e.scenePosition,this._pAmbientLightR+=e._iAmbientR,this._pAmbientLightG+=e._iAmbientG,this._pAmbientLightB+=e._iAmbientB,this._tangentSpace?(s=i.x,a=i.y,o=i.z,this._pVertexConstantData[r++]=this._inverseSceneMatrix[0]*s+this._inverseSceneMatrix[4]*a+this._inverseSceneMatrix[8]*o+this._inverseSceneMatrix[12],this._pVertexConstantData[r++]=this._inverseSceneMatrix[1]*s+this._inverseSceneMatrix[5]*a+this._inverseSceneMatrix[9]*o+this._inverseSceneMatrix[13],this._pVertexConstantData[r++]=this._inverseSceneMatrix[2]*s+this._inverseSceneMatrix[6]*a+this._inverseSceneMatrix[10]*o+this._inverseSceneMatrix[14]):(this._pVertexConstantData[r++]=i.x,this._pVertexConstantData[r++]=i.y,this._pVertexConstantData[r++]=i.z),this._pVertexConstantData[r++]=1,this._pFragmentConstantData[n++]=e._iDiffuseR,this._pFragmentConstantData[n++]=e._iDiffuseG,this._pFragmentConstantData[n++]=e._iDiffuseB,this._pFragmentConstantData[n++]=e._pRadius*e._pRadius,this._pFragmentConstantData[n++]=e._iSpecularR,this._pFragmentConstantData[n++]=e._iSpecularG,this._pFragmentConstantData[n++]=e._iSpecularB,this._pFragmentConstantData[n++]=e._pFallOffFactor)},i.prototype.pUsesProbes=function(){return!1},i.prototype.pUsesLights=function(){return!0},i.prototype.pUpdateProbes=function(){},i}(t.CompiledPass);t.ShadowCasterPass=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.geom.Matrix3D,r=t.stagegl.ContextGLProgramType,s=t.textures.RenderTexture,a=function(t){function e(){t.call(this),this._textureSize=512,this._polyOffset=Array(15,0,0,0),this._projectionTexturesInvalid=!0,this._pNumUsedStreams=2,this._pNumUsedVertexConstants=7,this._enc=Array(1,255,65025,16581375,1/255,1/255,1/255,0),this._pAnimatableAttributes=Array("va0","va1"),this._pAnimationTargetRegisters=Array("vt0","vt1")}return __extends(e,t),Object.defineProperty(e.prototype,"textureSize",{get:function(){return this._textureSize},set:function(t){this._textureSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polyOffset",{get:function(){return this._polyOffset[0]},set:function(t){this._polyOffset[0]=t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._textures){for(var t in this._textures){var e=this._textures[t];e.dispose()}this._textures=null}},e.prototype.updateProjectionTextures=function(){if(this._textures)for(var t in this._textures){var e=this._textures[t];e.dispose()}this._textures=new Object,this._projections=new Object,this._projectionTexturesInvalid=!1},e.prototype.iGetVertexCode=function(){var t;return t="mul vt7, vt1, vc4.x	\nadd vt7, vt7, vt0\nmov vt7.w, vt0.w\n",t+="m44 vt2, vt7, vc0\nmov op, vt2\n",t+="div v0, vt2, vt2.w\n"},e.prototype.iGetFragmentCode=function(){var t="";return t+="mul ft0, fc0, v0.z\nfrc ft0, ft0\nmul ft1, ft0.yzww, fc1\nsub ft0, ft0, ft1\nmov oc, ft0\n"},e.prototype._iGetDepthMap=function(t){return this._textures[t.materialOwner.id]},e.prototype._iGetProjection=function(t){return this._projections[t.materialOwner.id]},e.prototype.iRender=function(t,e,a){var o,h,p,u=e.context,l=this._pLightPicker.allPickedLights,c=t.materialOwner.id;this._textures[c]||(this._textures[c]=new s(this._textureSize,this._textureSize)),this._projections[c]||(this._projections[c]=new n),h=l.length,p=l[0],o=p.iGetObjectProjectionMatrix(t.sourceEntity,a,this._projections[c]),u.setRenderTarget(this._textures[c],!0),u.clear(1,1,1),u.setProgramConstantsFromMatrix(r.VERTEX,0,o,!0),u.setProgramConstantsFromArray(r.FRAGMENT,0,this._enc,2),u.activateBuffer(0,t.getVertexData(i.POSITION_DATA),t.getVertexOffset(i.POSITION_DATA),i.POSITION_FORMAT),u.activateBuffer(1,t.getVertexData(i.NORMAL_DATA),t.getVertexOffset(i.NORMAL_DATA),i.NORMAL_FORMAT),u.drawTriangles(u.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},e.prototype.iActivate=function(e,i){this._projectionTexturesInvalid&&this.updateProjectionTextures(),t.prototype.iActivate.call(this,e,i),e.context.setProgramConstantsFromArray(r.VERTEX,4,this._polyOffset,1)},e}(e.MaterialPassBase);e.SingleObjectDepthPass=a}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.LineSubGeometry,n=t.geom.Matrix3D,r=t.stagegl.ContextGLProgramType,s=function(t){function e(e){t.call(this),this._constants=new Array(0,0,0,0),this.material=e,this._calcMatrix=new n,this._constants[1]=1/255}return __extends(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness=t},enumerable:!0,configurable:!0}),e.prototype.iGetVertexCode=function(){return"m44 vt0, va0, vc8			\nm44 vt1, va1, vc8			\nsub vt2, vt1, vt0 			\nslt vt5.x, vt0.z, vc7.z			\nsub vt5.y, vc5.x, vt5.x			\nadd vt4.x, vt0.z, vc7.z			\nsub vt4.y, vt0.z, vt1.z			\nseq vt4.z, vt4.y vc6.x			\nadd vt4.y, vt4.y, vt4.z			\ndiv vt4.z, vt4.x, vt4.y			\nmul vt4.xyz, vt4.zzz, vt2.xyz	\nadd vt3.xyz, vt0.xyz, vt4.xyz	\nmov vt3.w, vc5.x			\nmul vt0, vt0, vt5.yyyy			\nmul vt3, vt3, vt5.xxxx			\nadd vt0, vt0, vt3				\nsub vt2, vt1, vt0 			\nnrm vt2.xyz, vt2.xyz			\nnrm vt5.xyz, vt0.xyz			\nmov vt5.w, vc5.x				\ncrs vt3.xyz, vt2, vt5			\nnrm vt3.xyz, vt3.xyz			\nmul vt3.xyz, vt3.xyz, va2.xxx	\nmov vt3.w, vc5.x			\ndp3 vt4.x, vt0, vc6			\nmul vt4.x, vt4.x, vc7.x			\nmul vt3.xyz, vt3.xyz, vt4.xxx	\nadd vt0.xyz, vt0.xyz, vt3.xyz	\nm44 op, vt0, vc0			\nmov v0, va3				\n"},e.prototype.iGetFragmentCode=function(){return"mov oc, v0\n"},e.prototype.iRender=function(t,e,n){var s=e.context;this._calcMatrix.copyFrom(t.sourceEntity.sceneTransform),this._calcMatrix.append(n.inverseSceneTransform),s.setProgramConstantsFromMatrix(r.VERTEX,8,this._calcMatrix,!0),s.activateBuffer(0,t.getVertexData(i.START_POSITION_DATA),t.getVertexOffset(i.START_POSITION_DATA),i.POSITION_FORMAT),s.activateBuffer(1,t.getVertexData(i.END_POSITION_DATA),t.getVertexOffset(i.END_POSITION_DATA),i.POSITION_FORMAT),s.activateBuffer(2,t.getVertexData(i.THICKNESS_DATA),t.getVertexOffset(i.THICKNESS_DATA),i.THICKNESS_FORMAT),s.activateBuffer(3,t.getVertexData(i.COLOR_DATA),t.getVertexOffset(i.COLOR_DATA),i.COLOR_FORMAT),s.drawTriangles(s.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},e.prototype.iActivate=function(i,n){var s=i.context;t.prototype.iActivate.call(this,i,n),this._constants[0]=this._thickness/(i.scissorRect?Math.min(i.scissorRect.width,i.scissorRect.height):Math.min(i.width,i.height)),this._constants[2]=n.projection.near,s.setProgramConstantsFromArray(r.VERTEX,5,e.pONE_VECTOR,1),s.setProgramConstantsFromArray(r.VERTEX,6,e.pFRONT_VECTOR,1),s.setProgramConstantsFromArray(r.VERTEX,7,this._constants,1),s.setProgramConstantsFromMatrix(r.VERTEX,0,n.projection.matrix,!0)},e.prototype.pDeactivate=function(t){var e=t.context;e.setVertexBufferAt(0,null),e.setVertexBufferAt(1,null),e.setVertexBufferAt(2,null),e.setVertexBufferAt(3,null)},e.pONE_VECTOR=Array(1,1,1,1),e.pFRONT_VECTOR=Array(0,0,-1,0),e}(e.MaterialPassBase);e.SegmentPass=s}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.stagegl.ContextGLCompareMode,r=t.stagegl.ContextGLMipFilter,s=t.stagegl.ContextGLProgramType,a=t.stagegl.ContextGLTextureFilter,o=t.stagegl.ContextGLTextureFormat,h=t.stagegl.ContextGLWrapMode,p=function(t){function e(e){t.call(this),this.material=e,this.mipmap=!1,this._pNumUsedTextures=1,this._vertexData=new Array(0,0,0,0,1,1,1,1)}return __extends(e,t),Object.defineProperty(e.prototype,"cubeTexture",{get:function(){return this._cubeTexture},set:function(t){this._cubeTexture=t},enumerable:!0,configurable:!0}),e.prototype.iGetVertexCode=function(){return"mul vt0, va0, vc5\nadd vt0, vt0, vc4\nm44 op, vt0, vc0\nmov v0, va0\n"},e.prototype.iGetFragmentCode=function(){var t;switch(this._cubeTexture.format){case o.COMPRESSED:t="dxt1,";break;case"compressedAlpha":t="dxt5,";break;default:t=""}var e=",mipnone";return this._cubeTexture.hasMipmaps&&(e=",miplinear"),"tex ft0, v0, fs0 <cube,"+t+"linear,clamp"+e+">\nmov oc, ft0\n"},e.prototype.iRender=function(t,e,n,r){var a=e.context,o=n.scenePosition;this._vertexData[0]=o.x,this._vertexData[1]=o.y,this._vertexData[2]=o.z,this._vertexData[4]=this._vertexData[5]=this._vertexData[6]=n.projection.far/Math.sqrt(3),a.setProgramConstantsFromMatrix(s.VERTEX,0,r,!0),a.setProgramConstantsFromArray(s.VERTEX,4,this._vertexData,2),a.activateBuffer(0,t.getVertexData(i.POSITION_DATA),t.getVertexOffset(i.POSITION_DATA),i.POSITION_FORMAT),a.drawTriangles(a.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i);var s=e.context;s.setSamplerStateAt(0,h.CLAMP,a.LINEAR,this._cubeTexture.hasMipmaps?r.MIPLINEAR:r.MIPNONE),s.setDepthTest(!1,n.LESS),s.activateCubeTexture(0,this._cubeTexture)},e}(e.MaterialPassBase);e.SkyboxPass=p}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){this.useLightFallOff=!0}return t.prototype.reset=function(){this.texturesIndex=-1,this.vertexConstantsIndex=-1,this.fragmentConstantsIndex=-1,this.useMipmapping=!0,this.useSmoothTextures=!0,this.repeatTextures=!1,this.needsProjection=!1,this.needsView=!1,this.needsNormals=!1,this.needsTangents=!1,this.needsUV=!1,this.needsSecondaryUV=!1,this.needsGlobalVertexPos=!1,this.needsGlobalFragmentPos=!1,this.numLights=0,this.useLightFallOff=!0},t}();t.MethodVO=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t){this.method=t,this.data=t.iCreateMethodVO()}return t}();t.MethodVOSet=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=function(i){function n(){i.call(this)}return __extends(n,i),n.prototype.iInitVO=function(){},n.prototype.iInitConstants=function(){},Object.defineProperty(n.prototype,"iSharedRegisters",{get:function(){return this._sharedRegisters},set:function(t){this._sharedRegisters=t},enumerable:!0,configurable:!0}),n.prototype.setISharedRegisters=function(t){this._sharedRegisters=t},Object.defineProperty(n.prototype,"passes",{get:function(){return this._passes},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){},n.prototype.iCreateMethodVO=function(){return new e.MethodVO},n.prototype.iReset=function(){this.iCleanCompilationData()},n.prototype.iCleanCompilationData=function(){},n.prototype.iGetVertexCode=function(){return""},n.prototype.iActivate=function(){},n.prototype.iSetRenderState=function(){},n.prototype.iDeactivate=function(){},n.prototype.pGetTex2DSampleCode=function(t,e,i,n,r,s){"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=null);var a,o=s||(t.repeatTextures?"wrap":"clamp"),h=this.getFormatStringForTexture(n),p=t.useMipmapping&&n.hasMipmaps;return a=t.useSmoothTextures?p?"linear,miplinear":"linear":p?"nearest,mipnearest":"nearest",null==r&&(r=this._sharedRegisters.uvVarying),"tex "+e+", "+r+", "+i+" <2d,"+a+","+h+o+">\n"},n.prototype.pGetTexCubeSampleCode=function(t,e,i,n,r){var s,a=this.getFormatStringForTexture(n),o=t.useMipmapping&&n.hasMipmaps;return s=t.useSmoothTextures?o?"linear,miplinear":"linear":o?"nearest,mipnearest":"nearest","tex "+e+", "+r+", "+i+" <cube,"+a+s+">\n"},n.prototype.getFormatStringForTexture=function(e){switch(e.format){case t.stagegl.ContextGLTextureFormat.COMPRESSED:return"dxt1,";case"compressedAlpha":return"dxt5,";default:return""}},n.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new t.events.ShadingMethodEvent(t.events.ShadingMethodEvent.SHADER_INVALIDATED))},n.prototype.copyFrom=function(){},n}(t.library.NamedAssetBase);e.ShadingMethodBase=i}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.iGetFragmentPreLightingCode=function(){return""},e.prototype.iGetFragmentCodePerLight=function(){return""},e.prototype.iGetFragmentCodePerProbe=function(){return""},e.prototype.iGetFragmentPostLightingCode=function(){return""},e}(t.ShadingMethodBase);t.LightingMethodBase=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=function(e){function n(t){e.call(this),this._pEpsilon=.02,this._pAlpha=1,this._pCastingLight=t,t.castsShadows=!0,this._pShadowMapper=t.shadowMapper}return __extends(n,e),Object.defineProperty(n.prototype,"assetType",{get:function(){return t.library.AssetType.SHADOW_MAP_METHOD},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"alpha",{get:function(){return this._pAlpha},set:function(t){this._pAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"castingLight",{get:function(){return this._pCastingLight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"epsilon",{get:function(){return this._pEpsilon},set:function(t){this._pEpsilon=t},enumerable:!0,configurable:!0}),n.prototype.iGetFragmentCode=function(){throw new i},n}(e.ShadingMethodBase);e.ShadowMapMethodBase=n}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.utils.Delegate,n=t.events.ShadingMethodEvent,r=function(t){function r(){t.call(this),this._onShaderInvalidatedDelegate=i.create(this,this.onShaderInvalidated),this._iMethods=new Array,this._iNormalMethod=new e.NormalBasicMethod,this._iAmbientMethod=new e.AmbientBasicMethod,this._iDiffuseMethod=new e.DiffuseBasicMethod,this._iSpecularMethod=new e.SpecularBasicMethod,this._iNormalMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iDiffuseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iSpecularMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iAmbientMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iNormalMethodVO=this._iNormalMethod.iCreateMethodVO(),this._iAmbientMethodVO=this._iAmbientMethod.iCreateMethodVO(),this._iDiffuseMethodVO=this._iDiffuseMethod.iCreateMethodVO(),this._iSpecularMethodVO=this._iSpecularMethod.iCreateMethodVO()}return __extends(r,t),r.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},r.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new n(n.SHADER_INVALIDATED))},Object.defineProperty(r.prototype,"normalMethod",{get:function(){return this._iNormalMethod},set:function(t){this._iNormalMethod&&this._iNormalMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iNormalMethod=t,t&&(t.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iNormalMethodVO=t.iCreateMethodVO()),t&&this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ambientMethod",{get:function(){return this._iAmbientMethod},set:function(t){this._iAmbientMethod&&this._iAmbientMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iAmbientMethod=t,t&&(t.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iAmbientMethodVO=t.iCreateMethodVO()),t&&this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowMethod",{get:function(){return this._iShadowMethod},set:function(t){this._iShadowMethod&&this._iShadowMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iShadowMethod=t,t?(t.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iShadowMethodVO=t.iCreateMethodVO()):this._iShadowMethodVO=null,this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethod},set:function(t){this._iDiffuseMethod&&this._iDiffuseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iDiffuseMethod=t,t&&(t.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iDiffuseMethodVO=t.iCreateMethodVO()),t&&this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"specularMethod",{get:function(){return this._iSpecularMethod},set:function(t){this._iSpecularMethod&&this._iSpecularMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iSpecularMethod=t,t?(t.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iSpecularMethodVO=t.iCreateMethodVO()):this._iSpecularMethodVO=null,this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"iColorTransformMethod",{get:function(){return this._iColorTransformMethod},set:function(t){this._iColorTransformMethod!=t&&(this._iColorTransformMethod&&this._iColorTransformMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iColorTransformMethod&&t||this.iInvalidateShaderProgram(),this._iColorTransformMethod=t,this._iColorTransformMethod?(this._iColorTransformMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iColorTransformMethodVO=this._iColorTransformMethod.iCreateMethodVO()):this._iColorTransformMethodVO=null)},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this.clearListeners(this._iNormalMethod),this.clearListeners(this._iDiffuseMethod),this.clearListeners(this._iShadowMethod),this.clearListeners(this._iAmbientMethod),this.clearListeners(this._iSpecularMethod);for(var t=0;t<this._iMethods.length;++t)this.clearListeners(this._iMethods[t].method);this._iMethods=null},r.prototype.clearListeners=function(t){t&&t.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)},r.prototype.addMethod=function(t){this._iMethods.push(new e.MethodVOSet(t)),t.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram()},r.prototype.hasMethod=function(t){return null!=this.getMethodSetForMethod(t)},r.prototype.addMethodAt=function(t,i){this._iMethods.splice(i,0,new e.MethodVOSet(t)),t.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram()},r.prototype.getMethodAt=function(t){return t>this._iMethods.length-1?null:this._iMethods[t].method},Object.defineProperty(r.prototype,"numMethods",{get:function(){return this._iMethods.length},enumerable:!0,configurable:!0}),r.prototype.removeMethod=function(t){var e=this.getMethodSetForMethod(t);if(null!=e){var i=this._iMethods.indexOf(e);this._iMethods.splice(i,1),t.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram()}},r.prototype.getMethodSetForMethod=function(t){for(var e=this._iMethods.length,i=0;e>i;++i)if(this._iMethods[i].method==t)return this._iMethods[i];return null},r}(t.events.EventDispatcher);e.ShaderMethodSetup=r}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this),this._useTexture=!1,this._ambientColor=16777215,this._ambientR=0,this._ambientG=0,this._ambientB=0,this._ambient=1,this._iLightAmbientR=0,this._iLightAmbientG=0,this._iLightAmbientB=0}return __extends(i,e),i.prototype.iInitVO=function(t){t.needsUV=this._useTexture},i.prototype.iInitConstants=function(t){t.fragmentData[t.fragmentConstantsIndex+3]=1},Object.defineProperty(i.prototype,"ambient",{get:function(){return this._ambient},set:function(t){this._ambient=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(t){this._ambientColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){var e=null!=t;(e!=this._useTexture||t&&this._texture&&(t.hasMipmaps!=this._texture.hasMipmaps||t.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._useTexture=e,this._texture=t},enumerable:!0,configurable:!0}),i.prototype.copyFrom=function(t){var e=t,i=e,n=i;this.ambient=n.ambient,this.ambientColor=n.ambientColor},i.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pAmbientInputRegister=null},i.prototype.iGetFragmentCode=function(t,e,i){var n="";return this._useTexture?(this._pAmbientInputRegister=e.getFreeTextureReg(),t.texturesIndex=this._pAmbientInputRegister.index,n+=this.pGetTex2DSampleCode(t,i,this._pAmbientInputRegister,this._texture)+"div "+i+".xyz, "+i+".xyz, "+i+".w\n"):(this._pAmbientInputRegister=e.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*this._pAmbientInputRegister.index,n+="mov "+i+", "+this._pAmbientInputRegister+"\n"),n},i.prototype.iActivate=function(e,i){this._useTexture&&(i.context.setSamplerStateAt(e.texturesIndex,e.repeatTextures?t.stagegl.ContextGLWrapMode.REPEAT:t.stagegl.ContextGLWrapMode.CLAMP,e.useSmoothTextures?t.stagegl.ContextGLTextureFilter.LINEAR:t.stagegl.ContextGLTextureFilter.NEAREST,e.useMipmapping?t.stagegl.ContextGLMipFilter.MIPLINEAR:t.stagegl.ContextGLMipFilter.MIPNONE),i.context.activateTexture(e.texturesIndex,this._texture))},i.prototype.updateAmbient=function(){this._ambientR=(255&this._ambientColor>>16)/255*this._ambient*this._iLightAmbientR,this._ambientG=(255&this._ambientColor>>8)/255*this._ambient*this._iLightAmbientG,this._ambientB=(255&this.ambientColor)/255*this._ambient*this._iLightAmbientB},i.prototype.iSetRenderState=function(t){if(this.updateAmbient(),!this._useTexture){var e=t.fragmentConstantsIndex,i=t.fragmentData;i[e]=this._ambientR,i[e+1]=this._ambientG,i[e+2]=this._ambientB}},i}(e.ShadingMethodBase);e.AmbientBasicMethod=i}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this),this._cubeTexture=e}return __extends(e,t),e.prototype.iInitVO=function(e){t.prototype.iInitVO.call(this,e),e.needsNormals=!0},Object.defineProperty(e.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(t){this._cubeTexture=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i),i.context.activateCubeTexture(e.texturesIndex,this._cubeTexture)},e.prototype.iGetFragmentCode=function(t,e,i){var n="",r=e.getFreeTextureReg();return t.texturesIndex=r.index,n+=this.pGetTexCubeSampleCode(t,i,r,this._cubeTexture,this._sharedRegisters.normalFragment),this._pAmbientInputRegister=e.getFreeFragmentConstant(),t.fragmentConstantsIndex=this._pAmbientInputRegister.index,n+="add "+i+".xyz, "+i+".xyz, "+this._pAmbientInputRegister+".xyz\n"},e}(t.AmbientBasicMethod);t.AmbientEnvMapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLMipFilter,n=t.stagegl.ContextGLTextureFilter,r=t.stagegl.ContextGLWrapMode,s=function(t){function e(){t.call(this),this._diffuseColor=16777215,this._diffuseR=1,this._diffuseG=1,this._diffuseB=1,this._diffuseA=1,this._alphaThreshold=0}return __extends(e,t),Object.defineProperty(e.prototype,"iUseAmbientTexture",{get:function(){return this._useAmbientTexture},set:function(t){this._useAmbientTexture!=t&&(this._useAmbientTexture=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.iInitVO=function(t){t.needsUV=this._pUseTexture,t.needsNormals=t.numLights>0},e.prototype.generateMip=function(t){this._pUseTexture&&t.context.activateTexture(0,this._texture)},Object.defineProperty(e.prototype,"diffuseAlpha",{get:function(){return this._diffuseA},set:function(t){this._diffuseA=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(t){this._diffuseColor=t,this.updateDiffuse()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){var e=null!=t;(e!=this._pUseTexture||t&&this._texture&&(t.hasMipmaps!=this._texture.hasMipmaps||t.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=e,this._texture=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(t){0>t?t=0:t>1&&(t=1),t!=this._alphaThreshold&&((0==t||0==this._alphaThreshold)&&this.iInvalidateShaderProgram(),this._alphaThreshold=t)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._texture=null},e.prototype.copyFrom=function(t){var e=t;this.alphaThreshold=e.alphaThreshold,this.texture=e.texture,this.iUseAmbientTexture=e.iUseAmbientTexture,this.diffuseAlpha=e.diffuseAlpha,this.diffuseColor=e.diffuseColor},e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._pShadowRegister=null,this._pTotalLightColorReg=null,this._pDiffuseInputRegister=null},e.prototype.iGetFragmentPreLightingCode=function(t,e){var i="";return this._pIsFirstLight=!0,t.numLights>0&&(this._pTotalLightColorReg=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(this._pTotalLightColorReg,1)),i},e.prototype.iGetFragmentCodePerLight=function(t,e,i,n){var r,s="";return this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1)),s+="dp3 "+r+".x, "+e+", "+this._sharedRegisters.normalFragment+"\nmax "+r+".w, "+r+".x, "+this._sharedRegisters.commons+".y\n",t.useLightFallOff&&(s+="mul "+r+".w, "+r+".w, "+e+".w\n"),null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),s+="mul "+r+", "+r+".w, "+i+"\n",this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r+"\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},e.prototype.iGetFragmentCodePerProbe=function(t,e,i,n){var r,s="";return this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1)),s+="tex "+r+", "+this._sharedRegisters.normalFragment+", "+e+" <cube,linear,miplinear>\nmul "+r+".xyz, "+r+".xyz, "+i+"\n",null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r+"\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},e.prototype.iGetFragmentPostLightingCode=function(t,e,i){var n,r,s="";return t.numLights>0?(this._pShadowRegister&&(s+=this.pApplyShadow(t,e)),n=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(n,1)):n=i,this._pUseTexture?(this._pDiffuseInputRegister=e.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,s+=this.pGetTex2DSampleCode(t,n,this._pDiffuseInputRegister,this._texture),this._alphaThreshold>0&&(r=e.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*r.index,s+="sub "+n+".w, "+n+".w, "+r+".x\nkil "+n+".w\nadd "+n+".w, "+n+".w, "+r+".x\n")):(this._pDiffuseInputRegister=e.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*this._pDiffuseInputRegister.index,s+="mov "+n+", "+this._pDiffuseInputRegister+"\n"),0==t.numLights?s:(s+="sat "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+"\n",this._useAmbientTexture?s+="mul "+n+".xyz, "+n+", "+this._pTotalLightColorReg+"\nmul "+this._pTotalLightColorReg+".xyz, "+i+", "+this._pTotalLightColorReg+"\nsub "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\nadd "+i+".xyz, "+n+", "+i+"\n":(s+="add "+i+".xyz, "+this._pTotalLightColorReg+", "+i+"\n",s+=this._pUseTexture?"mul "+i+".xyz, "+n+", "+i+"\nmov "+i+".w, "+n+".w\n":"mul "+i+".xyz, "+this._pDiffuseInputRegister+", "+i+"\nmov "+i+".w, "+this._pDiffuseInputRegister+".w\n"),e.removeFragmentTempUsage(this._pTotalLightColorReg),e.removeFragmentTempUsage(n),s)},e.prototype.pApplyShadow=function(){return"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pShadowRegister+".w\n"},e.prototype.iActivate=function(t,e){if(this._pUseTexture)e.context.setSamplerStateAt(t.texturesIndex,t.repeatTextures?r.REPEAT:r.CLAMP,t.useSmoothTextures?n.LINEAR:n.NEAREST,t.useMipmapping?i.MIPLINEAR:i.MIPNONE),e.context.activateTexture(t.texturesIndex,this._texture),this._alphaThreshold>0&&(t.fragmentData[t.fragmentConstantsIndex]=this._alphaThreshold);else{var s=t.fragmentConstantsIndex,a=t.fragmentData;a[s]=this._diffuseR,a[s+1]=this._diffuseG,a[s+2]=this._diffuseB,a[s+3]=this._diffuseA}},e.prototype.updateDiffuse=function(){this._diffuseR=(255&this._diffuseColor>>16)/255,this._diffuseG=(255&this._diffuseColor>>8)/255,this._diffuseB=(255&this._diffuseColor)/255},Object.defineProperty(e.prototype,"iShadowRegister",{set:function(t){this._pShadowRegister=t},enumerable:!0,configurable:!0}),e.prototype.setIShadowRegister=function(t){this._pShadowRegister=t},e}(e.LightingMethodBase);e.DiffuseBasicMethod=s}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.utils.Delegate,n=t.events.ShadingMethodEvent,r=function(t){function r(r,s){"undefined"==typeof s&&(s=null),t.call(this),this._onShaderInvalidatedDelegate=i.create(this,this.onShaderInvalidated),this.pBaseMethod=s||new e.DiffuseBasicMethod,this.pBaseMethod._iModulateMethod=r,this.pBaseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return __extends(r,t),Object.defineProperty(r.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(t){this.pBaseMethod!=t&&(this.pBaseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod=t,this.pBaseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),r.prototype.iInitVO=function(t){this.pBaseMethod.iInitVO(t)},r.prototype.iInitConstants=function(t){this.pBaseMethod.iInitConstants(t)},r.prototype.dispose=function(){this.pBaseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod.dispose()},Object.defineProperty(r.prototype,"alphaThreshold",{get:function(){return this.pBaseMethod.alphaThreshold},set:function(t){this.pBaseMethod.alphaThreshold=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(t){this.pBaseMethod.texture=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"diffuseAlpha",{get:function(){return this.pBaseMethod.diffuseAlpha},set:function(t){this.pBaseMethod.diffuseAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"diffuseColor",{get:function(){return this.pBaseMethod.diffuseColor},set:function(t){this.pBaseMethod.diffuseColor=t},enumerable:!0,configurable:!0}),r.prototype.iGetFragmentPreLightingCode=function(t,e){return this.pBaseMethod.iGetFragmentPreLightingCode(t,e)},r.prototype.iGetFragmentCodePerLight=function(t,e,i,n){var r=this.pBaseMethod.iGetFragmentCodePerLight(t,e,i,n);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,r},r.prototype.iGetFragmentCodePerProbe=function(t,e,i,n){var r=this.pBaseMethod.iGetFragmentCodePerProbe(t,e,i,n);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,r},r.prototype.iActivate=function(t,e){this.pBaseMethod.iActivate(t,e)},r.prototype.iDeactivate=function(t,e){this.pBaseMethod.iDeactivate(t,e)},r.prototype.iGetVertexCode=function(t,e){return this.pBaseMethod.iGetVertexCode(t,e)},r.prototype.iGetFragmentPostLightingCode=function(t,e,i){return this.pBaseMethod.iGetFragmentPostLightingCode(t,e,i)},r.prototype.iReset=function(){this.pBaseMethod.iReset()},r.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this.pBaseMethod.iCleanCompilationData()},Object.defineProperty(r.prototype,"iSharedRegisters",{set:function(e){this.pBaseMethod.setISharedRegisters(e),t.prototype.setISharedRegisters.call(this,e)},enumerable:!0,configurable:!0}),r.prototype.setISharedRegisters=function(e){this.pBaseMethod.setISharedRegisters(e),t.prototype.setISharedRegisters.call(this,e)},Object.defineProperty(r.prototype,"iShadowRegister",{set:function(e){t.prototype.setIShadowRegister.call(this,e),this.pBaseMethod.setIShadowRegister(e)
},enumerable:!0,configurable:!0}),r.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},r}(e.DiffuseBasicMethod);e.DiffuseCompositeMethod=r}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=3),"undefined"==typeof i&&(i=null);var n=this;t.call(this,null,i),this._smoothness=.1,this.baseMethod._iModulateMethod=function(t,e,i,r){return n.clampDiffuse(t,e,i,r)},this._levels=e}return __extends(e,t),e.prototype.iInitConstants=function(e){var i=e.fragmentData,n=e.secondaryFragmentConstantsIndex;t.prototype.iInitConstants.call(this,e),i[n+1]=1,i[n+2]=0},Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},set:function(t){this._levels=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness=t},enumerable:!0,configurable:!0}),e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._dataReg=null},e.prototype.iGetFragmentPreLightingCode=function(e,i){return this._dataReg=i.getFreeFragmentConstant(),e.secondaryFragmentConstantsIndex=4*this._dataReg.index,t.prototype.iGetFragmentPreLightingCode.call(this,e,i)},e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i);var n=e.fragmentData,r=e.secondaryFragmentConstantsIndex;n[r]=this._levels,n[r+3]=this._smoothness},e.prototype.clampDiffuse=function(t,e){return"mul "+e+".w, "+e+".w, "+this._dataReg+".x\nfrc "+e+".z, "+e+".w\nsub "+e+".y, "+e+".w, "+e+".z\nmov "+e+".x, "+this._dataReg+".x\nsub "+e+".x, "+e+".x, "+this._dataReg+".y\nrcp "+e+".x,"+e+".x\nmul "+e+".w, "+e+".y, "+e+".x\nsub "+e+".y, "+e+".w, "+e+".x\ndiv "+e+".z, "+e+".z, "+this._dataReg+".w\nsat "+e+".z, "+e+".z\nmul "+e+".w, "+e+".w, "+e+".z\nsub "+e+".z, "+this._dataReg+".y, "+e+".z\nmul "+e+".y, "+e+".y, "+e+".z\nadd "+e+".w, "+e+".w, "+e+".y\nsat "+e+".w, "+e+".w\n"},e}(t.DiffuseCompositeMethod);t.DiffuseCelMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.iInitConstants=function(t){var e=t.fragmentData,i=t.fragmentConstantsIndex;e[i]=1,e[i+1]=1/255,e[i+2]=1/65025,e[i+3]=1/16581375},e.prototype.iGetFragmentPostLightingCode=function(t,e,i){var n,r,s="";if(!this._pUseTexture)throw new Error("DiffuseDepthMethod requires texture!");return t.numLights>0&&(this._pShadowRegister&&(s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+this._pShadowRegister+".w\n"),s+="add "+i+".xyz, "+this._pTotalLightColorReg+".xyz, "+i+".xyz\nsat "+i+".xyz, "+i+".xyz\n",e.removeFragmentTempUsage(this._pTotalLightColorReg)),n=t.numLights>0?e.getFreeFragmentVectorTemp():i,this._pDiffuseInputRegister=e.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,r=e.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*r.index,s+=this.pGetTex2DSampleCode(t,n,this._pDiffuseInputRegister,this.texture)+"dp4 "+n+".x, "+n+", "+r+"\nmov "+n+".yz, "+n+".xx			\nmov "+n+".w, "+r+".x\nsub "+n+".xyz, "+r+".xxx, "+n+".xyz\n",0==t.numLights?s:s+="mul "+i+".xyz, "+n+".xyz, "+i+".xyz\nmov "+i+".w, "+n+".w\n"},e}(t.DiffuseBasicMethod);t.DiffuseDepthMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this),this._gradient=e}return __extends(e,t),Object.defineProperty(e.prototype,"gradient",{get:function(){return this._gradient},set:function(t){(t.hasMipmaps!=this._gradient.hasMipmaps||t.format!=this._gradient.format)&&this.iInvalidateShaderProgram(),this._gradient=t},enumerable:!0,configurable:!0}),e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._gradientTextureRegister=null},e.prototype.iGetFragmentPreLightingCode=function(e,i){var n=t.prototype.iGetFragmentPreLightingCode.call(this,e,i);return this._pIsFirstLight=!0,e.numLights>0&&(this._gradientTextureRegister=i.getFreeTextureReg(),e.secondaryTexturesIndex=this._gradientTextureRegister.index),n},e.prototype.iGetFragmentCodePerLight=function(t,e,i,n){var r,s="";return this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1)),s+="dp3 "+r+".w, "+e+".xyz, "+this._sharedRegisters.normalFragment+".xyz\nmul "+r+".w, "+r+".w, "+this._sharedRegisters.commons+".x\nadd "+r+".w, "+r+".w, "+this._sharedRegisters.commons+".x\nmul "+r+".xyz, "+r+".w, "+e+".w\n",null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),s+=this.pGetTex2DSampleCode(t,r,this._gradientTextureRegister,this._gradient,r,"clamp")+"mul "+r+".xyz, "+r+".xyz, "+i+".xyz\n",this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+r+".xyz\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},e.prototype.pApplyShadow=function(t,e){var i=e.getFreeFragmentVectorTemp();return"mov "+i+", "+this._pShadowRegister+".wwww\n"+this.pGetTex2DSampleCode(t,i,this._gradientTextureRegister,this._gradient,i,"clamp")+"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+i+"\n"},e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i),i.context.activateTexture(e.secondaryTexturesIndex,this._gradient)},e}(t.DiffuseBasicMethod);t.DiffuseGradientMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r){"undefined"==typeof i&&(i="multiply"),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=null),t.call(this,null,r),this._useSecondaryUV=n,this._lightMapTexture=e,this.blendMode=i}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(t!=e.ADD&&t!=e.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=t&&(this._blendMode=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightMapTexture",{get:function(){return this._lightMapTexture},set:function(t){this._lightMapTexture=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(e,i){i.context.activateTexture(e.secondaryTexturesIndex,this._lightMapTexture),t.prototype.iActivate.call(this,e,i)},e.prototype.iGetFragmentPostLightingCode=function(i,n,r){var s,a=n.getFreeTextureReg(),o=n.getFreeFragmentVectorTemp();switch(i.secondaryTexturesIndex=a.index,s=this.pGetTex2DSampleCode(i,o,a,this._lightMapTexture,this._sharedRegisters.secondaryUVVarying),this._blendMode){case e.MULTIPLY:s+="mul "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+o+"\n";break;case e.ADD:s+="add "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+o+"\n"}return s+=t.prototype.iGetFragmentPostLightingCode.call(this,i,n,r)},e.MULTIPLY="multiply",e.ADD="add",e}(t.DiffuseCompositeMethod);t.DiffuseLightMapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n,r){"undefined"==typeof i&&(i=512),"undefined"==typeof n&&(n=15),"undefined"==typeof r&&(r=null);var s=this;e.call(this,null,r),this._translucency=1,this._scatterColor=16777215,this._scatterR=1,this._scatterG=1,this._scatterB=1,this.pBaseMethod._iModulateMethod=function(t,e,i,n){return s.scatterLight(t,e,i,n)},this._passes=new Array,this._depthPass=new t.SingleObjectDepthPass,this._depthPass.textureSize=i,this._depthPass.polyOffset=n,this._passes.push(this._depthPass),this._scattering=.2,this._translucency=1}return __extends(i,e),i.prototype.iInitConstants=function(t){e.prototype.iInitConstants.call(this,t);var i=t.vertexData,n=t.secondaryVertexConstantsIndex;i[n]=.5,i[n+1]=-.5,i[n+2]=0,i[n+3]=1,i=t.fragmentData,n=t.secondaryFragmentConstantsIndex,i[n+3]=1,i[n+4]=1,i[n+5]=1/255,i[n+6]=1/65025,i[n+7]=1/16581375,i[n+10]=.5,i[n+11]=-.1},i.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._lightProjVarying=null,this._propReg=null,this._lightColorReg=null,this._colorReg=null,this._decReg=null,this._targetReg=null},Object.defineProperty(i.prototype,"scattering",{get:function(){return this._scattering},set:function(t){this._scattering=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"translucency",{get:function(){return this._translucency},set:function(t){this._translucency=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scatterColor",{get:function(){return this._scatterColor},set:function(t){this._scatterColor=t,this._scatterR=(255&t>>16)/255,this._scatterG=(255&t>>8)/255,this._scatterB=(255&t)/255},enumerable:!0,configurable:!0}),i.prototype.iGetVertexCode=function(t,i){var n,r,s=e.prototype.iGetVertexCode.call(this,t,i),a=i.getFreeVertexVectorTemp();return r=i.getFreeVertexConstant(),t.secondaryVertexConstantsIndex=4*r.index,this._lightProjVarying=i.getFreeVarying(),n=i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant(),s+="m44 "+a+", vt0, "+n+"\ndiv "+a+".xyz, "+a+".xyz, "+a+".w\nmul "+a+".xy, "+a+".xy, "+r+".xy\nadd "+a+".xy, "+a+".xy, "+r+".xx\nmov "+this._lightProjVarying+".xyz, "+a+".xyz\nmov "+this._lightProjVarying+".w, va0.w\n"},i.prototype.iGetFragmentPreLightingCode=function(t,i){return this._colorReg=i.getFreeFragmentConstant(),this._decReg=i.getFreeFragmentConstant(),this._propReg=i.getFreeFragmentConstant(),t.secondaryFragmentConstantsIndex=4*this._colorReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i)},i.prototype.iGetFragmentCodePerLight=function(t,i,n,r){return this._pIsFirstLight=!0,this._lightColorReg=n,e.prototype.iGetFragmentCodePerLight.call(this,t,i,n,r)},i.prototype.iGetFragmentPostLightingCode=function(t,i,n){var r=e.prototype.iGetFragmentPostLightingCode.call(this,t,i,n),s=i.getFreeFragmentVectorTemp();return r+="mul "+s+".xyz, "+this._lightColorReg+".xyz, "+this._targetReg+".w\nmul "+s+".xyz, "+s+".xyz, "+this._colorReg+".xyz\nadd "+n+".xyz, "+n+".xyz, "+s+".xyz\n",this._targetReg!=this._sharedRegisters.viewDirFragment&&i.removeFragmentTempUsage(n),r},i.prototype.iActivate=function(t,i){e.prototype.iActivate.call(this,t,i);var n=t.secondaryFragmentConstantsIndex,r=t.fragmentData;r[n]=this._scatterR,r[n+1]=this._scatterG,r[n+2]=this._scatterB,r[n+8]=this._scattering,r[n+9]=this._translucency},i.prototype.setRenderState=function(t,e,i){i.context.activateTexture(t.secondaryTexturesIndex,this._depthPass._iGetDepthMap(e)),this._depthPass._iGetProjection(e).copyRawDataTo(t.vertexData,t.secondaryVertexConstantsIndex+4,!0)},i.prototype.scatterLight=function(t,e,i,n){if(!this._pIsFirstLight)return"";this._pIsFirstLight=!1;var r="",s=i.getFreeTextureReg();n.viewDirFragment?this._targetReg=n.viewDirFragment:(this._targetReg=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._targetReg,1)),t.secondaryTexturesIndex=s.index;var a=i.getFreeFragmentVectorTemp();return r+="tex "+a+", "+this._lightProjVarying+", "+s+" <2d,nearest,clamp>\ndp4 "+e+".z, "+a+", "+this._decReg+"\n",r+="sub "+e+".z, "+this._lightProjVarying+".z, "+e+".z\nsub "+e+".z, "+this._propReg+".x, "+e+".z\nmul "+e+".z, "+this._propReg+".y, "+e+".z\nsat "+e+".z, "+e+".z\nneg "+e+".y, "+e+".x\nmul "+e+".y, "+e+".y, "+this._propReg+".z\nadd "+e+".y, "+e+".y, "+this._propReg+".z\nmul "+this._targetReg+".w, "+e+".z, "+e+".y\nsub "+e+".y, "+this._colorReg+".w, "+this._targetReg+".w\nmul "+e+".w, "+e+".w, "+e+".y\n"},i}(t.DiffuseCompositeMethod);t.DiffuseSubSurfaceMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=.5),t.call(this),this.wrapFactor=e}return __extends(e,t),e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._wrapDataRegister=null},Object.defineProperty(e.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(t){this._wrapFactor=t,this._wrapFactor=1/(t+1)},enumerable:!0,configurable:!0}),e.prototype.iGetFragmentPreLightingCode=function(e,i){var n=t.prototype.iGetFragmentPreLightingCode.call(this,e,i);return this._pIsFirstLight=!0,this._wrapDataRegister=i.getFreeFragmentConstant(),e.secondaryFragmentConstantsIndex=4*this._wrapDataRegister.index,n},e.prototype.iGetFragmentCodePerLight=function(t,e,i,n){var r,s="";return this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1)),s+="dp3 "+r+".x, "+e+".xyz, "+this._sharedRegisters.normalFragment+".xyz\nadd "+r+".y, "+r+".x, "+this._wrapDataRegister+".x\nmul "+r+".y, "+r+".y, "+this._wrapDataRegister+".y\nsat "+r+".w, "+r+".y\nmul "+r+".xz, "+r+".w, "+e+".wz\n",null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),s+="mul "+r+", "+r+".x, "+i+"\n",this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+r+".xyz\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i);var n=e.secondaryFragmentConstantsIndex,r=e.fragmentData;r[n]=this._wrapFactor,r[n+1]=1/(this._wrapFactor+1)},e}(t.DiffuseBasicMethod);t.DiffuseWrapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),Object.defineProperty(i.prototype,"assetType",{get:function(){return t.library.AssetType.EFFECTS_METHOD},enumerable:!0,configurable:!0}),i.prototype.iGetFragmentCode=function(){throw new t.errors.AbstractMethodError},i}(e.ShadingMethodBase);e.EffectMethodBase=i}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof i&&(i=!1),t.call(this),this._texture=e,this._useSecondaryUV=i}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(e.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){this._useSecondaryUV!=t&&(this._useSecondaryUV=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(t,e){e.context.activateTexture(t.texturesIndex,this._texture)},e.prototype.iGetFragmentCode=function(t,e,i){var n=e.getFreeTextureReg(),r=e.getFreeFragmentVectorTemp(),s=this._useSecondaryUV?this._sharedRegisters.secondaryUVVarying:this._sharedRegisters.uvVarying;return t.texturesIndex=n.index,this.pGetTex2DSampleCode(t,r,n,this._texture,s)+"mul "+i+", "+i+", "+r+".x\n"},e}(t.EffectMethodBase);t.EffectAlphaMaskMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){if(t.call(this),20!=e.length)throw new Error("Matrix length must be 20!");this._matrix=e}return __extends(e,t),Object.defineProperty(e.prototype,"colorMatrix",{get:function(){return this._matrix},set:function(t){this._matrix=t},enumerable:!0,configurable:!0}),e.prototype.iGetFragmentCode=function(t,e,i){var n="",r=e.getFreeFragmentConstant();e.getFreeFragmentConstant(),e.getFreeFragmentConstant(),e.getFreeFragmentConstant();var s=e.getFreeFragmentConstant();t.fragmentConstantsIndex=4*r.index;var a=e.getFreeFragmentVectorTemp();return n+="m44 "+a+", "+i+", "+r+"\nadd "+i+", "+a+", "+s+"\n"},e.prototype.iActivate=function(t){var e=this._matrix,i=t.fragmentConstantsIndex,n=t.fragmentData;n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3],n[i+4]=e[5],n[i+5]=e[6],n[i+6]=e[7],n[i+7]=e[8],n[i+8]=e[10],n[i+9]=e[11],n[i+10]=e[12],n[i+11]=e[13],n[i+12]=e[15],n[i+13]=e[16],n[i+14]=e[17],n[i+15]=e[18],n[i+16]=e[4],n[i+17]=e[9],n[i+18]=e[14],n[i+19]=e[19]},e}(t.EffectMethodBase);t.EffectColorMatrixMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){this._colorTransform=t},enumerable:!0,configurable:!0}),e.prototype.iGetFragmentCode=function(t,e,i){var n="",r=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*r.index,n+="mul "+i+", "+i+", "+r+"\nadd "+i+", "+i+", "+s+"\n"},e.prototype.iActivate=function(t){var e=1/255,i=t.fragmentConstantsIndex,n=t.fragmentData;n[i]=this._colorTransform.redMultiplier,n[i+1]=this._colorTransform.greenMultiplier,n[i+2]=this._colorTransform.blueMultiplier,n[i+3]=this._colorTransform.alphaMultiplier,n[i+4]=this._colorTransform.redOffset*e,n[i+5]=this._colorTransform.greenOffset*e,n[i+6]=this._colorTransform.blueOffset*e,n[i+7]=this._colorTransform.alphaOffset*e},e}(t.EffectMethodBase);t.EffectColorTransformMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof i&&(i=1),t.call(this),this._cubeTexture=e,this._alpha=i}return __extends(e,t),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){(t!=this._mask||t&&this._mask&&(t.hasMipmaps!=this._mask.hasMipmaps||t.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=t},enumerable:!0,configurable:!0}),e.prototype.iInitVO=function(t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},Object.defineProperty(e.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(t){this._cubeTexture=t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(t,e){t.fragmentData[t.fragmentConstantsIndex]=this._alpha,e.context.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&e.context.activateTexture(t.texturesIndex+1,this._mask)},e.prototype.iGetFragmentCode=function(t,e,i){var n=e.getFreeFragmentConstant(),r=e.getFreeFragmentVectorTemp(),s="",a=e.getFreeTextureReg();t.texturesIndex=a.index,t.fragmentConstantsIndex=4*n.index,e.addFragmentTempUsages(r,1);var o=e.getFreeFragmentVectorTemp();return s+="dp3 "+r+".w, "+this._sharedRegisters.viewDirFragment+".xyz, "+this._sharedRegisters.normalFragment+".xyz\nadd "+r+".w, "+r+".w, "+r+".w\nmul "+r+".xyz, "+this._sharedRegisters.normalFragment+".xyz, "+r+".w\nsub "+r+".xyz, "+r+".xyz, "+this._sharedRegisters.viewDirFragment+".xyz\n"+this.pGetTexCubeSampleCode(t,r,a,this._cubeTexture,r)+"sub "+o+".w, "+r+".w, fc0.x\nkil "+o+".w\nsub "+r+", "+r+", "+i+"\n",this._mask&&(s+=this.pGetTex2DSampleCode(t,o,e.getFreeTextureReg(),this._mask,this._sharedRegisters.uvVarying)+"mul "+r+", "+o+", "+r+"\n"),s+="mul "+r+", "+r+", "+n+".x\nadd "+i+", "+i+", "+r+"\n",e.removeFragmentTempUsage(r),s},e}(t.EffectMethodBase);t.EffectEnvMapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof n&&(n=8421504),t.call(this),this._minDistance=0,this._maxDistance=1e3,this.minDistance=e,this.maxDistance=i,this.fogColor=n}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsProjection=!0},e.prototype.iInitConstants=function(t){var e=t.fragmentData,i=t.fragmentConstantsIndex;e[i+3]=1,e[i+6]=0,e[i+7]=0},Object.defineProperty(e.prototype,"minDistance",{get:function(){return this._minDistance},set:function(t){this._minDistance=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogColor",{get:function(){return this._fogColor},set:function(t){this._fogColor=t,this._fogR=(255&t>>16)/255,this._fogG=(255&t>>8)/255,this._fogB=(255&t)/255},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(t){var e=t.fragmentData,i=t.fragmentConstantsIndex;e[i]=this._fogR,e[i+1]=this._fogG,e[i+2]=this._fogB,e[i+4]=this._minDistance,e[i+5]=1/(this._maxDistance-this._minDistance)},e.prototype.iGetFragmentCode=function(t,e,i){var n=e.getFreeFragmentConstant(),r=e.getFreeFragmentConstant(),s=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(s,1);var a=e.getFreeFragmentVectorTemp(),o="";return t.fragmentConstantsIndex=4*n.index,o+="sub "+a+".w, "+this._sharedRegisters.projectionFragment+".z, "+r+".x\nmul "+a+".w, "+a+".w, "+r+".y\nsat "+a+".w, "+a+".w\nsub "+s+", "+n+", "+i+"\nmul "+s+", "+s+", "+a+".w\nadd "+i+", "+i+", "+s+"\n",e.removeFragmentTempUsage(s),o},e}(t.EffectMethodBase);t.EffectFogMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof i&&(i=1),t.call(this),this._fresnelPower=5,this._normalReflectance=0,this._cubeTexture=e,this._alpha=i}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},e.prototype.iInitConstants=function(t){t.fragmentData[t.fragmentConstantsIndex+3]=1},Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){(Boolean(t)!=Boolean(this._mask)||t&&this._mask&&(t.hasMipmaps!=this._mask.hasMipmaps||t.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(t){this._cubeTexture=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(t,e){var i=t.fragmentData,n=t.fragmentConstantsIndex;i[n]=this._alpha,i[n+1]=this._normalReflectance,i[n+2]=this._fresnelPower,e.context.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&e.context.activateTexture(t.texturesIndex+1,this._mask)},e.prototype.iGetFragmentCode=function(t,e,i){var n=e.getFreeFragmentConstant(),r=e.getFreeFragmentVectorTemp(),s="",a=e.getFreeTextureReg(),o=this._sharedRegisters.viewDirFragment,h=this._sharedRegisters.normalFragment;t.texturesIndex=a.index,t.fragmentConstantsIndex=4*n.index,e.addFragmentTempUsages(r,1);var p=e.getFreeFragmentVectorTemp();if(s+="dp3 "+r+".w, "+o+".xyz, "+h+".xyz\nadd "+r+".w, "+r+".w, "+r+".w\nmul "+r+".xyz, "+h+".xyz, "+r+".w\nsub "+r+".xyz, "+r+".xyz, "+o+".xyz\n"+this.pGetTexCubeSampleCode(t,r,a,this._cubeTexture,r)+"sub "+p+".w, "+r+".w, fc0.x\nkil "+p+".w\nsub "+r+", "+r+", "+i+"\n",s+="dp3 "+o+".w, "+o+".xyz, "+h+".xyz\nsub "+o+".w, "+n+".w, "+o+".w\npow "+o+".w, "+o+".w, "+n+".z\nsub "+h+".w, "+n+".w, "+o+".w\nmul "+h+".w, "+n+".y, "+h+".w\nadd "+o+".w, "+o+".w, "+h+".w\nmul "+o+".w, "+n+".x, "+o+".w\n",this._mask){var u=e.getFreeTextureReg();s+=this.pGetTex2DSampleCode(t,p,u,this._mask,this._sharedRegisters.uvVarying)+"mul "+o+".w, "+p+".x, "+o+".w\n"}return s+="mul "+r+", "+r+", "+o+".w\nadd "+i+", "+i+", "+r+"\n",e.removeFragmentTempUsage(r),s},e}(t.EffectMethodBase);t.EffectFresnelEnvMapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof i&&(i="multiply"),"undefined"==typeof n&&(n=!1),t.call(this),this._useSecondaryUV=n,this._texture=e,this.blendMode=i}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsUV=!this._useSecondaryUV,t.needsSecondaryUV=this._useSecondaryUV},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(t!=e.ADD&&t!=e.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=t&&(this._blendMode=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){(t.hasMipmaps!=this._texture.hasMipmaps||t.format!=this._texture.format)&&this.iInvalidateShaderProgram(),this._texture=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(e,i){i.context.activateTexture(e.texturesIndex,this._texture),t.prototype.iActivate.call(this,e,i)},e.prototype.iGetFragmentCode=function(t,i,n){var r,s=i.getFreeTextureReg(),a=i.getFreeFragmentVectorTemp();switch(t.texturesIndex=s.index,r=this.pGetTex2DSampleCode(t,a,s,this._texture,this._useSecondaryUV?this._sharedRegisters.secondaryUVVarying:this._sharedRegisters.uvVarying),this._blendMode){case e.MULTIPLY:r+="mul "+n+", "+n+", "+a+"\n";break;case e.ADD:r+="add "+n+", "+n+", "+a+"\n"}return r},e.MULTIPLY="multiply",e.ADD="add",e}(t.EffectMethodBase);t.EffectLightMapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r,s){"undefined"==typeof i&&(i=.1),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),t.call(this),this._dispersionR=0,this._dispersionG=0,this._dispersionB=0,this._alpha=1,this._envMap=e,this._dispersionR=n,this._dispersionG=r,this._dispersionB=s,this._useDispersion=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG),this._refractionIndex=i}return __extends(e,t),e.prototype.iInitConstants=function(t){var e=t.fragmentConstantsIndex,i=t.fragmentData;i[e+4]=1,i[e+5]=0,i[e+7]=1},e.prototype.iInitVO=function(t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(e.prototype,"envMap",{get:function(){return this._envMap},set:function(t){this._envMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(t){this._refractionIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(t){this._dispersionR=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=e&&(this.iInvalidateShaderProgram(),this._useDispersion=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(t){this._dispersionG=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=e&&(this.iInvalidateShaderProgram(),this._useDispersion=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(t){this._dispersionB=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=e&&(this.iInvalidateShaderProgram(),this._useDispersion=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(t,e){var i=t.fragmentConstantsIndex,n=t.fragmentData;n[i]=this._dispersionR+this._refractionIndex,this._useDispersion&&(n[i+1]=this._dispersionG+this._refractionIndex,n[i+2]=this._dispersionB+this._refractionIndex),n[i+3]=this._alpha,e.context.activateCubeTexture(t.texturesIndex,this._envMap)},e.prototype.iGetFragmentCode=function(t,e,i){var n,r,s,a=e.getFreeFragmentConstant(),o=e.getFreeFragmentConstant(),h="",p=e.getFreeTextureReg();t.texturesIndex=p.index,t.fragmentConstantsIndex=4*a.index,n=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(n,1),r=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(r,1),s=e.getFreeFragmentVectorTemp();var u=this._sharedRegisters.viewDirFragment,l=this._sharedRegisters.normalFragment;return h+="neg "+u+".xyz, "+u+".xyz\n",h+="dp3 "+s+".x, "+u+".xyz, "+l+".xyz\nmul "+s+".w, "+s+".x, "+s+".x\nsub "+s+".w, "+o+".x, "+s+".w\nmul "+s+".w, "+a+".x, "+s+".w\nmul "+s+".w, "+a+".x, "+s+".w\nsub "+s+".w, "+o+".x, "+s+".w\nsqt "+s+".y, "+s+".w\nmul "+s+".x, "+a+".x, "+s+".x\nadd "+s+".x, "+s+".x, "+s+".y\nmul "+s+".xyz, "+s+".x, "+l+".xyz\nmul "+n+", "+a+".x, "+u+"\nsub "+n+".xyz, "+n+".xyz, "+s+".xyz\nnrm "+n+".xyz, "+n+".xyz\n",h+=this.pGetTexCubeSampleCode(t,r,p,this._envMap,n)+"sub "+r+".w, "+r+".w, fc0.x	\nkil "+r+".w\n",this._useDispersion&&(h+="dp3 "+s+".x, "+u+".xyz, "+l+".xyz\nmul "+s+".w, "+s+".x, "+s+".x\nsub "+s+".w, "+o+".x, "+s+".w\nmul "+s+".w, "+a+".y, "+s+".w\nmul "+s+".w, "+a+".y, "+s+".w\nsub "+s+".w, "+o+".x, "+s+".w\nsqt "+s+".y, "+s+".w\nmul "+s+".x, "+a+".y, "+s+".x\nadd "+s+".x, "+s+".x, "+s+".y\nmul "+s+".xyz, "+s+".x, "+l+".xyz\nmul "+n+", "+a+".y, "+u+"\nsub "+n+".xyz, "+n+".xyz, "+s+".xyz\nnrm "+n+".xyz, "+n+".xyz\n",h+=this.pGetTexCubeSampleCode(t,s,p,this._envMap,n)+"mov "+r+".y, "+s+".y\n",h+="dp3 "+s+".x, "+u+".xyz, "+l+".xyz\nmul "+s+".w, "+s+".x, "+s+".x\nsub "+s+".w, "+o+".x, "+s+".w\nmul "+s+".w, "+a+".z, "+s+".w\nmul "+s+".w, "+a+".z, "+s+".w\nsub "+s+".w, "+o+".x, "+s+".w\nsqt "+s+".y, "+s+".w\nmul "+s+".x, "+a+".z, "+s+".x\nadd "+s+".x, "+s+".x, "+s+".y\nmul "+s+".xyz, "+s+".x, "+l+".xyz\nmul "+n+", "+a+".z, "+u+"\nsub "+n+".xyz, "+n+".xyz, "+s+".xyz\nnrm "+n+".xyz, "+n+".xyz\n",h+=this.pGetTexCubeSampleCode(t,s,p,this._envMap,n)+"mov "+r+".z, "+s+".z\n"),e.removeFragmentTempUsage(n),h+="sub "+r+".xyz, "+r+".xyz, "+i+".xyz\nmul "+r+".xyz, "+r+".xyz, "+a+".w\nadd "+i+".xyz, "+i+".xyz, "+r+".xyz\n",e.removeFragmentTempUsage(r),h+="neg "+u+".xyz, "+u+".xyz\n"},e}(t.EffectMethodBase);t.EffectRefractionEnvMapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r){"undefined"==typeof e&&(e=16777215),"undefined"==typeof i&&(i=.4),"undefined"==typeof n&&(n=2),"undefined"==typeof r&&(r="mix"),t.call(this),this._blendMode=r,this._strength=i,this._power=n,this.color=e}return __extends(e,t),e.prototype.iInitConstants=function(t){t.fragmentData[t.fragmentConstantsIndex+3]=1},e.prototype.iInitVO=function(t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this._blendMode!=t&&(this._blendMode=t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._colorR=(255&t>>16)/255,this._colorG=(255&t>>8)/255,this._colorB=(255&t)/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"power",{get:function(){return this._power},set:function(t){this._power=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(t){var e=t.fragmentConstantsIndex,i=t.fragmentData;i[e]=this._colorR,i[e+1]=this._colorG,i[e+2]=this._colorB,i[e+4]=this._strength,i[e+5]=this._power},e.prototype.iGetFragmentCode=function(t,i,n){var r=i.getFreeFragmentConstant(),s=i.getFreeFragmentConstant(),a=i.getFreeFragmentVectorTemp(),o="";return t.fragmentConstantsIndex=4*r.index,o+="dp3 "+a+".x, "+this._sharedRegisters.viewDirFragment+".xyz, "+this._sharedRegisters.normalFragment+".xyz\nsat "+a+".x, "+a+".x\nsub "+a+".x, "+r+".w, "+a+".x\npow "+a+".x, "+a+".x, "+s+".y\nmul "+a+".x, "+a+".x, "+s+".x\nsub "+a+".x, "+r+".w, "+a+".x\nmul "+n+".xyz, "+n+".xyz, "+a+".x\nsub "+a+".w, "+r+".w, "+a+".x\n",o+=this._blendMode==e.ADD?"mul "+a+".xyz, "+a+".w, "+r+".xyz\nadd "+n+".xyz, "+n+".xyz, "+a+".xyz\n":this._blendMode==e.MULTIPLY?"mul "+a+".xyz, "+a+".w, "+r+".xyz\nmul "+n+".xyz, "+n+".xyz, "+a+".xyz\n":"sub "+a+".xyz, "+r+".xyz, "+n+".xyz\nmul "+a+".xyz, "+a+".xyz, "+a+".w\nadd "+n+".xyz, "+n+".xyz, "+a+".xyz\n"},e.ADD="add",e.MULTIPLY="multiply",e.MIX="mix",e}(t.EffectMethodBase);t.EffectRimLightMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLMipFilter,n=t.stagegl.ContextGLTextureFilter,r=t.stagegl.ContextGLWrapMode,s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsUV=null==this._texture
},Object.defineProperty(e.prototype,"iTangentSpace",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iHasOutput",{get:function(){return this._useTexture},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(t){var e=t;null!=e.normalMap&&(this.normalMap=e.normalMap)},Object.defineProperty(e.prototype,"normalMap",{get:function(){return this._texture},set:function(t){var e=null!=t;(e!=this._useTexture||t&&this._texture&&(t.hasMipmaps!=this._texture.hasMipmaps||t.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._useTexture=e,this._texture=t},enumerable:!0,configurable:!0}),e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._pNormalTextureRegister=null},e.prototype.dispose=function(){this._texture&&(this._texture=null)},e.prototype.iActivate=function(t,e){t.texturesIndex>=0&&(e.context.setSamplerStateAt(t.texturesIndex,t.repeatTextures?r.REPEAT:r.CLAMP,t.useSmoothTextures?n.LINEAR:n.NEAREST,t.useMipmapping?i.MIPLINEAR:i.MIPNONE),e.context.activateTexture(t.texturesIndex,this._texture))},e.prototype.iGetFragmentCode=function(t,e,i){return this._pNormalTextureRegister=e.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,this.pGetTex2DSampleCode(t,i,this._pNormalTextureRegister,this._texture)+"sub "+i+".xyz, "+i+".xyz, "+this._sharedRegisters.commons+".xxx\nnrm "+i+".xyz, "+i+"\n"},e}(e.ShadingMethodBase);e.NormalBasicMethod=s}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n,r){t.call(this),this.normalMap=e,this._worldXYRatio=i/n,this._worldXZRatio=r/n}return __extends(e,t),e.prototype.iInitConstants=function(t){var e=t.fragmentConstantsIndex,i=t.fragmentData;i[e]=1/this.normalMap.width,i[e+1]=1/this.normalMap.height,i[e+2]=0,i[e+3]=1,i[e+4]=this._worldXYRatio,i[e+5]=this._worldXZRatio},Object.defineProperty(e.prototype,"tangentSpace",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this._worldXYRatio=e._worldXYRatio,this._worldXZRatio=e._worldXZRatio},e.prototype.iGetFragmentCode=function(t,e,i){var n=e.getFreeFragmentVectorTemp(),r=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant();return this._pNormalTextureRegister=e.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*r.index,this.pGetTex2DSampleCode(t,i,this._pNormalTextureRegister,this.normalMap,this._sharedRegisters.uvVarying,"clamp")+"add "+n+", "+this._sharedRegisters.uvVarying+", "+r+".xzzz\n"+this.pGetTex2DSampleCode(t,n,this._pNormalTextureRegister,this.normalMap,n,"clamp")+"sub "+i+".x, "+i+".x, "+n+".x\nadd "+n+", "+this._sharedRegisters.uvVarying+", "+r+".zyzz\n"+this.pGetTex2DSampleCode(t,n,this._pNormalTextureRegister,this.normalMap,n,"clamp")+"sub "+i+".z, "+i+".z, "+n+".x\nmov "+i+".y, "+r+".w\nmul "+i+".xz, "+i+".xz, "+s+".xy\nnrm "+i+".xyz, "+i+".xyz\n"},e}(t.NormalBasicMethod);t.NormalHeightMapMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){t.call(this),this._useSecondNormalMap=!1,this._water1OffsetX=0,this._water1OffsetY=0,this._water2OffsetX=0,this._water2OffsetY=0,this.normalMap=e,this.secondaryNormalMap=i}return __extends(e,t),e.prototype.iInitConstants=function(t){var e=t.fragmentConstantsIndex;t.fragmentData[e]=.5,t.fragmentData[e+1]=0,t.fragmentData[e+2]=0,t.fragmentData[e+3]=1},e.prototype.iInitVO=function(e){t.prototype.iInitVO.call(this,e),this._useSecondNormalMap=this.normalMap!=this.secondaryNormalMap},Object.defineProperty(e.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(t){this._water1OffsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(t){this._water1OffsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(t){this._water2OffsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(t){this._water2OffsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondaryNormalMap",{get:function(){return this._texture2},set:function(t){this._texture2=t},enumerable:!0,configurable:!0}),e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._normalTextureRegister2=null},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._texture2=null},e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i);var n=e.fragmentData,r=e.fragmentConstantsIndex;n[r+4]=this._water1OffsetX,n[r+5]=this._water1OffsetY,n[r+6]=this._water2OffsetX,n[r+7]=this._water2OffsetY,this._useSecondNormalMap&&i.context.activateTexture(e.texturesIndex+1,this._texture2)},e.prototype.iGetFragmentCode=function(t,e,i){var n=e.getFreeFragmentVectorTemp(),r=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant();return this._pNormalTextureRegister=e.getFreeTextureReg(),this._normalTextureRegister2=this._useSecondNormalMap?e.getFreeTextureReg():this._pNormalTextureRegister,t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*r.index,"add "+n+", "+this._sharedRegisters.uvVarying+", "+s+".xyxy\n"+this.pGetTex2DSampleCode(t,i,this._pNormalTextureRegister,this.normalMap,n)+"add "+n+", "+this._sharedRegisters.uvVarying+", "+s+".zwzw\n"+this.pGetTex2DSampleCode(t,n,this._normalTextureRegister2,this._texture2,n)+"add "+i+", "+i+", "+n+"		\nmul "+i+", "+i+", "+r+".x	\nsub "+i+".xyz, "+i+".xyz, "+this._sharedRegisters.commons+".xxx	\nnrm "+i+".xyz, "+i+".xyz							\n"},e}(t.NormalBasicMethod);t.NormalSimpleWaterMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.entities.PointLight,n=t.errors.AbstractMethodError,r=function(t){function e(e){this._pUsePoint=e instanceof i,t.call(this,e)}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsView=!0,t.needsGlobalVertexPos=!0,t.needsGlobalFragmentPos=this._pUsePoint,t.needsNormals=t.numLights>0},e.prototype.iInitConstants=function(t){var e=t.fragmentData,i=t.vertexData,n=t.fragmentConstantsIndex;e[n]=1,e[n+1]=1/255,e[n+2]=1/65025,e[n+3]=1/16581375,e[n+6]=0,e[n+7]=1,this._pUsePoint&&(e[n+8]=0,e[n+9]=0,e[n+10]=0,e[n+11]=1),n=t.vertexConstantsIndex,-1!=n&&(i[n]=.5,i[n+1]=.5,i[n+2]=0,i[n+3]=1)},Object.defineProperty(e.prototype,"_iDepthMapCoordReg",{get:function(){return this._pDepthMapCoordReg},set:function(t){this._pDepthMapCoordReg=t},enumerable:!0,configurable:!0}),e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._pDepthMapCoordReg=null},e.prototype.iGetVertexCode=function(t,e){return this._pUsePoint?this._pGetPointVertexCode(t,e):this.pGetPlanarVertexCode(t,e)},e.prototype._pGetPointVertexCode=function(t){return t.vertexConstantsIndex=-1,""},e.prototype.pGetPlanarVertexCode=function(t,e){var i="",n=e.getFreeVertexVectorTemp(),r=e.getFreeVertexConstant(),s=e.getFreeVertexConstant();return e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),this._pDepthMapCoordReg=e.getFreeVarying(),t.vertexConstantsIndex=4*r.index,i+="m44 "+n+", "+this._sharedRegisters.globalPositionVertex+", "+s+"\ndiv "+n+", "+n+", "+n+".w\nmul "+n+".xy, "+n+".xy, "+r+".xy\nadd "+this._pDepthMapCoordReg+", "+n+", "+r+".xxwz\n"},e.prototype.iGetFragmentCode=function(t,e,i){var n=this._pUsePoint?this._pGetPointFragmentCode(t,e,i):this._pGetPlanarFragmentCode(t,e,i);return n+="add "+i+".w, "+i+".w, fc"+(t.fragmentConstantsIndex/4+1)+".y\nsat "+i+".w, "+i+".w\n"},e.prototype._pGetPlanarFragmentCode=function(){throw new n},e.prototype._pGetPointFragmentCode=function(){throw new n},e.prototype.iSetRenderState=function(t){this._pUsePoint||this._pShadowMapper.iDepthProjection.copyRawDataTo(t.vertexData,t.vertexConstantsIndex+4,!0)},e.prototype._iGetCascadeFragmentCode=function(){throw new Error("This shadow method is incompatible with cascade shadows")},e.prototype.iActivate=function(t,e){var i=t.fragmentData,n=t.fragmentConstantsIndex;if(this._pUsePoint?i[n+4]=-Math.pow(1/(this._pCastingLight.fallOff*this._pEpsilon),2):t.vertexData[t.vertexConstantsIndex+3]=-1/(this._pShadowMapper.depth*this._pEpsilon),i[n+5]=1-this._pAlpha,this._pUsePoint){var r=this._pCastingLight.scenePosition;i[n+8]=r.x,i[n+9]=r.y,i[n+10]=r.z;var s=this._pCastingLight.fallOff;i[n+11]=1/(2*s*s)}this._pUsePoint||e.context.activateRenderTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap)},e.prototype.iActivateForCascade=function(){throw new Error("This shadow method is incompatible with cascade shadows")},e}(e.ShadowMapMethodBase);e.ShadowMethodBase=r}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.entities.DirectionalLight,n=t.events.Event,r=t.events.ShadingMethodEvent,s=function(t){function s(e){var s=this;if(t.call(this,e.castingLight),this._baseMethod=e,!(this._pCastingLight instanceof i))throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");if(this._cascadeShadowMapper=this._pCastingLight.shadowMapper,!this._cascadeShadowMapper)throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");this._cascadeShadowMapper.addEventListener(n.CHANGE,function(t){return s.onCascadeChange(t)}),this._baseMethod.addEventListener(r.SHADER_INVALIDATED,function(t){return s.onShaderInvalidated(t)})}return __extends(s,t),Object.defineProperty(s.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){var e=this;this._baseMethod!=t&&(this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,function(t){return e.onShaderInvalidated(t)}),this._baseMethod=t,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,function(t){return e.onShaderInvalidated(t)}),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),s.prototype.iInitVO=function(t){var i=new e.MethodVO;this._baseMethod.iInitVO(i),t.needsGlobalVertexPos=!0,t.needsProjection=!0},Object.defineProperty(s.prototype,"iSharedRegisters",{set:function(t){this.setISharedRegisters(t),this._baseMethod.iSharedRegisters=t},enumerable:!0,configurable:!0}),s.prototype.iInitConstants=function(t){var e=t.fragmentData,i=t.vertexData,n=t.fragmentConstantsIndex;e[n]=1,e[n+1]=1/255,e[n+2]=1/65025,e[n+3]=1/16581375,e[n+6]=.5,e[n+7]=-.5,n=t.vertexConstantsIndex,i[n]=.5,i[n+1]=-.5,i[n+2]=0},s.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._cascadeProjections=null,this._depthMapCoordVaryings=null},s.prototype.iGetVertexCode=function(t,e){var i="",n=e.getFreeVertexConstant();this.initProjectionsRegs(e),t.vertexConstantsIndex=4*n.index;for(var r=e.getFreeVertexVectorTemp(),s=0;s<this._cascadeShadowMapper.numCascades;++s)i+="m44 "+r+", "+this._sharedRegisters.globalPositionVertex+", "+this._cascadeProjections[s]+"\nadd "+this._depthMapCoordVaryings[s]+", "+r+", "+n+".zzwz\n";return i},s.prototype.initProjectionsRegs=function(t){this._cascadeProjections=new Array(this._cascadeShadowMapper.numCascades),this._depthMapCoordVaryings=new Array(this._cascadeShadowMapper.numCascades);for(var e=0;e<this._cascadeShadowMapper.numCascades;++e)this._depthMapCoordVaryings[e]=t.getFreeVarying(),this._cascadeProjections[e]=t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant()},s.prototype.iGetFragmentCode=function(t,e,i){var n,r=this._cascadeShadowMapper.numCascades,s=e.getFreeTextureReg(),a=e.getFreeFragmentConstant(),o=e.getFreeFragmentConstant(),h=e.getFreeFragmentConstant(),p=Array(h+".x",h+".y",h+".z",h+".w");t.fragmentConstantsIndex=4*a.index,t.texturesIndex=s.index;var u=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(u,1);var l=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(l,1),n="mov "+l+", "+this._depthMapCoordVaryings[r-1]+"\n";for(var c=r-2;c>=0;--c){var d=this._depthMapCoordVaryings[c];n+="slt "+u+".z, "+this._sharedRegisters.projectionFragment+".z, "+p[c]+"\n";var _=e.getFreeFragmentVectorTemp();n+="sub "+_+", "+d+", "+l+"\nmul "+_+", "+_+", "+u+".z\nadd "+l+", "+l+", "+_+"\n"}return e.removeFragmentTempUsage(u),n+="div "+l+", "+l+", "+l+".w\nmul "+l+".xy, "+l+".xy, "+o+".zw\nadd "+l+".xy, "+l+".xy, "+o+".zz\n",n+=this._baseMethod._iGetCascadeFragmentCode(t,e,a,s,l,i)+"add "+i+".w, "+i+".w, "+o+".y\n",e.removeFragmentTempUsage(l),n},s.prototype.iActivate=function(t,e){e.context.activateTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap);var i=t.vertexData,n=t.vertexConstantsIndex;t.vertexData[t.vertexConstantsIndex+3]=-1/(this._cascadeShadowMapper.depth*this._pEpsilon);var r=this._cascadeShadowMapper.numCascades;n+=4;for(var s=0;r>s;++s)this._cascadeShadowMapper.getDepthProjections(s).copyRawDataTo(i,n,!0),n+=16;var a=t.fragmentData,o=t.fragmentConstantsIndex;a[o+5]=1-this._pAlpha;var h=this._cascadeShadowMapper._iNearPlaneDistances;o+=8;for(var p=0;r>p;++p)a[o+p]=h[p];this._baseMethod.iActivateForCascade(t,e)},s.prototype.iSetRenderState=function(){},s.prototype.onCascadeChange=function(){this.iInvalidateShaderProgram()},s.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},s}(e.ShadowMapMethodBase);e.ShadowCascadeMethod=s}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.base.BitmapData,n=t.textures.BitmapTexture,r=function(t){function e(i,n,r){"undefined"==typeof n&&(n=4),"undefined"==typeof r&&(r=1),t.call(this,i),this._depthMapSize=this._pCastingLight.shadowMapper.depthMapSize,this.numSamples=n,this.range=r,++e._grainUsages,e._grainTexture||this.initGrainTexture()}return __extends(e,t),Object.defineProperty(e.prototype,"numSamples",{get:function(){return this._numSamples},set:function(t){this._numSamples=t,this._numSamples<1?this._numSamples=1:this._numSamples>24&&(this._numSamples=24),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),e.prototype.iInitVO=function(e){t.prototype.iInitVO.call(this,e),e.needsProjection=!0},e.prototype.iInitConstants=function(e){t.prototype.iInitConstants.call(this,e);var i=e.fragmentData,n=e.fragmentConstantsIndex;i[n+8]=1/this._numSamples},Object.defineProperty(e.prototype,"range",{get:function(){return 2*this._range},set:function(t){this._range=t/2},enumerable:!0,configurable:!0}),e.prototype.initGrainTexture=function(){e._grainBitmapData=new i(64,64,!1);for(var t,r,s=new Array,a=4096,o=1/(this._depthMapSize*this._range),h=0;a>h;++h)t=2*(Math.random()-.5),r=2*(Math.random()-.5),0>t?t-=o:t+=o,0>r?r-=o:r+=o,t>1?t=1:-1>t&&(t=-1),r>1?r=1:-1>r&&(r=-1),s[h]=Math.floor(255*(.5*t+.5))<<16|Math.floor(255*(.5*r+.5))<<8;e._grainBitmapData.setVector(e._grainBitmapData.rect,s),e._grainTexture=new n(e._grainBitmapData)},e.prototype.dispose=function(){0==--e._grainUsages&&(e._grainTexture.dispose(),e._grainBitmapData.dispose(),e._grainTexture=null)},e.prototype.iActivate=function(i,n){t.prototype.iActivate.call(this,i,n);var r=i.fragmentData,s=i.fragmentConstantsIndex;r[s+9]=(n.width-1)/63,r[s+10]=(n.height-1)/63,r[s+11]=2*this._range/this._depthMapSize,n.context.activateTexture(i.texturesIndex+1,e._grainTexture)},e.prototype._pGetPlanarFragmentCode=function(t,e,i){var n=e.getFreeTextureReg(),r=e.getFreeFragmentConstant();e.getFreeFragmentConstant();var s=e.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*r.index,t.texturesIndex=n.index,this.getSampleCode(e,s,n,r,i)},e.prototype.getSampleCode=function(t,e,i,n,r){var s="",a=t.getFreeTextureReg(),o=t.getFreeFragmentVectorTemp(),h=this._numSamples;t.addFragmentTempUsages(o,1);var p=t.getFreeFragmentVectorTemp(),u=this._sharedRegisters.projectionFragment;for(s+="div "+o+", "+u+", "+u+".w\nmul "+o+".xy, "+o+".xy, "+e+".yz\n";h>0;)s+=h==this._numSamples?"tex "+o+", "+o+", "+a+" <2d,nearest,repeat,mipnone>\n":"tex "+o+", "+o+".zwxy, "+a+" <2d,nearest,repeat,mipnone>\n",s+="sub "+o+".zw, "+o+".xy, fc0.xx\nmul "+o+".zw, "+o+".zw, "+e+".w\n",s+=h==this._numSamples?"add "+o+".xy, "+o+".zw, "+this._pDepthMapCoordReg+".xy\ntex "+p+", "+o+", "+i+" <2d,nearest,clamp,mipnone>\ndp4 "+p+".z, "+p+", "+n+"\nslt "+r+".w, "+this._pDepthMapCoordReg+".z, "+p+".z\n":this.addSample(o,i,n,r,t),h>4&&(s+="add "+o+".xy, "+o+".xy, "+o+".zw\n"+this.addSample(o,i,n,r,t)),h>1&&(s+="sub "+o+".xy, "+this._pDepthMapCoordReg+".xy, "+o+".zw\n"+this.addSample(o,i,n,r,t)),h>5&&(s+="sub "+o+".xy, "+o+".xy, "+o+".zw\n"+this.addSample(o,i,n,r,t)),h>2&&(s+="neg "+o+".w, "+o+".w\n",s+="add "+o+".xy, "+o+".wz, "+this._pDepthMapCoordReg+".xy\n"+this.addSample(o,i,n,r,t)),h>6&&(s+="add "+o+".xy, "+o+".xy, "+o+".wz\n"+this.addSample(o,i,n,r,t)),h>3&&(s+="sub "+o+".xy, "+this._pDepthMapCoordReg+".xy, "+o+".wz\n"+this.addSample(o,i,n,r,t)),h>7&&(s+="sub "+o+".xy, "+o+".xy, "+o+".wz\n"+this.addSample(o,i,n,r,t)),h-=8;return t.removeFragmentTempUsage(o),s+="mul "+r+".w, "+r+".w, "+e+".x\n"},e.prototype.addSample=function(t,e,i,n,r){var s=r.getFreeFragmentVectorTemp();return"tex "+s+", "+t+", "+e+" <2d,nearest,clamp,mipnone>\ndp4 "+s+".z, "+s+", "+i+"\nslt "+s+".z, "+this._pDepthMapCoordReg+".z, "+s+".z\nadd "+n+".w, "+n+".w, "+s+".z\n"},e.prototype.iActivateForCascade=function(t,i){var n=t.fragmentData,r=t.secondaryFragmentConstantsIndex;n[r]=1/this._numSamples,n[r+1]=(i.width-1)/63,n[r+2]=(i.height-1)/63,n[r+3]=2*this._range/this._depthMapSize,i.context.activateTexture(t.texturesIndex+1,e._grainTexture)},e.prototype._iGetCascadeFragmentCode=function(t,e,i,n,r,s){this._pDepthMapCoordReg=r;var a=e.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*a.index,this.getSampleCode(e,a,n,i,s)},e}(e.ShadowMethodBase);e.ShadowDitheredMethod=r}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype.iInitConstants=function(e){t.prototype.iInitConstants.call(this,e);var i=e.fragmentData,n=e.fragmentConstantsIndex;i[n+8]=.5;var r=this.castingLight.shadowMapper.depthMapSize;i[n+9]=r,i[n+10]=1/r},e.prototype._pGetPlanarFragmentCode=function(t,e,i){var n=e.getFreeTextureReg(),r=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant();s=s;var a,o=e.getFreeFragmentConstant(),h=e.getFreeFragmentVectorTemp(),p="";return t.fragmentConstantsIndex=4*r.index,e.addFragmentTempUsages(h,1),a=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(a,1),p+="mov "+a+", "+this._pDepthMapCoordReg+"\ntex "+h+", "+this._pDepthMapCoordReg+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+r+"\nslt "+a+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\nadd "+a+".x, "+this._pDepthMapCoordReg+".x, "+o+".z\ntex "+h+", "+a+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+r+"\nslt "+a+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\nmul "+h+".x, "+this._pDepthMapCoordReg+".x, "+o+".y\nfrc "+h+".x, "+h+".x\nsub "+a+".w, "+a+".w, "+a+".z\nmul "+a+".w, "+a+".w, "+h+".x\nadd "+i+".w, "+a+".z, "+a+".w\nmov "+a+".x, "+this._pDepthMapCoordReg+".x\nadd "+a+".y, "+this._pDepthMapCoordReg+".y, "+o+".z\ntex "+h+", "+a+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+r+"\nslt "+a+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\nadd "+a+".x, "+this._pDepthMapCoordReg+".x, "+o+".z\ntex "+h+", "+a+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+r+"\nslt "+a+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\nmul "+h+".x, "+this._pDepthMapCoordReg+".x, "+o+".y\nfrc "+h+".x, "+h+".x\nsub "+a+".w, "+a+".w, "+a+".z\nmul "+a+".w, "+a+".w, "+h+".x\nadd "+a+".w, "+a+".z, "+a+".w\nmul "+h+".x, "+this._pDepthMapCoordReg+".y, "+o+".y\nfrc "+h+".x, "+h+".x\nsub "+a+".w, "+a+".w, "+i+".w\nmul "+a+".w, "+a+".w, "+h+".x\nadd "+i+".w, "+i+".w, "+a+".w\n",e.removeFragmentTempUsage(h),e.removeFragmentTempUsage(a),t.texturesIndex=n.index,p},e.prototype.iActivateForCascade=function(t){var e=this.castingLight.shadowMapper.depthMapSize,i=t.secondaryFragmentConstantsIndex,n=t.fragmentData;n[i]=e,n[i+1]=1/e},e.prototype._iGetCascadeFragmentCode=function(t,e,i,n,r,s){var a,o=e.getFreeFragmentConstant();t.secondaryFragmentConstantsIndex=4*o.index;var h=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(h,1);var p=e.getFreeFragmentVectorTemp();return e.addFragmentTempUsages(p,1),a="tex "+h+", "+r+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".x, "+r+".z, "+h+".z\nadd "+r+".x, "+r+".x, "+o+".y\ntex "+h+", "+r+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".z, "+r+".z, "+h+".z\nadd "+r+".y, "+r+".y, "+o+".y\ntex "+h+", "+r+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".w, "+r+".z, "+h+".z\nsub "+r+".x, "+r+".x, "+o+".y\ntex "+h+", "+r+", "+n+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".y, "+r+".z, "+h+".z\nmul "+h+".xy, "+r+".xy, "+o+".x\nfrc "+h+".xy, "+h+".xy\nsub "+r+", "+p+".xyzw, "+p+".zwxy\nmul "+r+", "+r+", "+h+".x\nadd "+p+".xy, "+p+".xy, "+r+".zw\nsub "+p+".y, "+p+".y, "+p+".x\nmul "+p+".y, "+p+".y, "+h+".y\nadd "+s+".w, "+p+".x, "+p+".y\n",e.removeFragmentTempUsage(h),e.removeFragmentTempUsage(p),a},e}(t.ShadowMethodBase);t.ShadowFilteredMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype._pGetPlanarFragmentCode=function(t,e,i){var n=e.getFreeTextureReg(),r=e.getFreeFragmentConstant();e.getFreeFragmentConstant();var s=e.getFreeFragmentVectorTemp(),a="";return t.fragmentConstantsIndex=4*r.index,t.texturesIndex=n.index,a+="tex "+s+", "+this._pDepthMapCoordReg+", "+n+" <2d, nearest, clamp>\ndp4 "+s+".z, "+s+", "+r+"\nslt "+i+".w, "+this._pDepthMapCoordReg+".z, "+s+".z\n"},e.prototype._pGetPointFragmentCode=function(t,e,i){var n=e.getFreeTextureReg(),r=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant(),a=e.getFreeFragmentConstant(),o=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(o,1);var h=e.getFreeFragmentVectorTemp(),p="";return t.fragmentConstantsIndex=4*r.index,t.texturesIndex=n.index,p+="sub "+h+", "+this._sharedRegisters.globalPositionVarying+", "+a+"\ndp3 "+h+".w, "+h+".xyz, "+h+".xyz\nmul "+h+".w, "+h+".w, "+a+".w\nnrm "+h+".xyz, "+h+".xyz\ntex "+o+", "+h+", "+n+" <cube, nearest, clamp>\ndp4 "+o+".z, "+o+", "+r+"\nadd "+i+".w, "+h+".w, "+s+".x\nslt "+i+".w, "+i+".w, "+o+".z\n",e.removeFragmentTempUsage(o),p},e.prototype._iGetCascadeFragmentCode=function(t,e,i,n,r,s){var a=e.getFreeFragmentVectorTemp();return"tex "+a+", "+r+", "+n+" <2d, nearest, clamp>\ndp4 "+a+".z, "+a+", "+i+"\nslt "+s+".w, "+r+".z, "+a+".z\n"},e.prototype.iActivateForCascade=function(){},e}(t.ShadowMethodBase);t.ShadowHardMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.events.ShadingMethodEvent,n=function(t){function e(e,n){"undefined"==typeof n&&(n=.1);var r=this;if(t.call(this,e.castingLight),this._onShaderInvalidatedDelegate=function(t){return r.onShaderInvalidated(t)},this._baseMethod=e,this._fadeRatio=n,this._nearShadowMapper=this._pCastingLight.shadowMapper,!this._nearShadowMapper)throw new Error("ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.");this._baseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return __extends(e,t),Object.defineProperty(e.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){this._baseMethod!=t&&(this._baseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=t,this._baseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.iInitConstants=function(e){t.prototype.iInitConstants.call(this,e),this._baseMethod.iInitConstants(e);var i=e.fragmentData,n=e.secondaryFragmentConstantsIndex;i[n+2]=0,i[n+3]=1},e.prototype.iInitVO=function(t){this._baseMethod.iInitVO(t),t.needsProjection=!0},e.prototype.dispose=function(){this._baseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)},Object.defineProperty(e.prototype,"alpha",{get:function(){return this._baseMethod.alpha},set:function(t){this._baseMethod.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"epsilon",{get:function(){return this._baseMethod.epsilon},set:function(t){this._baseMethod.epsilon=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(t){this._fadeRatio=t},enumerable:!0,configurable:!0}),e.prototype.iGetFragmentCode=function(t,e,i){var n=this._baseMethod.iGetFragmentCode(t,e,i),r=e.getFreeFragmentConstant(),s=e.getFreeFragmentSingleTemp();return t.secondaryFragmentConstantsIndex=4*r.index,n+="abs "+s+", "+this._sharedRegisters.projectionFragment+".w\nsub "+s+", "+s+", "+r+".x\nmul "+s+", "+s+", "+r+".y\nsat "+s+", "+s+"\nsub "+s+", "+r+".w,"+s+"\nsub "+i+".w, "+r+".w,"+i+".w\nmul "+i+".w, "+i+".w, "+s+"\nsub "+i+".w, "+r+".w,"+i+".w\n"},e.prototype.iActivate=function(t,e){this._baseMethod.iActivate(t,e)},e.prototype.iDeactivate=function(t,e){this._baseMethod.iDeactivate(t,e)},e.prototype.iSetRenderState=function(t,e,i,n){var r=n.projection.near,s=n.projection.far-r,a=this._nearShadowMapper.coverageRatio,o=a*(1-this._fadeRatio);a=r+a*s,o=r+o*s;var h=t.fragmentData,p=t.secondaryFragmentConstantsIndex;h[p]=o,h[p+1]=1/(a-o),this._baseMethod.iSetRenderState(t,e,i,n)},e.prototype.iGetVertexCode=function(t,e){return this._baseMethod.iGetVertexCode(t,e)},e.prototype.iReset=function(){this._baseMethod.iReset()},e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},Object.defineProperty(e.prototype,"iSharedRegisters",{set:function(t){this._sharedRegisters=this._baseMethod.iSharedRegisters=t},enumerable:!0,configurable:!0}),e.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},e}(e.ShadowMethodBase);e.ShadowNearMethod=n}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i,n){"undefined"==typeof i&&(i=5),"undefined"==typeof n&&(n=1),e.call(this,t),this._range=1,this.numSamples=i,this.range=n}return __extends(i,e),Object.defineProperty(i.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e,this._numSamples<1?this._numSamples=1:this._numSamples>32&&(this._numSamples=32),this._offsets=t.geom.PoissonLookup.getDistribution(this._numSamples),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t},enumerable:!0,configurable:!0}),i.prototype.iInitConstants=function(t){e.prototype.iInitConstants.call(this,t),t.fragmentData[t.fragmentConstantsIndex+8]=1/this._numSamples,t.fragmentData[t.fragmentConstantsIndex+9]=0},i.prototype.iActivate=function(t,i){e.prototype.iActivate.call(this,t,i);for(var n=.5*this._range/this._pCastingLight.shadowMapper.depthMapSize,r=t.fragmentData,s=t.fragmentConstantsIndex+10,a=this._numSamples<<1,o=0;a>o;++o)r[s+o]=this._offsets[o]*n},i.prototype._pGetPlanarFragmentCode=function(t,e,i){var n=e.getFreeTextureReg(),r=e.getFreeFragmentConstant();e.getFreeFragmentConstant();var s=e.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*r.index,t.texturesIndex=n.index,this.getSampleCode(e,n,r,i,s)},i.prototype.addSample=function(t,e,i,n,r){var s=r.getFreeFragmentVectorTemp();return"tex "+s+", "+t+", "+e+" <2d,nearest,clamp>\ndp4 "+s+".z, "+s+", "+i+"\nslt "+t+".w, "+this._pDepthMapCoordReg+".z, "+s+".z\nadd "+n+".w, "+n+".w, "+t+".w\n"},i.prototype.iActivateForCascade=function(t,i){e.prototype.iActivate.call(this,t,i);var n=this._range/this._pCastingLight.shadowMapper.depthMapSize,r=t.fragmentData,s=t.secondaryFragmentConstantsIndex,a=this._numSamples<<1;r[s]=1/this._numSamples,r[s+1]=0,s+=2;for(var o=0;a>o;++o)r[s+o]=this._offsets[o]*n;0==a%4&&(r[s+a]=0,r[s+a+1]=0)},i.prototype._iGetCascadeFragmentCode=function(t,e,i,n,r,s){this._pDepthMapCoordReg=r;var a=e.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*a.index,this.getSampleCode(e,n,i,s,a)},i.prototype.getSampleCode=function(t,e,i,n,r){var s,a,o=new Array(r+".zw");s=t.getFreeFragmentVectorTemp(),t.addFragmentTempUsages(s,1);for(var h=t.getFreeFragmentVectorTemp(),p=this._numSamples>>1,u=0;p>u;++u){var l=t.getFreeFragmentConstant();o.push(l+".xy"),o.push(l+".zw")}for(u=0;u<this._numSamples;++u)0==u?(a="add "+s+", "+this._pDepthMapCoordReg+", "+r+".zwyy\n",a+="tex "+h+", "+s+", "+e+" <2d,nearest,clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+n+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"):(a+="add "+s+".xy, "+this._pDepthMapCoordReg+".xy, "+o[u]+"\n",a+=this.addSample(s,e,i,n,t));return t.removeFragmentTempUsage(s),a+="mul "+n+".w, "+n+".w, "+r+".x\n"},i}(e.ShadowMethodBase);e.ShadowSoftMethod=i}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this),this._gloss=50,this._specular=1,this._specularColor=16777215,this._iSpecularR=1,this._iSpecularG=1,this._iSpecularB=1}return __extends(i,e),i.prototype.iInitVO=function(t){t.needsUV=this._pUseTexture,t.needsNormals=t.numLights>0,t.needsView=t.numLights>0},Object.defineProperty(i.prototype,"gloss",{get:function(){return this._gloss},set:function(t){this._gloss=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"specular",{get:function(){return this._specular},set:function(t){t!=this._specular&&(this._specular=t,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"specularColor",{get:function(){return this._specularColor},set:function(t){this._specularColor!=t&&((0==this._specularColor||0==t)&&this.iInvalidateShaderProgram(),this._specularColor=t,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){var e=null!=t;(e!=this._pUseTexture||t&&this._texture&&(t.hasMipmaps!=this._texture.hasMipmaps||t.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=e,this._texture=t},enumerable:!0,configurable:!0}),i.prototype.copyFrom=function(t){var e=t,i=e;this.texture=i.texture,this.specular=i.specular,this.specularColor=i.specularColor,this.gloss=i.gloss},i.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._shadowRegister=null,this._pTotalLightColorReg=null,this._pSpecularTextureRegister=null,this._pSpecularTexData=null,this._pSpecularDataRegister=null},i.prototype.iGetFragmentPreLightingCode=function(t,e){var i="";return this._pIsFirstLight=!0,t.numLights>0&&(this._pSpecularDataRegister=e.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*this._pSpecularDataRegister.index,this._pUseTexture?(this._pSpecularTexData=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(this._pSpecularTexData,1),this._pSpecularTextureRegister=e.getFreeTextureReg(),t.texturesIndex=this._pSpecularTextureRegister.index,i=this.pGetTex2DSampleCode(t,this._pSpecularTexData,this._pSpecularTextureRegister,this._texture)):this._pSpecularTextureRegister=null,this._pTotalLightColorReg=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(this._pTotalLightColorReg,1)),i},i.prototype.iGetFragmentCodePerLight=function(t,e,i,n){var r,s="";this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1));var a=this._sharedRegisters.viewDirFragment,o=this._sharedRegisters.normalFragment;return s+="add "+r+", "+e+", "+a+"\nnrm "+r+".xyz, "+r+"\ndp3 "+r+".w, "+o+", "+r+"\nsat "+r+".w, "+r+".w\n",s+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+r+".w, "+r+".w, "+this._pSpecularTexData+".w\n":"pow "+r+".w, "+r+".w, "+this._pSpecularDataRegister+".w\n",t.useLightFallOff&&(s+="mul "+r+".w, "+r+".w, "+e+".w\n"),null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),s+="mul "+r+".xyz, "+i+", "+r+".w\n",this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r+"\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},i.prototype.iGetFragmentCodePerProbe=function(t,e,i,n){var r,s="";this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1));var a=this._sharedRegisters.normalFragment,o=this._sharedRegisters.viewDirFragment;
return s+="dp3 "+r+".w, "+a+", "+o+"\nadd "+r+".w, "+r+".w, "+r+".w\nmul "+r+", "+r+".w, "+a+"\nsub "+r+", "+r+", "+o+"\ntex "+r+", "+r+", "+e+" <cube,"+(t.useSmoothTextures?"linear":"nearest")+",miplinear>\nmul "+r+".xyz, "+r+", "+i+"\n",null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r+"\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},i.prototype.iGetFragmentPostLightingCode=function(t,e,i){var n="";return 0==t.numLights?n:(this._shadowRegister&&(n+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._shadowRegister+".w\n"),this._pUseTexture&&(n+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularTexData+".x\n",e.removeFragmentTempUsage(this._pSpecularTexData)),n+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularDataRegister+"\nadd "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\n",e.removeFragmentTempUsage(this._pTotalLightColorReg),n)},i.prototype.iActivate=function(e,i){if(0!=e.numLights){this._pUseTexture&&(i.context.setSamplerStateAt(e.texturesIndex,e.repeatTextures?t.stagegl.ContextGLWrapMode.REPEAT:t.stagegl.ContextGLWrapMode.CLAMP,e.useSmoothTextures?t.stagegl.ContextGLTextureFilter.LINEAR:t.stagegl.ContextGLTextureFilter.NEAREST,e.useMipmapping?t.stagegl.ContextGLMipFilter.MIPLINEAR:t.stagegl.ContextGLMipFilter.MIPNONE),i.context.activateTexture(e.texturesIndex,this._texture));var n=e.fragmentConstantsIndex,r=e.fragmentData;r[n]=this._iSpecularR,r[n+1]=this._iSpecularG,r[n+2]=this._iSpecularB,r[n+3]=this._gloss}},i.prototype.updateSpecular=function(){this._iSpecularR=(255&this._specularColor>>16)/255*this._specular,this._iSpecularG=(255&this._specularColor>>8)/255*this._specular,this._iSpecularB=(255&this._specularColor)/255*this._specular},Object.defineProperty(i.prototype,"iShadowRegister",{set:function(t){this._shadowRegister=t},enumerable:!0,configurable:!0}),i.prototype.setIShadowRegister=function(t){this._shadowRegister=t},i}(e.LightingMethodBase);e.SpecularBasicMethod=i}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.utils.Delegate,n=t.events.ShadingMethodEvent,r=function(t){function r(r,s){"undefined"==typeof s&&(s=null),t.call(this),this._onShaderInvalidatedDelegate=i.create(this,this.onShaderInvalidated),this._baseMethod=s||new e.SpecularBasicMethod,this._baseMethod._iModulateMethod=r,this._baseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return __extends(r,t),r.prototype.iInitVO=function(t){this._baseMethod.iInitVO(t)},r.prototype.iInitConstants=function(t){this._baseMethod.iInitConstants(t)},Object.defineProperty(r.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){this._baseMethod!=t&&(this._baseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=t,this._baseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(t){this._baseMethod.gloss=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"specular",{get:function(){return this._baseMethod.specular},set:function(t){this._baseMethod.specular=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"passes",{get:function(){return this._baseMethod.passes},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this._baseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod.dispose()},Object.defineProperty(r.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(t){this._baseMethod.texture=t},enumerable:!0,configurable:!0}),r.prototype.iActivate=function(t,e){this._baseMethod.iActivate(t,e)},r.prototype.iDeactivate=function(t,e){this._baseMethod.iDeactivate(t,e)},Object.defineProperty(r.prototype,"iSharedRegisters",{set:function(e){t.prototype.setISharedRegisters.call(this,e),this._baseMethod.setISharedRegisters(e)},enumerable:!0,configurable:!0}),r.prototype.setISharedRegisters=function(e){t.prototype.setISharedRegisters.call(this,e),this._baseMethod.setISharedRegisters(e)},r.prototype.iGetVertexCode=function(t,e){return this._baseMethod.iGetVertexCode(t,e)},r.prototype.iGetFragmentPreLightingCode=function(t,e){return this._baseMethod.iGetFragmentPreLightingCode(t,e)},r.prototype.iGetFragmentCodePerLight=function(t,e,i,n){return this._baseMethod.iGetFragmentCodePerLight(t,e,i,n)},r.prototype.iGetFragmentCodePerProbe=function(t,e,i,n){return this._baseMethod.iGetFragmentCodePerProbe(t,e,i,n)},r.prototype.iGetFragmentPostLightingCode=function(t,e,i){return this._baseMethod.iGetFragmentPostLightingCode(t,e,i)},r.prototype.iReset=function(){this._baseMethod.iReset()},r.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},Object.defineProperty(r.prototype,"iShadowRegister",{set:function(t){this.setIShadowRegister(t),this._baseMethod.setIShadowRegister(t)},enumerable:!0,configurable:!0}),r.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},r}(e.SpecularBasicMethod);e.SpecularCompositeMethod=r}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.iInitVO=function(t){t.needsTangents=!0,t.needsView=!0},e.prototype.iGetFragmentCodePerLight=function(t,e,i,n){var r,s="";return this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1)),s+="nrm "+r+".xyz, "+this._sharedRegisters.tangentVarying+".xyz\ndp3 "+r+".w, "+r+".xyz, "+e+".xyz\ndp3 "+r+".z, "+r+".xyz, "+this._sharedRegisters.viewDirFragment+".xyz\n",s+="sin "+r+".x, "+r+".w\nsin "+r+".y, "+r+".z\nmul "+r+".x, "+r+".x, "+r+".y\ncos "+r+".z, "+r+".z\ncos "+r+".w, "+r+".w\nmul "+r+".w, "+r+".w, "+r+".z\nsub "+r+".w, "+r+".x, "+r+".w\n",s+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+r+".w, "+r+".w, "+this._pSpecularTexData+".w\n":"pow "+r+".w, "+r+".w, "+this._pSpecularDataRegister+".w\n",s+="mul "+r+".w, "+r+".w, "+e+".w\n",null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),s+="mul "+r+".xyz, "+i+".xyz, "+r+".w\n",this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+r+".xyz\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},e}(t.SpecularBasicMethod);t.SpecularAnisotropicMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=.5),"undefined"==typeof i&&(i=null);var n=this;t.call(this,null,i),this._smoothness=.1,this._specularCutOff=.1,this.baseMethod._iModulateMethod=function(t,e,i,r){return n.clampSpecular(t,e,i,r)},this._specularCutOff=e}return __extends(e,t),Object.defineProperty(e.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(t){this._specularCutOff=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i);var n=e.secondaryFragmentConstantsIndex,r=e.fragmentData;r[n]=this._smoothness,r[n+1]=this._specularCutOff},e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._dataReg=null},e.prototype.clampSpecular=function(t,e,i,n){return t=t,i=i,n=n,"sub "+e+".y, "+e+".w, "+this._dataReg+".y\ndiv "+e+".y, "+e+".y, "+this._dataReg+".x\nsat "+e+".y, "+e+".y\nsge "+e+".w, "+e+".w, "+this._dataReg+".y\nmul "+e+".w, "+e+".w, "+e+".y\n"},e.prototype.iGetFragmentPreLightingCode=function(e,i){return this._dataReg=i.getFreeFragmentConstant(),e.secondaryFragmentConstantsIndex=4*this._dataReg.index,t.prototype.iGetFragmentPreLightingCode.call(this,e,i)},e}(t.SpecularCompositeMethod);t.SpecularCelMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=!0),"undefined"==typeof i&&(i=null);var n=this;t.call(this,null,i),this._fresnelPower=5,this._normalReflectance=.028,this.baseMethod._iModulateMethod=function(t,e,i,r){return n.modulateSpecular(t,e,i,r)},this._incidentLight=!e}return __extends(e,t),e.prototype.iInitConstants=function(t){var e=t.secondaryFragmentConstantsIndex;t.fragmentData[e+2]=1,t.fragmentData[e+3]=0},Object.defineProperty(e.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},set:function(t){this._incidentLight==t&&(this._incidentLight=!t,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower=t},enumerable:!0,configurable:!0}),e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this),this._dataReg=null},Object.defineProperty(e.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance=t},enumerable:!0,configurable:!0}),e.prototype.iActivate=function(e,i){t.prototype.iActivate.call(this,e,i);var n=e.fragmentData,r=e.secondaryFragmentConstantsIndex;n[r]=this._normalReflectance,n[r+1]=this._fresnelPower},e.prototype.iGetFragmentPreLightingCode=function(e,i){return this._dataReg=i.getFreeFragmentConstant(),console.log("SpecularFresnelMethod","iGetFragmentPreLightingCode",this._dataReg),e.secondaryFragmentConstantsIndex=4*this._dataReg.index,t.prototype.iGetFragmentPreLightingCode.call(this,e,i)},e.prototype.modulateSpecular=function(t,e,i,n){var r;return r="dp3 "+e+".y, "+n.viewDirFragment+".xyz, "+(this._incidentLight?e+".xyz\n":n.normalFragment+".xyz\n")+"sub "+e+".y, "+this._dataReg+".z, "+e+".y\npow "+e+".x, "+e+".y, "+this._dataReg+".y\nsub "+e+".y, "+this._dataReg+".z, "+e+".y\nmul "+e+".y, "+this._dataReg+".x, "+e+".y\nadd "+e+".y, "+e+".x, "+e+".y\nmul "+e+".w, "+e+".w, "+e+".y\n",console.log("SpecularFresnelMethod","modulateSpecular",r),r},e}(t.SpecularCompositeMethod);t.SpecularFresnelMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.iGetFragmentCodePerLight=function(t,e,i,n){var r,s="";this._pIsFirstLight?r=this._pTotalLightColorReg:(r=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(r,1));var a=this._sharedRegisters.viewDirFragment,o=this._sharedRegisters.normalFragment;return s+="dp3 "+r+".w, "+e+", "+o+"\nadd "+r+".w, "+r+".w, "+r+".w\nmul "+r+".xyz, "+o+", "+r+".w\nsub "+r+".xyz, "+r+", "+e+"\nadd "+r+".w, "+r+".w, "+this._sharedRegisters.commons+".w\nsat "+r+".w, "+r+".w\nmul "+r+".xyz, "+r+", "+r+".w\ndp3 "+r+".w, "+r+", "+a+"\nsat "+r+".w, "+r+".w\n",s+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+r+".w, "+r+".w, "+this._pSpecularTexData+".w\n":"pow "+r+".w, "+r+".w, "+this._pSpecularDataRegister+".w\n",t.useLightFallOff&&(s+="mul "+r+".w, "+r+".w, "+e+".w\n"),null!=this._iModulateMethod&&(s+=this._iModulateMethod(t,r,n,this._sharedRegisters)),s+="mul "+r+".xyz, "+i+".xyz, "+r+".w\n",this._pIsFirstLight||(s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+r+".xyz\n",n.removeFragmentTempUsage(r)),this._pIsFirstLight=!1,s},e}(t.SpecularBasicMethod);t.SpecularPhongMethod=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(t){this._numUsedVertexConstants=0,this._numUsedFragmentConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._profile=t}return e.prototype.reset=function(){this._fragmentTempCache=new t.RegisterPool("ft",8,!1),this._vertexTempCache=new t.RegisterPool("vt",8,!1),this._varyingCache=new t.RegisterPool("v",8),this._textureCache=new t.RegisterPool("fs",8),this._vertexAttributesCache=new t.RegisterPool("va",8),this._fragmentConstantsCache=new t.RegisterPool("fc",28),this._vertexConstantsCache=new t.RegisterPool("vc",128),this._fragmentOutputRegister=new t.ShaderRegisterElement("oc",-1),this._vertexOutputRegister=new t.ShaderRegisterElement("op",-1),this._numUsedVertexConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._numUsedFragmentConstants=0;var e;for(e=0;e<this._vertexAttributesOffset;++e)this.getFreeVertexAttribute();for(e=0;e<this._vertexConstantOffset;++e)this.getFreeVertexConstant();for(e=0;e<this._varyingsOffset;++e)this.getFreeVarying();for(e=0;e<this._fragmentConstantOffset;++e)this.getFreeFragmentConstant()},e.prototype.dispose=function(){this._fragmentTempCache.dispose(),this._vertexTempCache.dispose(),this._varyingCache.dispose(),this._fragmentConstantsCache.dispose(),this._vertexAttributesCache.dispose(),this._fragmentTempCache=null,this._vertexTempCache=null,this._varyingCache=null,this._fragmentConstantsCache=null,this._vertexAttributesCache=null,this._fragmentOutputRegister=null,this._vertexOutputRegister=null},e.prototype.addFragmentTempUsages=function(t,e){this._fragmentTempCache.addUsage(t,e)},e.prototype.removeFragmentTempUsage=function(t){this._fragmentTempCache.removeUsage(t)},e.prototype.addVertexTempUsages=function(t,e){this._vertexTempCache.addUsage(t,e)},e.prototype.removeVertexTempUsage=function(t){this._vertexTempCache.removeUsage(t)},e.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()},e.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()},e.prototype.getFreeVarying=function(){return++this._numUsedVaryings,this._varyingCache.requestFreeVectorReg()},e.prototype.getFreeFragmentConstant=function(){return++this._numUsedFragmentConstants,this._fragmentConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexConstant=function(){return++this._numUsedVertexConstants,this._vertexConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()},e.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()},e.prototype.getFreeVertexAttribute=function(){return++this._numUsedStreams,this._vertexAttributesCache.requestFreeVectorReg()},e.prototype.getFreeTextureReg=function(){return++this._numUsedTextures,this._textureCache.requestFreeVectorReg()},Object.defineProperty(e.prototype,"vertexConstantOffset",{get:function(){return this._vertexConstantOffset},set:function(t){this._vertexConstantOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributesOffset",{get:function(){return this._vertexAttributesOffset},set:function(t){this._vertexAttributesOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"varyingsOffset",{get:function(){return this._varyingsOffset},set:function(t){this._varyingsOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentConstantOffset",{get:function(){return this._fragmentConstantOffset},set:function(t){this._fragmentConstantOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:!0,configurable:!0}),e}();t.ShaderRegisterCache=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(e,i,n){"undefined"==typeof n&&(n=-1),this._component=n,this._regName=e,this._index=i,this._toStr=this._regName,this._index>=0&&(this._toStr+=this._index),n>-1&&(this._toStr+="."+t.COMPONENTS[n])}return t.prototype.toString=function(){return this._toStr},Object.defineProperty(t.prototype,"regName",{get:function(){return this._regName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),t.COMPONENTS=["x","y","z","w"],t}();t.ShaderRegisterElement=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t}();t.ShaderRegisterData=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(){this._usesGlobalPosFragment=!1}return e.prototype.reset=function(){this._projectionDependencies=0,this._normalDependencies=0,this._viewDirDependencies=0,this._uvDependencies=0,this._secondaryUVDependencies=0,this._globalPosDependencies=0,this._tangentDependencies=0,this._usesGlobalPosFragment=!1},e.prototype.setPositionedLights=function(t,e){this._numPointLights=t,this._lightSourceMask=e},e.prototype.includeMethodVO=function(t){t.needsProjection&&++this._projectionDependencies,t.needsGlobalVertexPos?(++this._globalPosDependencies,t.needsGlobalFragmentPos&&(this._usesGlobalPosFragment=!0)):t.needsGlobalFragmentPos&&(++this._globalPosDependencies,this._usesGlobalPosFragment=!0),t.needsNormals&&++this._normalDependencies,t.needsTangents&&++this._tangentDependencies,t.needsView&&++this._viewDirDependencies,t.needsUV&&++this._uvDependencies,t.needsSecondaryUV&&++this._secondaryUVDependencies},Object.defineProperty(e.prototype,"tangentDependencies",{get:function(){return this._tangentDependencies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usesGlobalPosFragment",{get:function(){return this._usesGlobalPosFragment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionDependencies",{get:function(){return this._projectionDependencies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalDependencies",{get:function(){return this._normalDependencies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewDirDependencies",{get:function(){return this._viewDirDependencies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uvDependencies",{get:function(){return this._uvDependencies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondaryUVDependencies",{get:function(){return this._secondaryUVDependencies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalPosDependencies",{get:function(){return this._globalPosDependencies},enumerable:!0,configurable:!0}),e.prototype.addWorldSpaceDependencies=function(e){this._viewDirDependencies>0&&++this._globalPosDependencies,this._numPointLights>0&&this._lightSourceMask&t.LightSources.LIGHTS&&(++this._globalPosDependencies,e&&(this._usesGlobalPosFragment=!0))},e}();t.MethodDependencyCounter=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(t,e,i){"undefined"==typeof i&&(i=!0),this._regName=t,this._regCount=e,this._persistent=i,this.initRegisters(t,e)}return e.prototype.requestFreeVectorReg=function(){for(var t=0;t<this._regCount;++t)if(!this.isRegisterUsed(t))return this._persistent&&this._usedVectorCount[t]++,this._vectorRegisters[t];throw new Error("Register overflow!")},e.prototype.requestFreeRegComponent=function(){for(var t=0;t<this._regCount;++t)if(!(this._usedVectorCount[t]>0))for(var e=0;4>e;++e)if(0==this._usedSingleCount[e][t])return this._persistent&&this._usedSingleCount[e][t]++,this._registerComponents[e][t];throw new Error("Register overflow!")},e.prototype.addUsage=function(t,e){t._component>-1?this._usedSingleCount[t._component][t.index]+=e:this._usedVectorCount[t.index]+=e},e.prototype.removeUsage=function(t){if(t._component>-1){if(--this._usedSingleCount[t._component][t.index]<0)throw new Error("More usages removed than exist!")}else if(--this._usedVectorCount[t.index]<0)throw new Error("More usages removed than exist!")},e.prototype.dispose=function(){this._vectorRegisters=null,this._registerComponents=null,this._usedSingleCount=null,this._usedVectorCount=null},e.prototype.hasRegisteredRegs=function(){for(var t=0;t<this._regCount;++t)if(this.isRegisterUsed(t))return!0;return!1},e.prototype.initRegisters=function(t,i){var n=e._initPool(t,i);this._vectorRegisters=e._regPool[n],this._registerComponents=e._regCompsPool[n],this._usedVectorCount=this._initArray(Array(i),0),this._usedSingleCount=new Array(4),this._usedSingleCount[0]=this._initArray(new Array(i),0),this._usedSingleCount[1]=this._initArray(new Array(i),0),this._usedSingleCount[2]=this._initArray(new Array(i),0),this._usedSingleCount[3]=this._initArray(new Array(i),0)},e._initPool=function(i,n){var r=i+n;if(void 0!=e._regPool[r])return r;var s=new Array(n);e._regPool[r]=s;var a=[[],[],[],[]];e._regCompsPool[r]=a;for(var o=0;n>o;++o){s[o]=new t.ShaderRegisterElement(i,o);for(var h=0;4>h;++h)a[h][o]=new t.ShaderRegisterElement(i,o,h)}return r},e.prototype.isRegisterUsed=function(t){if(this._usedVectorCount[t]>0)return!0;for(var e=0;4>e;++e)if(this._usedSingleCount[e][t]>0)return!0;return!1},e.prototype._initArray=function(t,e){for(var i=t.length,n=0;i>n;n++)t[n]=e;return t},e._regPool=new Object,e._regCompsPool=new Object,e}();t.RegisterPool=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(e){this._preserveAlpha=!0,this._pVertexCode="",this._pFragmentCode="",this._commonsDataIndex=-1,this._uvBufferIndex=-1,this._uvTransformIndex=-1,this._secondaryUVBufferIndex=-1,this._pNormalBufferIndex=-1,this._pTangentBufferIndex=-1,this._pLightFragmentConstantIndex=-1,this._sceneMatrixIndex=-1,this._pSceneNormalMatrixIndex=-1,this._pCameraPositionIndex=-1,this._pProbeWeightsIndex=-1,this._pSharedRegisters=new t.ShaderRegisterData,this._pDependencyCounter=new t.MethodDependencyCounter,this._pProfile=e,this.initRegisterCache(e)}return Object.defineProperty(e.prototype,"enableLightFallOff",{get:function(){return this._pEnableLightFallOff},set:function(t){this._pEnableLightFallOff=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needUVAnimation",{get:function(){return this._needUVAnimation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVTarget",{get:function(){return this._UVTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVSource",{get:function(){return this._UVSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forceSeperateMVP",{get:function(){return this._forceSeperateMVP},set:function(t){this._forceSeperateMVP=t},enumerable:!0,configurable:!0}),e.prototype.initRegisterCache=function(e){this._pRegisterCache=new t.ShaderRegisterCache(e),this._pRegisterCache.vertexAttributesOffset=1,this._pRegisterCache.reset()},Object.defineProperty(e.prototype,"animateUVs",{get:function(){return this._animateUVs},set:function(t){this._animateUVs=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaPremultiplied",{get:function(){return this._pAlphaPremultiplied},set:function(t){this._pAlphaPremultiplied=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(t){this._preserveAlpha=t},enumerable:!0,configurable:!0}),e.prototype.setTextureSampling=function(t,e,i){this._smooth=t,this._repeat=e,this._mipmap=i},e.prototype.setConstantDataBuffers=function(t,e){this._vertexConstantData=t,this._fragmentConstantData=e},Object.defineProperty(e.prototype,"methodSetup",{get:function(){return this._pMethodSetup},set:function(t){this._pMethodSetup=t},enumerable:!0,configurable:!0}),e.prototype.compile=function(){this.pInitRegisterIndices(),this.pInitLightData(),this._pAnimatableAttributes=new Array("va0"),this._pAnimationTargetRegisters=new Array("vt0"),this._pVertexCode="",this._pFragmentCode="",this._pSharedRegisters.localPosition=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition,1),this.createCommons(),this.pCalculateDependencies(),this.updateMethodRegisters();for(var t=0;4>t;++t)this._pRegisterCache.getFreeVertexConstant();this.pCreateNormalRegisters(),(this._pDependencyCounter.globalPosDependencies>0||this._forceSeperateMVP)&&this.pCompileGlobalPositionCode(),this.compileProjectionCode(),this.pCompileMethodsCode(),this.compileFragmentOutput(),this._fragmentPostLightCode=this.fragmentCode},e.prototype.pCreateNormalRegisters=function(){},e.prototype.pCompileMethodsCode=function(){this._pDependencyCounter.uvDependencies>0&&this.compileUVCode(),this._pDependencyCounter.secondaryUVDependencies>0&&this.compileSecondaryUVCode(),this._pDependencyCounter.normalDependencies>0&&this.pCompileNormalCode(),this._pDependencyCounter.viewDirDependencies>0&&this.pCompileViewDirCode(),this.pCompileLightingCode(),this._fragmentLightCode=this._pFragmentCode,this._pFragmentCode="",this.pCompileMethods()},e.prototype.pCompileLightingCode=function(){},e.prototype.pCompileViewDirCode=function(){},e.prototype.pCompileNormalCode=function(){},e.prototype.compileUVCode=function(){var t=this._pRegisterCache.getFreeVertexAttribute();this._uvBufferIndex=t.index;var e=this._pRegisterCache.getFreeVarying();if(this._pSharedRegisters.uvVarying=e,this.animateUVs){var i=this._pRegisterCache.getFreeVertexConstant(),n=this._pRegisterCache.getFreeVertexConstant();this._uvTransformIndex=4*i.index,this._pVertexCode+="dp4 "+e+".x, "+t+", "+i+"\ndp4 "+e+".y, "+t+", "+n+"\nmov "+e+".zw, "+t+".zw \n"}else this._uvTransformIndex=-1,this._needUVAnimation=!0,this._UVTarget=e.toString(),this._UVSource=t.toString()},e.prototype.compileSecondaryUVCode=function(){var t=this._pRegisterCache.getFreeVertexAttribute();this._secondaryUVBufferIndex=t.index,this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.secondaryUVVarying+", "+t+"\n"},e.prototype.pCompileGlobalPositionCode=function(){this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex,this._pDependencyCounter.globalPosDependencies);var t=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._sceneMatrixIndex=4*t.index,this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex+", "+this._pSharedRegisters.localPosition+", "+t+"\n",this._pDependencyCounter.usesGlobalPosFragment&&(this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying+", "+this._pSharedRegisters.globalPositionVertex+"\n")},e.prototype.compileProjectionCode=function(){var t,e=this._pDependencyCounter.globalPosDependencies>0||this._forceSeperateMVP?this._pSharedRegisters.globalPositionVertex.toString():this._pAnimationTargetRegisters[0];this._pDependencyCounter.projectionDependencies>0?(this._pSharedRegisters.projectionFragment=this._pRegisterCache.getFreeVarying(),t="m44 vt5, "+e+", vc0		\nmov "+this._pSharedRegisters.projectionFragment+", vt5\nmov op, vt5\n"):t="m44 op, "+e+", vc0		\n",this._pVertexCode+=t},e.prototype.compileFragmentOutput=function(){this._pFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister+", "+this._pSharedRegisters.shadedTarget+"\n",this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget)},e.prototype.pInitRegisterIndices=function(){this._commonsDataIndex=-1,this._pCameraPositionIndex=-1,this._uvBufferIndex=-1,this._uvTransformIndex=-1,this._secondaryUVBufferIndex=-1,this._pNormalBufferIndex=-1,this._pTangentBufferIndex=-1,this._pLightFragmentConstantIndex=-1,this._sceneMatrixIndex=-1,this._pSceneNormalMatrixIndex=-1,this._pProbeWeightsIndex=-1},e.prototype.pInitLightData=function(){this._pNumLights=this._pNumPointLights+this._pNumDirectionalLights,this._pNumProbeRegisters=Math.ceil(this._pNumLightProbes/4),this._combinedLightSources=this._pMethodSetup._iSpecularMethod?this._specularLightSources|this._diffuseLightSources:this._diffuseLightSources,this._usingSpecularMethod=Boolean(this._pMethodSetup._iSpecularMethod&&(this.pUsesLightsForSpecular()||this.pUsesProbesForSpecular()))},e.prototype.createCommons=function(){this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant(),this._commonsDataIndex=4*this._pSharedRegisters.commons.index},e.prototype.pCalculateDependencies=function(){this._pDependencyCounter.reset(),this.setupAndCountMethodDependencies(this._pMethodSetup._iDiffuseMethod,this._pMethodSetup._iDiffuseMethodVO),this._pMethodSetup._iShadowMethod&&this.setupAndCountMethodDependencies(this._pMethodSetup._iShadowMethod,this._pMethodSetup._iShadowMethodVO),this.setupAndCountMethodDependencies(this._pMethodSetup._iAmbientMethod,this._pMethodSetup._iAmbientMethodVO),this._usingSpecularMethod&&this.setupAndCountMethodDependencies(this._pMethodSetup._iSpecularMethod,this._pMethodSetup._iSpecularMethodVO),this._pMethodSetup._iColorTransformMethod&&this.setupAndCountMethodDependencies(this._pMethodSetup._iColorTransformMethod,this._pMethodSetup._iColorTransformMethodVO);for(var t=this._pMethodSetup._iMethods,e=t.length,i=0;e>i;++i)this.setupAndCountMethodDependencies(t[i].method,t[i].data);this.usesNormals&&this.setupAndCountMethodDependencies(this._pMethodSetup._iNormalMethod,this._pMethodSetup._iNormalMethodVO),this._pDependencyCounter.setPositionedLights(this._pNumPointLights,this._combinedLightSources)},e.prototype.setupAndCountMethodDependencies=function(t,e){this.setupMethod(t,e),this._pDependencyCounter.includeMethodVO(e)},e.prototype.setupMethod=function(t,e){t.iReset(),e.reset(),e.vertexData=this._vertexConstantData,e.fragmentData=this._fragmentConstantData,e.useSmoothTextures=this._smooth,e.repeatTextures=this._repeat,e.useMipmapping=this._mipmap,e.useLightFallOff=this._pEnableLightFallOff&&"baselineConstrained"!=this._pProfile,e.numLights=this._pNumLights+this._pNumLightProbes,t.iInitVO(e)},Object.defineProperty(e.prototype,"commonsDataIndex",{get:function(){return this._commonsDataIndex},enumerable:!0,configurable:!0}),e.prototype.updateMethodRegisters=function(){this._pMethodSetup._iNormalMethod.iSharedRegisters=this._pSharedRegisters,this._pMethodSetup._iDiffuseMethod.iSharedRegisters=this._pSharedRegisters,this._pMethodSetup._iShadowMethod&&(this._pMethodSetup._iShadowMethod.iSharedRegisters=this._pSharedRegisters),this._pMethodSetup._iAmbientMethod.iSharedRegisters=this._pSharedRegisters,this._pMethodSetup._iSpecularMethod&&(this._pMethodSetup._iSpecularMethod.iSharedRegisters=this._pSharedRegisters),this._pMethodSetup._iColorTransformMethod&&(this._pMethodSetup._iColorTransformMethod.iSharedRegisters=this._pSharedRegisters);for(var t=this._pMethodSetup._iMethods,e=t.length,i=0;e>i;++i)t[i].method.iSharedRegisters=this._pSharedRegisters},Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){return this._pRegisterCache.numUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){return this._pRegisterCache.numUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._pRegisterCache.numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._pRegisterCache.numUsedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVaryings",{get:function(){return this._pRegisterCache.numUsedVaryings},enumerable:!0,configurable:!0}),e.prototype.pUsesLightsForSpecular=function(){return this._pNumLights>0&&0!=(this._specularLightSources&t.LightSources.LIGHTS)
},e.prototype.pUsesLightsForDiffuse=function(){return this._pNumLights>0&&0!=(this._diffuseLightSources&t.LightSources.LIGHTS)},e.prototype.dispose=function(){this.cleanUpMethods(),this._pRegisterCache.dispose(),this._pRegisterCache=null,this._pSharedRegisters=null},e.prototype.cleanUpMethods=function(){this._pMethodSetup._iNormalMethod&&this._pMethodSetup._iNormalMethod.iCleanCompilationData(),this._pMethodSetup._iDiffuseMethod&&this._pMethodSetup._iDiffuseMethod.iCleanCompilationData(),this._pMethodSetup._iAmbientMethod&&this._pMethodSetup._iAmbientMethod.iCleanCompilationData(),this._pMethodSetup._iSpecularMethod&&this._pMethodSetup._iSpecularMethod.iCleanCompilationData(),this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iCleanCompilationData(),this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iCleanCompilationData();for(var t=this._pMethodSetup._iMethods,e=t.length,i=0;e>i;++i)t[i].method.iCleanCompilationData()},Object.defineProperty(e.prototype,"specularLightSources",{get:function(){return this._specularLightSources},set:function(t){this._specularLightSources=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseLightSources",{get:function(){return this._diffuseLightSources},set:function(t){this._diffuseLightSources=t},enumerable:!0,configurable:!0}),e.prototype.pUsesProbesForSpecular=function(){return this._pNumLightProbes>0&&0!=(this._specularLightSources&t.LightSources.PROBES)},e.prototype.pUsesProbesForDiffuse=function(){return this._pNumLightProbes>0&&0!=(this._diffuseLightSources&t.LightSources.PROBES)},e.prototype.pUsesProbes=function(){return this._pNumLightProbes>0&&0!=((this._diffuseLightSources|this._specularLightSources)&t.LightSources.PROBES)},Object.defineProperty(e.prototype,"uvBufferIndex",{get:function(){return this._uvBufferIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uvTransformIndex",{get:function(){return this._uvTransformIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondaryUVBufferIndex",{get:function(){return this._secondaryUVBufferIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBufferIndex",{get:function(){return this._pNormalBufferIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tangentBufferIndex",{get:function(){return this._pTangentBufferIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightFragmentConstantIndex",{get:function(){return this._pLightFragmentConstantIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraPositionIndex",{get:function(){return this._pCameraPositionIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneMatrixIndex",{get:function(){return this._sceneMatrixIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneNormalMatrixIndex",{get:function(){return this._pSceneNormalMatrixIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"probeWeightsIndex",{get:function(){return this._pProbeWeightsIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentLightCode",{get:function(){return this._fragmentLightCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentPostLightCode",{get:function(){return this._fragmentPostLightCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numPointLights",{get:function(){return this._pNumPointLights},set:function(t){this._pNumPointLights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numDirectionalLights",{get:function(){return this._pNumDirectionalLights},set:function(t){this._pNumDirectionalLights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numLightProbes",{get:function(){return this._pNumLightProbes},set:function(t){this._pNumLightProbes=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usingSpecularMethod",{get:function(){return this._usingSpecularMethod},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animatableAttributes",{get:function(){return this._pAnimatableAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationTargetRegisters",{get:function(){return this._pAnimationTargetRegisters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usesNormals",{get:function(){return this._pDependencyCounter.normalDependencies>0&&this._pMethodSetup._iNormalMethod.iHasOutput},enumerable:!0,configurable:!0}),e.prototype.pUsesLights=function(){return this._pNumLights>0&&0!=(this._combinedLightSources&t.LightSources.LIGHTS)},e.prototype.pCompileMethods=function(){var t,e,i,n=this._pMethodSetup._iMethods,r=n.length;this._preserveAlpha&&(i=this._pRegisterCache.getFreeFragmentSingleTemp(),this._pRegisterCache.addFragmentTempUsages(i,1),this._pFragmentCode+="mov "+i+", "+this._pSharedRegisters.shadedTarget+".w\n");for(var s=0;r>s;++s)t=n[s].method,e=n[s].data,this._pVertexCode+=t.iGetVertexCode(e,this._pRegisterCache),(e.needsGlobalVertexPos||e.needsGlobalFragmentPos)&&this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex),this._pFragmentCode+=t.iGetFragmentCode(e,this._pRegisterCache,this._pSharedRegisters.shadedTarget),e.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),e.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);this._preserveAlpha&&(this._pFragmentCode+="mov "+this._pSharedRegisters.shadedTarget+".w, "+i+"\n",this._pRegisterCache.removeFragmentTempUsage(i)),this._pMethodSetup._iColorTransformMethod&&(this._pVertexCode+=this._pMethodSetup._iColorTransformMethod.iGetVertexCode(this._pMethodSetup._iColorTransformMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iColorTransformMethod.iGetFragmentCode(this._pMethodSetup._iColorTransformMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget))},Object.defineProperty(e.prototype,"lightProbeDiffuseIndices",{get:function(){return this._pLightProbeDiffuseIndices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightProbeSpecularIndices",{get:function(){return this._pLightProbeSpecularIndices},enumerable:!0,configurable:!0}),e}();t.ShaderCompiler=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype.pInitLightData=function(){t.prototype.pInitLightData.call(this),this._pointLightRegisters=new Array(3*this._pNumPointLights),this._dirLightRegisters=new Array(3*this._pNumDirectionalLights)},e.prototype.pCalculateDependencies=function(){t.prototype.pCalculateDependencies.call(this),this._pDependencyCounter.addWorldSpaceDependencies(!0)},e.prototype.pCompileNormalCode=function(){var t=new Array(3);return this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pDependencyCounter.normalDependencies),this._pMethodSetup._iNormalMethod.iHasOutput&&!this._pMethodSetup._iNormalMethod.iTangentSpace?(this._pVertexCode+=this._pMethodSetup._iNormalMethod.iGetVertexCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache),void(this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache,this._pSharedRegisters.normalFragment))):(this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying(),t[0]=this._pRegisterCache.getFreeVertexConstant(),t[1]=this._pRegisterCache.getFreeVertexConstant(),t[2]=this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pSceneNormalMatrixIndex=4*t[0].index,this._pMethodSetup._iNormalMethod.iHasOutput?(this.compileTangentVertexCode(t),this.compileTangentNormalMapFragmentCode()):(this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+t[0]+"\nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w	\n",this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w		\n",this._pDependencyCounter.tangentDependencies>0&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.tangentVarying+", "+this._pSharedRegisters.tangentInput+"\n")),void this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal))},e.prototype.pCreateNormalRegisters=function(){this._pDependencyCounter.normalDependencies>0&&(this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute(),this._pNormalBufferIndex=this._pSharedRegisters.normalInput.index,this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1),this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString())),this._pMethodSetup._iNormalMethod.iHasOutput&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1),this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString()))},e.prototype.compileTangentVertexCode=function(t){this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();var e=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="m33 "+e+".xyz, "+this._pSharedRegisters.animatedNormal+", "+t[0]+"\nnrm "+this._pSharedRegisters.animatedNormal+".xyz, "+e+"\nm33 "+e+".xyz, "+this._pSharedRegisters.animatedTangent+", "+t[0]+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+e+"\nmov "+this._pSharedRegisters.tangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".x  \nmov "+this._pSharedRegisters.tangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".x  \nmov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.bitangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.normalVarying+".x, "+this._pSharedRegisters.animatedTangent+".z  \nmov "+this._pSharedRegisters.normalVarying+".z, "+this._pSharedRegisters.animatedNormal+".z  \nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.normalInput+".w  \ncrs "+e+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.tangentVarying+".y, "+e+".x    \nmov "+this._pSharedRegisters.bitangentVarying+".y, "+e+".y  \nmov "+this._pSharedRegisters.normalVarying+".y, "+e+".z    \n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent)},e.prototype.compileTangentNormalMapFragmentCode=function(){var t,e,i;t=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(t,1),e=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(e,1),i=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(i,1),this._pFragmentCode+="nrm "+t+".xyz, "+this._pSharedRegisters.tangentVarying+"\nmov "+t+".w, "+this._pSharedRegisters.tangentVarying+".w	\nnrm "+e+".xyz, "+this._pSharedRegisters.bitangentVarying+"\nnrm "+i+".xyz, "+this._pSharedRegisters.normalVarying+"\n";var n=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(n,1),this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache,n)+"m33 "+this._pSharedRegisters.normalFragment+".xyz, "+n+", "+t+"	\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w	\n",this._pRegisterCache.removeFragmentTempUsage(n),this._pMethodSetup._iNormalMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment),(this._pMethodSetup._iNormalMethodVO.needsGlobalVertexPos||this._pMethodSetup._iNormalMethodVO.needsGlobalFragmentPos)&&this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex),this._pRegisterCache.removeFragmentTempUsage(e),this._pRegisterCache.removeFragmentTempUsage(t),this._pRegisterCache.removeFragmentTempUsage(i)},e.prototype.pCompileViewDirCode=function(){var t=this._pRegisterCache.getFreeVertexConstant();this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pDependencyCounter.viewDirDependencies),this._pCameraPositionIndex=4*t.index,this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+t+", "+this._pSharedRegisters.globalPositionVertex+"\n",this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\nmov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w 		\n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex)},e.prototype.pCompileLightingCode=function(){var t;this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1),this._pVertexCode+=this._pMethodSetup._iDiffuseMethod.iGetVertexCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache),this._usingSpecularMethod&&(this._pVertexCode+=this._pMethodSetup._iSpecularMethod.iGetVertexCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache)),this.pUsesLights()&&(this.initLightRegisters(),this.compileDirectionalLightCode(),this.compilePointLightCode()),this.pUsesProbes()&&this.compileLightProbeCode(),this._pVertexCode+=this._pMethodSetup._iAmbientMethod.iGetVertexCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iAmbientMethod.iGetFragmentCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget),this._pMethodSetup._iAmbientMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iAmbientMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment),this._pMethodSetup._iShadowMethod&&(this._pVertexCode+=this._pMethodSetup._iShadowMethod.iGetVertexCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache),0==this._pDependencyCounter.normalDependencies?(t=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(t,1)):t=this._pSharedRegisters.normalFragment,this._pMethodSetup._iDiffuseMethod.iShadowRegister=t,this._pFragmentCode+=this._pMethodSetup._iShadowMethod.iGetFragmentCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache,t)),this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget),this._pAlphaPremultiplied&&(this._pFragmentCode+="add "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.commons+".z\ndiv "+this._pSharedRegisters.shadedTarget+".xyz, "+this._pSharedRegisters.shadedTarget+", "+this._pSharedRegisters.shadedTarget+".w\nsub "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.commons+".z\nsat "+this._pSharedRegisters.shadedTarget+".xyz, "+this._pSharedRegisters.shadedTarget+"\n"),this._pMethodSetup._iDiffuseMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iDiffuseMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment),this._usingSpecularMethod&&(this._pMethodSetup._iSpecularMethod.iShadowRegister=t,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget),this._pMethodSetup._iSpecularMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iSpecularMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment))},e.prototype.initLightRegisters=function(){var t,e;for(e=this._dirLightRegisters.length,t=0;e>t;++t)this._dirLightRegisters[t]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*this._dirLightRegisters[t].index);for(e=this._pointLightRegisters.length,t=0;e>t;++t)this._pointLightRegisters[t]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*this._pointLightRegisters[t].index)},e.prototype.compileDirectionalLightCode=function(){var t,e,i,n=0,r=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),s=this.pUsesLightsForDiffuse();if(r||s)for(var a=0;a<this._pNumDirectionalLights;++a)i=this._dirLightRegisters[n++],t=this._dirLightRegisters[n++],e=this._dirLightRegisters[n++],s&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,i,t,this._pRegisterCache)),r&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,i,e,this._pRegisterCache))},e.prototype.compilePointLightCode=function(){var t,e,i,n,r=0,s=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),a=this.pUsesLightsForDiffuse();if(s||a)for(var o=0;o<this._pNumPointLights;++o)i=this._pointLightRegisters[r++],t=this._pointLightRegisters[r++],e=this._pointLightRegisters[r++],n=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(n,1),this._pFragmentCode+="sub "+n+", "+i+", "+this._pSharedRegisters.globalPositionVarying+"\ndp3 "+n+".w, "+n+", "+n+"\nsub "+n+".w, "+n+".w, "+t+".w\nmul "+n+".w, "+n+".w, "+e+".w\nsat "+n+".w, "+n+".w\nsub "+n+".w, "+i+".w, "+n+".w\nnrm "+n+".xyz, "+n+"\n",-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*i.index),a&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,n,t,this._pRegisterCache)),s&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,n,e,this._pRegisterCache)),this._pRegisterCache.removeFragmentTempUsage(n)},e.prototype.compileLightProbeCode=function(){var t,e,i,n=[".x",".y",".z",".w"],r=new Array,s=this._usingSpecularMethod&&this.pUsesProbesForSpecular(),a=this.pUsesProbesForDiffuse();if(s||a){for(a&&(this._pLightProbeDiffuseIndices=new Array),s&&(this._pLightProbeSpecularIndices=new Array),e=0;e<this._pNumProbeRegisters;++e)r[e]=this._pRegisterCache.getFreeFragmentConstant(),0==e&&(this._pProbeWeightsIndex=4*r[e].index);for(e=0;e<this._pNumLightProbes;++e)t=r[Math.floor(e/4)].toString()+n[e%4],a&&(i=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeDiffuseIndices[e]=i.index,this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iDiffuseMethodVO,i,t,this._pRegisterCache)),s&&(i=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeSpecularIndices[e]=i.index,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iSpecularMethodVO,i,t,this._pRegisterCache))}},e}(t.ShaderCompiler);t.SuperShaderCompiler=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.LIGHTS=1,t.PROBES=2,t.ALL=3,t}();t.LightSources=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.materials.DepthMapPass,n=t.materials.DistanceMapPass,r=function(t){function e(){t.call(this),this._pHeight=1,this._pWidth=1,this._pRequiresBlending=!1,this._iBaseScreenPassIndex=2,this._pDepthPass=new i(this),this._pDistancePass=new n(this)}return __extends(e,t),e.prototype.pAddDepthPasses=function(){this.pAddPass(this._pDepthPass),this.pAddPass(this._pDistancePass)},e.prototype.iHasDepthAlphaThreshold=function(){return this._pDepthPass.alphaThreshold>0},e.prototype.iActivateForDepth=function(t,e,i){"undefined"==typeof i&&(i=!1),this._distanceBasedDepthRender=i,i?this._pDistancePass.iActivate(t,e):this._pDepthPass.iActivate(t,e)},e.prototype.iDeactivateForDepth=function(t){this._distanceBasedDepthRender?this._pDistancePass.iDeactivate(t):this._pDepthPass.iDeactivate(t)},e.prototype.iRenderDepth=function(t,e,i,n){this._distanceBasedDepthRender?(t.materialOwner.animator&&this._pDistancePass.iUpdateAnimationState(t,e,i),this._pDistancePass.iRender(t,e,i,n)):(t.materialOwner.animator&&this._pDepthPass.iUpdateAnimationState(t,e,i),this._pDepthPass.iRender(t,e,i,n))},e}(e.MaterialBase);e.ShadowMaterialBase=r}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.ColorTransform,n=t.stagegl.ContextGLBlendFactor,r=t.stagegl.ContextGLCompareMode,s=t.textures.Texture2DBase,a=function(a){function o(t,i,n,o){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=!1),"undefined"==typeof o&&(o=!1),a.call(this),this._animateUVs=!1,this._alphaBlending=!1,this._alpha=1,this._alphaThreshold=0,this._specularLightSources=1,this._diffuseLightSources=3,this._ambientMethod=new e.AmbientBasicMethod,this._diffuseMethod=new e.DiffuseBasicMethod,this._normalMethod=new e.NormalBasicMethod,this._specularMethod=new e.SpecularBasicMethod,this._enableLightFallOff=!0,this._depthCompareMode=r.LESS_EQUAL,this._materialMode=e.TriangleMaterialMode.SINGLE_PASS,t instanceof s?(this.texture=t,this.smooth=null==i?!0:!1,this.repeat=n,this.mipmap=o):(this.color=t?Number(t):13421772,this.alpha=null==i?1:Number(i))}return __extends(o,a),Object.defineProperty(o.prototype,"materialMode",{get:function(){return this._materialMode},set:function(t){this._materialMode!=t&&(this._materialMode=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"animateUVs",{get:function(){return this._animateUVs},set:function(t){this._animateUVs=t,this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(t){this._depthCompareMode!=t&&(this._depthCompareMode=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t>1?t=1:0>t&&(t=0),this._alpha!=t&&(this._alpha=t,null==this._colorTransform&&(this._colorTransform=new i),this._colorTransform.alphaMultiplier=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"colorTransform",{get:function(){return this._screenPass.colorTransform},set:function(t){this._screenPass.colorTransform=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"color",{get:function(){return this._diffuseMethod.diffuseColor},set:function(t){this._diffuseMethod.diffuseColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"texture",{get:function(){return this._diffuseMethod.texture},set:function(t){this._diffuseMethod.texture=t,t&&(this._pHeight=t.height,this._pWidth=t.width)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ambientTexture",{get:function(){return this.ambientMethod.texture},set:function(t){this._ambientMethod.texture=t,this._diffuseMethod.iUseAmbientTexture=null!=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"enableLightFallOff",{get:function(){return this._enableLightFallOff},set:function(t){this._enableLightFallOff!=t&&(this._enableLightFallOff=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!=t&&(this._alphaThreshold=t,this._diffuseMethod.alphaThreshold=t,this._pDepthPass.alphaThreshold=t,this._pDistancePass.alphaThreshold=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"specularLightSources",{get:function(){return this._specularLightSources},set:function(t){this._specularLightSources=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"diffuseLightSources",{get:function(){return this._diffuseLightSources},set:function(t){this._diffuseLightSources=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(t){this._ambientMethod!=t&&(t&&this._ambientMethod&&t.copyFrom(this._ambientMethod),this._ambientMethod=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(t){this._shadowMethod!=t&&(t&&this._shadowMethod&&t.copyFrom(this._shadowMethod),this._shadowMethod=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(t){this._diffuseMethod!=t&&(t&&this._diffuseMethod&&t.copyFrom(this._diffuseMethod),this._diffuseMethod=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(t){this._specularMethod!=t&&(t&&this._specularMethod&&t.copyFrom(this._specularMethod),this._specularMethod=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(t){this._normalMethod!=t&&(t&&this._normalMethod&&t.copyFrom(this._normalMethod),this._normalMethod=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),o.prototype.addEffectMethod=function(t){null==this._screenPass&&(this._screenPass=new e.SuperShaderPass(this)),this._screenPass.addMethod(t),this.pInvalidateScreenPasses()},Object.defineProperty(o.prototype,"numEffectMethods",{get:function(){return this._screenPass?this._screenPass.numMethods:0},enumerable:!0,configurable:!0}),o.prototype.hasEffectMethod=function(t){return this._screenPass?this._screenPass.hasMethod(t):!1},o.prototype.getEffectMethodAt=function(t){return null==this._screenPass?null:this._screenPass.getMethodAt(t)},o.prototype.addEffectMethodAt=function(t,i){null==this._screenPass&&(this._screenPass=new e.SuperShaderPass(this)),this._screenPass.addMethodAt(t,i),this.pInvalidateScreenPasses()},o.prototype.removeEffectMethod=function(t){null!=this._screenPass&&(this._screenPass.removeMethod(t),0==this._screenPass.numMethods&&this.pInvalidateScreenPasses())},Object.defineProperty(o.prototype,"normalMap",{get:function(){return this._normalMethod.normalMap},set:function(t){this._normalMethod.normalMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"specularMap",{get:function(){return this._specularMethod.texture},set:function(t){this._specularMethod.texture=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"gloss",{get:function(){return this._specularMethod.gloss},set:function(t){this._specularMethod.gloss=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ambient",{get:function(){return this._ambientMethod.ambient},set:function(t){this._ambientMethod.ambient=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"specular",{get:function(){return this._specularMethod.specular},set:function(t){this._specularMethod.specular=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ambientColor",{get:function(){return this._ambientMethod.ambientColor},set:function(t){this._ambientMethod.ambientColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"specularColor",{get:function(){return this._specularMethod.specularColor},set:function(t){this._specularMethod.specularColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(t){this._alphaBlending!=t&&(this._alphaBlending=t,this.pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),o.prototype.iActivateForDepth=function(t,e,i){"undefined"==typeof i&&(i=!1),i?this._pDistancePass.alphaMask=this._diffuseMethod.texture:this._pDepthPass.alphaMask=this._diffuseMethod.texture,a.prototype.iActivateForDepth.call(this,t,e,i)},o.prototype.iUpdateMaterial=function(){var t;if(this._pScreenPassesInvalid&&(this.pUpdateScreenPasses(),t=!0),t||this.isAnyScreenPassInvalid()){if(this.pClearPasses(),this.pAddDepthPasses(),this._materialMode==e.TriangleMaterialMode.MULTI_PASS&&(this.pAddChildPassesFor(this._casterLightPass),this._nonCasterLightPasses))for(var i=0;i<this._nonCasterLightPasses.length;++i)this.pAddChildPassesFor(this._nonCasterLightPasses[i]);if(this.pAddChildPassesFor(this._screenPass),this._materialMode==e.TriangleMaterialMode.MULTI_PASS&&(this.addScreenPass(this._casterLightPass),this._nonCasterLightPasses))for(i=0;i<this._nonCasterLightPasses.length;++i)this.addScreenPass(this._nonCasterLightPasses[i]);this.addScreenPass(this._screenPass)}},o.prototype.addScreenPass=function(t){t&&(this.pAddPass(t),t._iPassesDirty=!1)},o.prototype.isAnyScreenPassInvalid=function(){if(this._casterLightPass&&this._casterLightPass._iPassesDirty||this._screenPass&&this._screenPass._iPassesDirty)return!0;if(this._nonCasterLightPasses)for(var t=0;t<this._nonCasterLightPasses.length;++t)if(this._nonCasterLightPasses[t]._iPassesDirty)return!0;return!1},o.prototype.iActivatePass=function(t,e,i){0==t&&e.context.setBlendFactors(n.ONE,n.ZERO),a.prototype.iActivatePass.call(this,t,e,i)},o.prototype.iDeactivate=function(t){a.prototype.iDeactivate.call(this,t),t.context.setBlendFactors(n.ONE,n.ZERO)},o.prototype.pUpdateScreenPasses=function(){this.initPasses(),this.setBlendAndCompareModes(),this._pScreenPassesInvalid=!1},o.prototype.initPasses=function(){0==this.numLights||this.numEffectMethods>0||this._materialMode==e.TriangleMaterialMode.SINGLE_PASS?this.initEffectsPass():this._screenPass&&this.removeEffectsPass(),this._shadowMethod&&this._materialMode==e.TriangleMaterialMode.MULTI_PASS?this.initCasterLightPass():this._casterLightPass&&this.removeCasterLightPass(),this.numNonCasters>0&&this._materialMode==e.TriangleMaterialMode.MULTI_PASS?this.initNonCasterLightPasses():this._nonCasterLightPasses&&this.removeNonCasterLightPasses()},o.prototype.setBlendAndCompareModes=function(){var e=this._casterLightPass||this._screenPass;if(this._casterLightPass&&(this._casterLightPass.setBlendMode(t.base.BlendMode.NORMAL),this._casterLightPass.depthCompareMode=this._depthCompareMode,this._casterLightPass.forceSeparateMVP=e),this._nonCasterLightPasses){var i=0;
this._casterLightPass||(this._nonCasterLightPasses[0].forceSeparateMVP=e,this._nonCasterLightPasses[0].setBlendMode(t.base.BlendMode.NORMAL),this._nonCasterLightPasses[0].depthCompareMode=this._depthCompareMode,i=1);for(var n=i;n<this._nonCasterLightPasses.length;++n)this._nonCasterLightPasses[n].forceSeparateMVP=e,this._nonCasterLightPasses[n].setBlendMode(t.base.BlendMode.ADD),this._nonCasterLightPasses[n].depthCompareMode=r.LESS_EQUAL}this._casterLightPass||this._nonCasterLightPasses?(this._pRequiresBlending=!1,this._screenPass&&(this._screenPass.iIgnoreLights=!0,this._screenPass.depthCompareMode=r.LESS_EQUAL,this._screenPass.setBlendMode(t.base.BlendMode.LAYER),this._screenPass.forceSeparateMVP=e)):this._screenPass&&(this._pRequiresBlending=this._pBlendMode!=t.base.BlendMode.NORMAL||this._alphaBlending||this._colorTransform&&this._colorTransform.alphaMultiplier<1,this._screenPass.iIgnoreLights=!1,this._screenPass.depthCompareMode=this._depthCompareMode,this._screenPass.preserveAlpha=this._pRequiresBlending,this._screenPass.colorTransform=this._colorTransform,this._screenPass.setBlendMode(this._pBlendMode==t.base.BlendMode.NORMAL&&this._pRequiresBlending?t.base.BlendMode.LAYER:this._pBlendMode),this._screenPass.forceSeparateMVP=!1)},o.prototype.initCasterLightPass=function(){null==this._casterLightPass&&(this._casterLightPass=new e.ShadowCasterPass(this)),this._casterLightPass.enableLightFallOff=this._enableLightFallOff,this._casterLightPass.animateUVs=this._animateUVs,this._casterLightPass.lightPicker=new e.StaticLightPicker([this._shadowMethod.castingLight]),this._casterLightPass.shadowMethod=this._shadowMethod,this._casterLightPass.diffuseMethod=this._diffuseMethod,this._casterLightPass.ambientMethod=this._ambientMethod,this._casterLightPass.normalMethod=this._normalMethod,this._casterLightPass.specularMethod=this._specularMethod,this._casterLightPass.diffuseLightSources=this._diffuseLightSources,this._casterLightPass.specularLightSources=this._specularLightSources},o.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose(),this.pRemovePass(this._casterLightPass),this._casterLightPass=null},o.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var t,i=this._pLightPicker.numDirectionalLights,n=this._pLightPicker.numPointLights,r=this._pLightPicker.numLightProbes,s=0,a=0,o=0;for(this._casterLightPass||(i+=this._pLightPicker.numCastingDirectionalLights,n+=this._pLightPicker.numCastingPointLights),this._nonCasterLightPasses=new Array;i>s||n>a||r>o;)t=new e.LightingPass(this),t.enableLightFallOff=this._enableLightFallOff,t.animateUVs=this._animateUVs,t.includeCasters=null==this._shadowMethod,t.directionalLightsOffset=s,t.pointLightsOffset=a,t.lightProbesOffset=o,t.lightPicker=this._pLightPicker,t.diffuseMethod=this._diffuseMethod,t.ambientMethod=this._ambientMethod,t.normalMethod=this._normalMethod,t.specularMethod=this._specularMethod,t.diffuseLightSources=this._diffuseLightSources,t.specularLightSources=this._specularLightSources,this._nonCasterLightPasses.push(t),s+=t.iNumDirectionalLights,a+=t.iNumPointLights,o+=t.iNumLightProbes},o.prototype.removeNonCasterLightPasses=function(){if(this._nonCasterLightPasses){for(var t=0;t<this._nonCasterLightPasses.length;++t)this.pRemovePass(this._nonCasterLightPasses[t]),this._nonCasterLightPasses[t].dispose();this._nonCasterLightPasses=null}},o.prototype.removeEffectsPass=function(){this._screenPass.ambientMethod!=this._ambientMethod&&this._screenPass.ambientMethod.dispose(),this._screenPass.diffuseMethod!=this._diffuseMethod&&this._screenPass.diffuseMethod.dispose(),this._screenPass.specularMethod!=this._specularMethod&&this._screenPass.specularMethod.dispose(),this._screenPass.normalMethod!=this._normalMethod&&this._screenPass.normalMethod.dispose(),this.pRemovePass(this._screenPass),this._screenPass.dispose(),this._screenPass=null},o.prototype.initEffectsPass=function(){null==this._screenPass&&(this._screenPass=new e.SuperShaderPass(this)),this._screenPass.enableLightFallOff=this._enableLightFallOff,this._screenPass.animateUVs=this._animateUVs,this._materialMode==e.TriangleMaterialMode.SINGLE_PASS?(this._screenPass.ambientMethod=this._ambientMethod,this._screenPass.diffuseMethod=this._diffuseMethod,this._screenPass.specularMethod=this._specularMethod,this._screenPass.normalMethod=this._normalMethod,this._screenPass.shadowMethod=this._shadowMethod):this._materialMode==e.TriangleMaterialMode.MULTI_PASS&&(0==this.numLights?this._screenPass.diffuseMethod=this._diffuseMethod:(this._screenPass.diffuseMethod=new e.DiffuseBasicMethod,this._screenPass.diffuseMethod.diffuseColor=0,this._screenPass.diffuseMethod.diffuseAlpha=0),this._screenPass.preserveAlpha=!1,this._screenPass.normalMethod=this._normalMethod)},Object.defineProperty(o.prototype,"numLights",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights+this._pLightPicker.numCastingDirectionalLights+this._pLightPicker.numCastingPointLights:0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"numNonCasters",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights:0},enumerable:!0,configurable:!0}),o}(e.ShadowMaterialBase);e.TriangleMaterial=a}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.SINGLE_PASS="singlePass",t.MULTI_PASS="multiPass",t}();t.TriangleMaterialMode=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),Object.defineProperty(e.prototype,"lightVertexConstantIndex",{get:function(){return this._lightVertexConstantIndex},enumerable:!0,configurable:!0}),e.prototype.pInitRegisterIndices=function(){t.prototype.pInitRegisterIndices.call(this),this._lightVertexConstantIndex=-1},e.prototype.pCreateNormalRegisters=function(){this.tangentSpace&&(this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1),this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1),this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString())),this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute(),this._pNormalBufferIndex=this._pSharedRegisters.normalInput.index,this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1),this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString())},Object.defineProperty(e.prototype,"tangentSpace",{get:function(){return 0==this._pNumLightProbes&&this._pMethodSetup._iNormalMethod.iHasOutput&&this._pMethodSetup._iNormalMethod.iTangentSpace},enumerable:!0,configurable:!0}),e.prototype.pInitLightData=function(){t.prototype.pInitLightData.call(this),this._pointLightVertexConstants=new Array(this._pNumPointLights),this._pointLightFragmentConstants=new Array(2*this._pNumPointLights),this.tangentSpace?(this._dirLightVertexConstants=new Array(this._pNumDirectionalLights),this._dirLightFragmentConstants=new Array(2*this._pNumDirectionalLights)):this._dirLightFragmentConstants=new Array(3*this._pNumDirectionalLights)},e.prototype.pCalculateDependencies=function(){t.prototype.pCalculateDependencies.call(this),this.tangentSpace||this._pDependencyCounter.addWorldSpaceDependencies(!1)},e.prototype.pCompileNormalCode=function(){if(this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pDependencyCounter.normalDependencies),this._pMethodSetup._iNormalMethod.iHasOutput&&!this._pMethodSetup._iNormalMethod.iTangentSpace)return this._pVertexCode+=this._pMethodSetup._iNormalMethod.iGetVertexCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache),void(this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache,this._pSharedRegisters.normalFragment));if(this.tangentSpace)this.compileTangentSpaceNormalMapCode();else{var t=new Array(3);t[0]=this._pRegisterCache.getFreeVertexConstant(),t[1]=this._pRegisterCache.getFreeVertexConstant(),t[2]=this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pSceneNormalMatrixIndex=4*t[0].index,this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+t[0]+"\nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w	\n",this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w		\n"}this._pDependencyCounter.tangentDependencies>0&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying())},e.prototype.compileTangentSpaceNormalMapCode=function(){this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\n",this._pVertexCode+="crs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n",this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache,this._pSharedRegisters.normalFragment),this._pMethodSetup._iNormalMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment),(this._pMethodSetup._iNormalMethodVO.needsGlobalFragmentPos||this._pMethodSetup._iNormalMethodVO.needsGlobalVertexPos)&&this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex)},e.prototype.pCompileViewDirCode=function(){var t=this._pRegisterCache.getFreeVertexConstant();if(this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pDependencyCounter.viewDirDependencies),this._pCameraPositionIndex=4*t.index,this.tangentSpace){var e=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+e+", "+t+", "+this._pSharedRegisters.localPosition+"\nm33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+e+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+t+", "+this._pSharedRegisters.globalPositionVertex+"\n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\nmov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w 		\n"},e.prototype.pCompileLightingCode=function(){this._pMethodSetup._iShadowMethod&&this.compileShadowCode(),this._pMethodSetup._iDiffuseMethod.iShadowRegister=this._shadowRegister,this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1),this._pVertexCode+=this._pMethodSetup._iDiffuseMethod.iGetVertexCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache),this._usingSpecularMethod&&(this._pVertexCode+=this._pMethodSetup._iSpecularMethod.iGetVertexCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache)),this.pUsesLights()&&(this.initLightRegisters(),this.compileDirectionalLightCode(),this.compilePointLightCode()),this.pUsesProbes()&&this.compileLightProbeCode(),this._pVertexCode+=this._pMethodSetup._iAmbientMethod.iGetVertexCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iAmbientMethod.iGetFragmentCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget),this._pMethodSetup._iAmbientMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iAmbientMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment),this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget),this._pAlphaPremultiplied&&(this._pFragmentCode+="add "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.commons+".z\ndiv "+this._pSharedRegisters.shadedTarget+".xyz, "+this._pSharedRegisters.shadedTarget+", "+this._pSharedRegisters.shadedTarget+".w\nsub "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.commons+".z\nsat "+this._pSharedRegisters.shadedTarget+".xyz, "+this._pSharedRegisters.shadedTarget+"\n"),this._pMethodSetup._iDiffuseMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iDiffuseMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment),this._usingSpecularMethod&&(this._pMethodSetup._iSpecularMethod.iShadowRegister=this._shadowRegister,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget),this._pMethodSetup._iSpecularMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iSpecularMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment)),this._pMethodSetup._iShadowMethod&&this._pRegisterCache.removeFragmentTempUsage(this._shadowRegister)},e.prototype.compileShadowCode=function(){this._shadowRegister=this._pSharedRegisters.normalFragment?this._pSharedRegisters.normalFragment:this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._shadowRegister,1),this._pVertexCode+=this._pMethodSetup._iShadowMethod.iGetVertexCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iShadowMethod.iGetFragmentCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache,this._shadowRegister)},e.prototype.initLightRegisters=function(){var t,e;if(this._dirLightVertexConstants)for(e=this._dirLightVertexConstants.length,t=0;e>t;++t)this._dirLightVertexConstants[t]=this._pRegisterCache.getFreeVertexConstant(),-1==this._lightVertexConstantIndex&&(this._lightVertexConstantIndex=4*this._dirLightVertexConstants[t].index);for(e=this._pointLightVertexConstants.length,t=0;e>t;++t)this._pointLightVertexConstants[t]=this._pRegisterCache.getFreeVertexConstant(),-1==this._lightVertexConstantIndex&&(this._lightVertexConstantIndex=4*this._pointLightVertexConstants[t].index);for(e=this._dirLightFragmentConstants.length,t=0;e>t;++t)this._dirLightFragmentConstants[t]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*this._dirLightFragmentConstants[t].index);for(e=this._pointLightFragmentConstants.length,t=0;e>t;++t)this._pointLightFragmentConstants[t]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*this._pointLightFragmentConstants[t].index)},e.prototype.compileDirectionalLightCode=function(){var t,e,i,n=0,r=0,s=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),a=this.pUsesLightsForDiffuse();if(s||a)for(var o=0;o<this._pNumDirectionalLights;++o){if(this.tangentSpace){i=this._dirLightVertexConstants[n++];var h=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+h+".xyz, "+i+", "+this._pSharedRegisters.animatedTangent+"\nmov "+h+".w, "+i+".w\n",i=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addVertexTempUsages(i,1),this._pFragmentCode+="nrm "+i+".xyz, "+h+"\n",this._pFragmentCode+="mov "+i+".w, "+h+".w\n"}else i=this._dirLightFragmentConstants[r++];t=this._dirLightFragmentConstants[r++],e=this._dirLightFragmentConstants[r++],a&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,i,t,this._pRegisterCache)),s&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,i,e,this._pRegisterCache)),this.tangentSpace&&this._pRegisterCache.removeVertexTempUsage(i)}},e.prototype.compilePointLightCode=function(){var t,e,i,n,r=0,s=0,a=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),o=this.pUsesLightsForDiffuse();if(a||o)for(var h=0;h<this._pNumPointLights;++h){i=this._pointLightVertexConstants[r++],t=this._pointLightFragmentConstants[s++],e=this._pointLightFragmentConstants[s++],n=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(n,1);var p=this._pRegisterCache.getFreeVarying();if(this.tangentSpace){var u=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+u+", "+i+", "+this._pSharedRegisters.localPosition+"\nm33 "+p+".xyz, "+u+", "+this._pSharedRegisters.animatedTangent+"\nmov "+p+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._pVertexCode+="sub "+p+", "+i+", "+this._pSharedRegisters.globalPositionVertex+"\n";this._pFragmentCode+=this._pEnableLightFallOff&&"baselineConstrained"!=this._pProfile?"dp3 "+n+".w, "+p+", "+p+"\nsub "+n+".w, "+n+".w, "+t+".w\nmul "+n+".w, "+n+".w, "+e+".w\nsat "+n+".w, "+n+".w\nsub "+n+".w, "+this._pSharedRegisters.commons+".w, "+n+".w\nnrm "+n+".xyz, "+p+"\n":"nrm "+n+".xyz, "+p+"\nmov "+n+".w, "+p+".w\n",-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*i.index),o&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,n,t,this._pRegisterCache)),a&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,n,e,this._pRegisterCache)),this._pRegisterCache.removeFragmentTempUsage(n)}},e.prototype.compileLightProbeCode=function(){var t,e,i,n=[".x",".y",".z",".w"],r=new Array,s=this._usingSpecularMethod&&this.pUsesProbesForSpecular(),a=this.pUsesProbesForDiffuse();if(s||a){for(a&&(this._pLightProbeDiffuseIndices=new Array),s&&(this._pLightProbeSpecularIndices=new Array),e=0;e<this._pNumProbeRegisters;++e)r[e]=this._pRegisterCache.getFreeFragmentConstant(),0==e&&(this._pProbeWeightsIndex=4*r[e].index);for(e=0;e<this._pNumLightProbes;++e)t=r[Math.floor(e/4)].toString()+n[e%4],a&&(i=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeDiffuseIndices[e]=i.index,this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iDiffuseMethodVO,i,t,this._pRegisterCache)),s&&(i=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeSpecularIndices[e]=i.index,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iSpecularMethodVO,i,t,this._pRegisterCache))}},e}(t.ShaderCompiler);t.LightingShaderCompiler=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i){"undefined"==typeof i&&(i=1.25),e.call(this),this.bothSides=!0,this.pAddDepthPasses(),this.pAddPass(this._screenPass=new t.SegmentPass(this)),this._screenPass.thickness=i}return __extends(i,e),i}(t.ShadowMaterialBase);t.LineMaterial=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n,r,s){"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!1),"undefined"==typeof s&&(s=!1),e.call(this),this._cubeMap=i,this.pAddPass(this._skyboxPass=new t.SkyboxPass(this)),this._skyboxPass.cubeTexture=this._cubeMap}return __extends(i,e),Object.defineProperty(i.prototype,"cubeMap",{get:function(){return this._cubeMap},set:function(t){t&&this._cubeMap&&(t.hasMipmaps!=this._cubeMap.hasMipmaps||t.format!=this._cubeMap.format)&&this.iInvalidatePasses(null),this._cubeMap=t,this._skyboxPass.cubeTexture=this._cubeMap},enumerable:!0,configurable:!0}),i}(t.MaterialBase);t.SkyboxMaterial=e}(t.materials||(t.materials={})),t.materials}(away||(away={}));var away;!function(t){!function(e){var i=function(t){function e(e){"undefined"==typeof e&&(e=null),t.call(this,e)}return __extends(e,t),e.prototype.perspectiveFieldOfViewLH=function(t,e,i,n){var r=1/Math.tan(t/2),s=r/e;this.copyRawDataFrom([s,0,0,0,0,r,0,0,0,0,n/(n-i),1,0,0,i*n/(i-n),0])},e}(t.geom.Matrix3D);e.PerspectiveMatrix3D=i}(t.utils||(t.utils={})),t.utils}(away||(away={}));var away;!function(t){!function(e){var i=t.materials.ShaderRegisterElement,n=function(t){function e(e){t.call(this,e),this.indexDictionary=new Object,this.vertexConstantData=new Array,this.fragmentConstantData=new Array}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.rotationRegisters=new Array,this.positionAttribute=this.getRegisterFromString(this.sourceRegisters[0]),this.scaleAndRotateTarget=this.getRegisterFromString(this.targetRegisters[0]),this.addVertexTempUsages(this.scaleAndRotateTarget,1);for(var e=1;e<this.targetRegisters.length;e++)this.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[e])),this.addVertexTempUsages(this.rotationRegisters[e-1],1);if(this.scaleAndRotateTarget=new i(this.scaleAndRotateTarget.regName,this.scaleAndRotateTarget.index),this.vertexZeroConst=this.getFreeVertexConstant(),this.vertexZeroConst=new i(this.vertexZeroConst.regName,this.vertexZeroConst.index,0),this.vertexOneConst=new i(this.vertexZeroConst.regName,this.vertexZeroConst.index,1),this.vertexTwoConst=new i(this.vertexZeroConst.regName,this.vertexZeroConst.index,2),this.positionTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.positionTarget,1),this.positionTarget=new i(this.positionTarget.regName,this.positionTarget.index),this.needVelocity)this.velocityTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.velocityTarget,1),this.velocityTarget=new i(this.velocityTarget.regName,this.velocityTarget.index),this.vertexTime=new i(this.velocityTarget.regName,this.velocityTarget.index,3),this.vertexLife=new i(this.positionTarget.regName,this.positionTarget.index,3);else{var n=this.getFreeVertexVectorTemp();this.addVertexTempUsages(n,1),this.vertexTime=new i(n.regName,n.index,0),this.vertexLife=new i(n.regName,n.index,1)}},e.prototype.setUVSourceAndTarget=function(t,e){this.uvVar=this.getRegisterFromString(e),this.uvAttribute=this.getRegisterFromString(t),this.uvTarget=new i(this.positionTarget.regName,this.positionTarget.index)},e.prototype.setRegisterIndex=function(t,e,i){var n=this.indexDictionary[t.id];null==n&&(n=this.indexDictionary[t.id]=new Array(8)),n[e]=i},e.prototype.getRegisterIndex=function(t,e){return this.indexDictionary[t.id][e]},e.prototype.getInitCode=function(){for(var t=this.sourceRegisters.length,e="",i=0;t>i;i++)e+="mov "+this.targetRegisters[i]+","+this.sourceRegisters[i]+"\n";return e+="mov "+this.positionTarget+".xyz,"+this.vertexZeroConst.toString()+"\n",this.needVelocity&&(e+="mov "+this.velocityTarget+".xyz,"+this.vertexZeroConst.toString()+"\n"),e},e.prototype.getCombinationCode=function(){return"add "+this.scaleAndRotateTarget+".xyz,"+this.scaleAndRotateTarget+".xyz,"+this.positionTarget+".xyz\n"},e.prototype.initColorRegisters=function(){var t="";return this.hasColorMulNode&&(this.colorMulTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorMulTarget,1),this.colorMulVary=this.getFreeVarying(),t+="mov "+this.colorMulTarget+","+this.vertexOneConst+"\n"),this.hasColorAddNode&&(this.colorAddTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorAddTarget,1),this.colorAddVary=this.getFreeVarying(),t+="mov "+this.colorAddTarget+","+this.vertexZeroConst+"\n"),t},e.prototype.getColorPassCode=function(){var t="";return this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)&&(this.hasColorMulNode&&(t+="mov "+this.colorMulVary+","+this.colorMulTarget+"\n"),this.hasColorAddNode&&(t+="mov "+this.colorAddVary+","+this.colorAddTarget+"\n")),t},e.prototype.getColorCombinationCode=function(t){var e="";if(this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){var i=this.getRegisterFromString(t);this.addFragmentTempUsages(i,1),this.hasColorMulNode&&(e+="mul "+i+","+i+","+this.colorMulVary+"\n"),this.hasColorAddNode&&(e+="add "+i+","+i+","+this.colorAddVary+"\n")}return e},e.prototype.getRegisterFromString=function(t){var e=t.split(/(\d+)/);return new i(e[0],parseInt(e[1]))},Object.defineProperty(e.prototype,"numVertexConstant",{get:function(){return this._numVertexConstant},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFragmentConstant",{get:function(){return this._numFragmentConstant},enumerable:!0,configurable:!0}),e.prototype.setDataLength=function(){this._numVertexConstant=this.numUsedVertexConstants-this.vertexConstantOffset,this._numFragmentConstant=this.numUsedFragmentConstants-this.fragmentConstantOffset,this.vertexConstantData.length=4*this._numVertexConstant,this.fragmentConstantData.length=4*this._numFragmentConstant},e.prototype.setVertexConst=function(t,e,i,n,r){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0);var s=4*(t-this.vertexConstantOffset);this.vertexConstantData[s++]=e,this.vertexConstantData[s++]=i,this.vertexConstantData[s++]=n,this.vertexConstantData[s]=r},e.prototype.setVertexConstFromArray=function(t,e){for(var i=4*(t-this.vertexConstantOffset),n=0;n<e.length;n++)this.vertexConstantData[i++]=e[n]},e.prototype.setVertexConstFromMatrix=function(t,e){var i=e.rawData,n=4*(t-this.vertexConstantOffset);this.vertexConstantData[n++]=i[0],this.vertexConstantData[n++]=i[4],this.vertexConstantData[n++]=i[8],this.vertexConstantData[n++]=i[12],this.vertexConstantData[n++]=i[1],this.vertexConstantData[n++]=i[5],this.vertexConstantData[n++]=i[9],this.vertexConstantData[n++]=i[13],this.vertexConstantData[n++]=i[2],this.vertexConstantData[n++]=i[6],this.vertexConstantData[n++]=i[10],this.vertexConstantData[n++]=i[14],this.vertexConstantData[n++]=i[3],this.vertexConstantData[n++]=i[7],this.vertexConstantData[n++]=i[11],this.vertexConstantData[n]=i[15]},e.prototype.setFragmentConst=function(t,e,i,n,r){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0);var s=4*(t-this.fragmentConstantOffset);this.fragmentConstantData[s++]=e,this.fragmentConstantData[s++]=i,this.fragmentConstantData[s++]=n,this.fragmentConstantData[s]=r},e}(t.materials.ShaderRegisterCache);e.AnimationRegisterCache=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){this._pVertexBuffer=new Array(8),this._pBufferContext=new Array(8),this._pBufferDirty=new Array(8),this.numProcessedVertices=0,this.previousTime=Number.NEGATIVE_INFINITY,this.animationParticles=new Array;for(var e=0;8>e;e++)this._pBufferDirty[e]=!0;this._iUniqueId=t.SUBGEOM_ID_COUNT++}return t.prototype.createVertexData=function(t,e){this._numVertices=t,this._totalLenOfOneVertex=e,this._pVertexData=new Array(t*e)},t.prototype.activateVertexBuffer=function(t,e,i,n){var r=i.stageIndex,s=i.context,a=this._pVertexBuffer[r];a&&this._pBufferContext[r]==s||(a=this._pVertexBuffer[r]=s.createVertexBuffer(this._numVertices,this._totalLenOfOneVertex),this._pBufferContext[r]=s,this._pBufferDirty[r]=!0),this._pBufferDirty[r]&&(a.uploadFromArray(this._pVertexData,0,this._numVertices),this._pBufferDirty[r]=!1),s.setVertexBufferAt(t,a,e,n)},t.prototype.dispose=function(){for(;this._pVertexBuffer.length;){var t=this._pVertexBuffer.pop();t&&t.dispose()}},t.prototype.invalidateBuffer=function(){for(var t=0;8>t;t++)this._pBufferDirty[t]=!0},Object.defineProperty(t.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:!0,configurable:!0}),t.SUBGEOM_ID_COUNT=0,t}();t.AnimationSubGeometry=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e){if(0>=t||t>=1)throw new Error("life exceeds range (0,1)");this._life=t,this._color=e}return Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"life",{get:function(){return this._life},enumerable:!0,configurable:!0}),t}();t.ColorSegmentPoint=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=t.geom.Matrix3D,r=t.geom.Quaternion,s=function(){function t(){this.orientation=new r,this.translation=new i}return t.prototype.toMatrix3D=function(t){return"undefined"==typeof t&&(t=null),null==t&&(t=new n),this.orientation.toMatrix3D(t),t.appendTranslation(this.translation.x,this.translation.y,this.translation.z),t},t.prototype.copyFrom=function(t){var e=t.orientation,i=t.translation;this.orientation.x=e.x,this.orientation.y=e.y,this.orientation.z=e.z,this.orientation.w=e.w,this.translation.x=i.x,this.translation.y=i.y,this.translation.z=i.z},t}();e.JointPose=s}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(t,e,i,n,r){this.index=t,this.startTime=e,this.totalTime=i+n,this.duration=i,this.delay=n,this.startVertexIndex=r.startVertexIndex,this.numVertices=r.numVertices}return t}();t.ParticleAnimationData=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t}();t.ParticleData=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t}();t.ParticleProperties=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.GLOBAL=0,t.LOCAL_STATIC=1,t.LOCAL_DYNAMIC=2,t}();t.ParticlePropertiesMode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.library.AssetType,n=function(t){function e(){t.call(this),this.joints=new Array}return __extends(e,t),Object.defineProperty(e.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),e.prototype.jointFromName=function(t){var e=this.jointIndexFromName(t);return-1!=e?this.joints[e]:null},e.prototype.jointIndexFromName=function(t){for(var e,i,n;n<this.joints.length;n++){if(i=this.joints[n],i.name==t)return e;e++}return-1},e.prototype.dispose=function(){this.joints.length=0},Object.defineProperty(e.prototype,"assetType",{get:function(){return i.SKELETON},enumerable:!0,configurable:!0}),e}(t.library.NamedAssetBase);e.Skeleton=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){}return t.ADDITIVE="additive",t.ABSOLUTE="absolute",t
}();t.VertexAnimationMode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function t(){this.parentIndex=-1}return t}();t.SkeletonJoint=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.library.AssetType,n=function(t){function n(){t.call(this),this.jointPoses=new Array}return __extends(n,t),Object.defineProperty(n.prototype,"numJointPoses",{get:function(){return this.jointPoses.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"assetType",{get:function(){return i.SKELETON_POSE},enumerable:!0,configurable:!0}),n.prototype.jointPoseFromName=function(t){var e=this.jointPoseIndexFromName(t);return-1!=e?this.jointPoses[e]:null},n.prototype.jointPoseIndexFromName=function(t){for(var e,i,n;n<this.jointPoses.length;n++){if(i=this.jointPoses[n],i.name==t)return e;e++}return-1},n.prototype.clone=function(){for(var t=new n,i=this.jointPoses.length,r=0;i>r;r++){var s=new e.JointPose,a=this.jointPoses[r];s.name=a.name,s.copyFrom(a),t.jointPoses[r]=s}return t},n.prototype.dispose=function(){this.jointPoses.length=0},n}(t.library.NamedAssetBase);e.SkeletonPose=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this),this._pLooping=!0,this._pTotalDuration=0,this._pStitchDirty=!0,this._pStitchFinalFrame=!1,this._pNumFrames=0,this._pDurations=new Array,this._pTotalDelta=new t.geom.Vector3D,this.fixedFrameRate=!0}return __extends(i,e),Object.defineProperty(i.prototype,"looping",{get:function(){return this._pLooping},set:function(t){this._pLooping!=t&&(this._pLooping=t,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(t){this._pStitchFinalFrame!=t&&(this._pStitchFinalFrame=t,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalDuration",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDuration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalDelta",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDelta},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastFrame",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pLastFrame},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"durations",{get:function(){return this._pDurations},enumerable:!0,configurable:!0}),i.prototype._pUpdateStitch=function(){this._pStitchDirty=!1,this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1,this._pTotalDuration=0,this._pTotalDelta.x=0,this._pTotalDelta.y=0,this._pTotalDelta.z=0},i}(e.AnimationNodeBase);e.AnimationClipNodeBase=i}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(i,n,r,s){"undefined"==typeof s&&(s=1),t.call(this),this._pDataLength=3,i+=e.MODES[n],this.name=i,this._pMode=n,this._priority=s,this._pDataLength=r,this._pOneData=new Array(this._pDataLength)}return __extends(e,t),Object.defineProperty(e.prototype,"mode",{get:function(){return this._pMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oneData",{get:function(){return this._pOneData},enumerable:!0,configurable:!0}),e.prototype.getAGALVertexCode=function(){return""},e.prototype.getAGALFragmentCode=function(){return""},e.prototype.getAGALUVCode=function(){return""},e.prototype._iGeneratePropertyOfOneParticle=function(){},e.prototype._iProcessAnimationSetting=function(){},e.GLOBAL="Global",e.LOCAL_STATIC="LocalStatic",e.LOCAL_DYNAMIC="LocalDynamic",e.MODES={0:e.GLOBAL,1:e.LOCAL_STATIC,2:e.LOCAL_DYNAMIC},e}(t.AnimationNodeBase);t.ParticleNodeBase=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=function(t){function n(n,r){"undefined"==typeof r&&(r=null),t.call(this,"ParticleAcceleration",n,3),this._pStateClass=e.ParticleAccelerationState,this._acceleration=r||new i}return __extends(n,t),n.prototype.pGetAGALVertexCode=function(t,i){var r=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,n.ACCELERATION_INDEX,r.index);var s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1);var a="mul "+s+","+i.vertexTime+","+r+"\n";if(i.needVelocity){var o=i.getFreeVertexVectorTemp();a+="mul "+o+","+s+","+i.vertexTwoConst+"\n",a+="add "+i.velocityTarget+".xyz,"+o+".xyz,"+i.velocityTarget+".xyz\n"}return i.removeVertexTempUsage(s),a+="mul "+s+","+s+","+i.vertexTime+"\n",a+="add "+i.positionTarget+".xyz,"+s+","+i.positionTarget+".xyz\n"},n.prototype.getAnimationState=function(t){return t.getAnimationState(this)},n.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[n.ACCELERATION_VECTOR3D];if(!e)throw new Error("there is no "+n.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=e.x/2,this._pOneData[1]=e.y/2,this._pOneData[2]=e.z/2},n.ACCELERATION_INDEX=0,n.ACCELERATION_VECTOR3D="AccelerationVector3D",n}(e.ParticleNodeBase);e.ParticleAccelerationNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=t.materials.ShaderRegisterElement,r=function(t){function r(n,r,s){"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=null),t.call(this,"ParticleBezierCurve",n,6),this._pStateClass=e.ParticleBezierCurveState,this._iControlPoint=r||new i,this._iEndPoint=s||new i}return __extends(r,t),r.prototype.getAGALVertexCode=function(t,i){t=t;var s=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,r.BEZIER_CONTROL_INDEX,s.index);var a=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,r.BEZIER_END_INDEX,a.index);var o=i.getFreeVertexVectorTemp(),h=new n(o.regName,o.index,0),p=new n(o.regName,o.index,1),u=new n(o.regName,o.index,2);i.addVertexTempUsages(o,1);var l=i.getFreeVertexVectorTemp(),c=new n(l.regName,l.index);i.removeVertexTempUsage(o);var d="";return d+="sub "+h+","+i.vertexOneConst+","+i.vertexLife+"\n",d+="mul "+p+","+i.vertexLife+","+i.vertexLife+"\n",d+="mul "+u+","+i.vertexLife+","+h+"\n",d+="mul "+u+","+u+","+i.vertexTwoConst+"\n",d+="mul "+c+".xyz,"+u+","+s+"\n",d+="add "+i.positionTarget+".xyz,"+c+".xyz,"+i.positionTarget+".xyz\n",d+="mul "+c+".xyz,"+p+","+a+"\n",d+="add "+i.positionTarget+".xyz,"+c+".xyz,"+i.positionTarget+".xyz\n",i.needVelocity&&(d+="mul "+p+","+i.vertexLife+","+i.vertexTwoConst+"\n",d+="sub "+u+","+i.vertexOneConst+","+p+"\n",d+="mul "+u+","+i.vertexTwoConst+","+u+"\n",d+="mul "+c+".xyz,"+s+","+u+"\n",d+="add "+i.velocityTarget+".xyz,"+c+".xyz,"+i.velocityTarget+".xyz\n",d+="mul "+c+".xyz,"+a+","+p+"\n",d+="add "+i.velocityTarget+".xyz,"+c+".xyz,"+i.velocityTarget+".xyz\n"),d},r.prototype.getAnimationState=function(t){return t.getAnimationState(this)},r.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[r.BEZIER_CONTROL_VECTOR3D];if(!e)throw new Error("there is no "+r.BEZIER_CONTROL_VECTOR3D+" in param!");var i=t[r.BEZIER_END_VECTOR3D];if(!i)throw new Error("there is no "+r.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=e.x,this._pOneData[1]=e.y,this._pOneData[2]=e.z,this._pOneData[3]=i.x,this._pOneData[4]=i.y,this._pOneData[5]=i.z},r.BEZIER_CONTROL_INDEX=0,r.BEZIER_END_INDEX=1,r.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D",r.BEZIER_END_VECTOR3D="BezierEndVector3D",r}(e.ParticleNodeBase);e.ParticleBezierCurveNode=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i){"undefined"==typeof i&&(i=null),e.call(this,"ParticleBillboard",t.ParticlePropertiesMode.GLOBAL,0,4),this._pStateClass=t.ParticleBillboardState,this._iBillboardAxis=i}return __extends(i,e),i.prototype.getAGALVertexCode=function(t,e){var n=e.getFreeVertexConstant();e.setRegisterIndex(this,i.MATRIX_INDEX,n.index),e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant();for(var r,s=e.getFreeVertexVectorTemp(),a="m33 "+s+".xyz,"+e.scaleAndRotateTarget+","+n+"\nmov "+e.scaleAndRotateTarget+".xyz,"+s+"\n",o=0;o<e.rotationRegisters.length;o++)r=e.rotationRegisters[o],a+="m33 "+s+".xyz,"+r+","+n+"\nmov "+r+".xyz,"+r+"\n";return a},i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i.prototype._iProcessAnimationSetting=function(t){t.hasBillboard=!0},i.MATRIX_INDEX=0,i}(t.ParticleNodeBase);t.ParticleBillboardNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.ColorTransform,n=function(t){function n(n,r,s,a,o,h,p,u,l){"undefined"==typeof r&&(r=!0),"undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=!1),"undefined"==typeof o&&(o=!1),"undefined"==typeof h&&(h=null),"undefined"==typeof p&&(p=null),"undefined"==typeof u&&(u=1),"undefined"==typeof l&&(l=0),t.call(this,"ParticleColor",n,r&&s?16:8,e.ParticleAnimationSet.COLOR_PRIORITY),this._pStateClass=e.ParticleColorState,this._iUsesMultiplier=r,this._iUsesOffset=s,this._iUsesCycle=a,this._iUsesPhase=o,this._iStartColor=h||new i,this._iEndColor=p||new i,this._iCycleDuration=u,this._iCyclePhase=l}return __extends(n,t),n.prototype.getAGALVertexCode=function(t,i){var r="";if(i.needFragmentAnimation){var s=i.getFreeVertexVectorTemp();if(this._iUsesCycle){var a=i.getFreeVertexConstant();i.setRegisterIndex(this,n.CYCLE_INDEX,a.index),i.addVertexTempUsages(s,1);var o=i.getFreeVertexSingleTemp();i.removeVertexTempUsage(s),r+="mul "+o+","+i.vertexTime+","+a+".x\n",this._iUsesPhase&&(r+="add "+o+","+o+","+a+".y\n"),r+="sin "+o+","+o+"\n"}if(this._iUsesMultiplier){var h=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute(),p=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,n.START_MULTIPLIER_INDEX,h.index),i.setRegisterIndex(this,n.DELTA_MULTIPLIER_INDEX,p.index),r+="mul "+s+","+p+","+(this._iUsesCycle?o:i.vertexLife)+"\n",r+="add "+s+","+s+","+h+"\n",r+="mul "+i.colorMulTarget+","+s+","+i.colorMulTarget+"\n"}if(this._iUsesOffset){var u=this._pMode==e.ParticlePropertiesMode.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant(),l=this._pMode==e.ParticlePropertiesMode.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant();i.setRegisterIndex(this,n.START_OFFSET_INDEX,u.index),i.setRegisterIndex(this,n.DELTA_OFFSET_INDEX,l.index),r+="mul "+s+","+l+","+(this._iUsesCycle?o:i.vertexLife)+"\n",r+="add "+s+","+s+","+u+"\n",r+="add "+i.colorAddTarget+","+s+","+i.colorAddTarget+"\n"}}return r},n.prototype.getAnimationState=function(t){return t.getAnimationState(this)},n.prototype._iProcessAnimationSetting=function(t){this._iUsesMultiplier&&(t.hasColorMulNode=!0),this._iUsesOffset&&(t.hasColorAddNode=!0)},n.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[n.COLOR_START_COLORTRANSFORM];if(!e)throw new Error("there is no "+n.COLOR_START_COLORTRANSFORM+" in param!");var i=t[n.COLOR_END_COLORTRANSFORM];if(!i)throw new Error("there is no "+n.COLOR_END_COLORTRANSFORM+" in param!");var r=0;this._iUsesCycle?(this._iUsesMultiplier&&(this._pOneData[r++]=(e.redMultiplier+i.redMultiplier)/2,this._pOneData[r++]=(e.greenMultiplier+i.greenMultiplier)/2,this._pOneData[r++]=(e.blueMultiplier+i.blueMultiplier)/2,this._pOneData[r++]=(e.alphaMultiplier+i.alphaMultiplier)/2,this._pOneData[r++]=(e.redMultiplier-i.redMultiplier)/2,this._pOneData[r++]=(e.greenMultiplier-i.greenMultiplier)/2,this._pOneData[r++]=(e.blueMultiplier-i.blueMultiplier)/2,this._pOneData[r++]=(e.alphaMultiplier-i.alphaMultiplier)/2),this._iUsesOffset&&(this._pOneData[r++]=(e.redOffset+i.redOffset)/510,this._pOneData[r++]=(e.greenOffset+i.greenOffset)/510,this._pOneData[r++]=(e.blueOffset+i.blueOffset)/510,this._pOneData[r++]=(e.alphaOffset+i.alphaOffset)/510,this._pOneData[r++]=(e.redOffset-i.redOffset)/510,this._pOneData[r++]=(e.greenOffset-i.greenOffset)/510,this._pOneData[r++]=(e.blueOffset-i.blueOffset)/510,this._pOneData[r++]=(e.alphaOffset-i.alphaOffset)/510)):(this._iUsesMultiplier&&(this._pOneData[r++]=e.redMultiplier,this._pOneData[r++]=e.greenMultiplier,this._pOneData[r++]=e.blueMultiplier,this._pOneData[r++]=e.alphaMultiplier,this._pOneData[r++]=i.redMultiplier-e.redMultiplier,this._pOneData[r++]=i.greenMultiplier-e.greenMultiplier,this._pOneData[r++]=i.blueMultiplier-e.blueMultiplier,this._pOneData[r++]=i.alphaMultiplier-e.alphaMultiplier),this._iUsesOffset&&(this._pOneData[r++]=e.redOffset/255,this._pOneData[r++]=e.greenOffset/255,this._pOneData[r++]=e.blueOffset/255,this._pOneData[r++]=e.alphaOffset/255,this._pOneData[r++]=(i.redOffset-e.redOffset)/255,this._pOneData[r++]=(i.greenOffset-e.greenOffset)/255,this._pOneData[r++]=(i.blueOffset-e.blueOffset)/255,this._pOneData[r++]=(i.alphaOffset-e.alphaOffset)/255))},n.START_MULTIPLIER_INDEX=0,n.DELTA_MULTIPLIER_INDEX=1,n.START_OFFSET_INDEX=2,n.DELTA_OFFSET_INDEX=3,n.CYCLE_INDEX=4,n.COLOR_START_COLORTRANSFORM="ColorStartColorTransform",n.COLOR_END_COLORTRANSFORM="ColorEndColorTransform",n}(e.ParticleNodeBase);e.ParticleColorNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n,r){"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!1),e.call(this,"ParticleFollow",t.ParticlePropertiesMode.LOCAL_DYNAMIC,i&&n?6:3,t.ParticleAnimationSet.POST_PRIORITY),this._pStateClass=t.ParticleFollowState,this._iUsesPosition=i,this._iUsesRotation=n,this._iSmooth=r}return __extends(i,e),i.prototype.getAGALVertexCode=function(t,e){var n="";if(this._iUsesRotation){var r=e.getFreeVertexAttribute();e.setRegisterIndex(this,i.FOLLOW_ROTATION_INDEX,r.index);var s=e.getFreeVertexVectorTemp();e.addVertexTempUsages(s,1);var a=e.getFreeVertexVectorTemp();e.addVertexTempUsages(a,1);var o,h=e.getFreeVertexVectorTemp();e.hasBillboard&&(e.addVertexTempUsages(h,1),o=e.getFreeVertexVectorTemp()),e.removeVertexTempUsage(s),e.removeVertexTempUsage(a),e.hasBillboard&&e.removeVertexTempUsage(h);var p,u=e.rotationRegisters.length;if(n+="mov "+s+","+e.vertexZeroConst+"\n",n+="mov "+s+".x,"+e.vertexOneConst+"\n",n+="mov "+h+","+e.vertexZeroConst+"\n",n+="sin "+h+".y,"+r+".x\n",n+="cos "+h+".z,"+r+".x\n",n+="mov "+a+".x,"+e.vertexZeroConst+"\n",n+="mov "+a+".y,"+h+".z\n",n+="neg "+a+".z,"+h+".y\n",e.hasBillboard)n+="m33 "+o+".xyz,"+e.positionTarget+".xyz,"+s+"\n";else for(n+="m33 "+e.scaleAndRotateTarget+".xyz,"+e.scaleAndRotateTarget+".xyz,"+s+"\n",p=0;u>p;p++)n+="m33 "+e.rotationRegisters[p]+".xyz,"+e.rotationRegisters[p]+","+s+"\n";if(n+="mov "+s+","+e.vertexZeroConst+"\n",n+="cos "+s+".x,"+r+".y\n",n+="sin "+s+".z,"+r+".y\n",n+="mov "+a+","+e.vertexZeroConst+"\n",n+="mov "+a+".y,"+e.vertexOneConst+"\n",n+="mov "+h+","+e.vertexZeroConst+"\n",n+="neg "+h+".x,"+s+".z\n",n+="mov "+h+".z,"+s+".x\n",e.hasBillboard)n+="m33 "+o+".xyz,"+o+".xyz,"+s+"\n";else for(n+="m33 "+e.scaleAndRotateTarget+".xyz,"+e.scaleAndRotateTarget+".xyz,"+s+"\n",p=0;u>p;p++)n+="m33 "+e.rotationRegisters[p]+".xyz,"+e.rotationRegisters[p]+","+s+"\n";if(n+="mov "+a+","+e.vertexZeroConst+"\n",n+="sin "+a+".x,"+r+".z\n",n+="cos "+a+".y,"+r+".z\n",n+="mov "+s+","+e.vertexZeroConst+"\n",n+="mov "+s+".x,"+a+".y\n",n+="neg "+s+".y,"+a+".x\n",n+="mov "+h+","+e.vertexZeroConst+"\n",n+="mov "+h+".z,"+e.vertexOneConst+"\n",e.hasBillboard)n+="m33 "+o+".xyz,"+o+".xyz,"+s+"\n",n+="sub "+o+".xyz,"+o+".xyz,"+e.positionTarget+".xyz\n",n+="add "+e.scaleAndRotateTarget+".xyz,"+o+".xyz,"+e.scaleAndRotateTarget+".xyz\n";else for(n+="m33 "+e.scaleAndRotateTarget+".xyz,"+e.scaleAndRotateTarget+".xyz,"+s+"\n",p=0;u>p;p++)n+="m33 "+e.rotationRegisters[p]+".xyz,"+e.rotationRegisters[p]+","+s+"\n"}if(this._iUsesPosition){var l=e.getFreeVertexAttribute();e.setRegisterIndex(this,i.FOLLOW_POSITION_INDEX,l.index),n+="add "+e.scaleAndRotateTarget+".xyz,"+l+","+e.scaleAndRotateTarget+".xyz\n"}return n},i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i.FOLLOW_POSITION_INDEX=0,i.FOLLOW_ROTATION_INDEX=1,i}(t.ParticleNodeBase);t.ParticleFollowNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.ColorTransform,n=function(t){function n(n,r,s,a){"undefined"==typeof r&&(r=!0),"undefined"==typeof s&&(s=!1),"undefined"==typeof a&&(a=null),t.call(this,"ParticleInitialColor",n,r&&s?8:4,e.ParticleAnimationSet.COLOR_PRIORITY),this._pStateClass=e.ParticleInitialColorState,this._iUsesMultiplier=r,this._iUsesOffset=s,this._iInitialColor=a||new i}return __extends(n,t),n.prototype.getAGALVertexCode=function(t,i){var r="";if(i.needFragmentAnimation){if(this._iUsesMultiplier){var s=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,n.MULTIPLIER_INDEX,s.index),r+="mul "+i.colorMulTarget+","+s+","+i.colorMulTarget+"\n"}if(this._iUsesOffset){var a=this._pMode==e.ParticlePropertiesMode.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant();i.setRegisterIndex(this,n.OFFSET_INDEX,a.index),r+="add "+i.colorAddTarget+","+a+","+i.colorAddTarget+"\n"}}return r},n.prototype._iProcessAnimationSetting=function(t){this._iUsesMultiplier&&(t.hasColorMulNode=!0),this._iUsesOffset&&(t.hasColorAddNode=!0)},n.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[n.COLOR_INITIAL_COLORTRANSFORM];if(!e)throw new Error("there is no "+n.COLOR_INITIAL_COLORTRANSFORM+" in param!");var i=0;this._iUsesMultiplier&&(this._pOneData[i++]=e.redMultiplier,this._pOneData[i++]=e.greenMultiplier,this._pOneData[i++]=e.blueMultiplier,this._pOneData[i++]=e.alphaMultiplier),this._iUsesOffset&&(this._pOneData[i++]=e.redOffset/255,this._pOneData[i++]=e.greenOffset/255,this._pOneData[i++]=e.blueOffset/255,this._pOneData[i++]=e.alphaOffset/255)},n.MULTIPLIER_INDEX=0,n.OFFSET_INDEX=1,n.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform",n}(e.ParticleNodeBase);e.ParticleInitialColorNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=t.materials.ShaderRegisterElement,r=function(t){function r(n,r,s,a,o,h,p,u){"undefined"==typeof r&&(r=!0),"undefined"==typeof s&&(s=!1),"undefined"==typeof a&&(a=!1),"undefined"==typeof o&&(o=100),"undefined"==typeof h&&(h=1),"undefined"==typeof p&&(p=0),"undefined"==typeof u&&(u=null);var l=3;a&&l++,t.call(this,"ParticleOrbit",n,l),this._pStateClass=e.ParticleOrbitState,this._iUsesEulers=r,this._iUsesCycle=s,this._iUsesPhase=a,this._iRadius=o,this._iCycleDuration=h,this._iCyclePhase=p,this._iEulers=u||new i}return __extends(r,t),r.prototype.getAGALVertexCode=function(t,i){var s=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,r.ORBIT_INDEX,s.index);var a=i.getFreeVertexConstant();i.setRegisterIndex(this,r.EULERS_INDEX,a.index),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant();var o=i.getFreeVertexVectorTemp();i.addVertexTempUsages(o,1);var h=new n(o.regName,o.index),p=i.getFreeVertexVectorTemp(),u=new n(p.regName,p.index,0),l=new n(p.regName,p.index,1),c=new n(p.regName,p.index,2);i.removeVertexTempUsage(o);var d="";return this._iUsesCycle?(d+="mul "+c+","+i.vertexTime+","+s+".y\n",this._iUsesPhase&&(d+="add "+c+","+c+","+s+".w\n")):d+="mul "+c+","+i.vertexLife+","+s+".y\n",d+="cos "+u+","+c+"\n",d+="sin "+l+","+c+"\n",d+="mul "+h+".x,"+u+","+s+".x\n",d+="mul "+h+".y,"+l+","+s+".x\n",d+="mov "+h+".wz"+i.vertexZeroConst+"\n",this._iUsesEulers&&(d+="m44 "+h+","+h+","+a+"\n"),d+="add "+i.positionTarget+".xyz,"+h+".xyz,"+i.positionTarget+".xyz\n",i.needVelocity&&(d+="neg "+h+".x,"+l+"\n",d+="mov "+h+".y,"+u+"\n",d+="mov "+h+".zw,"+i.vertexZeroConst+"\n",this._iUsesEulers&&(d+="m44 "+h+","+h+","+a+"\n"),d+="mul "+h+","+h+","+s+".z\n",d+="div "+h+","+h+","+s+".y\n",this._iUsesCycle||(d+="div "+h+","+h+","+i.vertexLife+"\n"),d+="add "+i.velocityTarget+".xyz,"+i.velocityTarget+".xyz,"+h+".xyz\n"),d},r.prototype.getAnimationState=function(t){return t.getAnimationState(this)},r.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[r.ORBIT_VECTOR3D];if(!e)throw new Error("there is no "+r.ORBIT_VECTOR3D+" in param!");if(this._pOneData[0]=e.x,this._iUsesCycle&&e.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=2*Math.PI/(this._iUsesCycle?e.y:1),this._pOneData[2]=2*e.x*Math.PI,this._iUsesPhase&&(this._pOneData[3]=e.z*Math.PI/180)},r.ORBIT_INDEX=0,r.EULERS_INDEX=1,r.ORBIT_VECTOR3D="OrbitVector3D",r}(e.ParticleNodeBase);e.ParticleOrbitNode=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=t.materials.ShaderRegisterElement,r=function(t){function r(n,r){"undefined"==typeof r&&(r=null),t.call(this,"ParticleOscillator",n,4),this._pStateClass=e.ParticleOscillatorState,this._iOscillator=r||new i}return __extends(r,t),r.prototype.getAGALVertexCode=function(t,i){t=t;var s=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,r.OSCILLATOR_INDEX,s.index);var a=i.getFreeVertexVectorTemp(),o=new n(a.regName,a.index,0),h=new n(a.regName,a.index,1),p=new n(a.regName,a.index,2);i.addVertexTempUsages(a,1);var u=i.getFreeVertexVectorTemp(),l=new n(u.regName,u.index);i.removeVertexTempUsage(a);var c="";return c+="mul "+o+","+i.vertexTime+","+s+".w\n",c+="sin "+h+","+o+"\n",c+="mul "+l+".xyz,"+h+","+s+".xyz\n",c+="add "+i.positionTarget+".xyz,"+l+".xyz,"+i.positionTarget+".xyz\n",i.needVelocity&&(c+="cos "+p+","+o+"\n",c+="mul "+l+".xyz,"+p+","+s+".xyz\n",c+="add "+i.velocityTarget+".xyz,"+l+".xyz,"+i.velocityTarget+".xyz\n"),c},r.prototype.getAnimationState=function(t){return t.getAnimationState(this)},r.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[r.OSCILLATOR_VECTOR3D];if(!e)throw new Error("there is no "+r.OSCILLATOR_VECTOR3D+" in param!");if(this._pOneData[0]=e.x,this._pOneData[1]=e.y,this._pOneData[2]=e.z,e.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=2*Math.PI/e.w},r.OSCILLATOR_INDEX=0,r.OSCILLATOR_VECTOR3D="OscillatorVector3D",r}(e.ParticleNodeBase);e.ParticleOscillatorNode=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=function(t){function n(n,r){"undefined"==typeof r&&(r=null),t.call(this,"ParticlePosition",n,3),this._pStateClass=e.ParticlePositionState,this._iPosition=r||new i}return __extends(n,t),n.prototype.getAGALVertexCode=function(t,i){t=t;var r=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();return i.setRegisterIndex(this,n.POSITION_INDEX,r.index),"add "+i.positionTarget+".xyz,"+r+".xyz,"+i.positionTarget+".xyz\n"},n.prototype.getAnimationState=function(t){return t.getAnimationState(this)},n.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[n.POSITION_VECTOR3D];if(!e)throw new Error("there is no "+n.POSITION_VECTOR3D+" in param!");this._pOneData[0]=e.x,this._pOneData[1]=e.y,this._pOneData[2]=e.z},n.POSITION_INDEX=0,n.POSITION_VECTOR3D="PositionVector3D",n}(e.ParticleNodeBase);e.ParticlePositionNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.materials.ShaderRegisterElement,n=function(t){function n(){t.call(this,"ParticleRotateToHeading",e.ParticlePropertiesMode.GLOBAL,0,3),this._pStateClass=e.ParticleRotateToHeadingState}return __extends(n,t),n.prototype.getAGALVertexCode=function(t,e){var r,s="",a=e.rotationRegisters.length;if(e.hasBillboard){var o=e.getFreeVertexVectorTemp();e.addVertexTempUsages(o,1);var h=e.getFreeVertexVectorTemp();e.addVertexTempUsages(h,1);var p=e.getFreeVertexVectorTemp(),u=e.getFreeVertexConstant();for(e.setRegisterIndex(this,n.MATRIX_INDEX,u.index),e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.removeVertexTempUsage(o),e.removeVertexTempUsage(h),s+="m33 "+o+".xyz,"+e.velocityTarget+".xyz,"+u+"\n",s+="mov "+p+","+e.vertexZeroConst+"\n",s+="mov "+p+".xy,"+o+".xy\n",s+="nrm "+p+".xyz,"+p+".xyz\n",s+="mov "+h+","+e.vertexZeroConst+"\n",s+="mov "+h+".x,"+p+".y\n",s+="mov "+h+".y,"+p+".x\n",s+="mov "+o+","+e.vertexZeroConst+"\n",s+="mov "+o+".x,"+p+".x\n",s+="neg "+o+".y,"+p+".y\n",s+="mov "+p+","+e.vertexZeroConst+"\n",s+="mov "+p+".z,"+e.vertexOneConst+"\n",s+="m33 "+e.scaleAndRotateTarget+".xyz,"+e.scaleAndRotateTarget+".xyz,"+o+"\n",r=0;a>r;r++)s+="m33 "+e.rotationRegisters[r]+".xyz,"+e.rotationRegisters[r]+","+o+"\n"}else{var l=e.getFreeVertexVectorTemp();e.addVertexTempUsages(l,1);var c=e.getFreeVertexVectorTemp();e.addVertexTempUsages(c,1);var d=e.getFreeVertexVectorTemp();e.addVertexTempUsages(d,1);var _=e.getFreeVertexVectorTemp(),f=new i(d.regName,d.index,3),g=new i(_.regName,_.index,3),m=new i(l.regName,l.index,3),y=g;for(e.removeVertexTempUsage(l),e.removeVertexTempUsage(c),e.removeVertexTempUsage(d),s+="mov "+c+".x,"+e.vertexOneConst+"\n",s+="mov "+c+".yz,"+e.vertexZeroConst+"\n",s+="nrm "+l+".xyz,"+e.velocityTarget+".xyz\n",s+="dp3 "+m+","+l+".xyz,"+c+".xyz\n",s+="crs "+l+".xyz,"+c+".xyz,"+l+".xyz\n",s+="nrm "+l+".xyz,"+l+".xyz\n",s+="dp3 "+d+".x,"+l+".xyz,"+l+".xyz\n",s+="sge "+d+".x,"+e.vertexZeroConst+","+d+".x\n",s+="add "+l+".z,"+d+".x,"+l+".z\n",s+="add "+y+","+m+","+e.vertexOneConst+"\n",s+="div "+y+","+y+","+e.vertexTwoConst+"\n",s+="sqt "+f+","+y+"\n",s+="sub "+y+","+e.vertexOneConst+","+m+"\n",s+="div "+y+","+y+","+e.vertexTwoConst+"\n",s+="sqt "+g+","+y+"\n",s+="mul "+d+".xyz,"+g+","+l+".xyz\n",s+="mul "+_+".xyz,"+g+","+l+".xyz\n",s+="neg "+_+".xyz,"+_+".xyz\n",s+="crs "+l+".xyz,"+d+".xyz,"+e.scaleAndRotateTarget+".xyz\n",s+="mul "+c+".xyz,"+f+","+e.scaleAndRotateTarget+".xyz\n",s+="add "+l+".xyz,"+l+".xyz,"+c+".xyz\n",s+="dp3 "+c+".w,"+d+".xyz,"+e.scaleAndRotateTarget+".xyz\n",s+="neg "+l+".w,"+c+".w\n",s+="crs "+d+".xyz,"+l+".xyz,"+_+".xyz\n",s+="mul "+c+".xyzw,"+l+".xyzw,"+f+"\n",s+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",s+="mul "+c+".xyz,"+l+".w,"+_+".xyz\n",s+="add "+e.scaleAndRotateTarget+".xyz,"+d+".xyz,"+c+".xyz\n",r=0;a>r;r++)s+="mov "+c+".x,"+e.vertexOneConst+"\n",s+="mov "+c+".yz,"+e.vertexZeroConst+"\n",s+="nrm "+l+".xyz,"+e.velocityTarget+".xyz\n",s+="dp3 "+m+","+l+".xyz,"+c+".xyz\n",s+="crs "+l+".xyz,"+c+".xyz,"+l+".xyz\n",s+="nrm "+l+".xyz,"+l+".xyz\n",s+="dp3 "+d+".x,"+l+".xyz,"+l+".xyz\n",s+="sge "+d+".x,"+e.vertexZeroConst+","+d+".x\n",s+="add "+l+".z,"+d+".x,"+l+".z\n",s+="add "+y+","+m+","+e.vertexOneConst+"\n",s+="div "+y+","+y+","+e.vertexTwoConst+"\n",s+="sqt "+f+","+y+"\n",s+="sub "+y+","+e.vertexOneConst+","+m+"\n",s+="div "+y+","+y+","+e.vertexTwoConst+"\n",s+="sqt "+g+","+y+"\n",s+="mul "+d+".xyz,"+g+","+l+".xyz\n",s+="mul "+_+".xyz,"+g+","+l+".xyz\n",s+="neg "+_+".xyz,"+_+".xyz\n",s+="crs "+l+".xyz,"+d+".xyz,"+e.rotationRegisters[r]+".xyz\n",s+="mul "+c+".xyz,"+f+","+e.rotationRegisters[r]+".xyz\n",s+="add "+l+".xyz,"+l+".xyz,"+c+".xyz\n",s+="dp3 "+c+".w,"+d+".xyz,"+e.rotationRegisters[r]+".xyz\n",s+="neg "+l+".w,"+c+".w\n",s+="crs "+d+".xyz,"+l+".xyz,"+_+".xyz\n",s+="mul "+c+".xyzw,"+l+".xyzw,"+f+"\n",s+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",s+="mul "+c+".xyz,"+l+".w,"+_+".xyz\n",s+="add "+e.rotationRegisters[r]+".xyz,"+d+".xyz,"+c+".xyz\n"}return s},n.prototype.getAnimationState=function(t){return t.getAnimationState(this)},n.prototype._iProcessAnimationSetting=function(t){t.needVelocity=!0},n.MATRIX_INDEX=0,n}(e.ParticleNodeBase);e.ParticleRotateToHeadingNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=t.materials.ShaderRegisterElement,r=function(t){function r(n,r){"undefined"==typeof r&&(r=null),t.call(this,"ParticleRotateToPosition",n,3,3),this._pStateClass=e.ParticleRotateToPositionState,this._iPosition=r||new i}return __extends(r,t),r.prototype.getAGALVertexCode=function(t,i){var s=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,r.POSITION_INDEX,s.index);var a,o="",h=i.rotationRegisters.length;if(i.hasBillboard){var p=i.getFreeVertexVectorTemp();i.addVertexTempUsages(p,1);var u=i.getFreeVertexVectorTemp();i.addVertexTempUsages(u,1);var l=i.getFreeVertexVectorTemp(),c=i.getFreeVertexConstant();for(i.setRegisterIndex(this,r.MATRIX_INDEX,c.index),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.removeVertexTempUsage(p),i.removeVertexTempUsage(u),o+="sub "+p+".xyz,"+s+".xyz,"+i.positionTarget+".xyz\n",o+="m33 "+p+".xyz,"+p+".xyz,"+c+"\n",o+="mov "+l+","+i.vertexZeroConst+"\n",o+="mov "+l+".xy,"+p+".xy\n",o+="nrm "+l+".xyz,"+l+".xyz\n",o+="mov "+u+","+i.vertexZeroConst+"\n",o+="mov "+u+".x,"+l+".y\n",o+="mov "+u+".y,"+l+".x\n",o+="mov "+p+","+i.vertexZeroConst+"\n",o+="mov "+p+".x,"+l+".x\n",o+="neg "+p+".y,"+l+".y\n",o+="mov "+l+","+i.vertexZeroConst+"\n",o+="mov "+l+".z,"+i.vertexOneConst+"\n",o+="m33 "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+p+"\n",a=0;h>a;a++)o+="m33 "+i.rotationRegisters[a]+".xyz,"+i.rotationRegisters[a]+","+p+"\n"}else{var d=i.getFreeVertexVectorTemp();i.addVertexTempUsages(d,1);var _=i.getFreeVertexVectorTemp();i.addVertexTempUsages(_,1);var f=new n(_.regName,_.index,0),g=new n(_.regName,_.index,1),m=new n(_.regName,_.index,2),y=new n(_.regName,_.index,3),b=i.getFreeVertexVectorTemp();for(i.addVertexTempUsages(b,1),i.removeVertexTempUsage(d),i.removeVertexTempUsage(_),i.removeVertexTempUsage(b),o+="sub "+d+".xyz,"+s+".xyz,"+i.positionTarget+".xyz\n",o+="nrm "+d+".xyz,"+d+".xyz\n",o+="mov "+g+","+d+".y\n",o+="mul "+f+","+g+","+g+"\n",o+="sub "+f+","+i.vertexOneConst+","+f+"\n",o+="sqt "+f+","+f+"\n",o+="mul "+b+".x,"+f+","+i.scaleAndRotateTarget+".y\n",o+="mul "+b+".y,"+g+","+i.scaleAndRotateTarget+".z\n",o+="mul "+b+".z,"+g+","+i.scaleAndRotateTarget+".y\n",o+="mul "+b+".w,"+f+","+i.scaleAndRotateTarget+".z\n",o+="sub "+i.scaleAndRotateTarget+".y,"+b+".x,"+b+".y\n",o+="add "+i.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",o+="abs "+b+".y,"+d+".y\n",o+="sge "+b+".z,"+b+".y,"+i.vertexOneConst+"\n",o+="mul "+b+".x,"+b+".y,"+d+".y\n",o+="mov "+d+".y,"+i.vertexZeroConst+"\n",o+="dp3 "+g+","+d+".xyz,"+d+".xyz\n",o+="sge "+y+","+i.vertexZeroConst+","+g+"\n",o+="mov "+d+".y,"+i.vertexZeroConst+"\n",o+="nrm "+d+".xyz,"+d+".xyz\n",o+="sub "+g+","+i.vertexOneConst+","+y+"\n",o+="mul "+g+","+g+","+d+".x\n",o+="mov "+f+","+d+".z\n",o+="neg "+f+","+f+"\n",o+="sub "+m+","+i.vertexOneConst+","+f+"\n",o+="mul "+m+","+b+".x,"+y+"\n",o+="add "+f+","+f+","+m+"\n",o+="mul "+b+".x,"+f+","+i.scaleAndRotateTarget+".x\n",o+="mul "+b+".y,"+g+","+i.scaleAndRotateTarget+".z\n",o+="mul "+b+".z,"+g+","+i.scaleAndRotateTarget+".x\n",o+="mul "+b+".w,"+f+","+i.scaleAndRotateTarget+".z\n",o+="sub "+i.scaleAndRotateTarget+".x,"+b+".x,"+b+".y\n",o+="add "+i.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",a=0;h>a;a++)o+="sub "+d+".xyz,"+s+".xyz,"+i.positionTarget+".xyz\n",o+="nrm "+d+".xyz,"+d+".xyz\n",o+="mov "+g+","+d+".y\n",o+="mul "+f+","+g+","+g+"\n",o+="sub "+f+","+i.vertexOneConst+","+f+"\n",o+="sqt "+f+","+f+"\n",o+="mul "+b+".x,"+f+","+i.rotationRegisters[a]+".y\n",o+="mul "+b+".y,"+g+","+i.rotationRegisters[a]+".z\n",o+="mul "+b+".z,"+g+","+i.rotationRegisters[a]+".y\n",o+="mul "+b+".w,"+f+","+i.rotationRegisters[a]+".z\n",o+="sub "+i.rotationRegisters[a]+".y,"+b+".x,"+b+".y\n",o+="add "+i.rotationRegisters[a]+".z,"+b+".z,"+b+".w\n",o+="abs "+b+".y,"+d+".y\n",o+="sge "+b+".z,"+b+".y,"+i.vertexOneConst+"\n",o+="mul "+b+".x,"+b+".y,"+d+".y\n",o+="mov "+d+".y,"+i.vertexZeroConst+"\n",o+="dp3 "+g+","+d+".xyz,"+d+".xyz\n",o+="sge "+y+","+i.vertexZeroConst+","+g+"\n",o+="mov "+d+".y,"+i.vertexZeroConst+"\n",o+="nrm "+d+".xyz,"+d+".xyz\n",o+="sub "+g+","+i.vertexOneConst+","+y+"\n",o+="mul "+g+","+g+","+d+".x\n",o+="mov "+f+","+d+".z\n",o+="neg "+f+","+f+"\n",o+="sub "+m+","+i.vertexOneConst+","+f+"\n",o+="mul "+m+","+b+".x,"+y+"\n",o+="add "+f+","+f+","+m+"\n",o+="mul "+b+".x,"+f+","+i.rotationRegisters[a]+".x\n",o+="mul "+b+".y,"+g+","+i.rotationRegisters[a]+".z\n",o+="mul "+b+".z,"+g+","+i.rotationRegisters[a]+".x\n",o+="mul "+b+".w,"+f+","+i.rotationRegisters[a]+".z\n",o+="sub "+i.rotationRegisters[a]+".x,"+b+".x,"+b+".y\n",o+="add "+i.rotationRegisters[a]+".z,"+b+".z,"+b+".w\n"
}return o},r.prototype.getAnimationState=function(t){return t.getAnimationState(this)},r.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[r.POSITION_VECTOR3D];if(!e)throw new Error("there is no "+r.POSITION_VECTOR3D+" in param!");this._pOneData[0]=e.x,this._pOneData[1]=e.y,this._pOneData[2]=e.z},r.MATRIX_INDEX=0,r.POSITION_INDEX=1,r.POSITION_VECTOR3D="RotateToPositionVector3D",r}(e.ParticleNodeBase);e.ParticleRotateToPositionNode=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=t.materials.ShaderRegisterElement,r=function(t){function r(n,r){"undefined"==typeof r&&(r=null),t.call(this,"ParticleRotationalVelocity",n,4),this._pStateClass=e.ParticleRotationalVelocityState,this._iRotationalVelocity=r||new i}return __extends(r,t),r.prototype.getAGALVertexCode=function(t,i){var s=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,r.ROTATIONALVELOCITY_INDEX,s.index);var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var o=i.getFreeVertexVectorTemp();i.addVertexTempUsages(o,1);var h=i.getFreeVertexVectorTemp();i.addVertexTempUsages(h,1);var p=new n(h.regName,h.index),u=i.getFreeVertexVectorTemp();u=new n(u.regName,u.index);var l=new n(p.regName,p.index,3),c=new n(u.regName,u.index,3);i.removeVertexTempUsage(a),i.removeVertexTempUsage(o),i.removeVertexTempUsage(h);var d="";d+="mov "+a+".xyz,"+s+".xyz\n",d+="mov "+a+".w,"+i.vertexZeroConst+"\n",d+="mul "+l+","+i.vertexTime+","+s+".w\n",d+="sin "+c+","+l+"\n",d+="cos "+l+","+l+"\n",d+="mul "+p+".xyz,"+c+","+a+".xyz\n",d+="mul "+u+".xyz,"+c+","+a+".xyz\n",d+="neg "+u+".xyz,"+u+".xyz\n",d+="crs "+a+".xyz,"+p+".xyz,"+i.scaleAndRotateTarget+".xyz\n",d+="mul "+o+".xyz,"+l+","+i.scaleAndRotateTarget+".xyz\n",d+="add "+a+".xyz,"+a+".xyz,"+o+".xyz\n",d+="dp3 "+o+".w,"+p+".xyz,"+i.scaleAndRotateTarget+".xyz\n",d+="neg "+a+".w,"+o+".w\n",d+="crs "+p+".xyz,"+a+".xyz,"+u+".xyz\n",d+="mul "+o+".xyzw,"+a+".xyzw,"+l+"\n",d+="add "+p+".xyz,"+p+".xyz,"+o+".xyz\n",d+="mul "+o+".xyz,"+a+".w,"+u+".xyz\n",d+="add "+i.scaleAndRotateTarget+".xyz,"+p+".xyz,"+o+".xyz\n";for(var _=i.rotationRegisters.length,f=0;_>f;f++)d+="mov "+a+".xyz,"+s+".xyz\n",d+="mov "+a+".w,"+i.vertexZeroConst+"\n",d+="mul "+l+","+i.vertexTime+","+s+".w\n",d+="sin "+c+","+l+"\n",d+="cos "+l+","+l+"\n",d+="mul "+p+".xyz,"+c+","+a+".xyz\n",d+="mul "+u+".xyz,"+c+","+a+".xyz\n",d+="neg "+u+".xyz,"+u+".xyz\n",d+="crs "+a+".xyz,"+p+".xyz,"+i.rotationRegisters[f]+".xyz\n",d+="mul "+o+".xyz,"+l+","+i.rotationRegisters[f]+"\n",d+="add "+a+".xyz,"+a+".xyz,"+o+".xyz\n",d+="dp3 "+o+".w,"+p+".xyz,"+i.rotationRegisters[f]+"\n",d+="neg "+a+".w,"+o+".w\n",d+="crs "+p+".xyz,"+a+".xyz,"+u+".xyz\n",d+="mul "+o+".xyzw,"+a+".xyzw,"+l+"\n",d+="add "+p+".xyz,"+p+".xyz,"+o+".xyz\n",d+="mul "+o+".xyz,"+a+".w,"+u+".xyz\n",d+="add "+i.rotationRegisters[f]+","+p+".xyz,"+o+".xyz\n";return d},r.prototype.getAnimationState=function(t){return t.getAnimationState(this)},r.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[r.ROTATIONALVELOCITY_VECTOR3D];if(!e)throw new Error("there is no "+r.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(e.length<=0?e.z=1:e.normalize(),this._pOneData[0]=e.x,this._pOneData[1]=e.y,this._pOneData[2]=e.z,e.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/e.w},r.ROTATIONALVELOCITY_INDEX=0,r.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D",r}(e.ParticleNodeBase);e.ParticleRotationalVelocityNode=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n,r,s,a,o,h){"undefined"==typeof s&&(s=1),"undefined"==typeof a&&(a=1),"undefined"==typeof o&&(o=1),"undefined"==typeof h&&(h=0),e.call(this,"ParticleScale",i,n&&r?4:n||r?3:2,3),this._pStateClass=t.ParticleScaleState,this._iUsesCycle=n,this._iUsesPhase=r,this._iMinScale=s,this._iMaxScale=a,this._iCycleDuration=o,this._iCyclePhase=h}return __extends(i,e),i.prototype.getAGALVertexCode=function(e,n){var r="",s=n.getFreeVertexSingleTemp(),a=this._pMode==t.ParticlePropertiesMode.GLOBAL?n.getFreeVertexConstant():n.getFreeVertexAttribute();return n.setRegisterIndex(this,i.SCALE_INDEX,a.index),this._iUsesCycle&&(r+="mul "+s+","+n.vertexTime+","+a+".z\n",this._iUsesPhase&&(r+="add "+s+","+s+","+a+".w\n"),r+="sin "+s+","+s+"\n"),r+="mul "+s+","+a+".y,"+(this._iUsesCycle?s:n.vertexLife)+"\n",r+="add "+s+","+a+".x,"+s+"\n",r+="mul "+n.scaleAndRotateTarget+".xyz,"+n.scaleAndRotateTarget+".xyz,"+s+"\n"},i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.SCALE_VECTOR3D];if(!e)throw new Error("there is no "+i.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){if(this._pOneData[0]=(e.x+e.y)/2,this._pOneData[1]=Math.abs(e.x-e.y)/2,e.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=2*Math.PI/e.z,this._iUsesPhase&&(this._pOneData[3]=e.w*Math.PI/180)}else this._pOneData[0]=e.x,this._pOneData[1]=e.y-e.x},i.SCALE_INDEX=0,i.SCALE_VECTOR3D="ScaleVector3D",i}(t.ParticleNodeBase);t.ParticleScaleNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.materials.ShaderRegisterElement,n=function(t){function n(i,n,r,s,a,o){if(t.call(this,"ParticleSegmentedColor",e.ParticlePropertiesMode.GLOBAL,0,e.ParticleAnimationSet.COLOR_PRIORITY),this._pStateClass=e.ParticleSegmentedColorState,r>4)throw new Error("the numSegmentPoint must be less or equal 4");this._iUsesMultiplier=i,this._iUsesOffset=n,this._iNumSegmentPoint=r,this._iStartColor=s,this._iEndColor=a,this._iSegmentPoints=o}return __extends(n,t),n.prototype._iProcessAnimationSetting=function(t){this._iUsesMultiplier&&(t.hasColorMulNode=!0),this._iUsesOffset&&(t.hasColorAddNode=!0)},n.prototype.getAGALVertexCode=function(t,e){var r="";if(e.needFragmentAnimation){var s;this._iUsesMultiplier&&(s=e.getFreeVertexVectorTemp(),e.addVertexTempUsages(s,1));var a=e.getFreeVertexVectorTemp();e.addVertexTempUsages(a,1);var o=e.getFreeVertexVectorTemp(),h=new i(o.regName,o.index,0),p=new i(o.regName,o.index,1);this._iUsesMultiplier&&e.removeVertexTempUsage(s),e.removeVertexTempUsage(a);var u=e.getFreeVertexConstant();e.setRegisterIndex(this,n.TIME_DATA_INDEX,u.index);var l,c,d;if(this._iUsesMultiplier)for(c=e.getFreeVertexConstant(),e.setRegisterIndex(this,n.START_MULTIPLIER_INDEX,c.index),d=new Array,l=0;l<this._iNumSegmentPoint+1;l++)d.push(e.getFreeVertexConstant());var _,f;if(this._iUsesOffset)for(_=e.getFreeVertexConstant(),e.setRegisterIndex(this,n.START_OFFSET_INDEX,_.index),f=new Array,l=0;l<this._iNumSegmentPoint+1;l++)f.push(e.getFreeVertexConstant());for(this._iUsesMultiplier&&(r+="mov "+s+","+c+"\n"),this._iUsesOffset&&(r+="add "+e.colorAddTarget+","+e.colorAddTarget+","+_+"\n"),l=0;l<this._iNumSegmentPoint;l++){switch(l){case 0:r+="min "+p+","+e.vertexLife+","+u+".x\n";break;case 1:r+="sub "+h+","+e.vertexLife+","+u+".x\n",r+="max "+p+","+h+","+e.vertexZeroConst+"\n",r+="min "+p+","+p+","+u+".y\n";break;case 2:r+="sub "+h+","+h+","+u+".y\n",r+="max "+p+","+h+","+e.vertexZeroConst+"\n",r+="min "+p+","+p+","+u+".z\n";break;case 3:r+="sub "+h+","+h+","+u+".z\n",r+="max "+p+","+h+","+e.vertexZeroConst+"\n",r+="min "+p+","+p+","+u+".w\n"}this._iUsesMultiplier&&(r+="mul "+a+","+p+","+d[l]+"\n",r+="add "+s+","+s+","+a+"\n"),this._iUsesOffset&&(r+="mul "+a+","+p+","+f[l]+"\n",r+="add "+e.colorAddTarget+","+e.colorAddTarget+","+a+"\n")}if(0==this._iNumSegmentPoint)p=e.vertexLife;else{switch(this._iNumSegmentPoint){case 1:r+="sub "+h+","+e.vertexLife+","+u+".x\n";break;case 2:r+="sub "+h+","+h+","+u+".y\n";break;case 3:r+="sub "+h+","+h+","+u+".z\n";break;case 4:r+="sub "+h+","+h+","+u+".w\n"}r+="max "+p+","+h+","+e.vertexZeroConst+"\n"}this._iUsesMultiplier&&(r+="mul "+a+","+p+","+d[this._iNumSegmentPoint]+"\n",r+="add "+s+","+s+","+a+"\n",r+="mul "+e.colorMulTarget+","+e.colorMulTarget+","+s+"\n"),this._iUsesOffset&&(r+="mul "+a+","+p+","+f[this._iNumSegmentPoint]+"\n",r+="add "+e.colorAddTarget+","+e.colorAddTarget+","+a+"\n")}return r},n.START_MULTIPLIER_INDEX=0,n.START_OFFSET_INDEX=1,n.TIME_DATA_INDEX=2,n}(e.ParticleNodeBase);e.ParticleSegmentedColorNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.materials.ShaderRegisterElement,n=function(t){function n(i,n,r,s,a,o,h,p){"undefined"==typeof s&&(s=1),"undefined"==typeof a&&(a=1),"undefined"==typeof o&&(o=1),"undefined"==typeof h&&(h=0),"undefined"==typeof p&&(p=Number.MAX_VALUE),t.call(this,"ParticleSpriteSheet",i,n?r?3:2:1,e.ParticleAnimationSet.POST_PRIORITY+1),this._pStateClass=e.ParticleSpriteSheetState,this._iUsesCycle=n,this._iUsesPhase=r,this._iNumColumns=s,this._iNumRows=a,this._iCyclePhase=h,this._iCycleDuration=o,this._iTotalFrames=Math.min(p,s*a)}return __extends(n,t),Object.defineProperty(n.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"totalFrames",{get:function(){return this._iTotalFrames},enumerable:!0,configurable:!0}),n.prototype.getAGALUVCode=function(t,r){var s=r.getFreeVertexConstant(),a=this._pMode==e.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();r.setRegisterIndex(this,n.UV_INDEX_0,s.index),r.setRegisterIndex(this,n.UV_INDEX_1,a.index);var o=new i(s.regName,s.index,0),h=new i(s.regName,s.index,1),p=new i(s.regName,s.index,2),u=new i(a.regName,a.index,0),l=new i(a.regName,a.index,1),c=new i(a.regName,a.index,2),d=r.getFreeVertexVectorTemp(),_=new i(d.regName,d.index,0),f=new i(d.regName,d.index,1);d=new i(d.regName,d.index,2);var g=new i(d.regName,d.index,3),m=new i(r.uvTarget.regName,r.uvTarget.index,0),y=new i(r.uvTarget.regName,r.uvTarget.index,1),b="";return b+="mul "+m+","+m+","+h+"\n",this._iNumRows>1&&(b+="mul "+y+","+y+","+p+"\n"),this._iUsesCycle?(b+=this._iUsesPhase?"add "+_+","+r.vertexTime+","+c+"\n":"mov "+_+","+r.vertexTime+"\n",b+="div "+_+","+_+","+l+"\n",b+="frc "+_+","+_+"\n",b+="mul "+_+","+_+","+l+"\n",b+="mul "+d+","+_+","+u+"\n"):b+="mul "+d.toString()+","+r.vertexLife+","+o+"\n",this._iNumRows>1&&(b+="frc "+g+","+d+"\n",b+="sub "+f+","+d+","+g+"\n",b+="mul "+f+","+f+","+p+"\n",b+="add "+y+","+y+","+f+"\n"),b+="div "+g+","+d+","+h+"\n",b+="frc "+d+","+g+"\n",b+="sub "+g+","+g+","+d+"\n",b+="mul "+d+","+g+","+h+"\n",this._iNumRows>1&&(b+="frc "+d+","+d+"\n"),b+="add "+m+","+m+","+d+"\n"},n.prototype.getAnimationState=function(t){return t.getAnimationState(this)},n.prototype._iProcessAnimationSetting=function(t){t.hasUVNode=!0},n.prototype._iGeneratePropertyOfOneParticle=function(t){if(this._iUsesCycle){var e=t[n.UV_VECTOR3D];if(!e)throw new Error("there is no "+n.UV_VECTOR3D+" in param!");if(e.x<=0)throw new Error("the cycle duration must be greater than zero");var i=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=i/e.x,this._pOneData[1]=e.x,this._iUsesPhase&&(this._pOneData[2]=e.y)}},n.UV_INDEX_0=0,n.UV_INDEX_1=1,n.UV_VECTOR3D="UVVector3D",n}(e.ParticleNodeBase);e.ParticleSpriteSheetNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n,r){"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),this._pStateClass=t.ParticleTimeState,this._iUsesDuration=i,this._iUsesLooping=n,this._iUsesDelay=r,e.call(this,"ParticleTime",t.ParticlePropertiesMode.LOCAL_STATIC,4,0)}return __extends(i,e),i.prototype.getAGALVertexCode=function(t,e){var n=e.getFreeVertexAttribute();e.setRegisterIndex(this,i.TIME_STREAM_INDEX,n.index);var r=e.getFreeVertexConstant();e.setRegisterIndex(this,i.TIME_CONSTANT_INDEX,r.index);var s="";s+="sub "+e.vertexTime+","+r+","+n+".x\n";var a=e.getFreeVertexSingleTemp();if(s+="sge "+a+","+e.vertexTime+","+e.vertexZeroConst+"\n",s+="mul "+e.scaleAndRotateTarget+".xyz,"+e.scaleAndRotateTarget+".xyz,"+a+"\n",this._iUsesDuration)if(this._iUsesLooping){var o=e.getFreeVertexSingleTemp();this._iUsesDelay?(s+="div "+o+","+e.vertexTime+","+n+".z\n",s+="frc "+o+","+o+"\n",s+="mul "+e.vertexTime+","+o+","+n+".z\n",s+="slt "+o+","+e.vertexTime+","+n+".y\n",s+="mul "+e.scaleAndRotateTarget+".xyz,"+e.scaleAndRotateTarget+".xyz,"+o+"\n"):(s+="mul "+o+","+e.vertexTime+","+n+".w\n",s+="frc "+o+","+o+"\n",s+="mul "+e.vertexTime+","+o+","+n+".y\n")}else{var h=e.getFreeVertexSingleTemp();s+="sge "+h+","+n+".y,"+e.vertexTime+"\n",s+="mul "+e.scaleAndRotateTarget+".xyz,"+e.scaleAndRotateTarget+".xyz,"+h+"\n"}return s+="mul "+e.vertexLife+","+e.vertexTime+","+n+".w\n"},i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i.prototype._iGeneratePropertyOfOneParticle=function(t){this._pOneData[0]=t.startTime,this._pOneData[1]=t.duration,this._pOneData[2]=t.delay+t.duration,this._pOneData[3]=1/t.duration},i.TIME_STREAM_INDEX=0,i.TIME_CONSTANT_INDEX=1,i}(t.ParticleNodeBase);t.ParticleTimeNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=t.materials.ShaderRegisterElement,r=function(t){function r(i,n,r,s){"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s="x"),t.call(this,"ParticleUV",e.ParticlePropertiesMode.GLOBAL,4,e.ParticleAnimationSet.POST_PRIORITY+1),this._pStateClass=e.ParticleUVState,this._cycle=n,this._scale=r,this._axis=s,this.updateUVData()}return __extends(r,t),Object.defineProperty(r.prototype,"cycle",{get:function(){return this._cycle},set:function(t){this._cycle=t,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"axis",{get:function(){return this._axis},set:function(t){this._axis=t},enumerable:!0,configurable:!0}),r.prototype.getAGALUVCode=function(t,e){var i="";if(e.needUVAnimation){var s=e.getFreeVertexConstant();e.setRegisterIndex(this,r.UV_INDEX,s.index);var a="x"==this._axis?0:"y"==this._axis?1:2,o=new n(e.uvTarget.regName,e.uvTarget.index,a),h=e.getFreeVertexSingleTemp();1!=this._scale&&(i+="mul "+o+","+o+","+s+".y\n"),i+="mul "+h+","+e.vertexTime+","+s+".x\n",i+="sin "+h+","+h+"\n",i+="add "+o+","+o+","+h+"\n"}return i},r.prototype.getAnimationState=function(t){return t.getAnimationState(this)},r.prototype.updateUVData=function(){this._iUvData=new i(2*Math.PI/this._cycle,this._scale,0,0)},r.prototype._iProcessAnimationSetting=function(t){t.hasUVNode=!0},r.UV_INDEX=0,r.U_AXIS="x",r.V_AXIS="y",r}(e.ParticleNodeBase);e.ParticleUVNode=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=function(t){function n(n,r){"undefined"==typeof r&&(r=null),t.call(this,"ParticleVelocity",n,3),this._pStateClass=e.ParticleVelocityState,this._iVelocity=r||new i}return __extends(n,t),n.prototype.getAGALVertexCode=function(t,i){var r=this._pMode==e.ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();i.setRegisterIndex(this,n.VELOCITY_INDEX,r.index);var s=i.getFreeVertexVectorTemp(),a="";return a+="mul "+s+","+i.vertexTime+","+r+"\n",a+="add "+i.positionTarget+".xyz,"+s+","+i.positionTarget+".xyz\n",i.needVelocity&&(a+="add "+i.velocityTarget+".xyz,"+r+".xyz,"+i.velocityTarget+".xyz\n"),a},n.prototype.getAnimationState=function(t){return t.getAnimationState(this)},n.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[n.VELOCITY_VECTOR3D];if(!e)throw new Error("there is no "+n.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=e.x,this._pOneData[1]=e.y,this._pOneData[2]=e.z},n.VELOCITY_INDEX=0,n.VELOCITY_VECTOR3D="VelocityVector3D",n}(e.ParticleNodeBase);e.ParticleVelocityNode=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(){e.call(this),this._pStateClass=t.SkeletonBinaryLERPState}return __extends(i,e),i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i}(t.AnimationNodeBase);t.SkeletonBinaryLERPNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(){e.call(this),this._frames=new Array,this.highQuality=!1,this._pStateClass=t.SkeletonClipState}return __extends(i,e),Object.defineProperty(i.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),i.prototype.addFrame=function(t,e){this._frames.push(t),this._pDurations.push(e),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,n,r=this._pNumFrames-1;r--;)this._pTotalDuration+=this._pDurations[r],t=this._frames[r].jointPoses[0].translation,i=this._frames[r+1].jointPoses[0].translation,n=i.subtract(t),this._pTotalDelta.x+=n.x,this._pTotalDelta.y+=n.y,this._pTotalDelta.z+=n.z;(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._frames[0].jointPoses[0].translation,i=this._frames[1].jointPoses[0].translation,n=i.subtract(t),this._pTotalDelta.x+=n.x,this._pTotalDelta.y+=n.y,this._pTotalDelta.z+=n.z)},i}(t.AnimationClipNodeBase);t.SkeletonClipNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(){e.call(this),this._pStateClass=t.SkeletonDifferenceState}return __extends(i,e),i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i}(t.AnimationNodeBase);t.SkeletonDifferenceNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(){e.call(this),this._pStateClass=t.SkeletonDirectionalState}return __extends(i,e),i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i}(t.AnimationNodeBase);t.SkeletonDirectionalNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(){e.call(this),this._iInputs=new Array,this._pStateClass=t.SkeletonNaryLERPState}return __extends(i,e),Object.defineProperty(i.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:!0,configurable:!0}),i.prototype.getInputIndex=function(t){return this._iInputs.indexOf(t)},i.prototype.getInputAt=function(t){return this._iInputs[t]},i.prototype.addInput=function(t){this._iInputs[this._numInputs++]=t},i.prototype.getAnimationState=function(t){return t.getAnimationState(this)},i}(t.AnimationNodeBase);t.SkeletonNaryLERPNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(){e.call(this),this._frames=new Array,this._translations=new Array,this._pStateClass=t.animators.VertexClipState}return __extends(i,e),Object.defineProperty(i.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),i.prototype.addFrame=function(e,i,n){"undefined"==typeof n&&(n=null),this._frames.push(e),this._pDurations.push(i),this._translations.push(n||new t.geom.Vector3D),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},i.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,n,r=this._pNumFrames-1;r--;)this._pTotalDuration+=this._pDurations[r],t=this._translations[r],i=this._translations[r+1],n=i.subtract(t),this._pTotalDelta.x+=n.x,this._pTotalDelta.y+=n.y,this._pTotalDelta.z+=n.z;this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._translations[0],i=this._translations[1],n=i.subtract(t),this._pTotalDelta.x+=n.x,this._pTotalDelta.y+=n.y,this._pTotalDelta.z+=n.z)},i}(e.AnimationClipNodeBase);e.VertexClipNode=i}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(){}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=function(){function e(e,i){this._pRootDelta=new t.geom.Vector3D,this._pPositionDeltaDirty=!0,this._pStartTime=0,this._pAnimator=e,this._pAnimationNode=i}return Object.defineProperty(e.prototype,"positionDelta",{get:function(){return this._pPositionDeltaDirty&&this._pUpdatePositionDelta(),this._pRootDelta},enumerable:!0,configurable:!0}),e.prototype.offset=function(t){this._pStartTime=t,this._pPositionDeltaDirty=!0},e.prototype.update=function(t){this._pTime!=t-this._pStartTime&&this._pUpdateTime(t)},e.prototype.phase=function(){},e.prototype._pUpdateTime=function(t){this._pTime=t-this._pStartTime,this._pPositionDeltaDirty=!0},e.prototype._pUpdatePositionDelta=function(){},e}();e.AnimationStateBase=i}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof n&&(n=!1),t.call(this,e,i),this._pDynamicProperties=new Array,this._pDynamicPropertiesDirty=new Object,this._particleNode=i,this._pNeedUpdateTime=n}return __extends(e,t),Object.defineProperty(e.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(){},e.prototype._pUpdateDynamicProperties=function(t){this._pDynamicPropertiesDirty[t._iUniqueId]=!0;for(var e,i,n,r,s,a=t.animationParticles,o=t.vertexData,h=t.totalLenOfOneVertex,p=this._particleNode.dataLength,u=this._particleNode._iDataOffset,l=this._pDynamicProperties.length,c=0,d=0,_=0;l>c;){for(;l>d&&(s=a[d]).index==c;){for(r=this._pDynamicProperties[c],e=s.numVertices*h,i=s.startVertexIndex*h+u,_=0;e>_;_+=h)for(n=i+_,_=0;e>_;_+=h)n=i+_,o[n++]=r.x,o[n++]=r.y,o[n++]=r.z,4==p&&(o[n++]=r.w);d++}c++}t.invalidateBuffer()},e}(t.AnimationStateBase);t.ParticleStateBase=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Vector3D,r=function(t){function r(e,i){t.call(this,e,i),this._particleAccelerationNode=i,this._acceleration=this._particleAccelerationNode._acceleration,this.updateAccelerationData()}return __extends(r,t),Object.defineProperty(r.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration.x=t.x,this._acceleration.y=t.y,this._acceleration.z=t.z,this.updateAccelerationData()},enumerable:!0,configurable:!0}),r.prototype.setRenderState=function(t,n,r,s){var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleAccelerationNode.ACCELERATION_INDEX);this._particleAccelerationNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?r.activateVertexBuffer(a,this._particleAccelerationNode._iDataOffset,t,i.FLOAT_3):s.setVertexConst(a,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)},r.prototype.updateAccelerationData=function(){this._particleAccelerationNode.mode==e.ParticlePropertiesMode.GLOBAL&&(this._halfAcceleration=new n(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2))},r}(e.ParticleStateBase);e.ParticleAccelerationState=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=function(t){function n(e,i){t.call(this,e,i),this._particleBezierCurveNode=i,this._controlPoint=this._particleBezierCurveNode._iControlPoint,this._endPoint=this._particleBezierCurveNode._iEndPoint}return __extends(n,t),Object.defineProperty(n.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(t){this._controlPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endPoint",{get:function(){return this._endPoint},set:function(t){this._endPoint=t},enumerable:!0,configurable:!0}),n.prototype.setRenderState=function(t,n,r,s){var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleBezierCurveNode.BEZIER_CONTROL_INDEX),o=s.getRegisterIndex(this._pAnimationNode,e.ParticleBezierCurveNode.BEZIER_END_INDEX);this._particleBezierCurveNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?(r.activateVertexBuffer(a,this._particleBezierCurveNode._iDataOffset,t,i.FLOAT_3),r.activateVertexBuffer(o,this._particleBezierCurveNode._iDataOffset+3,t,i.FLOAT_3)):(s.setVertexConst(a,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z),s.setVertexConst(o,this._endPoint.x,this._endPoint.y,this._endPoint.z))},n}(e.ParticleStateBase);e.ParticleBezierCurveState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Matrix3D,n=t.geom.Orientation3D,r=t.geom.MathConsts,s=function(t){function s(e,n){t.call(this,e,n),this._matrix=new i,this._billboardAxis=n._iBillboardAxis}return __extends(s,t),s.prototype.setRenderState=function(t,i,s,a,o){var h;if(this._billboardAxis){var p=i.sourceEntity.sceneTransform.position,u=o.sceneTransform.position.subtract(p),l=u.crossProduct(this._billboardAxis);l.normalize(),u=this.billboardAxis.crossProduct(l),u.normalize(),this._matrix.copyFrom(i.sourceEntity.sceneTransform),h=this._matrix.decompose(n.AXIS_ANGLE),this._matrix.copyColumnFrom(0,l),this._matrix.copyColumnFrom(1,this.billboardAxis),this._matrix.copyColumnFrom(2,u),this._matrix.copyColumnFrom(3,p),this._matrix.appendRotation(-h[1].w*r.RADIANS_TO_DEGREES,h[1])}else this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(o.inverseSceneTransform),h=this._matrix.decompose(n.AXIS_ANGLE),this._matrix.identity(),this._matrix.appendRotation(-h[1].w*r.RADIANS_TO_DEGREES,h[1]);a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,e.ParticleBillboardNode.MATRIX_INDEX),this._matrix)},Object.defineProperty(s.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(t){this.billboardAxis=t?t.clone():null,this.billboardAxis&&this.billboardAxis.normalize()},enumerable:!0,configurable:!0}),s}(e.ParticleStateBase);e.ParticleBillboardState=s}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Vector3D,r=function(t){function r(e,i){t.call(this,e,i),this._particleColorNode=i,this._usesMultiplier=this._particleColorNode._iUsesMultiplier,this._usesOffset=this._particleColorNode._iUsesOffset,this._usesCycle=this._particleColorNode._iUsesCycle,this._usesPhase=this._particleColorNode._iUsesPhase,this._startColor=this._particleColorNode._iStartColor,this._endColor=this._particleColorNode._iEndColor,this._cycleDuration=this._particleColorNode._iCycleDuration,this._cyclePhase=this._particleColorNode._iCyclePhase,this.updateColorData()}return __extends(r,t),Object.defineProperty(r.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"endColor",{get:function(){return this._endColor},set:function(t){this._endColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateColorData()},enumerable:!0,configurable:!0}),r.prototype.setRenderState=function(t,n,r,s){if(s.needFragmentAnimation){var a=this._particleColorNode._iDataOffset;this._usesCycle&&s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w),this._usesMultiplier&&(this._particleColorNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?(r.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.START_MULTIPLIER_INDEX),a,t,i.FLOAT_4),a+=4,r.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.DELTA_MULTIPLIER_INDEX),a,t,i.FLOAT_4),a+=4):(s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w),s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w))),this._usesOffset&&(this._particleColorNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?(r.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.START_OFFSET_INDEX),a,t,i.FLOAT_4),a+=4,r.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.DELTA_OFFSET_INDEX),a,t,i.FLOAT_4),a+=4):(s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w),s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleColorNode.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)))}},r.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new n(2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}this._particleColorNode.mode==e.ParticlePropertiesMode.GLOBAL&&(this._usesCycle?(this._usesMultiplier&&(this._startMultiplierData=new n((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2),this._deltaMultiplierData=new n((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)),this._usesOffset&&(this._startOffsetData=new n((this._startColor.redOffset+this._endColor.redOffset)/510,(this._startColor.greenOffset+this._endColor.greenOffset)/510,(this._startColor.blueOffset+this._endColor.blueOffset)/510,(this._startColor.alphaOffset+this._endColor.alphaOffset)/510),this._deltaOffsetData=new n((this._endColor.redOffset-this._startColor.redOffset)/510,(this._endColor.greenOffset-this._startColor.greenOffset)/510,(this._endColor.blueOffset-this._startColor.blueOffset)/510,(this._endColor.alphaOffset-this._startColor.alphaOffset)/510))):(this._usesMultiplier&&(this._startMultiplierData=new n(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),this._deltaMultiplierData=new n(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)),this._usesOffset&&(this._startOffsetData=new n(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),this._deltaOffsetData=new n((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255))))},r}(e.ParticleStateBase);e.ParticleColorState=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Vector3D,r=t.geom.MathConsts,s=function(t){function s(e,i){t.call(this,e,i,!0),this._targetPos=new n,this._targetEuler=new n,this._temp=new n,this._particleFollowNode=i,this._smooth=i._iSmooth}return __extends(s,t),Object.defineProperty(s.prototype,"followTarget",{get:function(){return this._followTarget},set:function(t){this._followTarget=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth=t},enumerable:!0,configurable:!0}),s.prototype.setRenderState=function(t,n,s,a){this._followTarget&&(this._particleFollowNode._iUsesPosition&&(this._targetPos.x=this._followTarget.transform.position.x/n.sourceEntity.scaleX,this._targetPos.y=this._followTarget.transform.position.y/n.sourceEntity.scaleY,this._targetPos.z=this._followTarget.transform.position.z/n.sourceEntity.scaleZ),this._particleFollowNode._iUsesRotation&&(this._targetEuler.x=this._followTarget.rotationX,this._targetEuler.y=this._followTarget.rotationY,this._targetEuler.z=this._followTarget.rotationZ,this._targetEuler.scaleBy(r.DEGREES_TO_RADIANS))),this._prePos||(this._prePos=this._targetPos.clone()),this._preEuler||(this._preEuler=this._targetEuler.clone());
var o=this._pTime/1e3,h=s.previousTime,p=o-h,u=h!=o;this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation?(u&&this.processPositionAndRotation(o,p,s),s.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,e.ParticleFollowNode.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,t,i.FLOAT_3),s.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,e.ParticleFollowNode.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,t,i.FLOAT_3)):this._particleFollowNode._iUsesPosition?(u&&this.processPosition(o,p,s),s.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,e.ParticleFollowNode.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,t,i.FLOAT_3)):this._particleFollowNode._iUsesRotation&&(u&&this.precessRotation(o,p,s),s.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,e.ParticleFollowNode.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,t,i.FLOAT_3)),this._prePos.copyFrom(this._targetPos),this._targetEuler.copyFrom(this._targetEuler),s.previousTime=o},s.prototype.processPosition=function(t,e,i){var n,r,s=i.animationParticles,a=i.vertexData,o=!1,h=s.length;this._smooth?(r=this._prePos.subtract(this._targetPos),r.scaleBy(1/e)):n=this._targetPos;for(var p=0;h>p;p++){var u=(t-s[p].startTime)/s[p].totalTime,l=(u-Math.floor(u))*s[p].totalTime;if(0>=l-e){var c=s[p].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(r),this._temp.scaleBy(l),n=this._targetPos.add(this._temp)),a[c]!=n.x||a[c+1]!=n.y||a[c+2]!=n.z){o=!0;for(var d=0;d<s[p].numVertices;d++)a[c++]=n.x,a[c++]=n.y,a[c++]=n.z}}}o&&i.invalidateBuffer()},s.prototype.precessRotation=function(t,e,i){var n,r,s=i.animationParticles,a=i.vertexData,o=!1,h=s.length;this._smooth?(r=this._preEuler.subtract(this._targetEuler),r.scaleBy(1/e)):n=this._targetEuler;for(var p=0;h>p;p++){var u=(t-s[p].startTime)/s[p].totalTime,l=(u-Math.floor(u))*s[p].totalTime;if(0>=l-e){var c=s[p].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(r),this._temp.scaleBy(l),n=this._targetEuler.add(this._temp)),a[c]!=n.x||a[c+1]!=n.y||a[c+2]!=n.z){o=!0;for(var d=0;d<s[p].numVertices;d++)a[c++]=n.x,a[c++]=n.y,a[c++]=n.z}}}o&&i.invalidateBuffer()},s.prototype.processPositionAndRotation=function(t,e,i){var n,r,s,a,o=i.animationParticles,h=i.vertexData,p=!1,u=o.length;this._smooth?(s=this._prePos.subtract(this._targetPos),s.scaleBy(1/e),a=this._preEuler.subtract(this._targetEuler),a.scaleBy(1/e)):(n=this._targetPos,r=this._targetEuler);for(var l=0;u>l;l++){var c=(t-o[l].startTime)/o[l].totalTime,d=(c-Math.floor(c))*o[l].totalTime;if(0>=d-e){var _=o[l].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(s),this._temp.scaleBy(d),n=this._targetPos.add(this._temp),this._temp.copyFrom(a),this._temp.scaleBy(d),r=this._targetEuler.add(this._temp)),h[_]!=n.x||h[_+1]!=n.y||h[_+2]!=n.z||h[_+3]!=r.x||h[_+4]!=r.y||h[_+5]!=r.z){p=!0;for(var f=0;f<o[l].numVertices;f++)h[_++]=n.x,h[_++]=n.y,h[_++]=n.z,h[_++]=r.x,h[_++]=r.y,h[_++]=r.z}}}p&&i.invalidateBuffer()},s}(e.ParticleStateBase);e.ParticleFollowState=s}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Vector3D,r=function(t){function r(e,i){t.call(this,e,i),this._particleInitialColorNode=i,this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._initialColor=i._iInitialColor,this.updateColorData()}return __extends(r,t),Object.defineProperty(r.prototype,"initialColor",{get:function(){return this._initialColor},set:function(t){this._initialColor=t},enumerable:!0,configurable:!0}),r.prototype.setRenderState=function(t,n,r,s,a){if(n=n,a=a,s.needFragmentAnimation)if(this._particleInitialColorNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC){var o=this._particleInitialColorNode._iDataOffset;this._usesMultiplier&&(r.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,e.ParticleInitialColorNode.MULTIPLIER_INDEX),o,t,i.FLOAT_4),o+=4),this._usesOffset&&r.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,e.ParticleInitialColorNode.OFFSET_INDEX),o,t,i.FLOAT_4)}else this._usesMultiplier&&s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleInitialColorNode.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w),this._usesOffset&&s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleInitialColorNode.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)},r.prototype.updateColorData=function(){this._particleInitialColorNode.mode==e.ParticlePropertiesMode.GLOBAL&&(this._usesMultiplier&&(this._multiplierData=new n(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier)),this._usesOffset&&(this._offsetData=new n(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)))},r}(e.ParticleStateBase);e.ParticleInitialColorState=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Matrix3D,r=t.geom.Vector3D,s=function(t){function s(e,i){t.call(this,e,i),this._particleOrbitNode=i,this._usesEulers=this._particleOrbitNode._iUsesEulers,this._usesCycle=this._particleOrbitNode._iUsesCycle,this._usesPhase=this._particleOrbitNode._iUsesPhase,this._eulers=this._particleOrbitNode._iEulers,this._radius=this._particleOrbitNode._iRadius,this._cycleDuration=this._particleOrbitNode._iCycleDuration,this._cyclePhase=this._particleOrbitNode._iCyclePhase,this.updateOrbitData()}return __extends(s,t),Object.defineProperty(s.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"eulers",{get:function(){return this._eulers},set:function(t){this._eulers=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),s.prototype.setRenderState=function(t,n,r,s){var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleOrbitNode.ORBIT_INDEX);this._particleOrbitNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?this._usesPhase?r.activateVertexBuffer(a,this._particleOrbitNode._iDataOffset,t,i.FLOAT_4):r.activateVertexBuffer(a,this._particleOrbitNode._iDataOffset,t,i.FLOAT_3):s.setVertexConst(a,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w),this._usesEulers&&s.setVertexConstFromMatrix(s.getRegisterIndex(this._pAnimationNode,e.ParticleOrbitNode.EULERS_INDEX),this._eulersMatrix)},s.prototype.updateOrbitData=function(){if(this._usesEulers&&(this._eulersMatrix=new n,this._eulersMatrix.appendRotation(this._eulers.x,r.X_AXIS),this._eulersMatrix.appendRotation(this._eulers.y,r.Y_AXIS),this._eulersMatrix.appendRotation(this._eulers.z,r.Z_AXIS)),this._particleOrbitNode.mode==e.ParticlePropertiesMode.GLOBAL)if(this._orbitData=new r(this._radius,0,2*this._radius*Math.PI,this._cyclePhase*Math.PI/180),this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=2*Math.PI/this._cycleDuration}else this._orbitData.y=2*Math.PI},s}(e.ParticleStateBase);e.ParticleOrbitState=s}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Vector3D,r=function(t){function r(e,i){t.call(this,e,i),this._particleOscillatorNode=i,this._oscillator=this._particleOscillatorNode._iOscillator,this.updateOscillatorData()}return __extends(r,t),Object.defineProperty(r.prototype,"oscillator",{get:function(){return this._oscillator},set:function(t){this._oscillator=t,this.updateOscillatorData()},enumerable:!0,configurable:!0}),r.prototype.setRenderState=function(t,n,r,s){var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleOscillatorNode.OSCILLATOR_INDEX);this._particleOscillatorNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?r.activateVertexBuffer(a,this._particleOscillatorNode._iDataOffset,t,i.FLOAT_4):s.setVertexConst(a,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)},r.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==e.ParticlePropertiesMode.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");null==this._oscillatorData&&(this._oscillatorData=new n),this._oscillatorData.x=this._oscillator.x,this._oscillatorData.y=this._oscillator.y,this._oscillatorData.z=this._oscillator.z,this._oscillatorData.w=2*Math.PI/this._oscillator.w}},r}(e.ParticleStateBase);e.ParticleOscillatorState=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=function(t){function n(e,i){t.call(this,e,i),this._particlePositionNode=i,this._position=this._particlePositionNode._iPosition}return __extends(n,t),Object.defineProperty(n.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),n.prototype.getPositions=function(){return this._pDynamicProperties},n.prototype.setPositions=function(t){this._pDynamicProperties=t,this._pDynamicPropertiesDirty=new Object},n.prototype.setRenderState=function(t,n,r,s){this._particlePositionNode.mode!=e.ParticlePropertiesMode.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var a=s.getRegisterIndex(this._pAnimationNode,e.ParticlePositionNode.POSITION_INDEX);this._particlePositionNode.mode==e.ParticlePropertiesMode.GLOBAL?s.setVertexConst(a,this._position.x,this._position.y,this._position.z):r.activateVertexBuffer(a,this._particlePositionNode._iDataOffset,t,i.FLOAT_3)},n}(e.ParticleStateBase);e.ParticlePositionState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Matrix3D,n=function(t){function n(e,n){t.call(this,e,n),this._matrix=new i}return __extends(n,t),n.prototype.setRenderState=function(t,i,n,r,s){r.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(s.inverseSceneTransform),r.setVertexConstFromMatrix(r.getRegisterIndex(this._pAnimationNode,e.ParticleRotateToHeadingNode.MATRIX_INDEX),this._matrix))},n}(e.ParticleStateBase);e.ParticleRotateToHeadingState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Matrix3D,r=function(t){function r(e,i){t.call(this,e,i),this._matrix=new n,this._particleRotateToPositionNode=i,this._position=this._particleRotateToPositionNode._iPosition}return __extends(r,t),Object.defineProperty(r.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),r.prototype.setRenderState=function(t,n,r,s,a){var o=s.getRegisterIndex(this._pAnimationNode,e.ParticleRotateToPositionNode.POSITION_INDEX);s.hasBillboard&&(this._matrix.copyFrom(n.sourceEntity.sceneTransform),this._matrix.append(a.inverseSceneTransform),s.setVertexConstFromMatrix(s.getRegisterIndex(this._pAnimationNode,e.ParticleRotateToPositionNode.MATRIX_INDEX),this._matrix)),this._particleRotateToPositionNode.mode==e.ParticlePropertiesMode.GLOBAL?(this._offset=n.sourceEntity.inverseSceneTransform.transformVector(this._position),s.setVertexConst(o,this._offset.x,this._offset.y,this._offset.z)):r.activateVertexBuffer(o,this._particleRotateToPositionNode._iDataOffset,t,i.FLOAT_3)},r}(e.ParticleStateBase);e.ParticleRotateToPositionState=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Vector3D,r=function(t){function r(e,i){t.call(this,e,i),this._particleRotationalVelocityNode=i,this._rotationalVelocity=this._particleRotationalVelocityNode._iRotationalVelocity,this.updateRotationalVelocityData()}return __extends(r,t),Object.defineProperty(r.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(t){this._rotationalVelocity=t,this.updateRotationalVelocityData()},enumerable:!0,configurable:!0}),r.prototype.getRotationalVelocities=function(){return this._pDynamicProperties},r.prototype.setRotationalVelocities=function(t){this._pDynamicProperties=t,this._pDynamicPropertiesDirty=new Object},r.prototype.setRenderState=function(t,n,r,s){this._particleRotationalVelocityNode.mode!=e.ParticlePropertiesMode.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleRotationalVelocityNode.ROTATIONALVELOCITY_INDEX);this._particleRotationalVelocityNode.mode==e.ParticlePropertiesMode.GLOBAL?s.setVertexConst(a,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w):r.activateVertexBuffer(a,this._particleRotationalVelocityNode._iDataOffset,t,i.FLOAT_4)},r.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==e.ParticlePropertiesMode.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var t=this._rotationalVelocity.clone();t.length<=0?t.z=1:t.normalize(),this._rotationalVelocityData=new n(t.x,t.y,t.z,Math.PI/t.w)}},r}(e.ParticleStateBase);e.ParticleRotationalVelocityState=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=t.geom.Vector3D,r=function(t){function r(e,i){t.call(this,e,i),this._particleScaleNode=i,this._usesCycle=this._particleScaleNode._iUsesCycle,this._usesPhase=this._particleScaleNode._iUsesPhase,this._minScale=this._particleScaleNode._iMinScale,this._maxScale=this._particleScaleNode._iMaxScale,this._cycleDuration=this._particleScaleNode._iCycleDuration,this._cyclePhase=this._particleScaleNode._iCyclePhase,this.updateScaleData()}return __extends(r,t),Object.defineProperty(r.prototype,"minScale",{get:function(){return this._minScale},set:function(t){this._minScale=t,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxScale",{get:function(){return this._maxScale},set:function(t){this._maxScale=t,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateScaleData()},enumerable:!0,configurable:!0}),r.prototype.setRenderState=function(t,n,r,s){var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleScaleNode.SCALE_INDEX);this._particleScaleNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?this._usesCycle?this._usesPhase?r.activateVertexBuffer(a,this._particleScaleNode._iDataOffset,t,i.FLOAT_4):r.activateVertexBuffer(a,this._particleScaleNode._iDataOffset,t,i.FLOAT_3):r.activateVertexBuffer(a,this._particleScaleNode._iDataOffset,t,i.FLOAT_2):s.setVertexConst(a,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)},r.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==e.ParticlePropertiesMode.GLOBAL)if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new n((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new n(this._minScale,this._maxScale-this._minScale,0,0)},r}(e.ParticleStateBase);e.ParticleScaleState=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(t,i){e.call(this,t,i),this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._startColor=i._iStartColor,this._endColor=i._iEndColor,this._segmentPoints=i._iSegmentPoints,this._numSegmentPoint=i._iNumSegmentPoint,this.updateColorData()}return __extends(i,e),Object.defineProperty(i.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"endColor",{get:function(){return this._endColor},set:function(t){this._endColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(t){this._segmentPoints=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:!0,configurable:!0}),i.prototype.setRenderState=function(e,i,n,r){r.needFragmentAnimation&&(this._numSegmentPoint>0&&r.setVertexConst(r.getRegisterIndex(this._pAnimationNode,t.ParticleSegmentedColorNode.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]),this._usesMultiplier&&r.setVertexConstFromArray(r.getRegisterIndex(this._pAnimationNode,t.ParticleSegmentedColorNode.START_MULTIPLIER_INDEX),this._multiplierData),this._usesOffset&&r.setVertexConstFromArray(r.getRegisterIndex(this._pAnimationNode,t.ParticleSegmentedColorNode.START_OFFSET_INDEX),this._offsetData))},i.prototype.updateColorData=function(){this._timeLifeData=new Array,this._multiplierData=new Array,this._offsetData=new Array;var t;for(t=0;t<this._numSegmentPoint;t++)this._timeLifeData.push(0==t?this._segmentPoints[t].life:this._segmentPoints[t].life-this._segmentPoints[t-1].life);if(this._timeLifeData.push(0==this._numSegmentPoint?1:1-this._segmentPoints[t-1].life),this._usesMultiplier){for(this._multiplierData.push(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),t=0;t<this._numSegmentPoint;t++)0==t?this._multiplierData.push((this._segmentPoints[t].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[t],(this._segmentPoints[t].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[t],(this._segmentPoints[t].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[t],(this._segmentPoints[t].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[t]):this._multiplierData.push((this._segmentPoints[t].color.redMultiplier-this._segmentPoints[t-1].color.redMultiplier)/this._timeLifeData[t],(this._segmentPoints[t].color.greenMultiplier-this._segmentPoints[t-1].color.greenMultiplier)/this._timeLifeData[t],(this._segmentPoints[t].color.blueMultiplier-this._segmentPoints[t-1].color.blueMultiplier)/this._timeLifeData[t],(this._segmentPoints[t].color.alphaMultiplier-this._segmentPoints[t-1].color.alphaMultiplier)/this._timeLifeData[t]);0==this._numSegmentPoint?this._multiplierData.push(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier):this._multiplierData.push((this._endColor.redMultiplier-this._segmentPoints[t-1].color.redMultiplier)/this._timeLifeData[t],(this._endColor.greenMultiplier-this._segmentPoints[t-1].color.greenMultiplier)/this._timeLifeData[t],(this._endColor.blueMultiplier-this._segmentPoints[t-1].color.blueMultiplier)/this._timeLifeData[t],(this._endColor.alphaMultiplier-this._segmentPoints[t-1].color.alphaMultiplier)/this._timeLifeData[t])}if(this._usesOffset){for(this._offsetData.push(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),t=0;t<this._numSegmentPoint;t++)0==t?this._offsetData.push((this._segmentPoints[t].color.redOffset-this._startColor.redOffset)/this._timeLifeData[t]/255,(this._segmentPoints[t].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[t]/255,(this._segmentPoints[t].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[t]/255,(this._segmentPoints[t].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[t]/255):this._offsetData.push((this._segmentPoints[t].color.redOffset-this._segmentPoints[t-1].color.redOffset)/this._timeLifeData[t]/255,(this._segmentPoints[t].color.greenOffset-this._segmentPoints[t-1].color.greenOffset)/this._timeLifeData[t]/255,(this._segmentPoints[t].color.blueOffset-this._segmentPoints[t-1].color.blueOffset)/this._timeLifeData[t]/255,(this._segmentPoints[t].color.alphaOffset-this._segmentPoints[t-1].color.alphaOffset)/this._timeLifeData[t]/255);0==this._numSegmentPoint?this._offsetData.push((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255):this._offsetData.push((this._endColor.redOffset-this._segmentPoints[t-1].color.redOffset)/this._timeLifeData[t]/255,(this._endColor.greenOffset-this._segmentPoints[t-1].color.greenOffset)/this._timeLifeData[t]/255,(this._endColor.blueOffset-this._segmentPoints[t-1].color.blueOffset)/this._timeLifeData[t]/255,(this._endColor.alphaOffset-this._segmentPoints[t-1].color.alphaOffset)/this._timeLifeData[t]/255)}this._timeLifeData.length=4},i}(t.ParticleStateBase);t.ParticleSegmentedColorState=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=function(t){function n(e,i){t.call(this,e,i),this._particleSpriteSheetNode=i,this._usesCycle=this._particleSpriteSheetNode._iUsesCycle,this._usesPhase=this._particleSpriteSheetNode._iUsesCycle,this._totalFrames=this._particleSpriteSheetNode._iTotalFrames,this._numColumns=this._particleSpriteSheetNode._iNumColumns,this._numRows=this._particleSpriteSheetNode._iNumRows,this._cycleDuration=this._particleSpriteSheetNode._iCycleDuration,this._cyclePhase=this._particleSpriteSheetNode._iCyclePhase,this.updateSpriteSheetData()}return __extends(n,t),Object.defineProperty(n.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),n.prototype.setRenderState=function(t,n,r,s){if(s.needUVAnimation&&(s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleSpriteSheetNode.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]),this._usesCycle)){var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleSpriteSheetNode.UV_INDEX_1);this._particleSpriteSheetNode.mode==e.ParticlePropertiesMode.LOCAL_STATIC?this._usesPhase?r.activateVertexBuffer(a,this._particleSpriteSheetNode._iDataOffset,t,i.FLOAT_3):r.activateVertexBuffer(a,this._particleSpriteSheetNode._iDataOffset,t,i.FLOAT_2):s.setVertexConst(a,this._spriteSheetData[4],this._spriteSheetData[5])}},n.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var t=this._totalFrames/this._numColumns;if(this._spriteSheetData[0]=t,this._spriteSheetData[1]=1/this._numColumns,this._spriteSheetData[2]=1/this._numRows,this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=t/this._cycleDuration,this._spriteSheetData[5]=this._cycleDuration,this._usesPhase&&(this._spriteSheetData[6]=this._cyclePhase)}},n}(e.ParticleStateBase);e.ParticleSpriteSheetState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=function(t){function n(e,i){t.call(this,e,i,!0),this._particleTimeNode=i}return __extends(n,t),n.prototype.setRenderState=function(t,n,r,s){r.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,e.ParticleTimeNode.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,t,i.FLOAT_4);var a=this._pTime/1e3;s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,e.ParticleTimeNode.TIME_CONSTANT_INDEX),a,a,a,a)},n}(e.ParticleStateBase);e.ParticleTimeState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(t,i){e.call(this,t,i),this._particleUVNode=i}return __extends(i,e),i.prototype.setRenderState=function(e,i,n,r){if(r.needUVAnimation){var s=r.getRegisterIndex(this._pAnimationNode,t.ParticleUVNode.UV_INDEX),a=this._particleUVNode._iUvData;r.setVertexConst(s,a.x,a.y)}},i}(t.ParticleStateBase);t.ParticleUVState=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLVertexBufferFormat,n=function(t){function n(e,i){t.call(this,e,i),this._particleVelocityNode=i,this._velocity=this._particleVelocityNode._iVelocity}return __extends(n,t),Object.defineProperty(n.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity=t},enumerable:!0,configurable:!0}),n.prototype.getVelocities=function(){return this._pDynamicProperties},n.prototype.setVelocities=function(t){this._pDynamicProperties=t,this._pDynamicPropertiesDirty=new Object},n.prototype.setRenderState=function(t,n,r,s){this._particleVelocityNode.mode!=e.ParticlePropertiesMode.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var a=s.getRegisterIndex(this._pAnimationNode,e.ParticleVelocityNode.VELOCITY_INDEX);this._particleVelocityNode.mode==e.ParticlePropertiesMode.GLOBAL?s.setVertexConst(a,this._velocity.x,this._velocity.y,this._velocity.z):r.activateVertexBuffer(a,this._particleVelocityNode._iDataOffset,t,i.FLOAT_3)},n}(e.ParticleStateBase);e.ParticleVelocityState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i){e.call(this,t,i),this._pFramesDirty=!0,this._animationClipNode=i}return __extends(i,e),Object.defineProperty(i.prototype,"blendWeight",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pBlendWeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pCurrentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pNextFrame},enumerable:!0,configurable:!0}),i.prototype.update=function(t){this._animationClipNode.looping||(t>this._pStartTime+this._animationClipNode.totalDuration?t=this._pStartTime+this._animationClipNode.totalDuration:t<this._pStartTime&&(t=this._pStartTime)),this._pTime!=t-this._pStartTime&&this._pUpdateTime(t)},i.prototype.phase=function(t){var e=t*this._animationClipNode.totalDuration+this._pStartTime;this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},i.prototype._pUpdateTime=function(t){this._pFramesDirty=!0,this._pTimeDir=t-this._pStartTime>this._pTime?1:-1,e.prototype._pUpdateTime.call(this,t)},i.prototype._pUpdateFrames=function(){this._pFramesDirty=!1;var t=this._animationClipNode.looping,e=this._animationClipNode.totalDuration,i=this._animationClipNode.lastFrame,n=this._pTime;if(t&&(n>=e||0>n)&&(n%=e,0>n&&(n+=e)),!t&&n>=e)this.notifyPlaybackComplete(),this._pCurrentFrame=i,this._pNextFrame=i,this._pBlendWeight=0;else if(!t&&0>=n)this._pCurrentFrame=0,this._pNextFrame=0,this._pBlendWeight=0;else if(this._animationClipNode.fixedFrameRate){var r=n/e*i;this._pCurrentFrame=Math.floor(r),this._pBlendWeight=r-this._pCurrentFrame,this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0,this._pNextFrame=0;var s,a=0,o=this._animationClipNode.durations;do s=a,a+=o[this._pNextFrame],this._pCurrentFrame=this._pNextFrame++;while(n>a);this._pCurrentFrame==i&&(this._pCurrentFrame=0,this._pNextFrame=1),this._pBlendWeight=(n-s)/o[this._pCurrentFrame]}},i.prototype.notifyPlaybackComplete=function(){null==this._animationStatePlaybackComplete&&(this._animationStatePlaybackComplete=new t.events.AnimationStateEvent(t.events.AnimationStateEvent.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode)),this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)},i}(e.AnimationStateBase);e.AnimationClipState=i}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n){e.call(this,i,n),this._blendWeight=0,this._skeletonPose=new t.SkeletonPose,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=n,this._inputA=i.getAnimationState(this._skeletonAnimationNode.inputA),this._inputB=i.getAnimationState(this._skeletonAnimationNode.inputB)}return __extends(i,e),Object.defineProperty(i.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(t){this._blendWeight=t,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),i.prototype.phase=function(t){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(t),this._inputB.phase(t)},i.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},i.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var t=this._inputA.positionDelta,e=this._inputB.positionDelta;this._pRootDelta.x=t.x+this._blendWeight*(e.x-t.x),this._pRootDelta.y=t.y+this._blendWeight*(e.y-t.y),this._pRootDelta.z=t.z+this._blendWeight*(e.z-t.z)},i.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var i,n,r,s,a,o,h=this._skeletonPose.jointPoses,p=this._inputA.getSkeletonPose(e).jointPoses,u=this._inputB.getSkeletonPose(e).jointPoses,l=e.numJoints;h.length!=l&&(h.length=l);for(var c=0;l>c;++c)i=h[c],null==i&&(i=h[c]=new t.JointPose),n=p[c],r=u[c],s=n.translation,a=r.translation,i.orientation.lerp(n.orientation,r.orientation,this._blendWeight),o=i.translation,o.x=s.x+this._blendWeight*(a.x-s.x),o.y=s.y+this._blendWeight*(a.y-s.y),o.z=s.z+this._blendWeight*(a.z-s.z)},i}(t.AnimationStateBase);t.SkeletonBinaryLERPState=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Vector3D,n=function(t){function n(n,r){t.call(this,n,r),this._rootPos=new i,this._skeletonPose=new e.SkeletonPose,this._skeletonPoseDirty=!0,this._skeletonClipNode=r,this._frames=this._skeletonClipNode.frames}return __extends(n,t),Object.defineProperty(n.prototype,"currentPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentPose},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextPose},enumerable:!0,configurable:!0}),n.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},n.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=!0,t.prototype._pUpdateTime.call(this,e)},n.prototype._pUpdateFrames=function(){t.prototype._pUpdateFrames.call(this),this._currentPose=this._frames[this._pCurrentFrame],this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame?(this._nextPose=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextPose=this._frames[this._pNextFrame]},n.prototype.updateSkeletonPose=function(t){if(this._skeletonPoseDirty=!1,this._skeletonClipNode.totalDuration){this._pFramesDirty&&this._pUpdateFrames();
var i,n,r,s,a,o,h=this._currentPose.jointPoses,p=this._nextPose.jointPoses,u=t.numJoints,l=this._skeletonPose.jointPoses;if(l.length!=u&&(l.length=u),u!=h.length||u!=p.length)throw new Error("joint counts don't match!");for(var c=0;u>c;++c)a=l[c],null==a&&(a=l[c]=new e.JointPose),r=h[c],s=p[c],i=r.translation,n=s.translation,this._skeletonClipNode.highQuality?a.orientation.slerp(r.orientation,s.orientation,this._pBlendWeight):a.orientation.lerp(r.orientation,s.orientation,this._pBlendWeight),c>0&&(o=a.translation,o.x=i.x+this._pBlendWeight*(n.x-i.x),o.y=i.y+this._pBlendWeight*(n.y-i.y),o.z=i.z+this._pBlendWeight*(n.z-i.z))}},n.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._pFramesDirty&&this._pUpdateFrames();var t,e,i,n=this._skeletonClipNode.totalDelta;(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame)&&(this._rootPos.x-=n.x*this._pTimeDir,this._rootPos.y-=n.y*this._pTimeDir,this._rootPos.z-=n.z*this._pTimeDir);var r=this._rootPos.x,s=this._rootPos.y,a=this._rootPos.z;this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame?(t=this._frames[0].jointPoses[0].translation,e=this._frames[1].jointPoses[0].translation,i=this._currentPose.jointPoses[0].translation,this._rootPos.x=i.x+t.x+this._pBlendWeight*(e.x-t.x),this._rootPos.y=i.y+t.y+this._pBlendWeight*(e.y-t.y),this._rootPos.z=i.z+t.z+this._pBlendWeight*(e.z-t.z)):(t=this._currentPose.jointPoses[0].translation,e=this._frames[this._pNextFrame].jointPoses[0].translation,this._rootPos.x=t.x+this._pBlendWeight*(e.x-t.x),this._rootPos.y=t.y+this._pBlendWeight*(e.y-t.y),this._rootPos.z=t.z+this._pBlendWeight*(e.z-t.z)),this._pRootDelta.x=this._rootPos.x-r,this._pRootDelta.y=this._rootPos.y-s,this._pRootDelta.z=this._rootPos.z-a,this._pOldFrame=this._pNextFrame},n}(e.AnimationClipState);e.SkeletonClipState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.geom.Quaternion,n=function(t){function n(i,n){t.call(this,i,n),this._blendWeight=0,this._skeletonPose=new e.SkeletonPose,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=n,this._baseInput=i.getAnimationState(this._skeletonAnimationNode.baseInput),this._differenceInput=i.getAnimationState(this._skeletonAnimationNode.differenceInput)}return __extends(n,t),Object.defineProperty(n.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(t){this._blendWeight=t,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),n.prototype.phase=function(t){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._baseInput.phase(t),this._baseInput.phase(t)},n.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=!0,this._baseInput.update(e),this._differenceInput.update(e),t.prototype._pUpdateTime.call(this,e)},n.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},n.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var t=this._baseInput.positionDelta,e=this._differenceInput.positionDelta;this.positionDelta.x=t.x+this._blendWeight*e.x,this.positionDelta.y=t.y+this._blendWeight*e.y,this.positionDelta.z=t.z+this._blendWeight*e.z},n.prototype.updateSkeletonPose=function(t){this._skeletonPoseDirty=!1;var i,r,s,a,o,h,p=this._skeletonPose.jointPoses,u=this._baseInput.getSkeletonPose(t).jointPoses,l=this._differenceInput.getSkeletonPose(t).jointPoses,c=t.numJoints;p.length!=c&&(p.length=c);for(var d=0;c>d;++d)i=p[d],null==i&&(i=p[d]=new e.JointPose),r=u[d],s=l[d],a=r.translation,o=s.translation,n._tempQuat.multiply(s.orientation,r.orientation),i.orientation.lerp(r.orientation,n._tempQuat,this._blendWeight),h=i.translation,h.x=a.x+this._blendWeight*o.x,h.y=a.y+this._blendWeight*o.y,h.z=a.z+this._blendWeight*o.z},n._tempQuat=new i,n}(e.AnimationStateBase);e.SkeletonDifferenceState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n){e.call(this,i,n),this._skeletonPose=new t.SkeletonPose,this._skeletonPoseDirty=!0,this._blendWeight=0,this._direction=0,this._blendDirty=!0,this._skeletonAnimationNode=n,this._forward=i.getAnimationState(this._skeletonAnimationNode.forward),this._backward=i.getAnimationState(this._skeletonAnimationNode.backward),this._left=i.getAnimationState(this._skeletonAnimationNode.left),this._right=i.getAnimationState(this._skeletonAnimationNode.right)}return __extends(i,e),Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction!=t&&(this._direction=t,this._blendDirty=!0,this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0)},enumerable:!0,configurable:!0}),i.prototype.phase=function(t){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(t),this._inputB.phase(t)},i.prototype._pUdateTime=function(t){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},i.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._blendDirty&&this.updateBlend();var t=this._inputA.positionDelta,e=this._inputB.positionDelta;this.positionDelta.x=t.x+this._blendWeight*(e.x-t.x),this.positionDelta.y=t.y+this._blendWeight*(e.y-t.y),this.positionDelta.z=t.z+this._blendWeight*(e.z-t.z)},i.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1,this._blendDirty&&this.updateBlend();var i,n,r,s,a,o,h=this._skeletonPose.jointPoses,p=this._inputA.getSkeletonPose(e).jointPoses,u=this._inputB.getSkeletonPose(e).jointPoses,l=e.numJoints;h.length!=l&&(h.length=l);for(var c=0;l>c;++c)i=h[c],null==i&&(i=h[c]=new t.JointPose),n=p[c],r=u[c],s=n.translation,a=r.translation,i.orientation.lerp(n.orientation,r.orientation,this._blendWeight),o=i.translation,o.x=s.x+this._blendWeight*(a.x-s.x),o.y=s.y+this._blendWeight*(a.y-s.y),o.z=s.z+this._blendWeight*(a.z-s.z)},i.prototype.updateBlend=function(){this._blendDirty=!1,(this._direction<0||this._direction>360)&&(this._direction%=360,this._direction<0&&(this._direction+=360)),this._direction<90?(this._inputA=this._forward,this._inputB=this._right,this._blendWeight=this._direction/90):this._direction<180?(this._inputA=this._right,this._inputB=this._backward,this._blendWeight=(this._direction-90)/90):this._direction<270?(this._inputA=this._backward,this._inputB=this._left,this._blendWeight=(this._direction-180)/90):(this._inputA=this._left,this._inputB=this._forward,this._blendWeight=(this._direction-270)/90)},i}(t.AnimationStateBase);t.SkeletonDirectionalState=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n){e.call(this,i,n),this._skeletonPose=new t.SkeletonPose,this._skeletonPoseDirty=!0,this._blendWeights=new Array,this._inputs=new Array,this._skeletonAnimationNode=n;for(var r=this._skeletonAnimationNode.numInputs;r--;)this._inputs[r]=i.getAnimationState(this._skeletonAnimationNode._iInputs[r])}return __extends(i,e),i.prototype.phase=function(t){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0;for(var e=0;e<this._skeletonAnimationNode.numInputs;++e)this._blendWeights[e]&&this._inputs[e].update(t)},i.prototype._pUdateTime=function(t){for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)this._blendWeights[i]&&this._inputs[i].update(t);e.prototype._pUpdateTime.call(this,t)},i.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},i.prototype.getBlendWeightAt=function(t){return this._blendWeights[t]},i.prototype.setBlendWeightAt=function(t,e){this._blendWeights[t]=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var t,e;this.positionDelta.x=0,this.positionDelta.y=0,this.positionDelta.z=0;for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)e=this._blendWeights[i],e&&(t=this._inputs[i].positionDelta,this.positionDelta.x+=e*t.x,this.positionDelta.y+=e*t.y,this.positionDelta.z+=e*t.z)},i.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x=this._skeletonPose.jointPoses,v=e.numJoints;x.length!=v&&(x.length=v);for(var w=0;w<this._skeletonAnimationNode.numInputs;++w)if(i=this._blendWeights[w])if(n=this._inputs[w].getSkeletonPose(e).jointPoses,u)for(l=0;l<e.numJoints;++l)r=x[l],s=n[l],p=u[l].orientation,d=p.x,_=p.y,f=p.z,c=p.w,p=s.orientation,o=s.translation,m=p.x,y=p.y,b=p.z,g=p.w,0>d*m+_*y+f*b+c*g&&(m=-m,y=-y,b=-b,g=-g),h=r.orientation,h.x+=i*m,h.y+=i*y,h.z+=i*b,h.w+=i*g,a=r.translation,a.x+=i*o.x,a.y+=i*o.y,a.z+=i*o.z;else for(u=n,l=0;v>l;++l)r=x[l],null==r&&(r=x[l]=new t.JointPose),s=n[l],p=s.orientation,o=s.translation,h=r.orientation,h.x=i*p.x,h.y=i*p.y,h.z=i*p.z,h.w=i*p.w,a=r.translation,a.x=i*o.x,a.y=i*o.y,a.z=i*o.z;for(l=0;l<e.numJoints;++l)x[l].orientation.normalize()},i}(t.AnimationStateBase);t.SkeletonNaryLERPState=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e,i){t.call(this,e,i),this._vertexClipNode=i,this._frames=this._vertexClipNode.frames}return __extends(e,t),Object.defineProperty(e.prototype,"currentGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentGeometry},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextGeometry},enumerable:!0,configurable:!0}),e.prototype._pUpdateFrames=function(){t.prototype._pUpdateFrames.call(this),this._currentGeometry=this._frames[this._pCurrentFrame],this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame?(this._nextGeometry=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextGeometry=this._frames[this._pNextFrame]},e.prototype._pUpdatePositionDelta=function(){},e}(t.AnimationClipState);t.VertexClipState=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(){function e(t){this.blendSpeed=.5,this.blendSpeed=t}return e.prototype.getAnimationNode=function(e,i,n,r){var s=new t.CrossfadeTransitionNode;return s.inputA=i,s.inputB=n,s.blendSpeed=this.blendSpeed,s.startBlend=r,s},e}();t.CrossfadeTransition=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(){e.call(this),this._pStateClass=t.CrossfadeTransitionState}return __extends(i,e),i}(t.SkeletonBinaryLERPNode);t.CrossfadeTransitionNode=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.events.AnimationStateEvent,n=function(t){function e(e,i){t.call(this,e,i),this._crossfadeTransitionNode=i}return __extends(e,t),e.prototype._pUpdateTime=function(e){this.blendWeight=Math.abs(e-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed),this.blendWeight>=1&&(this.blendWeight=1,null==this._animationStateTransitionComplete&&(this._animationStateTransitionComplete=new i(i.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode)),this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)),t.prototype._pUpdateTime.call(this,e)},e}(e.SkeletonBinaryLERPState);e.CrossfadeTransitionState=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=function(e){function n(){e.call(this),this._animations=new Array,this._animationNames=new Array,this._animationDictionary=new Object}return __extends(n,e),n.prototype._pFindTempReg=function(t,e){"undefined"==typeof e&&(e=null);for(var i,n=0;;){if(i="vt"+n,-1==t.indexOf(i)&&e!=i)return i;++n}return null},Object.defineProperty(n.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:!0,configurable:!0}),n.prototype.resetGPUCompatibility=function(){this._usesCPU=!1},n.prototype.cancelGPUCompatibility=function(){this._usesCPU=!0},n.prototype.getAGALVertexCode=function(){throw new i},n.prototype.activate=function(){throw new i},n.prototype.deactivate=function(){throw new i},n.prototype.getAGALFragmentCode=function(){throw new i},n.prototype.getAGALUVCode=function(){throw new i},n.prototype.doneAGALCode=function(){throw new i},Object.defineProperty(n.prototype,"assetType",{get:function(){return t.library.AssetType.ANIMATION_SET},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),n.prototype.hasAnimation=function(t){return null!=this._animationDictionary[t]},n.prototype.getAnimation=function(t){return this._animationDictionary[t]},n.prototype.addAnimation=function(e){if(this._animationDictionary[e.name])throw new t.errors.AnimationSetError("root node name '"+e.name+"' already exists in the set");this._animationDictionary[e.name]=e,this._animations.push(e),this._animationNames.push(e.name)},n.prototype.dispose=function(){},n}(t.library.NamedAssetBase);e.AnimationSetBase=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.errors.AbstractMethodError,n=t.events.AnimatorEvent,r=t.library.AssetType,s=function(e){function s(i){e.call(this),this._autoUpdate=!0,this._time=0,this._playbackSpeed=1,this._pOwners=new Array,this._pAbsoluteTime=0,this._animationStates=new Object,this.updatePosition=!0,this._pAnimationSet=i,this._broadcaster=new t.utils.RequestAnimationFrame(this.onEnterFrame,this)}return __extends(s,e),s.prototype.getAnimationState=function(t){var e=t.stateClass,i=t.id;return null==this._animationStates[i]&&(this._animationStates[i]=new e(this,t)),this._animationStates[i]},s.prototype.getAnimationStateByName=function(t){return this.getAnimationState(this._pAnimationSet.getAnimation(t))},Object.defineProperty(s.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate!=t&&(this._autoUpdate=t,this._autoUpdate?this.start():this.stop())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"time",{get:function(){return this._time},set:function(t){this._time!=t&&this.update(t)},enumerable:!0,configurable:!0}),s.prototype.phase=function(t){this._pActiveState.phase(t)},Object.defineProperty(s.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(t){this._playbackSpeed=t},enumerable:!0,configurable:!0}),s.prototype.setRenderState=function(){throw new t.errors.AbstractMethodError},s.prototype.start=function(){!this._isPlaying&&this._autoUpdate&&(this._time=this._pAbsoluteTime=t.utils.getTimer(),this._isPlaying=!0,this._broadcaster.start(),this.hasEventListener(n.START)&&(null==this._startEvent&&(this._startEvent=new n(n.START,this)),this.dispatchEvent(this._startEvent)))},s.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._broadcaster.stop(),this.hasEventListener(n.STOP)&&(null==this._stopEvent&&(this._stopEvent=new n(n.STOP,this)),this.dispatchEvent(this._stopEvent)))},s.prototype.update=function(t){var e=(t-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(e),this._time=t},s.prototype.reset=function(t,e){"undefined"==typeof e&&(e=0),this.getAnimationState(this._pAnimationSet.getAnimation(t)).offset(e+this._pAbsoluteTime)},s.prototype.addOwner=function(t){this._pOwners.push(t)},s.prototype.removeOwner=function(t){this._pOwners.splice(this._pOwners.indexOf(t),1)},s.prototype._pUpdateDeltaTime=function(t){this._pAbsoluteTime+=t,this._pActiveState.update(this._pAbsoluteTime),this.updatePosition&&this.applyPositionDelta()},s.prototype.onEnterFrame=function(e){"undefined"==typeof e&&(e=null),this.update(t.utils.getTimer())},s.prototype.applyPositionDelta=function(){var t,e=this._pActiveState.positionDelta,i=e.length;if(i>0){t=this._pOwners.length;for(var n=0;t>n;++n)this._pOwners[n].translateLocal(e,i)}},s.prototype.dispatchCycleEvent=function(){this.hasEventListener(n.CYCLE_COMPLETE)&&(null==this._cycleEvent&&(this._cycleEvent=new n(n.CYCLE_COMPLETE,this)),this.dispatchEvent(this._cycleEvent))},s.prototype.clone=function(){throw new i},s.prototype.dispose=function(){},s.prototype.testGPUCompatibility=function(){throw new i},Object.defineProperty(s.prototype,"assetType",{get:function(){return r.ANIMATOR},enumerable:!0,configurable:!0}),s.prototype.getRenderableSubGeometry=function(t,e){return e},s}(t.library.NamedAssetBase);e.AnimatorBase=s}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(e){function i(i,n,r){"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),e.call(this),this._animationSubGeometries=new Object,this._particleNodes=new Array,this._localDynamicNodes=new Array,this._localStaticNodes=new Array,this._totalLenOfOneVertex=0,this.addAnimation(this._timeNode=new t.ParticleTimeNode(i,n,r))}return __extends(i,e),Object.defineProperty(i.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:!0,configurable:!0}),i.prototype.addAnimation=function(i){var n,r=i;for(r._iProcessAnimationSetting(this),r.mode==t.ParticlePropertiesMode.LOCAL_STATIC?(r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength,this._localStaticNodes.push(r)):r.mode==t.ParticlePropertiesMode.LOCAL_DYNAMIC&&this._localDynamicNodes.push(r),n=this._particleNodes.length-1;n>=0&&!(this._particleNodes[n].priority<=r.priority);n--);this._particleNodes.splice(n+1,0,r),e.prototype.addAnimation.call(this,i)},i.prototype.activate=function(t,e){this._iAnimationRegisterCache=e.animationRegisterCache},i.prototype.deactivate=function(t){for(var e=t.context,i=this._iAnimationRegisterCache.vertexAttributesOffset,n=this._iAnimationRegisterCache.numUsedStreams,r=i;n>r;r++)e.setVertexBufferAt(r,null)},i.prototype.getAGALVertexCode=function(e,n,r,s){this._iAnimationRegisterCache=e.animationRegisterCache,null==this._iAnimationRegisterCache&&(this._iAnimationRegisterCache=e.animationRegisterCache=new t.AnimationRegisterCache(s)),this._iAnimationRegisterCache.vertexConstantOffset=e.numUsedVertexConstants,this._iAnimationRegisterCache.vertexAttributesOffset=e.numUsedStreams,this._iAnimationRegisterCache.varyingsOffset=e.numUsedVaryings,this._iAnimationRegisterCache.fragmentConstantOffset=e.numUsedFragmentConstants,this._iAnimationRegisterCache.hasUVNode=this.hasUVNode,this._iAnimationRegisterCache.needVelocity=this.needVelocity,this._iAnimationRegisterCache.hasBillboard=this.hasBillboard,this._iAnimationRegisterCache.sourceRegisters=n,this._iAnimationRegisterCache.targetRegisters=r,this._iAnimationRegisterCache.needFragmentAnimation=e.needFragmentAnimation,this._iAnimationRegisterCache.needUVAnimation=e.needUVAnimation,this._iAnimationRegisterCache.hasColorAddNode=this.hasColorAddNode,this._iAnimationRegisterCache.hasColorMulNode=this.hasColorMulNode,this._iAnimationRegisterCache.reset();var a="";a+=this._iAnimationRegisterCache.getInitCode();var o,h;for(h=0;h<this._particleNodes.length;h++)o=this._particleNodes[h],o.priority<i.POST_PRIORITY&&(a+=o.getAGALVertexCode(e,this._iAnimationRegisterCache));for(a+=this._iAnimationRegisterCache.getCombinationCode(),h=0;h<this._particleNodes.length;h++)o=this._particleNodes[h],o.priority>=i.POST_PRIORITY&&o.priority<i.COLOR_PRIORITY&&(a+=o.getAGALVertexCode(e,this._iAnimationRegisterCache));for(a+=this._iAnimationRegisterCache.initColorRegisters(),h=0;h<this._particleNodes.length;h++)o=this._particleNodes[h],o.priority>=i.COLOR_PRIORITY&&(a+=o.getAGALVertexCode(e,this._iAnimationRegisterCache));return a+=this._iAnimationRegisterCache.getColorPassCode()},i.prototype.getAGALUVCode=function(t,e,i){var n="";if(this.hasUVNode){this._iAnimationRegisterCache.setUVSourceAndTarget(e,i),n+="mov "+this._iAnimationRegisterCache.uvTarget+".xy,"+this._iAnimationRegisterCache.uvAttribute.toString()+"\n";for(var r,s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s];n+=r.getAGALUVCode(t,this._iAnimationRegisterCache),n+="mov "+this._iAnimationRegisterCache.uvVar.toString()+","+this._iAnimationRegisterCache.uvTarget+".xy\n"}else n+="mov "+i+","+e+"\n";return n},i.prototype.getAGALFragmentCode=function(t,e){return this._iAnimationRegisterCache.getColorCombinationCode(e)},i.prototype.doneAGALCode=function(){this._iAnimationRegisterCache.setDataLength(),this._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index,0,1,2,0)},Object.defineProperty(i.prototype,"usesCPU",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.cancelGPUCompatibility=function(){},i.prototype.dispose=function(){for(var t in this._animationSubGeometries)this._animationSubGeometries[t].dispose();e.prototype.dispose.call(this)},i.prototype.getAnimationSubGeometry=function(t){var e=t.parentMesh,i=e.shareAnimationGeometry?this._animationSubGeometries[t.subGeometry.id]:this._animationSubGeometries[t.id];return i?i:(this._iGenerateAnimationSubGeometries(e),e.shareAnimationGeometry?this._animationSubGeometries[t.subGeometry.id]:this._animationSubGeometries[t.id])},i.prototype._iGenerateAnimationSubGeometries=function(e){if(null==this.initParticleFunc)throw new Error("no initParticleFunc set");var i=e.geometry;if(!i)throw new Error("Particle animation can only be performed on a ParticleGeometry object");var n,r,s,a,o,h,p,u=!1;for(n=0;n<e.subMeshes.length;n++)h=e.subMeshes[n],o=h.subGeometry,e.shareAnimationGeometry&&(a=this._animationSubGeometries[o.id])||(a=new t.AnimationSubGeometry,e.shareAnimationGeometry?this._animationSubGeometries[o.id]=a:this._animationSubGeometries[h.id]=a,u=!0,a.createVertexData(o.numVertices,this._totalLenOfOneVertex));if(u){var l,c,d,_,f,g,m,y,b,x,v,w=i.particles,D=w.length,C=i.numParticles,S=new t.ParticleProperties;for(S.total=C,S.startTime=0,S.duration=1e3,S.delay=.1,n=0,r=0;C>n;){for(S.index=n,this.initParticleFunc.call(this.initParticleScope,S),s=0;s<this._localStaticNodes.length;s++)this._localStaticNodes[s]._iGeneratePropertyOfOneParticle(S);for(;D>r&&(l=w[r]).particleIndex==n;){for(s=0;s<e.subMeshes.length;s++)if(h=e.subMeshes[s],h.subGeometry==l.subGeometry){a=e.shareAnimationGeometry?this._animationSubGeometries[h.subGeometry.id]:this._animationSubGeometries[h.id];break}for(m=l.numVertices,y=a.vertexData,b=m*this._totalLenOfOneVertex,x=a.numProcessedVertices*this._totalLenOfOneVertex,s=0;s<this._localStaticNodes.length;s++)for(p=this._localStaticNodes[s],g=p.oneData,c=p.dataLength,d=x+p._iDataOffset,_=0;b>_;_+=this._totalLenOfOneVertex)for(v=d+_,f=0;c>f;f++)y[v+f]=g[f];this._localDynamicNodes.length&&a.animationParticles.push(new t.ParticleAnimationData(n,S.startTime,S.duration,S.delay,l)),a.numProcessedVertices+=m,r++}n++}}},i.POST_PRIORITY=9,i.COLOR_PRIORITY=18,i}(t.AnimationSetBase);t.ParticleAnimationSet=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.stagegl.ContextGLProgramType,n=function(t){function n(i){t.call(this,i),this._animationParticleStates=new Array,this._animatorParticleStates=new Array,this._timeParticleStates=new Array,this._totalLenOfOneVertex=0,this._animatorSubGeometries=new Object,this._particleAnimationSet=i;for(var n,r,s=0;s<this._particleAnimationSet.particleNodes.length;s++)r=this._particleAnimationSet.particleNodes[s],n=this.getAnimationState(r),r.mode==e.ParticlePropertiesMode.LOCAL_DYNAMIC?(this._animatorParticleStates.push(n),r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength):this._animationParticleStates.push(n),n.needUpdateTime&&this._timeParticleStates.push(n)}return __extends(n,t),n.prototype.clone=function(){return new n(this._particleAnimationSet)},n.prototype.setRenderState=function(t,e,n,r,s){var a,o=this._particleAnimationSet._iAnimationRegisterCache,h=e.subMesh;if(!h)throw new Error("Must be subMesh");var p=this._particleAnimationSet.getAnimationSubGeometry(h);for(a=0;a<this._animationParticleStates.length;a++)this._animationParticleStates[a].setRenderState(t,e,p,o,s);var u=this.getAnimatorSubGeometry(h);for(a=0;a<this._animatorParticleStates.length;a++)this._animatorParticleStates[a].setRenderState(t,e,u,o,s);t.context.setProgramConstantsFromArray(i.VERTEX,o.vertexConstantOffset,o.vertexConstantData,o.numVertexConstant),o.numFragmentConstant>0&&t.context.setProgramConstantsFromArray(i.FRAGMENT,o.fragmentConstantOffset,o.fragmentConstantData,o.numFragmentConstant)},n.prototype.testGPUCompatibility=function(){},n.prototype.start=function(){t.prototype.start.call(this);for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].offset(this._pAbsoluteTime)},n.prototype._pUpdateDeltaTime=function(t){this._pAbsoluteTime+=t;for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].update(this._pAbsoluteTime)},n.prototype.resetTime=function(t){"undefined"==typeof t&&(t=0);for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].offset(this._pAbsoluteTime+t);this.update(this.time)},n.prototype.dispose=function(){for(var t in this._animatorSubGeometries)this._animatorSubGeometries[t].dispose()},n.prototype.getAnimatorSubGeometry=function(t){if(this._animatorParticleStates.length){var i=t.subGeometry,n=this._animatorSubGeometries[i.id]=new e.AnimationSubGeometry;n.createVertexData(i.numVertices,this._totalLenOfOneVertex),n.animationParticles=this._particleAnimationSet.getAnimationSubGeometry(t).animationParticles}},n}(e.AnimatorBase);e.ParticleAnimator=n}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.events.AnimationStateEvent,r=t.stagegl.ContextGLProgramType,s=function(s){function a(t,i,n){"undefined"==typeof n&&(n=!1);var r=this;s.call(this,t),this._globalPose=new e.SkeletonPose,this._morphedSubGeometry=new Object,this._morphedSubGeometryDirty=new Object,this._skeleton=i,this._forceCPU=n,this._jointsPerVertex=t.jointsPerVertex,this._numJoints=this._skeleton.numJoints,this._globalMatrices=new Array(12*this._numJoints);for(var a=0,o=0;o<this._numJoints;++o)this._globalMatrices[a++]=1,this._globalMatrices[a++]=0,this._globalMatrices[a++]=0,this._globalMatrices[a++]=0,this._globalMatrices[a++]=0,this._globalMatrices[a++]=1,this._globalMatrices[a++]=0,this._globalMatrices[a++]=0,this._globalMatrices[a++]=0,this._globalMatrices[a++]=0,this._globalMatrices[a++]=1,this._globalMatrices[a++]=0;this._onTransitionCompleteDelegate=function(t){return r.onTransitionComplete(t)},this._onIndicesUpdateDelegate=function(t){return r.onIndicesUpdate(t)},this._onVerticesUpdateDelegate=function(t){return r.onVerticesUpdate(t)}}return __extends(a,s),Object.defineProperty(a.prototype,"globalMatrices",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalMatrices},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"globalPose",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalPose},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(t){this._useCondensedIndices=t},enumerable:!0,configurable:!0}),a.prototype.clone=function(){return new a(this._pAnimationSet,this._skeleton,this._forceCPU)},a.prototype.play=function(t,e,i){if("undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0/0),this._pActiveAnimationName!=t){if(this._pActiveAnimationName=t,!this._pAnimationSet.hasAnimation(t))throw new Error("Animation root node "+t+" not found!");e&&this._pActiveNode?(this._pActiveNode=e.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(t),this._pAbsoluteTime),this._pActiveNode.addEventListener(n.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)):this._pActiveNode=this._pAnimationSet.getAnimation(t),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeSkeletonState=this._pActiveState,this.start(),isNaN(i)||this.reset(t,i)}},a.prototype.setRenderState=function(t,e,n,s){this._globalPropertiesDirty&&this.updateGlobalProperties();var a=e.subMesh.subGeometry;if(a.useCondensedIndices=this._useCondensedIndices,this._useCondensedIndices)this.updateCondensedMatrices(a.condensedIndexLookUp,a.numCondensedJoints),t.context.setProgramConstantsFromArray(r.VERTEX,n,this._condensedMatrices,3*a.numCondensedJoints);else{if(this._pAnimationSet.usesCPU)return void(this._morphedSubGeometryDirty[a.id]&&this.morphSubGeometry(e,a));t.context.setProgramConstantsFromArray(r.VERTEX,n,this._globalMatrices,3*this._numJoints)}t.context.activateBuffer(s,e.getVertexData(i.JOINT_INDEX_DATA),e.getVertexOffset(i.JOINT_INDEX_DATA),e.JOINT_INDEX_FORMAT),t.context.activateBuffer(s+1,e.getVertexData(i.JOINT_WEIGHT_DATA),e.getVertexOffset(i.JOINT_WEIGHT_DATA),e.JOINT_WEIGHT_FORMAT)},a.prototype.testGPUCompatibility=function(t){!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||t.numUsedVertexConstants+3*this._numJoints>128)&&this._pAnimationSet.cancelGPUCompatibility()},a.prototype._pUpdateDeltaTime=function(t){if(s.prototype._pUpdateDeltaTime.call(this,t),this._globalPropertiesDirty=!0,this._pAnimationSet.usesCPU)for(var e in this._morphedSubGeometryDirty)this._morphedSubGeometryDirty[e]=!0},a.prototype.updateCondensedMatrices=function(t,e){var i,n,r=0,s=0;this._condensedMatrices=new Array;do for(n=4*t[r],i=n+12;i>n;)this._condensedMatrices[s++]=this._globalMatrices[n++];while(++r<e)},a.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=!1,this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);for(var t,e,i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w,D,C,S,P,A,T,M,E,O,R,I,N,L,F=0,V=this._globalPose.jointPoses,U=this._skeleton.joints,B=0;B<this._numJoints;++B)R=V[B],I=R.orientation,N=R.translation,e=I.x,i=I.y,n=I.z,r=I.w,s=(L=2*e)*i,a=L*n,o=L*r,h=(L=2*i)*n,p=L*r,u=2*n*r,h=2*i*n,p=2*i*r,u=2*n*r,e*=e,i*=i,n*=n,r*=r,l=(L=e-i)-n+r,c=s-u,d=a+p,_=s+u,f=-L-n+r,g=h-o,m=a-p,y=h+o,b=-e-i+n+r,t=U[B].inverseBindPose,x=t[0],v=t[4],w=t[8],D=t[12],C=t[1],S=t[5],P=t[9],A=t[13],T=t[2],M=t[6],E=t[10],O=t[14],this._globalMatrices[F]=l*x+c*C+d*T,this._globalMatrices[F+1]=l*v+c*S+d*M,this._globalMatrices[F+2]=l*w+c*P+d*E,this._globalMatrices[F+3]=l*D+c*A+d*O+N.x,this._globalMatrices[F+4]=_*x+f*C+g*T,this._globalMatrices[F+5]=_*v+f*S+g*M,this._globalMatrices[F+6]=_*w+f*P+g*E,this._globalMatrices[F+7]=_*D+f*A+g*O+N.y,this._globalMatrices[F+8]=m*x+y*C+b*T,this._globalMatrices[F+9]=m*v+y*S+b*M,this._globalMatrices[F+10]=m*w+y*P+b*E,this._globalMatrices[F+11]=m*D+y*A+b*O+N.z,F+=12},a.prototype.getRenderableSubGeometry=function(e,i){if(this._morphedSubGeometryDirty[i.id]=!0,!this._pAnimationSet.usesCPU)return i;var n;return(n=this._morphedSubGeometry[i.id])||(n=this._morphedSubGeometry[i.id]=i.clone(),n.autoDeriveNormals=!1,n.autoDeriveTangents=!1,n.autoDeriveUVs=!1,i.addEventListener(t.events.SubGeometryEvent.INDICES_UPDATED,this._onIndicesUpdateDelegate),i.addEventListener(t.events.SubGeometryEvent.VERTICES_UPDATED,this._onVerticesUpdateDelegate)),n},a.prototype.morphSubGeometry=function(t,e){this._morphedSubGeometryDirty[e.id]=!1;for(var i,n,r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w,D,C,S,P,A,T,M,E,O,R,I,N=e.positions,L=e.vertexNormals,F=e.vertexTangents,V=e.jointIndices,U=e.jointWeights,B=this._morphedSubGeometry[e.id],j=B.positions,z=B.vertexNormals,k=B.vertexTangents,G=0,H=0,X=N.length;X>G;){for(d=N[G],_=N[G+1],f=N[G+2],g=L[G],m=L[G+1],y=L[G+2],b=F[G],x=F[G+1],v=F[G+2],n=0,r=0,s=0,a=0,o=0,h=0,p=0,u=0,l=0,i=0;i<this._jointsPerVertex;)if(c=U[H],c>0){var W=V[H++]<<2;
w=this._globalMatrices[W],D=this._globalMatrices[W+1],C=this._globalMatrices[W+2],S=this._globalMatrices[W+3],P=this._globalMatrices[W+4],A=this._globalMatrices[W+5],T=this._globalMatrices[W+6],M=this._globalMatrices[W+7],E=this._globalMatrices[W+8],O=this._globalMatrices[W+9],R=this._globalMatrices[W+10],I=this._globalMatrices[W+11],n+=c*(w*d+D*_+C*f+S),r+=c*(P*d+A*_+T*f+M),s+=c*(E*d+O*_+R*f+I),a+=c*(w*g+D*m+C*y),o+=c*(P*g+A*m+T*y),h+=c*(E*g+O*m+R*y),p+=c*(w*b+D*x+C*v),u+=c*(P*b+A*x+T*v),l+=c*(E*b+O*x+R*v),++i}else H+=this._jointsPerVertex-i,i=this._jointsPerVertex;j[G]=n,j[G+1]=r,j[G+2]=s,z[G]=a,z[G+1]=o,z[G+2]=h,k[G]=p,k[G+1]=u,k[G+2]=l,G+=3}B.updatePositions(j),B.updateVertexNormals(z),B.updateVertexTangents(k)},a.prototype.localToGlobalPose=function(t,i,n){var r,s,a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w,D,C=i.jointPoses,S=n.joints,P=t.numJointPoses,A=t.jointPoses;C.length!=P&&(C.length=P);for(var T=0;P>T;++T)r=C[T],null==r&&(r=C[T]=new e.JointPose),a=S[T],s=a.parentIndex,h=A[T],c=r.orientation,l=r.translation,0>s?(u=h.translation,p=h.orientation,c.x=p.x,c.y=p.y,c.z=p.z,c.w=p.w,l.x=u.x,l.y=u.y,l.z=u.z):(o=C[s],p=o.orientation,u=h.translation,m=p.x,y=p.y,b=p.z,x=p.w,v=u.x,w=u.y,D=u.z,g=-m*v-y*w-b*D,d=x*v+y*D-b*w,_=x*w-m*D+b*v,f=x*D+m*w-y*v,u=o.translation,l.x=-g*m+d*x-_*b+f*y+u.x,l.y=-g*y+d*b+_*x-f*m+u.y,l.z=-g*b-d*y+_*m+f*x+u.z,d=p.x,_=p.y,f=p.z,g=p.w,p=h.orientation,m=p.x,y=p.y,b=p.z,x=p.w,c.w=g*x-d*m-_*y-f*b,c.x=g*m+d*x+_*b-f*y,c.y=g*y-d*b+_*x+f*m,c.z=g*b+d*y-_*m+f*x)},a.prototype.onTransitionComplete=function(t){t.type==n.TRANSITION_COMPLETE&&(t.animationNode.removeEventListener(n.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate),this._pActiveState==t.animationState&&(this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName),this._pActiveState=this.getAnimationState(this._pActiveNode),this._activeSkeletonState=this._pActiveState))},a.prototype.onIndicesUpdate=function(t){var e=t.target;this._morphedSubGeometry[e.id].updateIndices(e.indices)},a.prototype.onVerticesUpdate=function(t){var e=t.target,n=this._morphedSubGeometry[e.id];switch(t.dataType){case i.UV_DATA:n.updateUVs(e.uvs);case i.SECONDARY_UV_DATA:n.updateUVs(e.secondaryUVs)}},a}(e.AnimatorBase);e.SkeletonAnimator=s}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=4),t.call(this),this._jointsPerVertex=e}return __extends(e,t),Object.defineProperty(e.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:!0,configurable:!0}),e.prototype.getAGALVertexCode=function(t,e,i){for(var n=e.length,r=t.numUsedVertexConstants,s=r+1,a=r+2,o="va"+t.numUsedStreams,h="va"+(t.numUsedStreams+1),p=[o+".x",o+".y",o+".z",o+".w"],u=[h+".x",h+".y",h+".z",h+".w"],l=this._pFindTempReg(i),c=this._pFindTempReg(i,l),d="dp4",_="",f=0;n>f;++f){for(var g=e[f],m=0;m<this._jointsPerVertex;++m)_+=d+" "+l+".x, "+g+", vc["+p[m]+"+"+r+"]		\n"+d+" "+l+".y, "+g+", vc["+p[m]+"+"+s+"]    	\n"+d+" "+l+".z, "+g+", vc["+p[m]+"+"+a+"]		\nmov "+l+".w, "+g+".w		\nmul "+l+", "+l+", "+u[m]+"\n",_+=0==m?"mov "+c+", "+l+"\n":"add "+c+", "+c+", "+l+"\n";d="dp3",_+="mov "+i[f]+", "+c+"\n"}return _},e.prototype.activate=function(){},e.prototype.deactivate=function(t,e){var i=e.numUsedStreams,n=t.context;n.setVertexBufferAt(i,null),n.setVertexBufferAt(i+1,null)},e.prototype.getAGALFragmentCode=function(){return""},e.prototype.getAGALUVCode=function(t,e,i){return"mov "+i+","+e+"\n"},e.prototype.doneAGALCode=function(){},e}(t.AnimationSetBase);t.SkeletonAnimationSet=e}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=function(e){function i(t,i){"undefined"==typeof t&&(t=2),"undefined"==typeof i&&(i="absolute"),e.call(this),this._streamIndices=new Object,this._useNormals=new Object,this._useTangents=new Object,this._numPoses=t,this._blendMode=i}return __extends(i,e),Object.defineProperty(i.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useNormals",{get:function(){return this._uploadNormals},enumerable:!0,configurable:!0}),i.prototype.getAGALVertexCode=function(e,i,n){return this._blendMode==t.animators.VertexAnimationMode.ABSOLUTE?this.getAbsoluteAGALCode(e,i,n):this.getAdditiveAGALCode(e,i,n)},i.prototype.activate=function(t,e){var i=e._iUniqueId;this._uploadNormals=this._useNormals[i],this._uploadTangents=this._useTangents[i]},i.prototype.deactivate=function(t,e){var i=e._iUniqueId,n=this._streamIndices[i],r=t.context;r.setVertexBufferAt(n,null),this._uploadNormals&&r.setVertexBufferAt(n+1,null),this._uploadTangents&&r.setVertexBufferAt(n+2,null)},i.prototype.getAGALFragmentCode=function(){return""},i.prototype.getAGALUVCode=function(t,e,i){return"mov "+i+","+e+"\n"},i.prototype.doneAGALCode=function(){},i.prototype.getAbsoluteAGALCode=function(t,e,i){var n="",r=t._iUniqueId,s=this._pFindTempReg(i),a=this._pFindTempReg(i,s),o=new Array("x","y","z","w"),h=e.length,p="vc"+t.numUsedVertexConstants,u=this._useTangents[r]=h>2;this._useNormals[r]=h>1,h>2&&(h=2);for(var l=this._streamIndices[r]=t.numUsedStreams,c=0;h>c;++c){n+="mul "+s+", "+e[c]+", "+p+"."+o[0]+"\n";for(var d=1;d<this._numPoses;++d)n+="mul "+a+", va"+l+", "+p+"."+o[d]+"\n",d<this._numPoses-1&&(n+="add "+s+", "+s+", "+a+"\n"),++l;n+="add "+i[c]+", "+s+", "+a+"\n"}return u&&(n+="dp3 "+s+".x, "+e[2]+", "+i[1]+"\nmul "+s+", "+i[1]+", "+s+".x			 \nsub "+i[2]+", "+e[2]+", "+s+"\n"),n},i.prototype.getAdditiveAGALCode=function(t,e,i){var n,r="",s=t._iUniqueId,a=e.length,o=["x","y","z","w"],h=this._pFindTempReg(i),p=this._useTangents[s]=a>2,u=this._useNormals[s]=a>1,l=this._streamIndices[s]=t.numUsedStreams;a>2&&(a=2),r+="mov  "+i[0]+", "+e[0]+"\n",u&&(r+="mov "+i[1]+", "+e[1]+"\n");for(var c=0;a>c;++c)for(var d=0;d<this._numPoses;++d)r+="mul "+h+", va"+(l+n)+", vc"+t.numUsedVertexConstants+"."+o[d]+"\nadd "+i[c]+", "+i[c]+", "+h+"\n",n++;return p&&(r+="dp3 "+h+".x, "+e[2]+", "+i[1]+"\nmul "+h+", "+i[1]+", "+h+".x			 \nsub "+i[2]+", "+e[2]+", "+h+"\n"),r},i}(e.AnimationSetBase);e.VertexAnimationSet=i}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.pool.VertexDataPool,r=function(r){function s(t){r.call(this,t),this._poses=new Array,this._weights=Array(1,0,0,0),this._vertexAnimationSet=t,this._numPoses=t.numPoses,this._blendMode=t.blendMode}return __extends(s,r),s.prototype.clone=function(){return new s(this._vertexAnimationSet)},s.prototype.play=function(t,e,i){if("undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0/0),this._pActiveAnimationName!=t){if(this._pActiveAnimationName=t,!this._pAnimationSet.hasAnimation(t))throw new Error("Animation root node "+t+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(t),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeVertexState=this._pActiveState,this.start(),isNaN(i)||this.reset(t,i)}},s.prototype._pUpdateDeltaTime=function(t){r.prototype._pUpdateDeltaTime.call(this,t);var e=!1;if(this._poses[0]!=this._activeVertexState.currentGeometry&&(this._poses[0]=this._activeVertexState.currentGeometry,e=!0),this._poses[1]!=this._activeVertexState.nextGeometry&&(this._poses[1]=this._activeVertexState.nextGeometry,e=!0),this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight),e)for(var i,n=this._pOwners.length,s=0;n>s;s++)i=this._pOwners[s],i._iInvalidateRenderableGeometries()},s.prototype.setRenderState=function(r,s,a,o){if(!this._poses.length)return void this.setNullPose(r,s,a,o);var h,p,u=s.subMesh,l=this._numPoses;for(r.context.setProgramConstantsFromArray(t.stagegl.ContextGLProgramType.VERTEX,a,this._weights,1),p=this._blendMode==e.VertexAnimationMode.ABSOLUTE?1:0;l>p;++p)h=this._poses[p].subGeometries[u._iIndex]||u.subGeometry,r.context.activateBuffer(o++,n.getItem(h,s.getIndexData(),i.POSITION_DATA),h.getOffset(i.POSITION_DATA),i.POSITION_FORMAT),this._vertexAnimationSet.useNormals&&r.context.activateBuffer(o++,n.getItem(h,s.getIndexData(),i.NORMAL_DATA),h.getOffset(i.NORMAL_DATA),i.NORMAL_FORMAT)},s.prototype.setNullPose=function(n,r,s,a){if(n.context.setProgramConstantsFromArray(t.stagegl.ContextGLProgramType.VERTEX,s,this._weights,1),this._blendMode==e.VertexAnimationMode.ABSOLUTE)for(var o=this._numPoses,h=1;o>h;++h)n.context.activateBuffer(a++,r.getVertexData(i.POSITION_DATA),r.getVertexOffset(i.POSITION_DATA),i.POSITION_FORMAT),this._vertexAnimationSet.useNormals&&n.context.activateBuffer(a++,r.getVertexData(i.NORMAL_DATA),r.getVertexOffset(i.NORMAL_DATA),i.NORMAL_FORMAT)},s.prototype.testGPUCompatibility=function(){},s.prototype.getRenderableSubGeometry=function(t,i){return this._blendMode==e.VertexAnimationMode.ABSOLUTE&&this._poses.length?this._poses[0].subGeometries[t.subMesh._iIndex]||i:i},s}(e.AnimatorBase);e.VertexAnimator=r}(t.animators||(t.animators={})),t.animators}(away||(away={}));var away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.entities.Mesh,r=t.materials.DefaultMaterialManager,s=t.materials.SpecularBasicMethod,a=t.materials.TriangleMaterial,o=t.materials.TriangleMaterialMode,h=t.net.URLLoaderDataFormat,p=function(p){function u(t){"undefined"==typeof t&&(t=1),p.call(this,h.TEXT),this._mtlLibLoaded=!0,this._activeMaterialID="",this._scale=t}return __extends(u,p),Object.defineProperty(u.prototype,"scale",{set:function(t){this._scale=t},enumerable:!0,configurable:!0}),u.supportsType=function(t){return t=t.toLowerCase(),"obj"==t},u.supportsData=function(t){var i=e.ParserUtils.toString(t),n=!1,r=!1;return i&&(n=-1!=i.indexOf("\nv "),r=-1!=i.indexOf("\nf ")),n&&r},u.prototype._iResolveDependency=function(i){if("mtl"==i.id){var n=e.ParserUtils.toString(i.data);this.parseMtl(n)}else{var r;if(1!=i.assets.length)return;if(r=i.assets[0],r.assetType==t.library.AssetType.TEXTURE){var s=new LoadedMaterial;s.materialID=i.id,s.texture=r,this._materialLoaded.push(s),this._meshes.length>0&&this.applyMaterial(s)}}},u.prototype._iResolveDependencyFailure=function(t){if("mtl"==t.id)this._mtlLib=!1,this._mtlLibLoaded=!1;else{var e=new LoadedMaterial;e.materialID=t.id,this._materialLoaded.push(e)}this._meshes.length>0&&this.applyMaterial(e)},u.prototype._pProceedParsing=function(){var t,i,n=String.fromCharCode(10);for(this._startedParsing||(this._textData=this._pGetTextData(),this._textData=this._textData.replace(/\\[\r\n]+\s*/gm," ")),-1==this._textData.indexOf(n)&&(n=String.fromCharCode(13)),this._startedParsing||(this._startedParsing=!0,this._vertices=new Array,this._vertexNormals=new Array,this._materialIDs=new Array,this._materialLoaded=new Array,this._meshes=new Array,this._uvs=new Array,this._stringLength=this._textData.length,this._charIndex=this._textData.indexOf(n,0),this._oldIndex=0,this._objects=new Array,this._objectIndex=0);this._charIndex<this._stringLength&&this._pHasTime();)if(this._charIndex=this._textData.indexOf(n,this._oldIndex),-1==this._charIndex&&(this._charIndex=this._stringLength),t=this._textData.substring(this._oldIndex,this._charIndex),t=t.split("\r").join(""),t=t.replace("  "," "),i=t.split(" "),this._oldIndex=this._charIndex+1,this.parseLine(i),this.parsingPaused)return e.ParserBase.MORE_TO_PARSE;return this._charIndex>=this._stringLength?this._mtlLib&&!this._mtlLibLoaded?e.ParserBase.MORE_TO_PARSE:(this.translate(),this.applyMaterials(),e.ParserBase.PARSING_DONE):e.ParserBase.MORE_TO_PARSE},u.prototype._pStartParsing=function(e){p.prototype._pStartParsing.call(this,e),this._pContent=new t.containers.DisplayObjectContainer},u.prototype.parseLine=function(t){switch(t[0]){case"mtllib":this._mtlLib=!0,this._mtlLibLoaded=!1,this.loadMtl(t[1]);break;case"g":this.createGroup(t);break;case"o":this.createObject(t);break;case"usemtl":this._mtlLib&&(t[1]||(t[1]="def000"),this._materialIDs.push(t[1]),this._activeMaterialID=t[1],this._currentGroup&&(this._currentGroup.materialID=this._activeMaterialID));break;case"v":this.parseVertex(t);break;case"vt":this.parseUV(t);break;case"vn":this.parseVertexNormal(t);break;case"f":this.parseFace(t)}},u.prototype.translate=function(){for(var e=0;e<this._objects.length;++e)for(var i,s,h,p,u,l,c,d=this._objects[e].groups,_=d.length,f=0;_>f;++f){for(h=new t.base.Geometry,i=d[f].materialGroups,s=i.length,u=0;s>u;++u)this.translateMaterialGroup(i[u],h);if(0!=h.subGeometries.length){if(this._pFinalizeAsset(h),c=new a(r.getDefaultTexture()),this.materialMode>=2&&(c.materialMode=o.MULTI_PASS),p=new n(h,c),p.name=this._objects[e].name?this._objects[e].name:d[f].name?d[f].name:"",this._meshes.push(p),c.name=""!=d[f].materialID?d[f].materialID+"~"+p.name:this._lastMtlID+"~"+p.name,p.subMeshes.length>1)for(l=1;l<p.subMeshes.length;++l)p.subMeshes[l].material=c;this._pContent.addChild(p),this._pFinalizeAsset(p)}}},u.prototype.translateMaterialGroup=function(t,e){var n,r,s,a=t.faces,o=a.length,h=new Array,p=new Array,u=new Array,l=new Array;this._realIndices=[],this._vertexIndex=0;for(var c,d=0;o>d;++d)for(n=a[d],r=n.indexIds.length-1,c=1;r>c;++c)this.translateVertexData(n,c,h,p,l,u),this.translateVertexData(n,0,h,p,l,u),this.translateVertexData(n,c+1,h,p,l,u);h.length>0&&(s=new i(!0),s.autoDeriveNormals=u.length?!1:!0,s.updateIndices(l),s.updatePositions(h),s.updateVertexNormals(u),s.updateUVs(p),e.addSubGeometry(s))},u.prototype.translateVertexData=function(t,e,i,n,r,s){var a,o,h,p;if(this._realIndices[t.indexIds[e]])a=this._realIndices[t.indexIds[e]]-1;else if(a=this._vertexIndex,this._realIndices[t.indexIds[e]]=++this._vertexIndex,o=this._vertices[t.vertexIndices[e]-1],i.push(o.x*this._scale,o.y*this._scale,o.z*this._scale),t.normalIndices.length>0&&(h=this._vertexNormals[t.normalIndices[e]-1],s.push(h.x,h.y,h.z)),t.uvIndices.length>0)try{p=this._uvs[t.uvIndices[e]-1],n.push(p.u,p.v)}catch(u){switch(e){case 0:n.push(0,1);break;case 1:n.push(.5,0);break;case 2:n.push(1,1)}}r.push(a)},u.prototype.createObject=function(t){this._currentGroup=null,this._currentMaterialGroup=null,this._objects.push(this._currentObject=new ObjectGroup),t&&(this._currentObject.name=t[1])},u.prototype.createGroup=function(t){this._currentObject||this.createObject(null),this._currentGroup=new Group,this._currentGroup.materialID=this._activeMaterialID,t&&(this._currentGroup.name=t[1]),this._currentObject.groups.push(this._currentGroup),this.createMaterialGroup(null)},u.prototype.createMaterialGroup=function(t){this._currentMaterialGroup=new MaterialGroup,t&&(this._currentMaterialGroup.url=t[1]),this._currentGroup.materialGroups.push(this._currentMaterialGroup)},u.prototype.parseVertex=function(t){var e,i,n;if(t.length>4){for(var r,s=[],a=1;a<t.length;++a)r=parseFloat(t[a]),isNaN(r)||s.push(r);e=s[0],i=s[1],n=-s[2],this._vertices.push(new Vertex(e,i,n))}else e=parseFloat(t[1]),i=parseFloat(t[2]),n=-parseFloat(t[3]),this._vertices.push(new Vertex(e,i,n))},u.prototype.parseUV=function(t){if(t.length>3){for(var e,i=[],n=1;n<t.length;++n)e=parseFloat(t[n]),isNaN(e)||i.push(e);this._uvs.push(new UV(i[0],1-i[1]))}else this._uvs.push(new UV(parseFloat(t[1]),1-parseFloat(t[2])))},u.prototype.parseVertexNormal=function(t){if(t.length>4){for(var e,i=[],n=1;n<t.length;++n)e=parseFloat(t[n]),isNaN(e)||i.push(e);this._vertexNormals.push(new Vertex(i[0],i[1],-i[2]))}else this._vertexNormals.push(new Vertex(parseFloat(t[1]),parseFloat(t[2]),-parseFloat(t[3])))},u.prototype.parseFace=function(t){var e=t.length,i=new FaceData;this._currentGroup||this.createGroup(null);for(var n,r=1;e>r;++r)""!=t[r]&&(n=t[r].split("/"),i.vertexIndices.push(this.parseIndex(parseInt(n[0]),this._vertices.length)),n[1]&&String(n[1]).length>0&&i.uvIndices.push(this.parseIndex(parseInt(n[1]),this._uvs.length)),n[2]&&String(n[2]).length>0&&i.normalIndices.push(this.parseIndex(parseInt(n[2]),this._vertexNormals.length)),i.indexIds.push(t[r]));this._currentMaterialGroup.faces.push(i)},u.prototype.parseIndex=function(t,e){return 0>t?t+e+1:t},u.prototype.parseMtl=function(e){for(var i,n,r,h,p,u,l,c,d,_,f,g,m=e.split("newmtl"),y=0;y<m.length;++y){for(i=m[y].split("\r").join("").split("\n"),1==i.length&&(i=m[y].split(String.fromCharCode(13))),l=c=d=16777215,_=0,p=!1,u=!1,f=1,g="",r=0;r<i.length;++r)if(i[r]=i[r].replace(/\s+$/,""),"#"!=i[r].substring(0,1)&&(0==r||""!=i[r]))if(n=i[r].split(" "),(9==String(n[0]).charCodeAt(0)||32==String(n[0]).charCodeAt(0))&&(n[0]=n[0].substring(1,n[0].length)),0==r)this._lastMtlID=n.join(""),this._lastMtlID=""==this._lastMtlID?"def000":this._lastMtlID;else switch(n[0]){case"Ka":n[1]&&!isNaN(Number(n[1]))&&n[2]&&!isNaN(Number(n[2]))&&n[3]&&!isNaN(Number(n[3]))&&(c=255*n[1]<<16|255*n[2]<<8|255*n[3]);break;case"Ks":n[1]&&!isNaN(Number(n[1]))&&n[2]&&!isNaN(Number(n[2]))&&n[3]&&!isNaN(Number(n[3]))&&(d=255*n[1]<<16|255*n[2]<<8|255*n[3],p=!0);break;case"Ns":n[1]&&!isNaN(Number(n[1]))&&(_=.001*Number(n[1])),0==_&&(p=!1);break;case"Kd":n[1]&&!isNaN(Number(n[1]))&&n[2]&&!isNaN(Number(n[2]))&&n[3]&&!isNaN(Number(n[3]))&&(l=255*n[1]<<16|255*n[2]<<8|255*n[3],u=!0);break;case"tr":case"d":n[1]&&!isNaN(Number(n[1]))&&(f=Number(n[1]));break;case"map_Kd":g=this.parseMapKdString(n),g=g.replace(/\\/g,"/")}if(""!=g){if(p){h=new s,h.specularColor=d,h.specular=_;var b=new SpecularData;b.alpha=f,b.basicSpecularMethod=h,b.materialID=this._lastMtlID,this._materialSpecularData||(this._materialSpecularData=new Array),this._materialSpecularData.push(b)}this._pAddDependency(this._lastMtlID,new t.net.URLRequest(g))}else if(u&&!isNaN(l)){var x=new LoadedMaterial;x.materialID=this._lastMtlID,0==f&&console.log("Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:"+this._lastMtlID+", mesh(es) using it will be invisible!");var v;if(this.materialMode<2){v=new a(l);var w=v;w.alpha=f,w.ambientColor=c,w.repeat=!0,p&&(w.specularColor=d,w.specular=_)}else{v=new a(l),v.materialMode=o.MULTI_PASS;var D=v;D.ambientColor=c,D.repeat=!0,p&&(D.specularColor=d,D.specular=_)}x.cm=v,this._materialLoaded.push(x),this._meshes.length>0&&this.applyMaterial(x)}}this._mtlLibLoaded=!0},u.prototype.parseMapKdString=function(t){var e,i,n="";for(e=1;e<t.length;){switch(t[e]){case"-blendu":case"-blendv":case"-cc":case"-clamp":case"-texres":e+=2;break;case"-mm":e+=3;break;case"-o":case"-s":case"-t":e+=4;continue;default:i=!0}if(i)break}for(e;e<t.length;e++)n+=t[e],n+=" ";return n=n.replace(/\s+$/,"")},u.prototype.loadMtl=function(e){this._pAddDependency("mtl",new t.net.URLRequest(e),!0),this._pPauseAndRetrieveDependencies()},u.prototype.applyMaterial=function(t){for(var e,i,n,r,s,a=0;a<this._meshes.length;++a)if(i=this._meshes[a],e=i.material.name.split("~"),e[0]==t.materialID){if(t.cm)i.material&&(i.material=null),i.material=t.cm;else if(t.texture)if(this.materialMode<2){if(n=i.material,n.texture=t.texture,n.ambientColor=t.ambientColor,n.alpha=t.alpha,n.repeat=!0,t.specularMethod)n.specularMethod=null,n.specularMethod=t.specularMethod;else if(this._materialSpecularData)for(r=0;r<this._materialSpecularData.length;++r)if(s=this._materialSpecularData[r],s.materialID==t.materialID){n.specularMethod=null,n.specularMethod=s.basicSpecularMethod,n.ambientColor=s.ambientColor,n.alpha=s.alpha;break}}else if(n=i.material,n.materialMode=o.MULTI_PASS,n.texture=t.texture,n.ambientColor=t.ambientColor,n.repeat=!0,t.specularMethod)n.specularMethod=null,n.specularMethod=t.specularMethod;else if(this._materialSpecularData)for(r=0;r<this._materialSpecularData.length;++r)if(s=this._materialSpecularData[r],s.materialID==t.materialID){n.specularMethod=null,n.specularMethod=s.basicSpecularMethod,n.ambientColor=s.ambientColor;break}i.material.name=e[1]?e[1]:e[0],this._meshes.splice(a,1),--a}(t.cm||n)&&this._pFinalizeAsset(t.cm||n)},u.prototype.applyMaterials=function(){if(0!=this._materialLoaded.length)for(var t=0;t<this._materialLoaded.length;++t)this.applyMaterial(this._materialLoaded[t])},u}(e.ParserBase);e.OBJParser=p}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var BasicSpecularMethod=away.materials.SpecularBasicMethod,MaterialBase=away.materials.MaterialBase,Texture2DBase=away.textures.Texture2DBase,ObjectGroup=function(){function t(){this.groups=new Array}return t}(),Group=function(){function t(){this.materialGroups=new Array}return t}(),MaterialGroup=function(){function t(){this.faces=new Array}return t}(),SpecularData=function(){function t(){this.ambientColor=16777215,this.alpha=1}return t}(),LoadedMaterial=function(){function t(){this.ambientColor=16777215,this.alpha=1}return t}(),FaceData=function(){function t(){this.vertexIndices=new Array,this.uvIndices=new Array,this.normalIndices=new Array,this.indexIds=new Array}return t}(),UV=function(){function t(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this._u=t,this._v=e}return Object.defineProperty(t.prototype,"v",{get:function(){return this._v},set:function(t){this._v=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"u",{get:function(){return this._u},set:function(t){this._u=t},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this._u,this._v)},t.prototype.toString=function(){return this._u+","+this._v},t}(),Vertex=function(){function t(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this._x=t,this._y=e,this._z=i,this._index=n}return Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this._x,this._y,this._z)},t}(),away;!function(t){!function(e){var i=t.animators.JointPose,n=t.animators.Skeleton,r=t.animators.SkeletonAnimationSet,s=t.animators.SkeletonAnimator,a=t.animators.SkeletonClipNode,o=t.animators.SkeletonPose,h=t.animators.SkeletonJoint,p=t.animators.VertexAnimationSet,u=t.animators.VertexAnimator,l=t.animators.VertexClipNode,c=t.base.BlendMode,d=t.base.Geometry,_=t.base.TriangleSubGeometry,f=t.entities.Mesh,g=t.entities.DirectionalLight,m=t.entities.PointLight,y=t.geom.ColorTransform,b=t.geom.Matrix3D,x=t.library.AssetType,v=t.materials.AmbientEnvMapMethod,w=t.materials.DefaultMaterialManager,D=t.materials.DiffuseDepthMethod,C=t.materials.DiffuseCelMethod,S=t.materials.DiffuseSubSurfaceMethod,P=t.materials.DiffuseGradientMethod,A=t.materials.DiffuseLightMapMethod,T=t.materials.DiffuseWrapMethod,M=t.materials.EffectAlphaMaskMethod,E=t.materials.EffectColorMatrixMethod,O=t.materials.EffectColorTransformMethod,R=t.materials.EffectEnvMapMethod,I=t.materials.EffectFogMethod,N=t.materials.EffectFresnelEnvMapMethod,L=t.materials.EffectLightMapMethod,F=t.materials.EffectRimLightMethod,V=t.materials.NormalSimpleWaterMethod,U=t.materials.TriangleMaterial,B=t.materials.TriangleMaterialMode,j=t.materials.ShadowDitheredMethod,z=t.materials.ShadowFilteredMethod,k=t.materials.SkyboxMaterial,G=t.materials.SpecularFresnelMethod,H=t.materials.ShadowHardMethod,X=t.materials.SpecularAnisotropicMethod,W=t.materials.SpecularCelMethod,Y=t.materials.SpecularPhongMethod,Z=t.materials.ShadowNearMethod,q=t.materials.CubeMapShadowMapper,K=t.materials.DirectionalShadowMapper,J=t.materials.ShadowSoftMethod,Q=t.materials.StaticLightPicker,$=t.net.URLLoaderDataFormat,te=t.parsers.ParserBase,ee=t.parsers.ParserUtils,ie=t.textures.BitmapCubeTexture,ne=t.textures.ImageCubeTexture,re=t.textures.ImageTexture,se=t.utils.ByteArray,ae=function(e){function ae(){e.call(this,$.ARRAY_BUFFER),this._debug=!1,this._startedParsing=!1,this._texture_users={},this._parsed_header=!1,this._blocks=new Array,this._blocks[0]=new AWDBlock,this._blocks[0].data=null,this.blendModeDic=new Array,this.blendModeDic.push(c.NORMAL),this.blendModeDic.push(c.ADD),this.blendModeDic.push(c.ALPHA),this.blendModeDic.push(c.DARKEN),this.blendModeDic.push(c.DIFFERENCE),this.blendModeDic.push(c.ERASE),this.blendModeDic.push(c.HARDLIGHT),this.blendModeDic.push(c.INVERT),this.blendModeDic.push(c.LAYER),this.blendModeDic.push(c.LIGHTEN),this.blendModeDic.push(c.MULTIPLY),this.blendModeDic.push(c.NORMAL),this.blendModeDic.push(c.OVERLAY),this.blendModeDic.push(c.SCREEN),this.blendModeDic.push(c.SHADER),this.blendModeDic.push(c.OVERLAY),this._depthSizeDic=new Array,this._depthSizeDic.push(256),this._depthSizeDic.push(512),this._depthSizeDic.push(2048),this._depthSizeDic.push(1024),this._version=Array()}return __extends(ae,e),ae.supportsType=function(t){return t=t.toLowerCase(),"awd"==t},ae.supportsData=function(e){return"AWD"==t.parsers.ParserUtils.toString(e,3)},ae.prototype._iResolveDependency=function(t){if(1==t.assets.length){var e,i,n,r=t.id.split("#"),s=r[0];if(1==r.length&&(e=t.assets[0],e&&(n=this._blocks[t.id],n.data=e,e.resetAssetPath(n.name,null,!0),n.name=e.name,this._pFinalizeAsset(e),this._debug&&(console.log("Successfully loaded Bitmap for texture"),console.log("Parsed texture: Name = "+n.name)))),r.length>1){i=t.assets[0];var a=i;if(this._cubeTextures[r[1]]=a.htmlImageElement,this._texture_users[s].push(1),this._debug&&console.log("Successfully loaded Bitmap "+this._texture_users[s].length+" / 6 for Cubetexture"),this._texture_users[s].length==this._cubeTextures.length){var o=this._cubeTextures[0],h=this._cubeTextures[1],p=this._cubeTextures[2],u=this._cubeTextures[3],l=this._cubeTextures[4],c=this._cubeTextures[5];e=new ne(o,h,p,u,l,c),n=this._blocks[s],n.data=e,e.resetAssetPath(n.name,null,!0),n.name=e.name,this._pFinalizeAsset(e),this._debug&&console.log("Parsed CubeTexture: Name = "+n.name)}}}},ae.prototype._iResolveDependencyFailure=function(){},ae.prototype._iResolveDependencyName=function(t,e){var i=e.name;if(e){var n=this._blocks[parseInt(t.id)];e.resetAssetPath(n.name,null,!0)}var r=e.name;return e.name=i,r},ae.prototype._pProceedParsing=function(){if(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0),!this._parsed_header){switch(this.parseHeader(),this._compression){case ae.DEFLATE:case ae.LZMA:this._pDieWithError("Compressed AWD formats not yet supported");break;case ae.UNCOMPRESSED:this._body=this._byteData}this._parsed_header=!0}if(this._body){for(;this._body.getBytesAvailable()>0&&!this.parsingPaused;)this.parseNextBlock();return 0==this._body.getBytesAvailable()?(this.dispose(),te.PARSING_DONE):te.MORE_TO_PARSE}switch(this._compression){case ae.DEFLATE:case ae.LZMA:this._debug&&console.log("(!) AWDParser Error: Compressed AWD formats not yet supported (!)")}return te.PARSING_DONE},ae.prototype._pStartParsing=function(i){e.prototype._pStartParsing.call(this,i),this._pContent=new t.containers.DisplayObjectContainer},ae.prototype.dispose=function(){for(var t in this._blocks){var e=this._blocks[t];e.dispose()}},ae.prototype.parseNextBlock=function(){var t,e,i,n,r,s=!1;this._cur_block_id=this._body.readUnsignedInt(),e=this._body.readUnsignedByte(),i=this._body.readUnsignedByte(),n=this._body.readUnsignedByte(),r=this._body.readUnsignedInt();var a=bitFlags.test(n,bitFlags.FLAG4);bitFlags.test(n,bitFlags.FLAG5),this._accuracyOnBlocks&&(this._accuracyMatrix=bitFlags.test(n,bitFlags.FLAG1),this._accuracyGeo=bitFlags.test(n,bitFlags.FLAG2),this._accuracyProps=bitFlags.test(n,bitFlags.FLAG3),this._geoNrType=ae.FLOAT32,this._accuracyGeo&&(this._geoNrType=ae.FLOAT64),this._matrixNrType=ae.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=ae.FLOAT64),this._propsNrType=ae.FLOAT32,this._accuracyProps&&(this._propsNrType=ae.FLOAT64));var o=this._body.position+r;if(r>this._body.getBytesAvailable())return this._pDieWithError("AWD2 block length is bigger than the bytes that are available!"),void(this._body.position+=this._body.getBytesAvailable());this._newBlockBytes=new se,this._body.readBytes(this._newBlockBytes,0,r),a&&this._pDieWithError("Compressed AWD formats not yet supported"),this._newBlockBytes.position=0,t=new AWDBlock,t.len=this._newBlockBytes.position+r,t.id=this._cur_block_id;var h=this._newBlockBytes.position+r;if(a&&this._pDieWithError("Compressed AWD formats not yet supported"),this._debug&&console.log("AWDBlock:  ID = "+this._cur_block_id+" | TypeID = "+i+" | Compression = "+a+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps),this._blocks[this._cur_block_id]=t,2==this._version[0]&&1==this._version[1])switch(i){case 11:this.parsePrimitves(this._cur_block_id),s=!0;break;case 31:this.parseSkyboxInstance(this._cur_block_id),s=!0;break;case 41:this.parseLight(this._cur_block_id),s=!0;break;case 42:this.parseCamera(this._cur_block_id),s=!0;break;case 51:this.parseLightPicker(this._cur_block_id),s=!0;break;case 81:this.parseMaterial_v1(this._cur_block_id),s=!0;break;case 83:this.parseCubeTexture(this._cur_block_id),s=!0;break;case 91:this.parseSharedMethodBlock(this._cur_block_id),s=!0;break;case 92:this.parseShadowMethodBlock(this._cur_block_id),s=!0;break;case 111:this.parseMeshPoseAnimation(this._cur_block_id,!0),s=!0;break;case 112:this.parseMeshPoseAnimation(this._cur_block_id),s=!0;break;case 113:this.parseVertexAnimationSet(this._cur_block_id),s=!0;break;case 122:this.parseAnimatorSet(this._cur_block_id),s=!0;break;case 253:this.parseCommand(this._cur_block_id),s=!0}if(0==s)switch(i){case 1:this.parseTriangleGeometrieBlock(this._cur_block_id);break;case 22:this.parseContainer(this._cur_block_id);break;case 23:this.parseMeshInstance(this._cur_block_id);break;case 81:this.parseMaterial(this._cur_block_id);break;case 82:this.parseTexture(this._cur_block_id);break;case 101:this.parseSkeleton(this._cur_block_id);break;case 102:this.parseSkeletonPose(this._cur_block_id);break;case 103:this.parseSkeletonAnimation(this._cur_block_id);break;case 121:case 254:this.parseNameSpace(this._cur_block_id);break;case 255:this.parseMetaData(this._cur_block_id);break;default:this._debug&&console.log("AWDBlock:   Unknown BlockType  (BlockID = "+this._cur_block_id+") - Skip "+r+" bytes"),this._newBlockBytes.position+=r}var p=0;if(this._newBlockBytes.position==h){if(this._debug&&t.errorMessages)for(;p<t.errorMessages.length;)console.log("        (!) Error: "+t.errorMessages[p]+" (!)"),p++;this._debug&&console.log("\n")}else if(this._debug&&(console.log("  (!)(!)(!) Error while reading AWDBlock ID "+this._cur_block_id+" = skip to next block"),t.errorMessages))for(;p<t.errorMessages.length;)console.log("        (!) Error: "+t.errorMessages[p]+" (!)"),p++;this._body.position=o,this._newBlockBytes=null},ae.prototype.parseTriangleGeometrieBlock=function(e){for(var i=new t.base.Geometry,n=this.parseVarStr(),r=this._newBlockBytes.readUnsignedShort(),s=this.parseProperties({1:this._geoNrType,2:this._geoNrType}),a=s.get(1,1),o=s.get(2,1),h=0;r>h;){var p,u,l,c,d;p=this._newBlockBytes.readUnsignedInt(),u=this._newBlockBytes.position+p;for(var f=this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._newBlockBytes.position<u;){var g,m,y,b,x=0;m=this._newBlockBytes.readUnsignedByte(),g=this._newBlockBytes.readUnsignedByte(),y=this._newBlockBytes.readUnsignedInt(),b=this._newBlockBytes.position+y;var v,w,D;if(1==m)for(var C=new Array;this._newBlockBytes.position<b;)v=this.readNumber(this._accuracyGeo),w=this.readNumber(this._accuracyGeo),D=this.readNumber(this._accuracyGeo),C[x++]=v,C[x++]=w,C[x++]=D;else if(2==m)for(var S=new Array;this._newBlockBytes.position<b;)S[x++]=this._newBlockBytes.readUnsignedShort();else if(3==m)for(var P=new Array;this._newBlockBytes.position<b;)P[x++]=this.readNumber(this._accuracyGeo);else if(4==m)for(var A=new Array;this._newBlockBytes.position<b;)A[x++]=this.readNumber(this._accuracyGeo);else if(6==m)for(c=Array();this._newBlockBytes.position<b;)c[x++]=3*this._newBlockBytes.readUnsignedShort();else if(7==m)for(d=new Array;this._newBlockBytes.position<b;)d[x++]=this.readNumber(this._accuracyGeo);else this._newBlockBytes.position=b}this.parseUserAttributes(),l=new _(!0),d&&(l.jointsPerVertex=d.length/(C.length/3)),A&&(l.autoDeriveNormals=!1),P&&(l.autoDeriveUVs=!1),l.updateIndices(S),l.updatePositions(C),l.updateVertexNormals(A),l.updateUVs(P),l.updateVertexTangents(null),l.updateJointWeights(d),l.updateJointIndices(c);var T=f.get(1,1),M=f.get(2,1),E=!1;(a!=T||o!=M)&&(E=!0,T=a/T,M=o/M),E&&l.scaleUV(T,M),i.addSubGeometry(l),h++}(1!=a||1!=o)&&i.scaleUV(a,o),this.parseUserAttributes(),this._pFinalizeAsset(i,n),this._blocks[e].data=i,this._debug&&console.log("Parsed a TriangleGeometry: Name = "+n+"| Id = "+l.id)
},ae.prototype.parsePrimitves=function(e){var i,n,r,s;i=this.parseVarStr(),r=this._newBlockBytes.readUnsignedByte(),s=this.parseProperties({101:this._geoNrType,102:this._geoNrType,103:this._geoNrType,110:this._geoNrType,111:this._geoNrType,301:ae.UINT16,302:ae.UINT16,303:ae.UINT16,701:ae.BOOL,702:ae.BOOL,703:ae.BOOL,704:ae.BOOL});var a=["Unsupported Type-ID","PrimitivePlanePrefab","PrimitiveCubePrefab","PrimitiveSpherePrefab","PrimitiveCylinderPrefab","PrimitivesConePrefab","PrimitivesCapsulePrefab","PrimitivesTorusPrefab"];switch(r){case 1:n=new t.prefabs.PrimitivePlanePrefab(s.get(101,100),s.get(102,100),s.get(301,1),s.get(302,1),s.get(701,!0),s.get(702,!1));break;case 2:n=new t.prefabs.PrimitiveCubePrefab(s.get(101,100),s.get(102,100),s.get(103,100),s.get(301,1),s.get(302,1),s.get(303,1),s.get(701,!0));break;case 3:n=new t.prefabs.PrimitiveSpherePrefab(s.get(101,50),s.get(301,16),s.get(302,12),s.get(701,!0));break;case 4:n=new t.prefabs.PrimitiveCylinderPrefab(s.get(101,50),s.get(102,50),s.get(103,100),s.get(301,16),s.get(302,1),!0,!0,!0),s.get(701,!0)||(n.topClosed=!1),s.get(702,!0)||(n.bottomClosed=!1),s.get(703,!0)||(n.yUp=!1);break;case 5:n=new t.prefabs.PrimitiveConePrefab(s.get(101,50),s.get(102,100),s.get(301,16),s.get(302,1),s.get(701,!0),s.get(702,!0));break;case 6:n=new t.prefabs.PrimitiveCapsulePrefab(s.get(101,50),s.get(102,100),s.get(301,16),s.get(302,15),s.get(701,!0));break;case 7:n=new t.prefabs.PrimitiveTorusPrefab(s.get(101,50),s.get(102,50),s.get(301,16),s.get(302,8),s.get(701,!0));break;default:n=new t.prefabs.PrefabBase,console.log("ERROR: UNSUPPORTED PREFAB_TYPE")}1!=s.get(110,1)||1!=s.get(111,1),this.parseUserAttributes(),n.name=i,this._pFinalizeAsset(n,i),this._blocks[e].data=n,this._debug&&((0>r||r>7)&&(r=0),console.log("Parsed a Primivite: Name = "+i+"| type = "+a[r]))},ae.prototype.parseContainer=function(e){var i,n,r,s;n=this._newBlockBytes.readUnsignedInt(),r=this.parseMatrix3D(),i=this.parseVarStr();var a="Root (TopLevel)";s=new t.containers.DisplayObjectContainer,s.transform.matrix3D=r;var o=this.getAssetByID(n,[x.CONTAINER,x.LIGHT,x.MESH]);if(o[0]?(o[1].addChild(s),a=o[1].name):n>0?this._blocks[e].addError("Could not find a parent for this ObjectContainer3D"):this._pContent.addChild(s),2==this._version[0]&&1==this._version[1]){var h=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:ae.UINT8});s.pivot=new t.geom.Vector3D(h.get(1,0),h.get(2,0),h.get(3,0))}else this.parseProperties(null);s.extra=this.parseUserAttributes(),this._pFinalizeAsset(s,i),this._blocks[e].data=s,this._debug&&console.log("Parsed a Container: Name = '"+i+"' | Parent-Name = "+a)},ae.prototype.parseMeshInstance=function(e){var i,n,r,s=this._newBlockBytes.readUnsignedInt(),a=this.parseMatrix3D(),o=this.parseVarStr(),h="Root (TopLevel)",p=this._newBlockBytes.readUnsignedInt(),u=this.getAssetByID(p,[x.GEOMETRY]);u[0]?r=u[1]:(this._blocks[e].addError("Could not find a Geometry for this Mesh. A empty Geometry is created!"),r=new t.base.Geometry),this._blocks[e].geoID=p;var l=new Array;i=this._newBlockBytes.readUnsignedShort();var c=new Array;n=0;for(var d;i>n;){var _;_=this._newBlockBytes.readUnsignedInt(),d=this.getAssetByID(_,[x.MATERIAL]),!d[0]&&_>0&&this._blocks[e].addError("Could not find Material Nr "+n+" (ID = "+_+" ) for this Mesh");var g=d[1];l.push(g),c.push(g.name),n++}var m=new f(r,null);m.transform.matrix3D=a;var y=this.getAssetByID(s,[x.CONTAINER,x.LIGHT,x.MESH]);if(y[0]){var b=y[1];b.addChild(m),h=b.name}else s>0?this._blocks[e].addError("Could not find a parent for this Mesh"):this._pContent.addChild(m);if(l.length>=1&&1==m.subMeshes.length)m.material=l[0];else if(l.length>1){var v;for(v=0;v<m.subMeshes.length;v++)m.subMeshes[v].material=l[Math.min(l.length-1,v)]}if(2==this._version[0]&&1==this._version[1]){var w=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:ae.UINT8,5:ae.BOOL});m.pivot=new t.geom.Vector3D(w.get(1,0),w.get(2,0),w.get(3,0)),m.castsShadows=w.get(5,!0)}else this.parseProperties(null);m.extra=this.parseUserAttributes(),this._pFinalizeAsset(m,o),this._blocks[e].data=m,this._debug&&console.log("Parsed a Mesh: Name = '"+o+"' | Parent-Name = "+h+"| Geometry-Name = "+r.name+" | SubMeshes = "+m.subMeshes.length+" | Mat-Names = "+c.toString())},ae.prototype.parseSkyboxInstance=function(e){var i=this.parseVarStr(),n=this._newBlockBytes.readUnsignedInt(),r=this.getAssetByID(n,[x.TEXTURE],"CubeTexture");r[0]||0==n||this._blocks[e].addError("Could not find the Cubetexture (ID = "+n+" ) for this Skybox");var s=new t.entities.Skybox(new k(r[1]));this.parseProperties(null),s.extra=this.parseUserAttributes(),this._pFinalizeAsset(s,i),this._blocks[e].data=s,this._debug&&console.log("Parsed a Skybox: Name = '"+i+"' | CubeTexture-Name = "+r[1].name)},ae.prototype.parseLight=function(t){var e,i,n=this._newBlockBytes.readUnsignedInt(),r=this.parseMatrix3D(),s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedByte(),o=this.parseProperties({1:this._propsNrType,2:this._propsNrType,3:ae.COLOR,4:this._propsNrType,5:this._propsNrType,6:ae.BOOL,7:ae.COLOR,8:this._propsNrType,9:ae.UINT8,10:ae.UINT8,11:this._propsNrType,12:ae.UINT16,21:this._matrixNrType,22:this._matrixNrType,23:this._matrixNrType}),h=o.get(9,0),p="Root (TopLevel)",u=["Unsupported LightType","PointLight","DirectionalLight"],l=["No ShadowMapper","DirectionalShadowMapper","NearDirectionalShadowMapper","CascadeShadowMapper","CubeMapShadowMapper"];if(1==a&&(e=new m,e.radius=o.get(1,9e4),e.fallOff=o.get(2,1e5),h>0&&4==h&&(i=new q),e.transform.matrix3D=r),2==a&&(e=new g(o.get(21,0),o.get(22,-1),o.get(23,1)),h>0&&1==h&&(i=new K)),e.color=o.get(3,16777215),e.specular=o.get(4,1),e.diffuse=o.get(5,1),e.ambientColor=o.get(7,16777215),e.ambient=o.get(8,0),i&&(i instanceof q?1!=o.get(10,1)&&(i.depthMapSize=this._depthSizeDic[o.get(10,1)]):2!=o.get(10,2)&&(i.depthMapSize=this._depthSizeDic[o.get(10,2)]),e.shadowMapper=i,e.castsShadows=!0),0!=n){var c=this.getAssetByID(n,[x.CONTAINER,x.LIGHT,x.MESH]);c[0]?(c[1].addChild(e),p=c[1].name):this._blocks[t].addError("Could not find a parent for this Light")}else this._pContent.addChild(e);this.parseUserAttributes(),this._pFinalizeAsset(e,s),this._blocks[t].data=e,this._debug&&console.log("Parsed a Light: Name = '"+s+"' | Type = "+u[a]+" | Parent-Name = "+p+" | ShadowMapper-Type = "+l[h])},ae.prototype.parseCamera=function(e){var i,n=this._newBlockBytes.readUnsignedInt(),r=this.parseMatrix3D(),s=this.parseVarStr(),a="Root (TopLevel)";this._newBlockBytes.readUnsignedByte(),this._newBlockBytes.readShort();var o=this._newBlockBytes.readShort(),h=this.parseProperties({101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType});switch(o){case 5001:i=new t.projections.PerspectiveProjection(h.get(101,60));break;case 5002:i=new t.projections.OrthographicProjection(h.get(101,500));break;case 5003:i=new t.projections.OrthographicOffCenterProjection(h.get(101,-400),h.get(102,400),h.get(103,-300),h.get(104,300));break;default:return void console.log("unsupportedLenstype")}var p=new t.entities.Camera(i);p.transform.matrix3D=r;var u=this.getAssetByID(n,[x.CONTAINER,x.LIGHT,x.MESH]);if(u[0]){var l=u[1];l.addChild(p),a=l.name}else n>0?this._blocks[e].addError("Could not find a parent for this Camera"):this._pContent.addChild(p);p.name=s,h=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:ae.UINT8}),p.pivot=new t.geom.Vector3D(h.get(1,0),h.get(2,0),h.get(3,0)),p.extra=this.parseUserAttributes(),this._pFinalizeAsset(p,s),this._blocks[e].data=p,this._debug&&console.log("Parsed a Camera: Name = '"+s+"' | Projectiontype = "+i+" | Parent-Name = "+a)},ae.prototype.parseLightPicker=function(t){var e,i=this.parseVarStr(),n=this._newBlockBytes.readUnsignedShort(),r=new Array,s=0,a=0,o=new Array;for(s=0;n>s;s++)a=this._newBlockBytes.readUnsignedInt(),e=this.getAssetByID(a,[x.LIGHT]),e[0]?(r.push(e[1]),o.push(e[1].name)):this._blocks[t].addError("Could not find a Light Nr "+s+" (ID = "+a+" ) for this LightPicker");if(0==r.length)return this._blocks[t].addError("Could not create this LightPicker, cause no Light was found."),void this.parseUserAttributes();var h=new Q(r);h.name=i,this.parseUserAttributes(),this._pFinalizeAsset(h,i),this._blocks[t].data=h,this._debug&&console.log("Parsed a StaticLightPicker: Name = '"+i+"' | Texture-Name = "+o.toString())},ae.prototype.parseMaterial=function(t){var e,i,n,r,s,a,o,h;for(e=this.parseVarStr(),i=this._newBlockBytes.readUnsignedByte(),a=this._newBlockBytes.readUnsignedByte(),n=this.parseProperties({1:ae.INT32,2:ae.BADDR,10:this._propsNrType,11:ae.BOOL,12:this._propsNrType,13:ae.BOOL}),o=0;a>o;){var p;p=this._newBlockBytes.readUnsignedShort(),this.parseProperties(null),this.parseUserAttributes(),o+=1}var u="";if(s=this.parseUserAttributes(),1===i){u+="Parsed a ColorMaterial(SinglePass): Name = '"+e+"' | ";var l;l=n.get(1,13421772),this.materialMode<2?r=new U(l,n.get(10,1)):(r=new U(l),r.materialMode=B.MULTI_PASS)}else if(2===i){var c=n.get(2,0);h=this.getAssetByID(c,[x.TEXTURE]),!h[0]&&c>0&&this._blocks[t].addError("Could not find the DiffsueTexture (ID = "+c+" ) for this Material"),r=new U(h[1]),this.materialMode<2?(r.alphaBlending=n.get(11,!1),r.alpha=n.get(10,1),u+="Parsed a TriangleMaterial(SinglePass): Name = '"+e+"' | Texture-Name = "+r.name):(r.materialMode=B.MULTI_PASS,u+="Parsed a TriangleMaterial(MultiPass): Name = '"+e+"' | Texture-Name = "+r.name)}r.extra=s,r.alphaThreshold=n.get(12,0),r.repeat=n.get(13,!1),this._pFinalizeAsset(r,e),this._blocks[t].data=r,this._debug&&console.log(u)},ae.prototype.parseMaterial_v1=function(t){var e,i,n,r,s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedByte(),o=this._newBlockBytes.readUnsignedByte(),h=this.parseProperties({1:ae.UINT32,2:ae.BADDR,3:ae.BADDR,4:ae.UINT8,5:ae.BOOL,6:ae.BOOL,7:ae.BOOL,8:ae.BOOL,9:ae.UINT8,10:this._propsNrType,11:ae.BOOL,12:this._propsNrType,13:ae.BOOL,15:this._propsNrType,16:ae.UINT32,17:ae.BADDR,18:this._propsNrType,19:this._propsNrType,20:ae.UINT32,21:ae.BADDR,22:ae.BADDR}),p=h.get(4,0),u="";if(p>=2)return void this._blocks[t].addError("Material-spezialType '"+p+"' is not supported, can only be 0:singlePass, 1:MultiPass !");if(1==this.materialMode?p=0:2==this.materialMode&&(p=1),2>p){if(1==a){var l=h.get(1,13421772);1==p?(e=new U(l),e.materialMode=B.MULTI_PASS,u+="Parsed a ColorMaterial(MultiPass): Name = '"+s+"' | "):(e=new U(l,h.get(10,1)),e.alphaBlending=h.get(11,!1),u+="Parsed a ColorMaterial(SinglePass): Name = '"+s+"' | ")}else if(2==a){var c=h.get(2,0);r=this.getAssetByID(c,[x.TEXTURE]),!r[0]&&c>0&&this._blocks[t].addError("Could not find the DiffuseTexture (ID = "+c+" ) for this TriangleMaterial");var d,_=r[1],f=h.get(17,0);r=this.getAssetByID(f,[x.TEXTURE]),r[0]||0==f||this._blocks[t].addError("Could not find the AmbientTexture (ID = "+f+" ) for this TriangleMaterial"),r[0]&&(d=r[1]),e=new U(_),1==p?(e.materialMode=B.MULTI_PASS,u+="Parsed a TriangleMaterial(MultiPass): Name = '"+s+"' | Texture-Name = "+_.name):(e.alpha=h.get(10,1),e.alphaBlending=h.get(11,!1),u+="Parsed a TriangleMaterial(SinglePass): Name = '"+s+"' | Texture-Name = "+_.name),d&&(e.ambientTexture=d,u+=" | AmbientTexture-Name = "+d.name)}var g=h.get(3,0);r=this.getAssetByID(g,[x.TEXTURE]),r[0]||0==g||this._blocks[t].addError("Could not find the NormalTexture (ID = "+g+" ) for this TriangleMaterial"),r[0]&&(i=r[1],u+=" | NormalTexture-Name = "+i.name);var m=h.get(21,0);r=this.getAssetByID(m,[x.TEXTURE]),r[0]||0==m||this._blocks[t].addError("Could not find the SpecularTexture (ID = "+m+" ) for this TriangleMaterial"),r[0]&&(n=r[1],u+=" | SpecularTexture-Name = "+n.name);var y=h.get(22,0);r=this.getAssetByID(y,[x.LIGHT_PICKER]),!r[0]&&y?this._blocks[t].addError("Could not find the LightPicker (ID = "+y+" ) for this TriangleMaterial"):e.lightPicker=r[1],e.smooth=h.get(5,!0),e.mipmap=h.get(6,!0),e.bothSides=h.get(7,!1),e.alphaPremultiplied=h.get(8,!1),e.blendMode=this.blendModeDic[h.get(9,0)],e.repeat=h.get(13,!1),i&&(e.normalMap=i),n&&(e.specularMap=n),e.alphaThreshold=h.get(12,0),e.ambient=h.get(15,1),e.ambientColor=h.get(16,16777215),e.specular=h.get(18,1),e.gloss=h.get(19,50),e.specularColor=h.get(20,16777215);for(var b,w=0;o>w;){var M;switch(M=this._newBlockBytes.readUnsignedShort(),h=this.parseProperties({1:ae.BADDR,2:ae.BADDR,3:ae.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:ae.UINT32,202:ae.UINT32,301:ae.UINT16,302:ae.UINT16,401:ae.UINT8,402:ae.UINT8,601:ae.COLOR,602:ae.COLOR,701:ae.BOOL,702:ae.BOOL,801:ae.MTX4x4}),M){case 999:b=h.get(1,0),r=this.getAssetByID(b,[x.EFFECTS_METHOD]),r[0]?(e.addEffectMethod(r[1]),u+=" | EffectMethod-Name = "+r[1].name):this._blocks[t].addError("Could not find the EffectMethod (ID = "+b+" ) for this Material");break;case 998:b=h.get(1,0),r=this.getAssetByID(b,[x.SHADOW_MAP_METHOD]),r[0]?(e.shadowMethod=r[1],u+=" | ShadowMethod-Name = "+r[1].name):this._blocks[t].addError("Could not find the ShadowMethod (ID = "+b+" ) for this Material");break;case 1:b=h.get(1,0),r=this.getAssetByID(b,[x.TEXTURE],"CubeTexture"),r[0]||this._blocks[t].addError("Could not find the EnvMap (ID = "+b+" ) for this EnvMapAmbientMethodMaterial"),e.ambientMethod=new v(r[1]),u+=" | AmbientEnvMapMethod | EnvMap-Name ="+r[1].name;break;case 51:e.diffuseMethod=new D,u+=" | DiffuseDepthMethod";break;case 52:b=h.get(1,0),r=this.getAssetByID(b,[x.TEXTURE]),r[0]||this._blocks[t].addError("Could not find the GradientDiffuseTexture (ID = "+b+" ) for this GradientDiffuseMethod"),e.diffuseMethod=new P(r[1]),u+=" | DiffuseGradientMethod | GradientDiffuseTexture-Name ="+r[1].name;break;case 53:e.diffuseMethod=new T(h.get(101,5)),u+=" | DiffuseWrapMethod";break;case 54:b=h.get(1,0),r=this.getAssetByID(b,[x.TEXTURE]),r[0]||this._blocks[t].addError("Could not find the LightMap (ID = "+b+" ) for this LightMapDiffuseMethod"),e.diffuseMethod=new A(r[1],this.blendModeDic[h.get(401,10)],!1,e.diffuseMethod),u+=" | DiffuseLightMapMethod | LightMapTexture-Name ="+r[1].name;break;case 55:e.diffuseMethod=new C(h.get(401,3),e.diffuseMethod),e.diffuseMethod.smoothness=h.get(101,.1),u+=" | DiffuseCelMethod";break;case 56:e.diffuseMethod=new S,e.diffuseMethod.scattering=h.get(101,.2),e.diffuseMethod.translucency=h.get(102,1),e.diffuseMethod.scatterColor=h.get(601,16777215),u+=" | DiffuseSubSurfaceMethod";break;case 101:e.specularMethod=new X,u+=" | SpecularAnisotropicMethod";break;case 102:e.specularMethod=new Y,u+=" | SpecularPhongMethod";break;case 103:e.specularMethod=new W(h.get(101,.5),e.specularMethod),e.specularMethod.smoothness=h.get(102,.1),u+=" | SpecularCelMethod";break;case 104:e.specularMethod=new G(h.get(701,!0),e.specularMethod),e.specularMethod.fresnelPower=h.get(101,5),e.specularMethod.normalReflectance=h.get(102,.1),u+=" | SpecularFresnelMethod";break;case 151:break;case 152:b=h.get(1,0),r=this.getAssetByID(b,[x.TEXTURE]),r[0]||this._blocks[t].addError("Could not find the SecoundNormalMap (ID = "+b+" ) for this SimpleWaterNormalMethod"),e.normalMap||this._blocks[t].addError("Could not find a normal Map on this Material to use with this SimpleWaterNormalMethod"),e.normalMap=r[1],e.normalMethod=new V(e.normalMap,r[1]),u+=" | NormalSimpleWaterMethod | Second-NormalTexture-Name = "+r[1].name}this.parseUserAttributes(),w+=1}}e.extra=this.parseUserAttributes(),this._pFinalizeAsset(e,s),this._blocks[t].data=e,this._debug&&console.log(u)},ae.prototype.parseTexture=function(e){var i;this._blocks[e].name=this.parseVarStr();var n,r=this._newBlockBytes.readUnsignedByte();if(this._texture_users[this._cur_block_id.toString()]=[],0==r){n=this._newBlockBytes.readUnsignedInt();var s;s=this._newBlockBytes.readUTFBytes(n),this._pAddDependency(this._cur_block_id.toString(),new t.net.URLRequest(s),!1,null,!0)}else{n=this._newBlockBytes.readUnsignedInt();var a;a=new se,this._newBlockBytes.readBytes(a,0,n),this._pAddDependency(this._cur_block_id.toString(),null,!1,ee.byteArrayToImage(a),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=i,this._debug){var o=["external","embed"];console.log("Start parsing a "+o[r]+" Bitmap for Texture")}},ae.prototype.parseCubeTexture=function(e){var i,n,r;this._cubeTextures=new Array,this._texture_users[this._cur_block_id.toString()]=[];var s=this._newBlockBytes.readUnsignedByte();for(this._blocks[e].name=this.parseVarStr(),r=0;6>r;r++)if(this._texture_users[this._cur_block_id.toString()]=[],this._cubeTextures.push(null),0==s){i=this._newBlockBytes.readUnsignedInt();var a;a=this._newBlockBytes.readUTFBytes(i),this._pAddDependency(this._cur_block_id.toString()+"#"+r,new t.net.URLRequest(a),!1,null,!0)}else{i=this._newBlockBytes.readUnsignedInt();var o;o=new se,this._newBlockBytes.readBytes(o,0,i),this._pAddDependency(this._cur_block_id.toString()+"#"+r,null,!1,ee.byteArrayToImage(o),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=n,this._debug){var h=["external","embed"];console.log("Start parsing 6 "+h[s]+" Bitmaps for CubeTexture")}},ae.prototype.parseSharedMethodBlock=function(t){var e;this._blocks[t].name=this.parseVarStr(),e=this.parseSharedMethodList(t),this.parseUserAttributes(),this._blocks[t].data=e,this._pFinalizeAsset(e,this._blocks[t].name),this._blocks[t].data=e,this._debug&&console.log("Parsed a EffectMethod: Name = "+e.name+" Type = "+e)},ae.prototype.parseShadowMethodBlock=function(t){var e,i;this._blocks[t].name=this.parseVarStr(),i=this._newBlockBytes.readUnsignedInt();var n=this.getAssetByID(i,[x.LIGHT]);return n[0]?(e=this.parseShadowMethodList(n[1],t),void(e&&(this.parseUserAttributes(),this._pFinalizeAsset(e,this._blocks[t].name),this._blocks[t].data=e,this._debug&&console.log("Parsed a ShadowMapMethodMethod: Name = "+e.name+" | Type = "+e+" | Light-Name = ",n[1].name)))):void this._blocks[t].addError("Could not find the TargetLight (ID = "+i+" ) for this ShadowMethod - ShadowMethod not created")},ae.prototype.parseCommand=function(e){1==this._newBlockBytes.readUnsignedByte();var i,n,r=this._newBlockBytes.readUnsignedInt(),s=this.parseMatrix3D(),a=this.parseVarStr(),o=this.getAssetByID(r,[x.CONTAINER,x.LIGHT,x.MESH]);o[0]&&(i=o[1]),this._newBlockBytes.readShort();var h=this._newBlockBytes.readShort(),p=this.parseProperties({1:ae.BADDR});switch(h){case 1:var u=p.get(1,0),l=this.getAssetByID(u,[x.LIGHT,x.TEXTURE_PROJECTOR]);if(!l[0]&&0!=u)return void this._blocks[e].addError("Could not find the light (ID = "+u+" ( for this CommandBock!");n=l[1],i&&i.addChild(n),n.transform.matrix3D=s}n&&(p=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:ae.UINT8}),n.pivot=new t.geom.Vector3D(p.get(1,0),p.get(2,0),p.get(3,0)),n.extra=this.parseUserAttributes()),this._blocks[e].data=n,this._debug&&console.log("Parsed a CommandBlock: Name = '"+a)},ae.prototype.parseMetaData=function(){var t=this.parseProperties({1:ae.UINT32,2:ae.AWDSTRING,3:ae.AWDSTRING,4:ae.AWDSTRING,5:ae.AWDSTRING});this._debug&&(console.log("Parsed a MetaDataBlock: TimeStamp         = "+t.get(1,0)),console.log("                        EncoderName       = "+t.get(2,"unknown")),console.log("                        EncoderVersion    = "+t.get(3,"unknown")),console.log("                        GeneratorName     = "+t.get(4,"unknown")),console.log("                        GeneratorVersion  = "+t.get(5,"unknown")))},ae.prototype.parseNameSpace=function(){var t=this._newBlockBytes.readUnsignedByte(),e=this.parseVarStr();this._debug&&console.log("Parsed a NameSpaceBlock: ID = "+t+" | String = "+e)},ae.prototype.parseShadowMethodList=function(t,e){var i,n,r,s=this._newBlockBytes.readUnsignedShort(),a=this.parseProperties({1:ae.BADDR,2:ae.BADDR,3:ae.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:ae.UINT32,202:ae.UINT32,301:ae.UINT16,302:ae.UINT16,401:ae.UINT8,402:ae.UINT8,601:ae.COLOR,602:ae.COLOR,701:ae.BOOL,702:ae.BOOL,801:ae.MTX4x4});switch(s){case 1002:if(n=a.get(1,0),r=this.getAssetByID(n,[x.SHADOW_MAP_METHOD]),!r[0])return this._blocks[e].addError("Could not find the ShadowBaseMethod (ID = "+n+" ) for this ShadowNearMethod - ShadowMethod not created"),i;i=new Z(r[1]);break;case 1101:i=new z(t),i.alpha=a.get(101,1),i.epsilon=a.get(102,.002);break;case 1102:i=new j(t,a.get(201,5)),i.alpha=a.get(101,1),i.epsilon=a.get(102,.002),i.range=a.get(103,1);break;case 1103:i=new J(t,a.get(201,5)),i.alpha=a.get(101,1),i.epsilon=a.get(102,.002),i.range=a.get(103,1);break;case 1104:i=new H(t),i.alpha=a.get(101,1),i.epsilon=a.get(102,.002)}return this.parseUserAttributes(),i},ae.prototype.parseSkeleton=function(t){var e=this.parseVarStr(),i=this._newBlockBytes.readUnsignedShort(),r=new n;this.parseProperties(null);for(var s=0;i>s;){var a,o;this._newBlockBytes.readUnsignedShort(),a=new h,a.parentIndex=this._newBlockBytes.readUnsignedShort()-1,a.name=this.parseVarStr(),o=this.parseMatrix3D(),a.inverseBindPose=o.rawData,this.parseProperties(null),this.parseUserAttributes(),r.joints.push(a),s++}this.parseUserAttributes(),this._pFinalizeAsset(r,e),this._blocks[t].data=r,this._debug&&console.log("Parsed a Skeleton: Name = "+r.name+" | Number of Joints = "+s)},ae.prototype.parseSkeletonPose=function(t){var e=this.parseVarStr(),n=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var r=new o,s=0;n>s;){var a,h;if(a=new i,h=this._newBlockBytes.readUnsignedByte(),1==h){var p=this.parseMatrix43RawData(),u=new b(p);a.orientation.fromMatrix(u),a.translation.copyFrom(u.position),r.jointPoses[s]=a}s++}this.parseUserAttributes(),this._pFinalizeAsset(r,e),this._blocks[t].data=r,this._debug&&console.log("Parsed a SkeletonPose: Name = "+r.name+" | Number of Joints = "+s)},ae.prototype.parseSkeletonAnimation=function(t){var e,i,n=this.parseVarStr(),r=new a,s=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var o,h=0;s>h;)i=this._newBlockBytes.readUnsignedInt(),e=this._newBlockBytes.readUnsignedShort(),o=this.getAssetByID(i,[x.SKELETON_POSE]),o[0]?r.addFrame(this._blocks[i].data,e):this._blocks[t].addError("Could not find the SkeletonPose Frame # "+h+" (ID = "+i+" ) for this SkeletonClipNode"),h++;return 0==r.frames.length?void this._blocks[t].addError("Could not this SkeletonClipNode, because no Frames where set."):(this.parseUserAttributes(),this._pFinalizeAsset(r,n),this._blocks[t].data=r,void(this._debug&&console.log("Parsed a SkeletonClipNode: Name = "+r.name+" | Number of Frames = "+r.frames.length)))},ae.prototype.parseMeshPoseAnimation=function(t,e){"undefined"==typeof e&&(e=!1);var i,n,r,s,a,o,h,p,u,c,f,g,m,y,b=1,v=0,w=new l,D=0,C=0,S=new Array,P=this.parseVarStr(),A=this._newBlockBytes.readUnsignedInt(),T=this.getAssetByID(A,[x.GEOMETRY]);if(!T[0])return void this._blocks[t].addError("Could not find the target-Geometry-Object "+A+" ) for this VertexClipNode");var M=this.getUVForVertexAnimation(A);for(e||(b=this._newBlockBytes.readUnsignedShort()),i=this._newBlockBytes.readUnsignedShort(),D=this._newBlockBytes.readUnsignedShort(),C=0;D>C;)S.push(this._newBlockBytes.readUnsignedShort()),C++;for(y=this.parseProperties({1:ae.BOOL,2:ae.BOOL}),w.looping=y.get(1,!0),w.stitchFinalFrame=y.get(2,!1),n=0;b>n;){for(s=this._newBlockBytes.readUnsignedShort(),c=new d,r=0;i>r;)for(C=0,p=this._newBlockBytes.readUnsignedInt(),u=this._newBlockBytes.position+p;D>C;){if(1==S[C]){for(g=T[1].subGeometries[r].indices,m=new Array,v=0;this._newBlockBytes.position<u;)a=this.readNumber(this._accuracyGeo),o=this.readNumber(this._accuracyGeo),h=this.readNumber(this._accuracyGeo),m[v++]=a,m[v++]=o,m[v++]=h;f=new _(!0),f.updateIndices(g),f.updatePositions(m),f.updateUVs(M[r]),f.updateVertexNormals(null),f.updateVertexTangents(null),f.autoDeriveNormals=!1,f.autoDeriveTangents=!1,r++,c.addSubGeometry(f)}else this._newBlockBytes.position=u;C++}w.addFrame(c,s),n++}this.parseUserAttributes(),this._pFinalizeAsset(w,P),this._blocks[t].data=w,this._debug&&console.log("Parsed a VertexClipNode: Name = "+w.name+" | Target-Geometry-Name = "+T[1].name+" | Number of Frames = "+w.frames.length)},ae.prototype.parseVertexAnimationSet=function(t){for(var e,i=this.parseVarStr(),n=this._newBlockBytes.readUnsignedShort(),s=this.parseProperties({1:ae.UINT16}),o=0,h=new Array,u=new Array;n>o;){e=this._newBlockBytes.readUnsignedInt();var c=this.getAssetByID(e,[x.ANIMATION_NODE]);c[0]?(c[1]instanceof l&&u.push(c[1]),c[1]instanceof a&&h.push(c[1])):this._blocks[t].addError("Could not find the AnimationClipNode Nr "+o+" ( "+e+" ) for this AnimationSet"),o++}if(0==u.length&&0==h.length)return void this._blocks[t].addError("Could not create this AnimationSet, because it contains no animations");if(this.parseUserAttributes(),u.length>0){for(var d=new p,_=0;_<u.length;_++)d.addAnimation(u[_]);this._pFinalizeAsset(d,i),this._blocks[t].data=d,this._debug&&console.log("Parsed a VertexAnimationSet: Name = "+i+" | Animations = "+d.animations.length+" | Animation-Names = "+d.animationNames.toString())}else if(h.length>0){c=this.getAssetByID(e,[x.ANIMATION_NODE]);for(var f=new r(s.get(1,4)),_=0;_<h.length;_++)f.addAnimation(h[_]);this._pFinalizeAsset(f,i),this._blocks[t].data=f,this._debug&&console.log("Parsed a SkeletonAnimationSet: Name = "+i+" | Animations = "+f.animations.length+" | Animation-Names = "+f.animationNames.toString())}},ae.prototype.parseAnimatorSet=function(t){var e,i,n=this.parseVarStr(),r=this._newBlockBytes.readUnsignedShort(),a=this.parseProperties({1:ae.BADDR});e=this._newBlockBytes.readUnsignedInt();for(var o=this._newBlockBytes.readUnsignedShort(),h=new Array,p=0;o>p;p++)h.push(this._newBlockBytes.readUnsignedInt());this._newBlockBytes.readUnsignedShort(),1==this._newBlockBytes.readUnsignedByte(),this.parseUserAttributes(),this.parseUserAttributes();var l,c=new Array;for(p=0;p<h.length;p++)l=this.getAssetByID(h[p],[x.MESH]),l[0]&&c.push(l[1]);if(l=this.getAssetByID(e,[x.ANIMATION_SET]),!l[0])return void this._blocks[t].addError("Could not find the AnimationSet ( "+e+" ) for this Animator");i=l[1];var d;if(1==r){if(l=this.getAssetByID(a.get(1,0),[x.SKELETON]),!l[0])return void this._blocks[t].addError("Could not find the Skeleton ( "+a.get(1,0)+" ) for this Animator");d=new s(i,l[1])}else 2==r&&(d=new u(i));for(this._pFinalizeAsset(d,n),this._blocks[t].data=d,p=0;p<c.length;p++)1==r&&(c[p].animator=d),2==r&&(c[p].animator=d);this._debug&&console.log("Parsed a Animator: Name = "+n)},ae.prototype.parseSharedMethodList=function(t){var e,i,n,r=this._newBlockBytes.readUnsignedShort(),s=this.parseProperties({1:ae.BADDR,2:ae.BADDR,3:ae.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType,105:this._propsNrType,106:this._propsNrType,107:this._propsNrType,201:ae.UINT32,202:ae.UINT32,301:ae.UINT16,302:ae.UINT16,401:ae.UINT8,402:ae.UINT8,601:ae.COLOR,602:ae.COLOR,701:ae.BOOL,702:ae.BOOL});switch(r){case 401:e=new E(s.get(101,new Array(0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)));break;case 402:e=new O;var a=s.get(601,0);e.colorTransform=new y(s.get(102,1),s.get(103,1),s.get(104,1),s.get(101,1),255&a>>16,255&a>>8,255&a,255&a>>24);break;case 403:i=s.get(1,0),console.log("ENV MAP",i),n=this.getAssetByID(i,[x.TEXTURE],"CubeTexture"),n[0]||this._blocks[t].addError("Could not find the EnvMap (ID = "+i+" ) for this EnvMapMethod"),e=new R(n[1],s.get(101,1)),i=s.get(2,0),i>0&&(n=this.getAssetByID(i,[x.TEXTURE]),n[0]||this._blocks[t].addError("Could not find the Mask-texture (ID = "+i+" ) for this EnvMapMethod"));break;case 404:i=s.get(1,0),n=this.getAssetByID(i,[x.TEXTURE]),n[0]||this._blocks[t].addError("Could not find the LightMap (ID = "+i+" ) for this LightMapMethod"),e=new L(n[1],this.blendModeDic[s.get(401,10)]);break;case 406:e=new F(s.get(601,16777215),s.get(101,.4),s.get(101,2));break;case 407:i=s.get(1,0),n=this.getAssetByID(i,[x.TEXTURE]),n[0]||this._blocks[t].addError("Could not find the Alpha-texture (ID = "+i+" ) for this AlphaMaskMethod"),e=new M(n[1],s.get(701,!1));break;case 410:i=s.get(1,0),n=this.getAssetByID(i,[x.TEXTURE],"CubeTexture"),n[0]||this._blocks[t].addError("Could not find the EnvMap (ID = "+i+" ) for this FresnelEnvMapMethod"),e=new N(n[1],s.get(101,1));break;case 411:e=new I(s.get(101,0),s.get(102,1e3),s.get(601,8421504))}return this.parseUserAttributes(),e},ae.prototype.parseUserAttributes=function(){var t,e,i;if(e=this._newBlockBytes.readUnsignedInt(),e>0){var n;for(t={},n=this._newBlockBytes.position+e;this._newBlockBytes.position<n;){var r,s,a,o,h;if(r=this._newBlockBytes.readUnsignedByte(),s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedByte(),o=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+o>n)return console.log("           Error in reading attribute # "+i+" = skipped to end of attribute-list"),this._newBlockBytes.position=n,t;switch(a){case ae.AWDSTRING:h=this._newBlockBytes.readUTFBytes(o);break;case ae.INT8:h=this._newBlockBytes.readByte();break;case ae.INT16:h=this._newBlockBytes.readShort();break;case ae.INT32:h=this._newBlockBytes.readInt();break;case ae.BOOL:case ae.UINT8:h=this._newBlockBytes.readUnsignedByte();break;case ae.UINT16:h=this._newBlockBytes.readUnsignedShort();break;case ae.UINT32:case ae.BADDR:h=this._newBlockBytes.readUnsignedInt();break;case ae.FLOAT32:h=this._newBlockBytes.readFloat();break;case ae.FLOAT64:h=this._newBlockBytes.readDouble();break;default:h="unimplemented attribute type "+a,this._newBlockBytes.position+=o}this._debug&&console.log("attribute = name: "+s+"  / value = "+h),t[s]=h,i+=1}}return t},ae.prototype.parseProperties=function(t){var e,i,n=0,r=new AWDProperties;if(i=this._newBlockBytes.readUnsignedInt(),e=this._newBlockBytes.position+i,t)for(;this._newBlockBytes.position<e;){var s,a,o;if(a=this._newBlockBytes.readUnsignedShort(),s=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+s>e)return console.log("           Error in reading property # "+n+" = skipped to end of propertie-list"),this._newBlockBytes.position=e,r;t.hasOwnProperty(a.toString())?(o=t[a],r.set(a,this.parseAttrValue(o,s))):this._newBlockBytes.position+=s,n+=1}else this._newBlockBytes.position=e;return r},ae.prototype.parseAttrValue=function(t,e){var i,n;switch(t){case ae.BOOL:case ae.INT8:i=1,n=this._newBlockBytes.readByte;break;case ae.INT16:i=2,n=this._newBlockBytes.readShort;break;case ae.INT32:i=4,n=this._newBlockBytes.readInt;break;case ae.UINT8:i=1,n=this._newBlockBytes.readUnsignedByte;break;case ae.UINT16:i=2,n=this._newBlockBytes.readUnsignedShort;break;case ae.UINT32:case ae.COLOR:case ae.BADDR:i=4,n=this._newBlockBytes.readUnsignedInt;break;case ae.FLOAT32:i=4,n=this._newBlockBytes.readFloat;break;case ae.FLOAT64:i=8,n=this._newBlockBytes.readDouble;break;case ae.AWDSTRING:return this._newBlockBytes.readUTFBytes(e);case ae.VECTOR2x1:case ae.VECTOR3x1:case ae.VECTOR4x1:case ae.MTX3x2:case ae.MTX3x3:case ae.MTX4x3:case ae.MTX4x4:i=8,n=this._newBlockBytes.readDouble}if(e>i){for(var r=[],s=0,a=e/i;a>s;)r.push(n.apply(this._newBlockBytes)),s++;return r}var o=n.apply(this._newBlockBytes);return o},ae.prototype.parseHeader=function(){var t,e;this._byteData.position=3,this._version[0]=this._byteData.readUnsignedByte(),this._version[1]=this._byteData.readUnsignedByte(),t=this._byteData.readUnsignedShort(),this._streaming=bitFlags.test(t,bitFlags.FLAG1),2==this._version[0]&&1==this._version[1]&&(this._accuracyMatrix=bitFlags.test(t,bitFlags.FLAG2),this._accuracyGeo=bitFlags.test(t,bitFlags.FLAG3),this._accuracyProps=bitFlags.test(t,bitFlags.FLAG4)),this._geoNrType=ae.FLOAT32,this._accuracyGeo&&(this._geoNrType=ae.FLOAT64),this._matrixNrType=ae.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=ae.FLOAT64),this._propsNrType=ae.FLOAT32,this._accuracyProps&&(this._propsNrType=ae.FLOAT64),this._compression=this._byteData.readUnsignedByte(),this._debug&&(console.log("Import AWDFile of version = "+this._version[0]+" - "+this._version[1]),console.log("Global Settings = Compression = "+this._compression+" | Streaming = "+this._streaming+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps)),e=this._byteData.readUnsignedInt(),this._streaming||e==this._byteData.getBytesAvailable()||this._pDieWithError("AWD2 body length does not match header integrity field")},ae.prototype.getUVForVertexAnimation=function(t){if(this._blocks[t].data instanceof f&&(t=this._blocks[t].geoID),this._blocks[t].uvsForVertexAnimation)return this._blocks[t].uvsForVertexAnimation;var e,i,n,r,s,a,o,h=this._blocks[t].data,p=0;for(this._blocks[t].uvsForVertexAnimation=new Array;p<h.subGeometries.length;){for(a=new Array,o=h.subGeometries[p],r=o.numVertices,e=o.uvs,i=o.getStride(_.UV_DATA),n=o.getOffset(_.UV_DATA),s=0;r>s;s++)a.push(e[n+s*i+0]),a.push(e[n+s*i+1]);
this._blocks[t].uvsForVertexAnimation.push(a),p++}return this._blocks[t].uvsForVertexAnimation},ae.prototype.parseVarStr=function(){var t=this._newBlockBytes.readUnsignedShort();return this._newBlockBytes.readUTFBytes(t)},ae.prototype.getAssetByID=function(t,e,i){"undefined"==typeof i&&(i="SingleTexture");var n=new Array,r=0;if(t>0&&this._blocks[t]&&this._blocks[t].data)for(;r<e.length;){var s=this._blocks[t].data;if(s.assetType==e[r]){if(e[r]==x.TEXTURE&&"CubeTexture"==i&&this._blocks[t].data instanceof ne)return n.push(!0),n.push(this._blocks[t].data),n;if(e[r]!=x.TEXTURE||"SingleTexture"!=i)return n.push(!0),n.push(this._blocks[t].data),n;if(this._blocks[t].data instanceof re)return n.push(!0),n.push(this._blocks[t].data),n}if(e[r]==x.GEOMETRY&&s.assetType==x.MESH){var a=this._blocks[t].data;return n.push(!0),n.push(a.geometry),n}r++}return n.push(!1),n.push(this.getDefaultAsset(e[0],i)),n},ae.prototype.getDefaultAsset=function(t,e){switch(!0){case t==x.TEXTURE:if("CubeTexture"==e)return this.getDefaultCubeTexture();if("SingleTexture"==e)return this.getDefaultTexture();break;case t==x.MATERIAL:return this.getDefaultMaterial()}return null},ae.prototype.getDefaultMaterial=function(){return this._defaultBitmapMaterial||(this._defaultBitmapMaterial=w.getDefaultMaterial()),this._defaultBitmapMaterial},ae.prototype.getDefaultTexture=function(){return this._defaultTexture||(this._defaultTexture=w.getDefaultTexture()),this._defaultTexture},ae.prototype.getDefaultCubeTexture=function(){if(!this._defaultCubeTexture){var t=w.createCheckeredBitmapData();this._defaultCubeTexture=new ie(t,t,t,t,t,t),this._defaultCubeTexture.name="defaultCubeTexture"}return this._defaultCubeTexture},ae.prototype.readNumber=function(t){return"undefined"==typeof t&&(t=!1),t?this._newBlockBytes.readDouble():this._newBlockBytes.readFloat()},ae.prototype.parseMatrix3D=function(){return new b(this.parseMatrix43RawData())},ae.prototype.parseMatrix32RawData=function(){var t,e=new Array(6);for(t=0;6>t;t++)e[t]=this._newBlockBytes.readFloat();return e},ae.prototype.parseMatrix43RawData=function(){var t=new Array(16);return t[0]=this.readNumber(this._accuracyMatrix),t[1]=this.readNumber(this._accuracyMatrix),t[2]=this.readNumber(this._accuracyMatrix),t[3]=0,t[4]=this.readNumber(this._accuracyMatrix),t[5]=this.readNumber(this._accuracyMatrix),t[6]=this.readNumber(this._accuracyMatrix),t[7]=0,t[8]=this.readNumber(this._accuracyMatrix),t[9]=this.readNumber(this._accuracyMatrix),t[10]=this.readNumber(this._accuracyMatrix),t[11]=0,t[12]=this.readNumber(this._accuracyMatrix),t[13]=this.readNumber(this._accuracyMatrix),t[14]=this.readNumber(this._accuracyMatrix),t[15]=1,isNaN(t[0])&&(t[0]=1,t[1]=0,t[2]=0,t[4]=0,t[5]=1,t[6]=0,t[8]=0,t[9]=0,t[10]=1,t[12]=0,t[13]=0,t[14]=0),t},ae.COMPRESSIONMODE_LZMA="lzma",ae.UNCOMPRESSED=0,ae.DEFLATE=1,ae.LZMA=2,ae.INT8=1,ae.INT16=2,ae.INT32=3,ae.UINT8=4,ae.UINT16=5,ae.UINT32=6,ae.FLOAT32=7,ae.FLOAT64=8,ae.BOOL=21,ae.COLOR=22,ae.BADDR=23,ae.AWDSTRING=31,ae.AWDBYTEARRAY=32,ae.VECTOR2x1=41,ae.VECTOR3x1=42,ae.VECTOR4x1=43,ae.MTX3x2=44,ae.MTX3x3=45,ae.MTX4x3=46,ae.MTX4x4=47,ae}(t.parsers.ParserBase);e.AWDParser=ae}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var AWDBlock=function(){function t(){}return t.prototype.dispose=function(){this.id=null,this.bytes=null,this.errorMessages=null,this.uvsForVertexAnimation=null},t.prototype.addError=function(t){this.errorMessages||(this.errorMessages=new Array),this.errorMessages.push(t)},t}(),bitFlags=function(){function t(){}return t.test=function(t,e){return(t&e)==e},t.FLAG1=1,t.FLAG2=2,t.FLAG3=4,t.FLAG4=8,t.FLAG5=16,t.FLAG6=32,t.FLAG7=64,t.FLAG8=128,t.FLAG9=256,t.FLAG10=512,t.FLAG11=1024,t.FLAG12=2048,t.FLAG13=4096,t.FLAG14=8192,t.FLAG15=16384,t.FLAG16=32768,t}(),AWDProperties=function(){function t(){}return t.prototype.set=function(t,e){this[t.toString()]=e},t.prototype.get=function(t,e){return this.hasOwnProperty(t.toString())?this[t.toString()]:e},t}(),away;!function(t){!function(e){var i=t.base.TriangleSubGeometry,n=t.materials.DefaultMaterialManager,r=t.materials.TriangleMaterial,s=t.materials.TriangleMaterialMode,a=t.net.URLLoaderDataFormat,o=function(o){function h(t){"undefined"==typeof t&&(t=!0),o.call(this,a.ARRAY_BUFFER),this._useSmoothingGroups=t}return __extends(h,o),h.supportsType=function(t){return t=t.toLowerCase(),"3ds"==t},h.supportsData=function(t){var i;return i=e.ParserUtils.toByteArray(t),i&&(i.position=0,19789==i.readShort())?!0:!1},h.prototype._iResolveDependency=function(e){if(1==e.assets.length){var i;if(i=e.assets[0],i.assetType==t.library.AssetType.TEXTURE){var n;n=this._textures[e.id],n.texture=i}}},h.prototype._iResolveDependencyFailure=function(){},h.prototype._pProceedParsing=function(){for(this._byteData||(this._byteData=this._pGetByteData(),this._byteData.position=0,this._textures={},this._materials={},this._unfinalized_objects={});this._pHasTime();)if(this._cur_mat&&this._byteData.position>=this._cur_mat_end?this.finalizeCurrentMaterial():this._cur_obj&&this._byteData.position>=this._cur_obj_end&&(this._unfinalized_objects[this._cur_obj.name]=this._cur_obj,this._cur_obj_end=Number.MAX_VALUE,this._cur_obj=null),this._byteData.getBytesAvailable()>0){var i,n,r;switch(i=this._byteData.readUnsignedShort(),n=this._byteData.readUnsignedInt(),r=this._byteData.position+(n-6),i){case 19789:case 15677:case 45056:continue;case 45055:this._cur_mat_end=r,this._cur_mat=this.parseMaterial();break;case 16384:this._cur_obj_end=r,this._cur_obj=new ObjectVO,this._cur_obj.name=this.readNulTermstring(),this._cur_obj.materials=new Array,this._cur_obj.materialFaces={};break;case 16640:this._cur_obj.type=t.library.AssetType.MESH;break;case 16656:this.parseVertexList();break;case 16672:this.parseFaceList();break;case 16704:this.parseUVList();break;case 16688:this.parseFaceMaterialList();break;case 16736:this._cur_obj.transform=this.readTransform();break;case 45058:this.parseObjectAnimation(r);break;case 16720:this.parseSmoothingGroups();break;default:this._byteData.position+=n-6}if(this.dependencies.length){this._pPauseAndRetrieveDependencies();break}}if(this._byteData.getBytesAvailable()||this._cur_obj||this._cur_mat)return e.ParserBase.MORE_TO_PARSE;var s;for(s in this._unfinalized_objects){var a;a=this.constructObject(this._unfinalized_objects[s]),a&&(this._pContent.addChild(a),this._pFinalizeAsset(a,s))}return e.ParserBase.PARSING_DONE},h.prototype._pStartParsing=function(e){o.prototype._pStartParsing.call(this,e),this._pContent=new t.containers.DisplayObjectContainer},h.prototype.parseMaterial=function(){var t;for(t=new MaterialVO;this._byteData.position<this._cur_mat_end;){var e,i,n;switch(e=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedInt(),n=this._byteData.position+(i-6),e){case 40960:t.name=this.readNulTermstring();break;case 40976:t.ambientColor=this.readColor();break;case 40992:t.diffuseColor=this.readColor();break;case 41008:t.specularColor=this.readColor();break;case 41089:t.twoSided=!0;break;case 41472:t.colorMap=this.parseTexture(n);break;case 41476:t.specularMap=this.parseTexture(n);break;default:this._byteData.position=n}}return t},h.prototype.parseTexture=function(e){var i;for(i=new TextureVO;this._byteData.position<e;){var n,r;switch(n=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedInt(),n){case 41728:i.url=this.readNulTermstring();break;default:this._byteData.position+=r-6}}return this._textures[i.url]=i,this._pAddDependency(i.url,new t.net.URLRequest(i.url)),i},h.prototype.parseVertexList=function(){var t,e,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.verts=new Array(3*i),t=0,e=this._cur_obj.verts.length;e>t;){var n,r,s;n=this._byteData.readFloat(),r=this._byteData.readFloat(),s=this._byteData.readFloat(),this._cur_obj.verts[t++]=n,this._cur_obj.verts[t++]=s,this._cur_obj.verts[t++]=r}},h.prototype.parseFaceList=function(){var t,e,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.indices=new Array(3*i),t=0,e=this._cur_obj.indices.length;e>t;){var n,r,s;n=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedShort(),this._cur_obj.indices[t++]=n,this._cur_obj.indices[t++]=s,this._cur_obj.indices[t++]=r,this._byteData.position+=2}this._cur_obj.smoothingGroups=new Array(i)},h.prototype.parseSmoothingGroups=function(){for(var t=this._cur_obj.indices.length/3,e=0;t>e;)this._cur_obj.smoothingGroups[e]=this._byteData.readUnsignedInt(),e++},h.prototype.parseUVList=function(){var t,e,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.uvs=new Array(2*i),t=0,e=this._cur_obj.uvs.length;e>t;)this._cur_obj.uvs[t++]=this._byteData.readFloat(),this._cur_obj.uvs[t++]=1-this._byteData.readFloat()},h.prototype.parseFaceMaterialList=function(){var t,e,i,n;for(t=this.readNulTermstring(),e=this._byteData.readUnsignedShort(),n=new Array(e),i=0;i<n.length;)n[i++]=this._byteData.readUnsignedShort();this._cur_obj.materials.push(t),this._cur_obj.materialFaces[t]=n},h.prototype.parseObjectAnimation=function(e){var i,n,r,s,a;for(r=new t.geom.Vector3D;this._byteData.position<e;){var o,h;switch(o=this._byteData.readUnsignedShort(),h=this._byteData.readUnsignedInt(),o){case 45072:s=this.readNulTermstring(),this._byteData.position+=4,a=this._byteData.readShort();break;case 45075:r.x=this._byteData.readFloat(),r.z=this._byteData.readFloat(),r.y=this._byteData.readFloat();break;default:this._byteData.position+=h-6}}"$$$DUMMY"!=s&&this._unfinalized_objects.hasOwnProperty(s)&&(i=this._unfinalized_objects[s],n=this.constructObject(i,r),n&&(this._pContent.addChild(n),this._pFinalizeAsset(n,i.name)),delete this._unfinalized_objects[s])},h.prototype.constructObject=function(e,n){if("undefined"==typeof n&&(n=null),e.type==t.library.AssetType.MESH){var r,s,a,o,h,p,u,l;if(e.materials.length>1&&console.log("The Away3D 3DS parser does not support multiple materials per mesh at this point."),!e.indices||0==e.indices.length)return null;for(u=new Array(e.verts.length/3),l=new Array(e.indices.length/3),this.prepareData(u,l,e),this._useSmoothingGroups&&this.applySmoothGroups(u,l),e.verts=new Array(3*u.length),r=0;r<u.length;r++)e.verts[3*r]=u[r].x,e.verts[3*r+1]=u[r].y,e.verts[3*r+2]=u[r].z;for(e.indices=new Array(3*l.length),r=0;r<l.length;r++)e.indices[3*r]=l[r].a,e.indices[3*r+1]=l[r].b,e.indices[3*r+2]=l[r].c;if(e.uvs)for(e.uvs=new Array(2*u.length),r=0;r<u.length;r++)e.uvs[2*r]=u[r].u,e.uvs[2*r+1]=u[r].v;if(a=new t.base.Geometry,s=new i(!0),s.updateIndices(e.indices),s.updatePositions(e.verts),s.updateUVs(e.uvs),a.addSubGeometry(s),e.materials.length>0){var c;c=e.materials[0],o=this._materials[c].material}if(n){if(e.transform){var d=e.transform.concat();d[12]=0,d[13]=0,d[14]=0,p=new t.geom.Matrix3D(d),n=p.transformVector(n)}n.scaleBy(-1),p=new t.geom.Matrix3D,p.appendTranslation(n.x,n.y,n.z),a.applyTransformation(p)}return e.transform&&(p=new t.geom.Matrix3D(e.transform),p.invert(),a.applyTransformation(p)),this._pFinalizeAsset(a,e.name.concat("_geom")),h=new t.entities.Mesh(a,o),h.transform.matrix3D=new t.geom.Matrix3D(e.transform),h}return null},h.prototype.prepareData=function(t,e,i){var n,r,s,a=i.verts.length;for(n=0,r=0,s=0;a>n;){var o=new VertexVO;o.x=i.verts[n++],o.y=i.verts[n++],o.z=i.verts[n++],i.uvs&&(o.u=i.uvs[r++],o.v=i.uvs[r++]),t[s++]=o}for(a=i.indices.length,n=0,s=0;a>n;){var h=new FaceVO;h.a=i.indices[n++],h.b=i.indices[n++],h.c=i.indices[n++],h.smoothGroup=i.smoothingGroups[s]||0,e[s++]=h}},h.prototype.applySmoothGroups=function(t,e){var i,n,r,s,a,o=t.length,h=e.length,p=new Array(o);for(i=0;o>i;i++)p[i]=new Array;for(i=0;h>i;i++){var u=e[i];for(n=0;3>n;n++){var l=p[0==n?u.a:1==n?u.b:u.c],c=u.smoothGroup;for(r=l.length-1;r>=0;r--)(c&l[r])>0&&(c|=l[r],l.splice(r,1),r=l.length-1);l.push(c)}}var d=new Array(o);for(i=0;o>i;i++)if(!((a=p[i].length)<1)){var _=new Array(a);d[i]=_,_[0]=i;var f=t[i];for(n=1;a>n;n++){var g=new VertexVO;g.x=f.x,g.y=f.y,g.z=f.z,g.u=f.u,g.v=f.v,_[n]=t.length,t.push(g)}}for(o=t.length,i=0;h>i;i++)for(u=e[i],c=u.smoothGroup,n=0;3>n;n++)for(r=0==n?u.a:1==n?u.b:u.c,l=p[r],a=l.length,_=d[r],s=0;a>s;s++)if(0==c&&0==l[s]||(c&l[s])>0){var m=_[s];0==c&&(l.splice(s,1),_.splice(s,1)),0==n?u.a=m:1==n?u.b=m:u.c=m,s=a}},h.prototype.finalizeCurrentMaterial=function(){var t;t=new r(this._cur_mat.colorMap?this._cur_mat.colorMap.texture||n.getDefaultTexture():this._cur_mat.diffuseColor),t.ambientColor=this._cur_mat.ambientColor,t.specularColor=this._cur_mat.specularColor,this.materialMode>=2&&(t.materialMode=s.MULTI_PASS),t.bothSides=this._cur_mat.twoSided,this._pFinalizeAsset(t,this._cur_mat.name),this._materials[this._cur_mat.name]=this._cur_mat,this._cur_mat.material=t,this._cur_mat=null},h.prototype.readNulTermstring=function(){for(var t,e="";(t=this._byteData.readUnsignedByte())>0;)e+=String.fromCharCode(t);return e},h.prototype.readTransform=function(){var t;return t=new Array(16),t[0]=this._byteData.readFloat(),t[2]=this._byteData.readFloat(),t[1]=this._byteData.readFloat(),t[3]=0,t[8]=this._byteData.readFloat(),t[10]=this._byteData.readFloat(),t[9]=this._byteData.readFloat(),t[11]=0,t[4]=this._byteData.readFloat(),t[6]=this._byteData.readFloat(),t[5]=this._byteData.readFloat(),t[7]=0,t[12]=this._byteData.readFloat(),t[14]=this._byteData.readFloat(),t[13]=this._byteData.readFloat(),t[15]=1,t},h.prototype.readColor=function(){var t,e,i,n,r;switch(t=this._byteData.readUnsignedShort(),e=this._byteData.readUnsignedInt(),t){case 16:i=255*this._byteData.readFloat(),n=255*this._byteData.readFloat(),r=255*this._byteData.readFloat();break;case 17:i=this._byteData.readUnsignedByte(),n=this._byteData.readUnsignedByte(),r=this._byteData.readUnsignedByte();break;default:this._byteData.position+=e-6}return i<<16|n<<8|r},h}(e.ParserBase);e.Max3DSParser=o}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var Vector3D=away.geom.Vector3D,TextureVO=function(){function t(){}return t}(),MaterialVO=function(){function t(){}return t}(),ObjectVO=function(){function t(){}return t}(),VertexVO=function(){function t(){}return t}(),FaceVO=function(){function t(){}return t}(),away;!function(t){!function(e){var i=t.base.Geometry,n=t.base.TriangleSubGeometry,r=t.animators.VertexAnimationSet,s=t.animators.VertexClipNode,a=t.materials.DefaultMaterialManager,o=t.materials.TriangleMaterial,h=t.materials.TriangleMaterialMode,p=t.net.URLLoaderDataFormat,u=function(u){function l(t,e){"undefined"==typeof t&&(t="jpg"),"undefined"==typeof e&&(e=!0),u.call(this,p.ARRAY_BUFFER),this._clipNodes=new Object,this._animationSet=new r,this.materialFinal=!1,this.geoCreated=!1,this._textureType=t,this._ignoreTexturePath=e}return __extends(l,u),l.supportsType=function(t){return t=t.toLowerCase(),"md2"==t},l.supportsData=function(t){return"IDP2"==e.ParserUtils.toString(t,4)},l.prototype._iResolveDependency=function(t){if(1==t.assets.length){var e=t.assets[0];if(e){var i=new o(e);this.materialMode>=2&&(i.materialMode=h.MULTI_PASS),this._pContent.addChild(this._mesh),i.name=this._mesh.material.name,this._mesh.material=i,this._pFinalizeAsset(i),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)}this.materialFinal=!0}},l.prototype._iResolveDependencyFailure=function(){this.materialMode<2?this._mesh.material=a.getDefaultMaterial():(this._mesh.material=new o(t.materials.DefaultMaterialManager.getDefaultTexture()),this._mesh.material.materialMode=h.MULTI_PASS),this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh),this.materialFinal=!0},l.prototype._pProceedParsing=function(){for(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0,this._byteData.position=0);this._pHasTime();)if(this._parsedHeader)if(this._parsedUV)if(this._parsedFaces)if(this._parsedFrames){if(this.geoCreated&&this.materialFinal)return t.parsers.ParserBase.PARSING_DONE;this.geoCreated||(this.geoCreated=!0,this._geometry.addSubGeometry(this._firstSubGeom.clone()),this._mesh.name="",this.materialFinal&&(this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)),this._pPauseAndRetrieveDependencies())}else this.parseFrames();else this.parseFaces();else this.parseUV();else this._geometry=new i,this._mesh=new t.entities.Mesh(this._geometry,null),this.materialMode<2?this._mesh.material=a.getDefaultMaterial():(this._mesh.material=new o(a.getDefaultTexture()),this._mesh.material.materialMode=h.MULTI_PASS),this.parseHeader(),this.parseMaterialNames();return t.parsers.ParserBase.MORE_TO_PARSE},l.prototype._pStartParsing=function(e){u.prototype._pStartParsing.call(this,e),this._pContent=new t.containers.DisplayObjectContainer},l.prototype.parseHeader=function(){this._ident=this._byteData.readInt(),this._version=this._byteData.readInt(),this._skinWidth=this._byteData.readInt(),this._skinHeight=this._byteData.readInt(),this._byteData.readInt(),this._numSkins=this._byteData.readInt(),this._numVertices=this._byteData.readInt(),this._numST=this._byteData.readInt(),this._numTris=this._byteData.readInt(),this._byteData.readInt(),this._numFrames=this._byteData.readInt(),this._offsetSkins=this._byteData.readInt(),this._offsetST=this._byteData.readInt(),this._offsetTris=this._byteData.readInt(),this._offsetFrames=this._byteData.readInt(),this._byteData.readInt(),this._offsetEnd=this._byteData.readInt(),this._parsedHeader=!0},l.prototype.parseMaterialNames=function(){var e,i,n,r;this._materialNames=new Array,this._byteData.position=this._offsetSkins;for(var s=new RegExp("[^a-zA-Z0-9\\_/.]","g"),a=0;a<this._numSkins;++a)i=this._byteData.readUTFBytes(64),i=i.replace(s,""),n=i.lastIndexOf("."),this._ignoreTexturePath&&(r=i.lastIndexOf("/")),-1==i.toLowerCase().indexOf(".jpg")&&-1==i.toLowerCase().indexOf(".png")?(i=i.substring(r+1,n),e=i+"."+this._textureType):e=i,this._materialNames[a]=i,0==this.dependencies.length&&this._pAddDependency(i,new t.net.URLRequest(e));this._materialNames.length>0?this._mesh.material.name=this._materialNames[0]:this.materialFinal=!0},l.prototype.parseUV=function(){var t=0;this._uvs=new Array(2*this._numST),this._byteData.position=this._offsetST;for(var e=0;e<this._numST;e++)this._uvs[t++]=this._byteData.readShort()/this._skinWidth,this._uvs[t++]=this._byteData.readShort()/this._skinHeight;this._parsedUV=!0},l.prototype.parseFaces=function(){var t,e,i,n,r,s,a;for(this._vertIndices=new Array,this._uvIndices=new Array,this._indices=new Array,this._byteData.position=this._offsetTris,a=0;a<this._numTris;a++)t=this._byteData.readUnsignedShort(),e=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedShort(),n=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedShort(),this.addIndex(t,n),this.addIndex(e,r),this.addIndex(i,s);var o=this._uvIndices.length;for(this._finalUV=new Array(2*o),a=0;o>a;++a)this._finalUV[a<<1]=this._uvs[this._uvIndices[a]<<1],this._finalUV[(a<<1)+1]=this._uvs[(this._uvIndices[a]<<1)+1];this._parsedFaces=!0},l.prototype.addIndex=function(t,e){var i=this.findIndex(t,e);-1==i?(this._indices.push(this._vertIndices.length),this._vertIndices.push(t),this._uvIndices.push(e)):this._indices.push(i)},l.prototype.findIndex=function(t,e){for(var i=this._vertIndices.length,n=0;i>n;++n)if(this._vertIndices[n]==t&&this._uvIndices[n]==e)return n;return-1},l.prototype.parseFrames=function(){var e,r,a,o,h,p,u,l,c,d,_,f,g,m=this._vertIndices.length,y="",b=null;for(this._byteData.position=this._offsetFrames,_=0;_<this._numFrames;_++){for(d=new Array,c=new Array(3*m),e=this._byteData.readFloat(),r=this._byteData.readFloat(),a=this._byteData.readFloat(),o=this._byteData.readFloat(),h=this._byteData.readFloat(),p=this._byteData.readFloat(),y=this.readFrameName(),f=0;f<this._numVertices;f++,this._byteData.position++)d.push(e*this._byteData.readUnsignedByte()+o,r*this._byteData.readUnsignedByte()+h,a*this._byteData.readUnsignedByte()+p);for(g=0,f=0;m>f;f++)c[g++]=d[3*this._vertIndices[f]],c[g++]=d[3*this._vertIndices[f]+2],c[g++]=d[3*this._vertIndices[f]+1];l=new n(!0),null==this._firstSubGeom&&(this._firstSubGeom=l),u=new i,u.addSubGeometry(l),l.updateIndices(this._indices),l.updatePositions(c),l.updateUVs(this._finalUV),l.vertexNormals,l.vertexTangents,l.autoDeriveNormals=!1,l.autoDeriveTangents=!1;var x=this._clipNodes[y];x||(b&&(this._pFinalizeAsset(b),this._animationSet.addAnimation(b)),x=new s,x.name=y,x.stitchFinalFrame=!0,this._clipNodes[y]=x,b=x),x.addFrame(u,1e3/t.parsers.MD2Parser.FPS)}b&&(this._pFinalizeAsset(b),this._animationSet.addAnimation(b)),this._pFinalizeAsset(this._animationSet),this._parsedFrames=!0},l.prototype.readFrameName=function(){for(var t="",e=0,i=0;16>i;i++){var n=this._byteData.readUnsignedByte();Math.floor(n)>57&&Math.floor(n)<=122&&0==e&&(t+=String.fromCharCode(n)),Math.floor(n)>=48&&Math.floor(n)<=57&&e++}return t},l.FPS=6,l}(e.ParserBase);e.MD2Parser=u}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(e){var i=t.animators.JointPose,n=t.animators.SkeletonPose,r=t.animators.SkeletonClipNode,s=t.geom.Quaternion,a=t.geom.Vector3D,o=t.net.URLLoaderDataFormat,h=function(t){function h(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),t.call(this,o.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new s;var n=new s,r=new s;n.fromAxisAngle(a.X_AXIS,.5*-Math.PI),r.fromAxisAngle(a.Y_AXIS,.5*-Math.PI),this._rotationQuat.multiply(r,n),e&&(this._rotationQuat.multiply(r,n),n.fromAxisAngle(e,i),this._rotationQuat.multiply(n,this._rotationQuat))}return __extends(h,t),h.supportsType=function(t){return t=t.toLowerCase(),"md5anim"==t},h.supportsData=function(){return!1},h.prototype._pProceedParsing=function(){var t;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(t=this.getNextToken()){case h.COMMENT_TOKEN:this.ignoreLine();break;case"":break;case h.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case h.COMMAND_LINE_TOKEN:this.parseCMD();break;case h.NUM_FRAMES_TOKEN:this._numFrames=this.getNextInt(),this._bounds=new Array,this._frameData=new Array;break;case h.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._hierarchy=new Array(this._numJoints),this._baseFrameData=new Array(this._numJoints);break;case h.FRAME_RATE_TOKEN:this._frameRate=this.getNextInt();break;case h.NUM_ANIMATED_COMPONENTS_TOKEN:this._numAnimatedComponents=this.getNextInt();break;case h.HIERARCHY_TOKEN:this.parseHierarchy();break;case h.BOUNDS_TOKEN:this.parseBounds();break;case h.BASE_FRAME_TOKEN:this.parseBaseFrame();break;case h.FRAME_TOKEN:this.parseFrame();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF)return this._clip=new r,this.translateClip(),this._pFinalizeAsset(this._clip),e.ParserBase.PARSING_DONE}return e.ParserBase.MORE_TO_PARSE},h.prototype.translateClip=function(){for(var t=0;t<this._numFrames;++t)this._clip.addFrame(this.translatePose(this._frameData[t]),1e3/this._frameRate)},h.prototype.translatePose=function(t){for(var e,r,o,h,p,u=new a,l=new s,c=t.components,d=new n,_=d.jointPoses,f=0;f<this._numJoints;++f){p=0,r=new i,e=this._hierarchy[f],o=this._baseFrameData[f],h=e.flags,u.x=o.position.x,u.y=o.position.y,u.z=o.position.z,l.x=o.orientation.x,l.y=o.orientation.y,l.z=o.orientation.z,1&h&&(u.x=c[e.startIndex+p++]),2&h&&(u.y=c[e.startIndex+p++]),4&h&&(u.z=c[e.startIndex+p++]),8&h&&(l.x=c[e.startIndex+p++]),16&h&&(l.y=c[e.startIndex+p++]),32&h&&(l.z=c[e.startIndex+p++]);var g=1-l.x*l.x-l.y*l.y-l.z*l.z;l.w=0>g?0:-Math.sqrt(g),e.parentIndex<0?(r.orientation.multiply(this._rotationQuat,l),r.translation=this._rotationQuat.rotatePoint(u)):(r.orientation.copyFrom(l),r.translation.x=u.x,r.translation.y=u.y,r.translation.z=u.z),r.orientation.y=-r.orientation.y,r.orientation.z=-r.orientation.z,r.translation.x=-r.translation.x,_[f]=r}return d},h.prototype.parseHierarchy=function(){var t,e,i=this.getNextToken(),n=0;"{"!=i&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),e=new HierarchyData,e.name=this.parseLiteralstring(),e.parentIndex=this.getNextInt(),e.flags=this.getNextInt(),e.startIndex=this.getNextInt(),this._hierarchy[n++]=e,t=this.getNextChar(),"/"==t&&(this.putBack(),t=this.getNextToken(),t==h.COMMENT_TOKEN&&this.ignoreLine(),t=this.getNextChar()),"}"!=t&&this.putBack();while("}"!=t)},h.prototype.parseBounds=function(){var t,e,i=this.getNextToken(),n=0;"{"!=i&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),e=new BoundsData,e.min=this.parseVector3D(),e.max=this.parseVector3D(),this._bounds[n++]=e,t=this.getNextChar(),"/"==t&&(this.putBack(),t=this.getNextToken(),t==h.COMMENT_TOKEN&&this.ignoreLine(),t=this.getNextChar()),"}"!=t&&this.putBack();while("}"!=t)},h.prototype.parseBaseFrame=function(){var t,e,i=this.getNextToken(),n=0;"{"!=i&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),e=new BaseFrameData,e.position=this.parseVector3D(),e.orientation=this.parseQuaternion(),this._baseFrameData[n++]=e,t=this.getNextChar(),"/"==t&&(this.putBack(),t=this.getNextToken(),t==h.COMMENT_TOKEN&&this.ignoreLine(),t=this.getNextChar()),"}"!=t&&this.putBack();while("}"!=t)},h.prototype.parseFrame=function(){var t,e,i,n;n=this.getNextInt(),i=this.getNextToken(),"{"!=i&&this.sendUnknownKeywordError();do{this._reachedEOF&&this.sendEOFError(),e=new FrameData,e.components=new Array(this._numAnimatedComponents);for(var r=0;r<this._numAnimatedComponents;++r)e.components[r]=this.getNextNumber();this._frameData[n]=e,t=this.getNextChar(),"/"==t&&(this.putBack(),t=this.getNextToken(),t==h.COMMENT_TOKEN&&this.ignoreLine(),t=this.getNextChar()),"}"!=t&&this.putBack()}while("}"!=t)},h.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},h.prototype.getNextToken=function(){for(var t,e="";!this._reachedEOF;){if(t=this.getNextChar()," "==t||"\r"==t||"\n"==t||"	"==t){if(e!=h.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=e)return e}else e+=t;if(e==h.COMMENT_TOKEN)return e}return e},h.prototype.skipWhiteSpace=function(){var t;do t=this.getNextChar();while("\n"==t||" "==t||"\r"==t||"	"==t);this.putBack()},h.prototype.ignoreLine=function(){for(var t;!this._reachedEOF&&"\n"!=t;)t=this.getNextChar()},h.prototype.getNextChar=function(){var t=this._textData.charAt(this._parseIndex++);return"\n"==t?(++this._line,this._charLineIndex=0):"\r"!=t&&++this._charLineIndex,this._parseIndex==this._textData.length&&(this._reachedEOF=!0),t},h.prototype.getNextInt=function(){var t=parseInt(this.getNextToken());return isNaN(t)&&this.sendParseError("int type"),t},h.prototype.getNextNumber=function(){var t=parseFloat(this.getNextToken());return isNaN(t)&&this.sendParseError("float type"),t},h.prototype.parseVector3D=function(){var t=new a,e=this.getNextToken();return"("!=e&&this.sendParseError("("),t.x=this.getNextNumber(),t.y=this.getNextNumber(),t.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),t},h.prototype.parseQuaternion=function(){var t=new s,e=this.getNextToken();"("!=e&&this.sendParseError("("),t.x=this.getNextNumber(),t.y=this.getNextNumber(),t.z=this.getNextNumber();var i=1-t.x*t.x-t.y*t.y-t.z*t.z;return t.w=0>i?0:-Math.sqrt(i),")"!=this.getNextToken()&&this.sendParseError(")"),t},h.prototype.parseCMD=function(){this.parseLiteralstring()},h.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var t=this.getNextChar(),e="";'"'!=t&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),t=this.getNextChar(),'"'!=t&&(e+=t);while('"'!=t);return e},h.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},h.prototype.sendParseError=function(t){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+t+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},h.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},h.VERSION_TOKEN="MD5Version",h.COMMAND_LINE_TOKEN="commandline",h.NUM_FRAMES_TOKEN="numFrames",h.NUM_JOINTS_TOKEN="numJoints",h.FRAME_RATE_TOKEN="frameRate",h.NUM_ANIMATED_COMPONENTS_TOKEN="numAnimatedComponents",h.HIERARCHY_TOKEN="hierarchy",h.BOUNDS_TOKEN="bounds",h.BASE_FRAME_TOKEN="baseframe",h.FRAME_TOKEN="frame",h.COMMENT_TOKEN="//",h}(e.ParserBase);e.MD5AnimParser=h}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var HierarchyData=function(){function t(){}return t.prototype.HierarchyData=function(){},t}(),BoundsData=function(){function t(){}return t.prototype.BoundsData=function(){},t}(),BaseFrameData=function(){function t(){}return t.prototype.BaseFrameData=function(){},t}(),FrameData=function(){function t(){}return t.prototype.FrameData=function(){},t}(),away;!function(t){!function(e){var i=t.animators.SkeletonAnimationSet,n=t.animators.Skeleton,r=t.animators.SkeletonJoint,s=t.base.Geometry,a=t.base.TriangleSubGeometry,o=t.geom.Quaternion,h=t.geom.Vector3D,p=t.entities.Mesh,u=t.net.URLLoaderDataFormat,l=function(l){function c(t,e){if("undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=0),l.call(this,u.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new o,this._rotationQuat.fromAxisAngle(h.X_AXIS,.5*-Math.PI),t){var i=new o;i.fromAxisAngle(t,e),this._rotationQuat.multiply(this._rotationQuat,i)}}return __extends(c,l),c.supportsType=function(t){return t=t.toLowerCase(),"md5mesh"==t},c.supportsData=function(){return!1},c.prototype._pProceedParsing=function(){var t;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(t=this.getNextToken()){case c.COMMENT_TOKEN:this.ignoreLine();break;case c.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case c.COMMAND_LINE_TOKEN:this.parseCMD();break;case c.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._bindPoses=new Array(this._numJoints);break;case c.NUM_MESHES_TOKEN:this._numMeshes=this.getNextInt();break;case c.JOINTS_TOKEN:this.parseJoints();break;case c.MESH_TOKEN:this.parseMesh();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF){this.calculateMaxJointCount(),this._animationSet=new i(this._maxJointCount),this._mesh=new p(new s,null),this._geometry=this._mesh.geometry;for(var n=0;n<this._meshData.length;++n)this._geometry.addSubGeometry(this.translateGeom(this._meshData[n].vertexData,this._meshData[n].weightData,this._meshData[n].indices));return this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._geometry),this._pFinalizeAsset(this._mesh),this._pFinalizeAsset(this._skeleton),this._pFinalizeAsset(this._animationSet),e.ParserBase.PARSING_DONE}}return e.ParserBase.MORE_TO_PARSE},c.prototype._pStartParsing=function(e){l.prototype._pStartParsing.call(this,e),this._pContent=new t.containers.DisplayObjectContainer},c.prototype.calculateMaxJointCount=function(){this._maxJointCount=0;for(var t=this._meshData.length,e=0;t>e;++e)for(var i=this._meshData[e],n=i.vertexData,r=n.length,s=0;r>s;++s){var a=this.countZeroWeightJoints(n[s],i.weightData),o=n[s].countWeight-a;o>this._maxJointCount&&(this._maxJointCount=o)}},c.prototype.countZeroWeightJoints=function(t,e){for(var i,n=t.startWeight,r=t.startWeight+t.countWeight,s=0,a=n;r>a;++a)i=e[a].bias,0==i&&++s;return s},c.prototype.parseJoints=function(){var t,e,i,s,a=0,o=this.getNextToken();"{"!=o&&this.sendUnknownKeywordError(),this._skeleton=new n;do{this._reachedEOF&&this.sendEOFError(),e=new r,e.name=this.parseLiteralstring(),e.parentIndex=this.getNextInt(),i=this.parseVector3D(),i=this._rotationQuat.rotatePoint(i),s=this.parseQuaternion(),this._bindPoses[a]=s.toMatrix3D(),this._bindPoses[a].appendTranslation(i.x,i.y,i.z);var h=this._bindPoses[a].clone();h.invert(),e.inverseBindPose=h.rawData,this._skeleton.joints[a++]=e,t=this.getNextChar(),"/"==t&&(this.putBack(),t=this.getNextToken(),t==c.COMMENT_TOKEN&&this.ignoreLine(),t=this.getNextChar()),"}"!=t&&this.putBack()}while("}"!=t)},c.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},c.prototype.parseMesh=function(){var t,e,i,n,r=this.getNextToken();for("{"!=r&&this.sendUnknownKeywordError(),null==this._shaders&&(this._shaders=new Array);"}"!=t;)switch(t=this.getNextToken()){case c.COMMENT_TOKEN:this.ignoreLine();break;case c.MESH_SHADER_TOKEN:this._shaders.push(this.parseLiteralstring());break;case c.MESH_NUM_VERTS_TOKEN:e=new Array(this.getNextInt());break;case c.MESH_NUM_TRIS_TOKEN:n=new Array(3*this.getNextInt());break;case c.MESH_NUM_WEIGHTS_TOKEN:i=new Array(this.getNextInt());
break;case c.MESH_VERT_TOKEN:this.parseVertex(e);break;case c.MESH_TRI_TOKEN:this.parseTri(n);break;case c.MESH_WEIGHT_TOKEN:this.parseJoint(i)}null==this._meshData&&(this._meshData=new Array);var s=this._meshData.length;this._meshData[s]=new MeshData,this._meshData[s].vertexData=e,this._meshData[s].weightData=i,this._meshData[s].indices=n},c.prototype.translateGeom=function(t,e,i){for(var n,r,s,o,h,p,u,l,c=t.length,d=new a(!0),_=new Array(2*c),f=new Array(3*c),g=new Array(c*this._maxJointCount),m=new Array(c*this._maxJointCount),y=0,b=0;c>b;++b){o=t[b],n=3*o.index,r=n+1,s=n+2,f[n]=f[r]=f[s]=0,l=0;for(var x=0;x<o.countWeight;++x)h=e[o.startWeight+x],h.bias>0&&(p=this._bindPoses[h.joint],u=p.transformVector(h.pos),f[n]+=u.x*h.bias,f[r]+=u.y*h.bias,f[s]+=u.z*h.bias,g[y]=3*h.joint,m[y++]=h.bias,++l);for(x=l;x<this._maxJointCount;++x)g[y]=0,m[y++]=0;n=o.index<<1,_[n++]=o.s,_[n]=o.t}return d.jointsPerVertex=this._maxJointCount,d.updateIndices(i),d.updatePositions(f),d.updateUVs(_),d.updateJointIndices(g),d.updateJointWeights(m),d.vertexNormals,d.vertexTangents,d.autoDeriveTangents=!1,d.autoDeriveNormals=!1,d},c.prototype.parseTri=function(t){var e=3*this.getNextInt();t[e]=this.getNextInt(),t[e+1]=this.getNextInt(),t[e+2]=this.getNextInt()},c.prototype.parseJoint=function(t){var e=new JointData;e.index=this.getNextInt(),e.joint=this.getNextInt(),e.bias=this.getNextNumber(),e.pos=this.parseVector3D(),t[e.index]=e},c.prototype.parseVertex=function(t){var e=new VertexData;e.index=this.getNextInt(),this.parseUV(e),e.startWeight=this.getNextInt(),e.countWeight=this.getNextInt(),t[e.index]=e},c.prototype.parseUV=function(t){var e=this.getNextToken();"("!=e&&this.sendParseError("("),t.s=this.getNextNumber(),t.t=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")")},c.prototype.getNextToken=function(){for(var t,e="";!this._reachedEOF;){if(t=this.getNextChar()," "==t||"\r"==t||"\n"==t||"	"==t){if(e!=c.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=e)return e}else e+=t;if(e==c.COMMENT_TOKEN)return e}return e},c.prototype.skipWhiteSpace=function(){var t;do t=this.getNextChar();while("\n"==t||" "==t||"\r"==t||"	"==t);this.putBack()},c.prototype.ignoreLine=function(){for(var t;!this._reachedEOF&&"\n"!=t;)t=this.getNextChar()},c.prototype.getNextChar=function(){var t=this._textData.charAt(this._parseIndex++);return"\n"==t?(++this._line,this._charLineIndex=0):"\r"!=t&&++this._charLineIndex,this._parseIndex>=this._textData.length&&(this._reachedEOF=!0),t},c.prototype.getNextInt=function(){var t=parseInt(this.getNextToken());return isNaN(t)&&this.sendParseError("int type"),t},c.prototype.getNextNumber=function(){var t=parseFloat(this.getNextToken());return isNaN(t)&&this.sendParseError("float type"),t},c.prototype.parseVector3D=function(){var t=new h,e=this.getNextToken();return"("!=e&&this.sendParseError("("),t.x=-this.getNextNumber(),t.y=this.getNextNumber(),t.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),t},c.prototype.parseQuaternion=function(){var t=new o,e=this.getNextToken();"("!=e&&this.sendParseError("("),t.x=this.getNextNumber(),t.y=-this.getNextNumber(),t.z=-this.getNextNumber();var i=1-t.x*t.x-t.y*t.y-t.z*t.z;t.w=0>i?0:-Math.sqrt(i),")"!=this.getNextToken()&&this.sendParseError(")");var n=new o;return n.multiply(this._rotationQuat,t),n},c.prototype.parseCMD=function(){this.parseLiteralstring()},c.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var t=this.getNextChar(),e="";'"'!=t&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),t=this.getNextChar(),'"'!=t&&(e+=t);while('"'!=t);return e},c.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},c.prototype.sendParseError=function(t){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+t+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},c.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},c.VERSION_TOKEN="MD5Version",c.COMMAND_LINE_TOKEN="commandline",c.NUM_JOINTS_TOKEN="numJoints",c.NUM_MESHES_TOKEN="numMeshes",c.COMMENT_TOKEN="//",c.JOINTS_TOKEN="joints",c.MESH_TOKEN="mesh",c.MESH_SHADER_TOKEN="shader",c.MESH_NUM_VERTS_TOKEN="numverts",c.MESH_VERT_TOKEN="vert",c.MESH_NUM_TRIS_TOKEN="numtris",c.MESH_TRI_TOKEN="tri",c.MESH_NUM_WEIGHTS_TOKEN="numweights",c.MESH_WEIGHT_TOKEN="weight",c}(e.ParserBase);e.MD5MeshParser=l}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var VertexData=function(){function t(){}return t}(),JointData=function(){function t(){}return t}(),MeshData=function(){function t(){}return t}(),away;!function(t){!function(e){var i=t.library.AssetLoader,n=function(){function t(){}return t.enableAllBundled=function(){i.enableParsers(t.ALL_BUNDLED)},t.ALL_BUNDLED=Array(e.AWDParser,e.Max3DSParser,e.MD2Parser,e.OBJParser),t}();e.Parsers=n}(t.parsers||(t.parsers={})),t.parsers}(away||(away={}));var away;!function(t){!function(e){var i=t.base.Geometry,n=t.base.TriangleSubGeometry,r=t.geom.Matrix3DUtils,s=t.entities.Mesh,a=function(){function t(t,e,i){"undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=!1),this._keepMaterial=t,this._disposeSources=e,this._objectSpace=i}return Object.defineProperty(t.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(t){this._disposeSources=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(t){this._keepMaterial=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(t){this._objectSpace=t},enumerable:!0,configurable:!0}),t.prototype.applyToContainer=function(t,e){this.reset(),this.parseContainer(t,e),this.collect(t,!1),this.merge(t,this._disposeSources)},t.prototype.applyToMeshes=function(t,e){if(this.reset(),e.length){for(var i=0;i<e.length;i++)e[i]!=t&&this.collect(e[i],this._disposeSources);this.collect(t,!1),this.merge(t,this._disposeSources)}},t.prototype.apply=function(t,e){this.reset(),this.collect(e,this._disposeSources),this.collect(t,!1),this.merge(t,this._disposeSources)},t.prototype.reset=function(){this._toDispose=new Array,this._geomVOs=new Array},t.prototype.merge=function(t,e){var r,s,a,o,h;for(a=t.geometry,o=t.geometry=new i,s=t.subMeshes.length,h=this._geomVOs.length>1,r=0;r<this._geomVOs.length;r++){var p,u=new n(!0);u.autoDeriveNormals=!1,u.autoDeriveTangents=!1,p=this._geomVOs[r],u.updateIndices(p.indices),u.updatePositions(p.vertices),u.updateVertexNormals(p.normals),u.updateVertexTangents(p.tangents),u.updateUVs(p.uvs),o.addSubGeometry(u),this._keepMaterial&&h&&(t.subMeshes[s].material=p.material)}if(this._keepMaterial&&!h&&this._geomVOs.length&&(t.material=this._geomVOs[0].material),e){for(var l,r,c=this._toDispose.length;c>r;r++)l=this._toDispose[r],l.geometry.dispose(),l.dispose();a.dispose()}this._toDispose=null},t.prototype.collect=function(t,e){if(t.geometry){var i,n,s=t.geometry.subGeometries;for(i=0;i<s.length;i++){var a,o,h,p,u,l,c,d,_,f,g,m,y,b,x,v,w;for(_=s[i],b=_.positions,x=_.vertexNormals,v=_.vertexTangents,w=_.uvs,f=this.getSubGeomData(t.subMeshes[i].material||t.material),g=this._objectSpace?f.vertices:new Array,m=this._objectSpace?f.normals:new Array,y=this._objectSpace?f.tangents:new Array,p=g.length,u=m.length,l=y.length,c=f.uvs.length,o=_.numVertices,a=0;o>a;a++)n=3*a,g[p++]=b[n],g[p++]=b[n+1],g[p++]=b[n+2],m[u++]=x[n],m[u++]=x[n+1],m[u++]=x[n+2],y[l++]=v[n],y[l++]=v[n+1],y[l++]=v[n+2],f.uvs[c++]=w[2*a],f.uvs[c++]=w[2*a+1];for(d=this._objectSpace?0:f.vertices.length/3,h=f.indices.length,o=_.numTriangles,a=0;o>a;a++)n=3*a,f.indices[h++]=_.indices[n]+d,f.indices[h++]=_.indices[n+1]+d,f.indices[h++]=_.indices[n+2]+d;if(!this._objectSpace)for(t.sceneTransform.transformVectors(g,g),r.deltaTransformVectors(t.sceneTransform,m,m),r.deltaTransformVectors(t.sceneTransform,y,y),p=f.vertices.length,u=f.normals.length,l=f.tangents.length,o=g.length,a=0;o>a;a++)f.vertices[p++]=g[a],f.normals[u++]=m[a],f.tangents[l++]=y[a]}e&&this._toDispose.push(t)}},t.prototype.getSubGeomData=function(t){var e;if(this._keepMaterial){var i,n;for(n=this._geomVOs.length,i=0;n>i;i++)if(this._geomVOs[i].material==t){e=this._geomVOs[i];break}}else this._geomVOs.length&&(e=this._geomVOs[0]);return e||(e=new GeometryVO,e.vertices=new Array,e.normals=new Array,e.tangents=new Array,e.uvs=new Array,e.indices=new Array,e.material=t,this._geomVOs.push(e)),e},t.prototype.parseContainer=function(t,e){var i,n;for(e instanceof s&&e!=t&&this.collect(e,this._disposeSources),n=0;n<e.numChildren;++n)i=e.getChildAt(n),this.parseContainer(t,i)},t}();e.Merge=a}(t.commands||(t.commands={})),t.commands}(away||(away={}));var GeometryVO=function(){function t(){}return t}(),away;!function(t){!function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(t){this._defaultUVTransform=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(t){this._defaultVertexTransform=t,this._defaultInvVertexTransform=t.clone(),this._defaultInvVertexTransform.invert(),this._defaultInvVertexTransform.transpose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:!0,configurable:!0}),t}();t.ParticleGeometryTransform=e}(t.tools||(t.tools={})),t.tools}(away||(away={}));var away;!function(t){!function(e){var i=t.animators.ParticleData,n=t.base.ParticleGeometry,r=t.base.TriangleSubGeometry,s=t.geom.Point,a=t.geom.Vector3D,o=function(){function t(){}return t.generateGeometry=function(e,o){"undefined"==typeof o&&(o=null);var h,p,u,l,c,d,_,f,g,m,y,b,x=new Array,v=new Array,w=new Array,D=new Array,C=new Array,S=new Array,P=new Array,A=new Array,T=e.length,M=new Array,E=new a,O=new a,R=new a,I=new s;for(y=0;T>y;y++){h=e[y].subGeometries,u=h.length;for(var N=0;u>N;N++){M.length<=N&&(M.push(A.length),x.push(new Array),v.push(new Array),w.push(new Array),D.push(new Array),C.push(new Array),A.push(new r(!0)),S.push(0)),p=h[N],p.numVertices+S[M[N]]>t.MAX_VERTEX&&(M[N]=A.length,x.push(new Array),v.push(new Array),w.push(new Array),D.push(new Array),C.push(new Array),A.push(new r(!0)),S.push(0)),b=M[N],l=x[b],c=v[b],d=w[b],_=D[b],f=C[b],g=S[b],m=A[b];var L=new i;L.numVertices=p.numVertices,L.startVertexIndex=g,L.particleIndex=y,L.subGeometry=m,P.push(L),S[b]+=p.numVertices;var F,V,U,B,j,z,k,G=p;if(G)if(V=G.numVertices,G.numTriangles,B=G.positions,j=G.vertexNormals,z=G.vertexTangents,k=G.uvs,o){var H=o[y],X=H.vertexTransform,W=H.invVertexTransform,Y=H.UVTransform;for(F=0;V>F;F++)U=3*F,E.x=B[U],E.y=B[U+1],E.z=B[U+2],O.x=j[U],O.y=j[U+1],O.z=j[U+2],R.x=z[U],R.y=z[U+1],R.z=z[U+2],I.x=k[2*F],I.y=k[2*F+1],X&&(E=X.transformVector(E),O=W.deltaTransformVector(O),R=W.deltaTransformVector(O)),Y&&(I=Y.transformPoint(I)),B.push(E.x,E.y,E.z),j.push(O.x,O.y,O.z),z.push(R.x,R.y,R.z),k.push(I.x,I.y)}else for(F=0;V>F;F++)U=3*F,c.push(B[U],B[U+1],B[U+2]),d.push(j[U],j[U+1],j[U+2]),_.push(z[U],z[U+1],z[U+2]),f.push(k[2*F],k[2*F+1]);var Z=p.indices;for(V=p.numTriangles,F=0;V>F;F++)U=3*F,l.push(Z[U]+g,Z[U+1]+g,Z[U+2]+g)}}var q=new n;for(q.particles=P,q.numParticles=T,T=A.length,y=0;T>y;y++)m=A[y],m.autoDeriveNormals=!1,m.autoDeriveTangents=!1,m.updateIndices(x[y]),m.updatePositions(v[y]),m.updateVertexNormals(w[y]),m.updateVertexTangents(D[y]),m.updateUVs(C[y]),q.addSubGeometry(m);return q},t.MAX_VERTEX=65535,t}();e.ParticleGeometryHelper=o}(t.tools||(t.tools={})),t.tools}(away||(away={})),away.Debug.THROW_ERRORS=!1,away.Debug.LOG_PI_ERRORS=!1;var away;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.events.EventDispatcher);t.StageGLRenderer=e}(away||(away={})),function(){var t,e,i,n,r,s,a,o,h,p;p=void 0,a=void 0,h=void 0,r=[],s=function(){var i;i=e(.25,65535),p=n(240,180,0),a=t(400,400,400,i),p.scene.addChild(a),h=new away.utils.RequestAnimationFrame(o),h.start()},n=function(t,e,i){var n;return n=new away.render.DefaultRenderer,p=new away.containers.View(n),p.width=t,p.height=e,p.backgroundColor=i,p},t=function(t,e,i,n){var r,s;return r=away.materials.DefaultMaterialManager.getDefaultTexture(),s=new away.materials.TriangleMaterial(r),a=new away.prefabs.PrimitiveCubePrefab(t,e,i).getNewObject(),a.material=s,s.lightPicker=new away.materials.StaticLightPicker([n]),a},e=function(t,e){var i;return i=new away.entities.DirectionalLight,i.direction=new away.geom.Vector3D(0,-1,1),i.ambient=t,i.color=e,i},i=function(){var t;return t=new away.materials.TriangleMaterial},o=function(){return function(){a.rotationX=(a.rotationX+100)%360,a.rotationY=(a.rotationY+1)%360,p.render()}}(this),window.onload=s}.call(this);